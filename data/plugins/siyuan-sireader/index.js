"use strict";var Bl=Object.create;var Na=Object.defineProperty;var Al=Object.getOwnPropertyDescriptor;var Ml=Object.getOwnPropertyNames;var Nl=Object.getPrototypeOf,Il=Object.prototype.hasOwnProperty;var sl=an=>{throw TypeError(an)};var Dl=(an,on,sn)=>on in an?Na(an,on,{enumerable:!0,configurable:!0,writable:!0,value:sn}):an[on]=sn;var Rl=(an,on,sn,ln)=>{if(on&&typeof on=="object"||typeof on=="function")for(let cn of Ml(on))!Il.call(an,cn)&&cn!==sn&&Na(an,cn,{get:()=>on[cn],enumerable:!(ln=Al(on,cn))||ln.enumerable});return an};var Pl=(an,on,sn)=>(sn=an!=null?Bl(Nl(an)):{},Rl(on||!an||!an.__esModule?Na(sn,"default",{value:an,enumerable:!0}):sn,an));var ir=(an,on,sn)=>Dl(an,typeof on!="symbol"?on+"":on,sn),Ia=(an,on,sn)=>on.has(an)||sl("Cannot "+sn);var $n=(an,on,sn)=>(Ia(an,on,"read from private field"),sn?sn.call(an):on.get(an)),pr=(an,on,sn)=>on.has(an)?sl("Cannot add the same private member more than once"):on instanceof WeakSet?on.add(an):on.set(an,sn),yr=(an,on,sn,ln)=>(Ia(an,on,"write to private field"),ln?ln.call(an,sn):on.set(an,sn),sn),dr=(an,on,sn)=>(Ia(an,on,"access private method"),sn);var Ii=(an,on,sn,ln)=>({set _(cn){yr(an,on,cn,sn)},get _(){return $n(an,on,ln)}});const siyuan=require("siyuan");function _mergeNamespaces(an,on){for(var sn=0;sn<on.length;sn++){const ln=on[sn];if(typeof ln!="string"&&!Array.isArray(ln)){for(const cn in ln)if(cn!=="default"&&!(cn in an)){const un=Object.getOwnPropertyDescriptor(ln,cn);un&&Object.defineProperty(an,cn,un.get?un:{enumerable:!0,get:()=>ln[cn]})}}}return Object.freeze(Object.defineProperty(an,Symbol.toStringTag,{value:"Module"}))}const version$2="0.7.0",PluginInfoString={version:version$2};/**
* @vue/shared v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/function makeMap(an){const on=Object.create(null);for(const sn of an.split(","))on[sn]=1;return sn=>sn in on}const EMPTY_OBJ={},EMPTY_ARR=[],NOOP=()=>{},NO=()=>!1,isOn=an=>an.charCodeAt(0)===111&&an.charCodeAt(1)===110&&(an.charCodeAt(2)>122||an.charCodeAt(2)<97),isModelListener=an=>an.startsWith("onUpdate:"),extend=Object.assign,remove=(an,on)=>{const sn=an.indexOf(on);sn>-1&&an.splice(sn,1)},hasOwnProperty$1=Object.prototype.hasOwnProperty,hasOwn=(an,on)=>hasOwnProperty$1.call(an,on),isArray$1=Array.isArray,isMap=an=>toTypeString(an)==="[object Map]",isSet=an=>toTypeString(an)==="[object Set]",isDate=an=>toTypeString(an)==="[object Date]",isFunction=an=>typeof an=="function",isString$1=an=>typeof an=="string",isSymbol=an=>typeof an=="symbol",isObject$2=an=>an!==null&&typeof an=="object",isPromise=an=>(isObject$2(an)||isFunction(an))&&isFunction(an.then)&&isFunction(an.catch),objectToString=Object.prototype.toString,toTypeString=an=>objectToString.call(an),toRawType=an=>toTypeString(an).slice(8,-1),isPlainObject$1=an=>toTypeString(an)==="[object Object]",isIntegerKey=an=>isString$1(an)&&an!=="NaN"&&an[0]!=="-"&&""+parseInt(an,10)===an,isReservedProp=makeMap(",key,ref,ref_for,ref_key,onVnodeBeforeMount,onVnodeMounted,onVnodeBeforeUpdate,onVnodeUpdated,onVnodeBeforeUnmount,onVnodeUnmounted"),cacheStringFunction=an=>{const on=Object.create(null);return(sn=>on[sn]||(on[sn]=an(sn)))},camelizeRE=/-\w/g,camelize=cacheStringFunction(an=>an.replace(camelizeRE,on=>on.slice(1).toUpperCase())),hyphenateRE=/\B([A-Z])/g,hyphenate=cacheStringFunction(an=>an.replace(hyphenateRE,"-$1").toLowerCase()),capitalize=cacheStringFunction(an=>an.charAt(0).toUpperCase()+an.slice(1)),toHandlerKey=cacheStringFunction(an=>an?`on${capitalize(an)}`:""),hasChanged=(an,on)=>!Object.is(an,on),invokeArrayFns=(an,...on)=>{for(let sn=0;sn<an.length;sn++)an[sn](...on)},def=(an,on,sn,ln=!1)=>{Object.defineProperty(an,on,{configurable:!0,enumerable:!1,writable:ln,value:sn})},looseToNumber=an=>{const on=parseFloat(an);return isNaN(on)?an:on},toNumber=an=>{const on=isString$1(an)?Number(an):NaN;return isNaN(on)?an:on};let _globalThis;const getGlobalThis=()=>_globalThis||(_globalThis=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:typeof global<"u"?global:{});function normalizeStyle(an){if(isArray$1(an)){const on={};for(let sn=0;sn<an.length;sn++){const ln=an[sn],cn=isString$1(ln)?parseStringStyle(ln):normalizeStyle(ln);if(cn)for(const un in cn)on[un]=cn[un]}return on}else if(isString$1(an)||isObject$2(an))return an}const listDelimiterRE=/;(?![^(]*\))/g,propertyDelimiterRE=/:([^]+)/,styleCommentRE=/\/\*[^]*?\*\//g;function parseStringStyle(an){const on={};return an.replace(styleCommentRE,"").split(listDelimiterRE).forEach(sn=>{if(sn){const ln=sn.split(propertyDelimiterRE);ln.length>1&&(on[ln[0].trim()]=ln[1].trim())}}),on}function normalizeClass(an){let on="";if(isString$1(an))on=an;else if(isArray$1(an))for(let sn=0;sn<an.length;sn++){const ln=normalizeClass(an[sn]);ln&&(on+=ln+" ")}else if(isObject$2(an))for(const sn in an)an[sn]&&(on+=sn+" ");return on.trim()}const specialBooleanAttrs="itemscope,allowfullscreen,formnovalidate,ismap,nomodule,novalidate,readonly",isSpecialBooleanAttr=makeMap(specialBooleanAttrs);function includeBooleanAttr(an){return!!an||an===""}function looseCompareArrays(an,on){if(an.length!==on.length)return!1;let sn=!0;for(let ln=0;sn&&ln<an.length;ln++)sn=looseEqual(an[ln],on[ln]);return sn}function looseEqual(an,on){if(an===on)return!0;let sn=isDate(an),ln=isDate(on);if(sn||ln)return sn&&ln?an.getTime()===on.getTime():!1;if(sn=isSymbol(an),ln=isSymbol(on),sn||ln)return an===on;if(sn=isArray$1(an),ln=isArray$1(on),sn||ln)return sn&&ln?looseCompareArrays(an,on):!1;if(sn=isObject$2(an),ln=isObject$2(on),sn||ln){if(!sn||!ln)return!1;const cn=Object.keys(an).length,un=Object.keys(on).length;if(cn!==un)return!1;for(const dn in an){const hn=an.hasOwnProperty(dn),fn=on.hasOwnProperty(dn);if(hn&&!fn||!hn&&fn||!looseEqual(an[dn],on[dn]))return!1}}return String(an)===String(on)}function looseIndexOf(an,on){return an.findIndex(sn=>looseEqual(sn,on))}const isRef$1=an=>!!(an&&an.__v_isRef===!0),toDisplayString=an=>isString$1(an)?an:an==null?"":isArray$1(an)||isObject$2(an)&&(an.toString===objectToString||!isFunction(an.toString))?isRef$1(an)?toDisplayString(an.value):JSON.stringify(an,replacer,2):String(an),replacer=(an,on)=>isRef$1(on)?replacer(an,on.value):isMap(on)?{[`Map(${on.size})`]:[...on.entries()].reduce((sn,[ln,cn],un)=>(sn[stringifySymbol(ln,un)+" =>"]=cn,sn),{})}:isSet(on)?{[`Set(${on.size})`]:[...on.values()].map(sn=>stringifySymbol(sn))}:isSymbol(on)?stringifySymbol(on):isObject$2(on)&&!isArray$1(on)&&!isPlainObject$1(on)?String(on):on,stringifySymbol=(an,on="")=>{var sn;return isSymbol(an)?`Symbol(${(sn=an.description)!=null?sn:on})`:an};/**
* @vue/reactivity v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let activeEffectScope;class EffectScope{constructor(on=!1){this.detached=on,this._active=!0,this._on=0,this.effects=[],this.cleanups=[],this._isPaused=!1,this.parent=activeEffectScope,!on&&activeEffectScope&&(this.index=(activeEffectScope.scopes||(activeEffectScope.scopes=[])).push(this)-1)}get active(){return this._active}pause(){if(this._active){this._isPaused=!0;let on,sn;if(this.scopes)for(on=0,sn=this.scopes.length;on<sn;on++)this.scopes[on].pause();for(on=0,sn=this.effects.length;on<sn;on++)this.effects[on].pause()}}resume(){if(this._active&&this._isPaused){this._isPaused=!1;let on,sn;if(this.scopes)for(on=0,sn=this.scopes.length;on<sn;on++)this.scopes[on].resume();for(on=0,sn=this.effects.length;on<sn;on++)this.effects[on].resume()}}run(on){if(this._active){const sn=activeEffectScope;try{return activeEffectScope=this,on()}finally{activeEffectScope=sn}}}on(){++this._on===1&&(this.prevScope=activeEffectScope,activeEffectScope=this)}off(){this._on>0&&--this._on===0&&(activeEffectScope=this.prevScope,this.prevScope=void 0)}stop(on){if(this._active){this._active=!1;let sn,ln;for(sn=0,ln=this.effects.length;sn<ln;sn++)this.effects[sn].stop();for(this.effects.length=0,sn=0,ln=this.cleanups.length;sn<ln;sn++)this.cleanups[sn]();if(this.cleanups.length=0,this.scopes){for(sn=0,ln=this.scopes.length;sn<ln;sn++)this.scopes[sn].stop(!0);this.scopes.length=0}if(!this.detached&&this.parent&&!on){const cn=this.parent.scopes.pop();cn&&cn!==this&&(this.parent.scopes[this.index]=cn,cn.index=this.index)}this.parent=void 0}}}function getCurrentScope(){return activeEffectScope}function onScopeDispose(an,on=!1){activeEffectScope&&activeEffectScope.cleanups.push(an)}let activeSub;const pausedQueueEffects=new WeakSet;class ReactiveEffect{constructor(on){this.fn=on,this.deps=void 0,this.depsTail=void 0,this.flags=5,this.next=void 0,this.cleanup=void 0,this.scheduler=void 0,activeEffectScope&&activeEffectScope.active&&activeEffectScope.effects.push(this)}pause(){this.flags|=64}resume(){this.flags&64&&(this.flags&=-65,pausedQueueEffects.has(this)&&(pausedQueueEffects.delete(this),this.trigger()))}notify(){this.flags&2&&!(this.flags&32)||this.flags&8||batch(this)}run(){if(!(this.flags&1))return this.fn();this.flags|=2,cleanupEffect(this),prepareDeps(this);const on=activeSub,sn=shouldTrack;activeSub=this,shouldTrack=!0;try{return this.fn()}finally{cleanupDeps(this),activeSub=on,shouldTrack=sn,this.flags&=-3}}stop(){if(this.flags&1){for(let on=this.deps;on;on=on.nextDep)removeSub(on);this.deps=this.depsTail=void 0,cleanupEffect(this),this.onStop&&this.onStop(),this.flags&=-2}}trigger(){this.flags&64?pausedQueueEffects.add(this):this.scheduler?this.scheduler():this.runIfDirty()}runIfDirty(){isDirty(this)&&this.run()}get dirty(){return isDirty(this)}}let batchDepth=0,batchedSub,batchedComputed;function batch(an,on=!1){if(an.flags|=8,on){an.next=batchedComputed,batchedComputed=an;return}an.next=batchedSub,batchedSub=an}function startBatch(){batchDepth++}function endBatch(){if(--batchDepth>0)return;if(batchedComputed){let on=batchedComputed;for(batchedComputed=void 0;on;){const sn=on.next;on.next=void 0,on.flags&=-9,on=sn}}let an;for(;batchedSub;){let on=batchedSub;for(batchedSub=void 0;on;){const sn=on.next;if(on.next=void 0,on.flags&=-9,on.flags&1)try{on.trigger()}catch(ln){an||(an=ln)}on=sn}}if(an)throw an}function prepareDeps(an){for(let on=an.deps;on;on=on.nextDep)on.version=-1,on.prevActiveLink=on.dep.activeLink,on.dep.activeLink=on}function cleanupDeps(an){let on,sn=an.depsTail,ln=sn;for(;ln;){const cn=ln.prevDep;ln.version===-1?(ln===sn&&(sn=cn),removeSub(ln),removeDep(ln)):on=ln,ln.dep.activeLink=ln.prevActiveLink,ln.prevActiveLink=void 0,ln=cn}an.deps=on,an.depsTail=sn}function isDirty(an){for(let on=an.deps;on;on=on.nextDep)if(on.dep.version!==on.version||on.dep.computed&&(refreshComputed(on.dep.computed)||on.dep.version!==on.version))return!0;return!!an._dirty}function refreshComputed(an){if(an.flags&4&&!(an.flags&16)||(an.flags&=-17,an.globalVersion===globalVersion)||(an.globalVersion=globalVersion,!an.isSSR&&an.flags&128&&(!an.deps&&!an._dirty||!isDirty(an))))return;an.flags|=2;const on=an.dep,sn=activeSub,ln=shouldTrack;activeSub=an,shouldTrack=!0;try{prepareDeps(an);const cn=an.fn(an._value);(on.version===0||hasChanged(cn,an._value))&&(an.flags|=128,an._value=cn,on.version++)}catch(cn){throw on.version++,cn}finally{activeSub=sn,shouldTrack=ln,cleanupDeps(an),an.flags&=-3}}function removeSub(an,on=!1){const{dep:sn,prevSub:ln,nextSub:cn}=an;if(ln&&(ln.nextSub=cn,an.prevSub=void 0),cn&&(cn.prevSub=ln,an.nextSub=void 0),sn.subs===an&&(sn.subs=ln,!ln&&sn.computed)){sn.computed.flags&=-5;for(let un=sn.computed.deps;un;un=un.nextDep)removeSub(un,!0)}!on&&!--sn.sc&&sn.map&&sn.map.delete(sn.key)}function removeDep(an){const{prevDep:on,nextDep:sn}=an;on&&(on.nextDep=sn,an.prevDep=void 0),sn&&(sn.prevDep=on,an.nextDep=void 0)}let shouldTrack=!0;const trackStack=[];function pauseTracking(){trackStack.push(shouldTrack),shouldTrack=!1}function resetTracking(){const an=trackStack.pop();shouldTrack=an===void 0?!0:an}function cleanupEffect(an){const{cleanup:on}=an;if(an.cleanup=void 0,on){const sn=activeSub;activeSub=void 0;try{on()}finally{activeSub=sn}}}let globalVersion=0;class Link{constructor(on,sn){this.sub=on,this.dep=sn,this.version=sn.version,this.nextDep=this.prevDep=this.nextSub=this.prevSub=this.prevActiveLink=void 0}}class Dep{constructor(on){this.computed=on,this.version=0,this.activeLink=void 0,this.subs=void 0,this.map=void 0,this.key=void 0,this.sc=0,this.__v_skip=!0}track(on){if(!activeSub||!shouldTrack||activeSub===this.computed)return;let sn=this.activeLink;if(sn===void 0||sn.sub!==activeSub)sn=this.activeLink=new Link(activeSub,this),activeSub.deps?(sn.prevDep=activeSub.depsTail,activeSub.depsTail.nextDep=sn,activeSub.depsTail=sn):activeSub.deps=activeSub.depsTail=sn,addSub(sn);else if(sn.version===-1&&(sn.version=this.version,sn.nextDep)){const ln=sn.nextDep;ln.prevDep=sn.prevDep,sn.prevDep&&(sn.prevDep.nextDep=ln),sn.prevDep=activeSub.depsTail,sn.nextDep=void 0,activeSub.depsTail.nextDep=sn,activeSub.depsTail=sn,activeSub.deps===sn&&(activeSub.deps=ln)}return sn}trigger(on){this.version++,globalVersion++,this.notify(on)}notify(on){startBatch();try{for(let sn=this.subs;sn;sn=sn.prevSub)sn.sub.notify()&&sn.sub.dep.notify()}finally{endBatch()}}}function addSub(an){if(an.dep.sc++,an.sub.flags&4){const on=an.dep.computed;if(on&&!an.dep.subs){on.flags|=20;for(let ln=on.deps;ln;ln=ln.nextDep)addSub(ln)}const sn=an.dep.subs;sn!==an&&(an.prevSub=sn,sn&&(sn.nextSub=an)),an.dep.subs=an}}const targetMap=new WeakMap,ITERATE_KEY=Symbol(""),MAP_KEY_ITERATE_KEY=Symbol(""),ARRAY_ITERATE_KEY=Symbol("");function track(an,on,sn){if(shouldTrack&&activeSub){let ln=targetMap.get(an);ln||targetMap.set(an,ln=new Map);let cn=ln.get(sn);cn||(ln.set(sn,cn=new Dep),cn.map=ln,cn.key=sn),cn.track()}}function trigger(an,on,sn,ln,cn,un){const dn=targetMap.get(an);if(!dn){globalVersion++;return}const hn=fn=>{fn&&fn.trigger()};if(startBatch(),on==="clear")dn.forEach(hn);else{const fn=isArray$1(an),pn=fn&&isIntegerKey(sn);if(fn&&sn==="length"){const gn=Number(ln);dn.forEach((mn,bn)=>{(bn==="length"||bn===ARRAY_ITERATE_KEY||!isSymbol(bn)&&bn>=gn)&&hn(mn)})}else switch((sn!==void 0||dn.has(void 0))&&hn(dn.get(sn)),pn&&hn(dn.get(ARRAY_ITERATE_KEY)),on){case"add":fn?pn&&hn(dn.get("length")):(hn(dn.get(ITERATE_KEY)),isMap(an)&&hn(dn.get(MAP_KEY_ITERATE_KEY)));break;case"delete":fn||(hn(dn.get(ITERATE_KEY)),isMap(an)&&hn(dn.get(MAP_KEY_ITERATE_KEY)));break;case"set":isMap(an)&&hn(dn.get(ITERATE_KEY));break}}endBatch()}function reactiveReadArray(an){const on=toRaw(an);return on===an?on:(track(on,"iterate",ARRAY_ITERATE_KEY),isShallow(an)?on:on.map(toReactive))}function shallowReadArray(an){return track(an=toRaw(an),"iterate",ARRAY_ITERATE_KEY),an}const arrayInstrumentations={__proto__:null,[Symbol.iterator](){return iterator(this,Symbol.iterator,toReactive)},concat(...an){return reactiveReadArray(this).concat(...an.map(on=>isArray$1(on)?reactiveReadArray(on):on))},entries(){return iterator(this,"entries",an=>(an[1]=toReactive(an[1]),an))},every(an,on){return apply(this,"every",an,on,void 0,arguments)},filter(an,on){return apply(this,"filter",an,on,sn=>sn.map(toReactive),arguments)},find(an,on){return apply(this,"find",an,on,toReactive,arguments)},findIndex(an,on){return apply(this,"findIndex",an,on,void 0,arguments)},findLast(an,on){return apply(this,"findLast",an,on,toReactive,arguments)},findLastIndex(an,on){return apply(this,"findLastIndex",an,on,void 0,arguments)},forEach(an,on){return apply(this,"forEach",an,on,void 0,arguments)},includes(...an){return searchProxy(this,"includes",an)},indexOf(...an){return searchProxy(this,"indexOf",an)},join(an){return reactiveReadArray(this).join(an)},lastIndexOf(...an){return searchProxy(this,"lastIndexOf",an)},map(an,on){return apply(this,"map",an,on,void 0,arguments)},pop(){return noTracking(this,"pop")},push(...an){return noTracking(this,"push",an)},reduce(an,...on){return reduce(this,"reduce",an,on)},reduceRight(an,...on){return reduce(this,"reduceRight",an,on)},shift(){return noTracking(this,"shift")},some(an,on){return apply(this,"some",an,on,void 0,arguments)},splice(...an){return noTracking(this,"splice",an)},toReversed(){return reactiveReadArray(this).toReversed()},toSorted(an){return reactiveReadArray(this).toSorted(an)},toSpliced(...an){return reactiveReadArray(this).toSpliced(...an)},unshift(...an){return noTracking(this,"unshift",an)},values(){return iterator(this,"values",toReactive)}};function iterator(an,on,sn){const ln=shallowReadArray(an),cn=ln[on]();return ln!==an&&!isShallow(an)&&(cn._next=cn.next,cn.next=()=>{const un=cn._next();return un.done||(un.value=sn(un.value)),un}),cn}const arrayProto=Array.prototype;function apply(an,on,sn,ln,cn,un){const dn=shallowReadArray(an),hn=dn!==an&&!isShallow(an),fn=dn[on];if(fn!==arrayProto[on]){const mn=fn.apply(an,un);return hn?toReactive(mn):mn}let pn=sn;dn!==an&&(hn?pn=function(mn,bn){return sn.call(this,toReactive(mn),bn,an)}:sn.length>2&&(pn=function(mn,bn){return sn.call(this,mn,bn,an)}));const gn=fn.call(dn,pn,ln);return hn&&cn?cn(gn):gn}function reduce(an,on,sn,ln){const cn=shallowReadArray(an);let un=sn;return cn!==an&&(isShallow(an)?sn.length>3&&(un=function(dn,hn,fn){return sn.call(this,dn,hn,fn,an)}):un=function(dn,hn,fn){return sn.call(this,dn,toReactive(hn),fn,an)}),cn[on](un,...ln)}function searchProxy(an,on,sn){const ln=toRaw(an);track(ln,"iterate",ARRAY_ITERATE_KEY);const cn=ln[on](...sn);return(cn===-1||cn===!1)&&isProxy(sn[0])?(sn[0]=toRaw(sn[0]),ln[on](...sn)):cn}function noTracking(an,on,sn=[]){pauseTracking(),startBatch();const ln=toRaw(an)[on].apply(an,sn);return endBatch(),resetTracking(),ln}const isNonTrackableKeys=makeMap("__proto__,__v_isRef,__isVue"),builtInSymbols=new Set(Object.getOwnPropertyNames(Symbol).filter(an=>an!=="arguments"&&an!=="caller").map(an=>Symbol[an]).filter(isSymbol));function hasOwnProperty(an){isSymbol(an)||(an=String(an));const on=toRaw(this);return track(on,"has",an),on.hasOwnProperty(an)}class BaseReactiveHandler{constructor(on=!1,sn=!1){this._isReadonly=on,this._isShallow=sn}get(on,sn,ln){if(sn==="__v_skip")return on.__v_skip;const cn=this._isReadonly,un=this._isShallow;if(sn==="__v_isReactive")return!cn;if(sn==="__v_isReadonly")return cn;if(sn==="__v_isShallow")return un;if(sn==="__v_raw")return ln===(cn?un?shallowReadonlyMap:readonlyMap:un?shallowReactiveMap:reactiveMap).get(on)||Object.getPrototypeOf(on)===Object.getPrototypeOf(ln)?on:void 0;const dn=isArray$1(on);if(!cn){let fn;if(dn&&(fn=arrayInstrumentations[sn]))return fn;if(sn==="hasOwnProperty")return hasOwnProperty}const hn=Reflect.get(on,sn,isRef(on)?on:ln);if((isSymbol(sn)?builtInSymbols.has(sn):isNonTrackableKeys(sn))||(cn||track(on,"get",sn),un))return hn;if(isRef(hn)){const fn=dn&&isIntegerKey(sn)?hn:hn.value;return cn&&isObject$2(fn)?readonly(fn):fn}return isObject$2(hn)?cn?readonly(hn):reactive(hn):hn}}class MutableReactiveHandler extends BaseReactiveHandler{constructor(on=!1){super(!1,on)}set(on,sn,ln,cn){let un=on[sn];if(!this._isShallow){const fn=isReadonly(un);if(!isShallow(ln)&&!isReadonly(ln)&&(un=toRaw(un),ln=toRaw(ln)),!isArray$1(on)&&isRef(un)&&!isRef(ln))return fn||(un.value=ln),!0}const dn=isArray$1(on)&&isIntegerKey(sn)?Number(sn)<on.length:hasOwn(on,sn),hn=Reflect.set(on,sn,ln,isRef(on)?on:cn);return on===toRaw(cn)&&(dn?hasChanged(ln,un)&&trigger(on,"set",sn,ln):trigger(on,"add",sn,ln)),hn}deleteProperty(on,sn){const ln=hasOwn(on,sn);on[sn];const cn=Reflect.deleteProperty(on,sn);return cn&&ln&&trigger(on,"delete",sn,void 0),cn}has(on,sn){const ln=Reflect.has(on,sn);return(!isSymbol(sn)||!builtInSymbols.has(sn))&&track(on,"has",sn),ln}ownKeys(on){return track(on,"iterate",isArray$1(on)?"length":ITERATE_KEY),Reflect.ownKeys(on)}}class ReadonlyReactiveHandler extends BaseReactiveHandler{constructor(on=!1){super(!0,on)}set(on,sn){return!0}deleteProperty(on,sn){return!0}}const mutableHandlers=new MutableReactiveHandler,readonlyHandlers=new ReadonlyReactiveHandler,shallowReactiveHandlers=new MutableReactiveHandler(!0),shallowReadonlyHandlers=new ReadonlyReactiveHandler(!0),toShallow=an=>an,getProto=an=>Reflect.getPrototypeOf(an);function createIterableMethod(an,on,sn){return function(...ln){const cn=this.__v_raw,un=toRaw(cn),dn=isMap(un),hn=an==="entries"||an===Symbol.iterator&&dn,fn=an==="keys"&&dn,pn=cn[an](...ln),gn=sn?toShallow:on?toReadonly:toReactive;return!on&&track(un,"iterate",fn?MAP_KEY_ITERATE_KEY:ITERATE_KEY),{next(){const{value:mn,done:bn}=pn.next();return bn?{value:mn,done:bn}:{value:hn?[gn(mn[0]),gn(mn[1])]:gn(mn),done:bn}},[Symbol.iterator](){return this}}}}function createReadonlyMethod(an){return function(...on){return an==="delete"?!1:an==="clear"?void 0:this}}function createInstrumentations(an,on){const sn={get(cn){const un=this.__v_raw,dn=toRaw(un),hn=toRaw(cn);an||(hasChanged(cn,hn)&&track(dn,"get",cn),track(dn,"get",hn));const{has:fn}=getProto(dn),pn=on?toShallow:an?toReadonly:toReactive;if(fn.call(dn,cn))return pn(un.get(cn));if(fn.call(dn,hn))return pn(un.get(hn));un!==dn&&un.get(cn)},get size(){const cn=this.__v_raw;return!an&&track(toRaw(cn),"iterate",ITERATE_KEY),cn.size},has(cn){const un=this.__v_raw,dn=toRaw(un),hn=toRaw(cn);return an||(hasChanged(cn,hn)&&track(dn,"has",cn),track(dn,"has",hn)),cn===hn?un.has(cn):un.has(cn)||un.has(hn)},forEach(cn,un){const dn=this,hn=dn.__v_raw,fn=toRaw(hn),pn=on?toShallow:an?toReadonly:toReactive;return!an&&track(fn,"iterate",ITERATE_KEY),hn.forEach((gn,mn)=>cn.call(un,pn(gn),pn(mn),dn))}};return extend(sn,an?{add:createReadonlyMethod("add"),set:createReadonlyMethod("set"),delete:createReadonlyMethod("delete"),clear:createReadonlyMethod("clear")}:{add(cn){!on&&!isShallow(cn)&&!isReadonly(cn)&&(cn=toRaw(cn));const un=toRaw(this);return getProto(un).has.call(un,cn)||(un.add(cn),trigger(un,"add",cn,cn)),this},set(cn,un){!on&&!isShallow(un)&&!isReadonly(un)&&(un=toRaw(un));const dn=toRaw(this),{has:hn,get:fn}=getProto(dn);let pn=hn.call(dn,cn);pn||(cn=toRaw(cn),pn=hn.call(dn,cn));const gn=fn.call(dn,cn);return dn.set(cn,un),pn?hasChanged(un,gn)&&trigger(dn,"set",cn,un):trigger(dn,"add",cn,un),this},delete(cn){const un=toRaw(this),{has:dn,get:hn}=getProto(un);let fn=dn.call(un,cn);fn||(cn=toRaw(cn),fn=dn.call(un,cn)),hn&&hn.call(un,cn);const pn=un.delete(cn);return fn&&trigger(un,"delete",cn,void 0),pn},clear(){const cn=toRaw(this),un=cn.size!==0,dn=cn.clear();return un&&trigger(cn,"clear",void 0,void 0),dn}}),["keys","values","entries",Symbol.iterator].forEach(cn=>{sn[cn]=createIterableMethod(cn,an,on)}),sn}function createInstrumentationGetter(an,on){const sn=createInstrumentations(an,on);return(ln,cn,un)=>cn==="__v_isReactive"?!an:cn==="__v_isReadonly"?an:cn==="__v_raw"?ln:Reflect.get(hasOwn(sn,cn)&&cn in ln?sn:ln,cn,un)}const mutableCollectionHandlers={get:createInstrumentationGetter(!1,!1)},shallowCollectionHandlers={get:createInstrumentationGetter(!1,!0)},readonlyCollectionHandlers={get:createInstrumentationGetter(!0,!1)},shallowReadonlyCollectionHandlers={get:createInstrumentationGetter(!0,!0)},reactiveMap=new WeakMap,shallowReactiveMap=new WeakMap,readonlyMap=new WeakMap,shallowReadonlyMap=new WeakMap;function targetTypeMap(an){switch(an){case"Object":case"Array":return 1;case"Map":case"Set":case"WeakMap":case"WeakSet":return 2;default:return 0}}function getTargetType(an){return an.__v_skip||!Object.isExtensible(an)?0:targetTypeMap(toRawType(an))}function reactive(an){return isReadonly(an)?an:createReactiveObject(an,!1,mutableHandlers,mutableCollectionHandlers,reactiveMap)}function shallowReactive(an){return createReactiveObject(an,!1,shallowReactiveHandlers,shallowCollectionHandlers,shallowReactiveMap)}function readonly(an){return createReactiveObject(an,!0,readonlyHandlers,readonlyCollectionHandlers,readonlyMap)}function shallowReadonly(an){return createReactiveObject(an,!0,shallowReadonlyHandlers,shallowReadonlyCollectionHandlers,shallowReadonlyMap)}function createReactiveObject(an,on,sn,ln,cn){if(!isObject$2(an)||an.__v_raw&&!(on&&an.__v_isReactive))return an;const un=getTargetType(an);if(un===0)return an;const dn=cn.get(an);if(dn)return dn;const hn=new Proxy(an,un===2?ln:sn);return cn.set(an,hn),hn}function isReactive(an){return isReadonly(an)?isReactive(an.__v_raw):!!(an&&an.__v_isReactive)}function isReadonly(an){return!!(an&&an.__v_isReadonly)}function isShallow(an){return!!(an&&an.__v_isShallow)}function isProxy(an){return an?!!an.__v_raw:!1}function toRaw(an){const on=an&&an.__v_raw;return on?toRaw(on):an}function markRaw(an){return!hasOwn(an,"__v_skip")&&Object.isExtensible(an)&&def(an,"__v_skip",!0),an}const toReactive=an=>isObject$2(an)?reactive(an):an,toReadonly=an=>isObject$2(an)?readonly(an):an;function isRef(an){return an?an.__v_isRef===!0:!1}function ref(an){return createRef(an,!1)}function shallowRef(an){return createRef(an,!0)}function createRef(an,on){return isRef(an)?an:new RefImpl(an,on)}class RefImpl{constructor(on,sn){this.dep=new Dep,this.__v_isRef=!0,this.__v_isShallow=!1,this._rawValue=sn?on:toRaw(on),this._value=sn?on:toReactive(on),this.__v_isShallow=sn}get value(){return this.dep.track(),this._value}set value(on){const sn=this._rawValue,ln=this.__v_isShallow||isShallow(on)||isReadonly(on);on=ln?on:toRaw(on),hasChanged(on,sn)&&(this._rawValue=on,this._value=ln?on:toReactive(on),this.dep.trigger())}}function unref(an){return isRef(an)?an.value:an}function toValue(an){return isFunction(an)?an():unref(an)}const shallowUnwrapHandlers={get:(an,on,sn)=>on==="__v_raw"?an:unref(Reflect.get(an,on,sn)),set:(an,on,sn,ln)=>{const cn=an[on];return isRef(cn)&&!isRef(sn)?(cn.value=sn,!0):Reflect.set(an,on,sn,ln)}};function proxyRefs(an){return isReactive(an)?an:new Proxy(an,shallowUnwrapHandlers)}class ComputedRefImpl{constructor(on,sn,ln){this.fn=on,this.setter=sn,this._value=void 0,this.dep=new Dep(this),this.__v_isRef=!0,this.deps=void 0,this.depsTail=void 0,this.flags=16,this.globalVersion=globalVersion-1,this.next=void 0,this.effect=this,this.__v_isReadonly=!sn,this.isSSR=ln}notify(){if(this.flags|=16,!(this.flags&8)&&activeSub!==this)return batch(this,!0),!0}get value(){const on=this.dep.track();return refreshComputed(this),on&&(on.version=this.dep.version),this._value}set value(on){this.setter&&this.setter(on)}}function computed$1(an,on,sn=!1){let ln,cn;return isFunction(an)?ln=an:(ln=an.get,cn=an.set),new ComputedRefImpl(ln,cn,sn)}const INITIAL_WATCHER_VALUE={},cleanupMap=new WeakMap;let activeWatcher;function onWatcherCleanup(an,on=!1,sn=activeWatcher){if(sn){let ln=cleanupMap.get(sn);ln||cleanupMap.set(sn,ln=[]),ln.push(an)}}function watch$1(an,on,sn=EMPTY_OBJ){const{immediate:ln,deep:cn,once:un,scheduler:dn,augmentJob:hn,call:fn}=sn,pn=Tn=>cn?Tn:isShallow(Tn)||cn===!1||cn===0?traverse(Tn,1):traverse(Tn);let gn,mn,bn,vn,yn=!1,wn=!1;if(isRef(an)?(mn=()=>an.value,yn=isShallow(an)):isReactive(an)?(mn=()=>pn(an),yn=!0):isArray$1(an)?(wn=!0,yn=an.some(Tn=>isReactive(Tn)||isShallow(Tn)),mn=()=>an.map(Tn=>{if(isRef(Tn))return Tn.value;if(isReactive(Tn))return pn(Tn);if(isFunction(Tn))return fn?fn(Tn,2):Tn()})):isFunction(an)?on?mn=fn?()=>fn(an,2):an:mn=()=>{if(bn){pauseTracking();try{bn()}finally{resetTracking()}}const Tn=activeWatcher;activeWatcher=gn;try{return fn?fn(an,3,[vn]):an(vn)}finally{activeWatcher=Tn}}:mn=NOOP,on&&cn){const Tn=mn,Bn=cn===!0?1/0:cn;mn=()=>traverse(Tn(),Bn)}const kn=getCurrentScope(),_n=()=>{gn.stop(),kn&&kn.active&&remove(kn.effects,gn)};if(un&&on){const Tn=on;on=(...Bn)=>{Tn(...Bn),_n()}}let xn=wn?new Array(an.length).fill(INITIAL_WATCHER_VALUE):INITIAL_WATCHER_VALUE;const En=Tn=>{if(!(!(gn.flags&1)||!gn.dirty&&!Tn))if(on){const Bn=gn.run();if(cn||yn||(wn?Bn.some((Nn,Mn)=>hasChanged(Nn,xn[Mn])):hasChanged(Bn,xn))){bn&&bn();const Nn=activeWatcher;activeWatcher=gn;try{const Mn=[Bn,xn===INITIAL_WATCHER_VALUE?void 0:wn&&xn[0]===INITIAL_WATCHER_VALUE?[]:xn,vn];xn=Bn,fn?fn(on,3,Mn):on(...Mn)}finally{activeWatcher=Nn}}}else gn.run()};return hn&&hn(En),gn=new ReactiveEffect(mn),gn.scheduler=dn?()=>dn(En,!1):En,vn=Tn=>onWatcherCleanup(Tn,!1,gn),bn=gn.onStop=()=>{const Tn=cleanupMap.get(gn);if(Tn){if(fn)fn(Tn,4);else for(const Bn of Tn)Bn();cleanupMap.delete(gn)}},on?ln?En(!0):xn=gn.run():dn?dn(En.bind(null,!0),!0):gn.run(),_n.pause=gn.pause.bind(gn),_n.resume=gn.resume.bind(gn),_n.stop=_n,_n}function traverse(an,on=1/0,sn){if(on<=0||!isObject$2(an)||an.__v_skip||(sn=sn||new Map,(sn.get(an)||0)>=on))return an;if(sn.set(an,on),on--,isRef(an))traverse(an.value,on,sn);else if(isArray$1(an))for(let ln=0;ln<an.length;ln++)traverse(an[ln],on,sn);else if(isSet(an)||isMap(an))an.forEach(ln=>{traverse(ln,on,sn)});else if(isPlainObject$1(an)){for(const ln in an)traverse(an[ln],on,sn);for(const ln of Object.getOwnPropertySymbols(an))Object.prototype.propertyIsEnumerable.call(an,ln)&&traverse(an[ln],on,sn)}return an}/**
* @vue/runtime-core v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const stack=[];let isWarning=!1;function warn$1(an,...on){if(isWarning)return;isWarning=!0,pauseTracking();const sn=stack.length?stack[stack.length-1].component:null,ln=sn&&sn.appContext.config.warnHandler,cn=getComponentTrace();if(ln)callWithErrorHandling(ln,sn,11,[an+on.map(un=>{var dn,hn;return(hn=(dn=un.toString)==null?void 0:dn.call(un))!=null?hn:JSON.stringify(un)}).join(""),sn&&sn.proxy,cn.map(({vnode:un})=>`at <${formatComponentName(sn,un.type)}>`).join(`
`),cn]);else{const un=[`[Vue warn]: ${an}`,...on];cn.length&&un.push(`
`,...formatTrace(cn)),console.warn(...un)}resetTracking(),isWarning=!1}function getComponentTrace(){let an=stack[stack.length-1];if(!an)return[];const on=[];for(;an;){const sn=on[0];sn&&sn.vnode===an?sn.recurseCount++:on.push({vnode:an,recurseCount:0});const ln=an.component&&an.component.parent;an=ln&&ln.vnode}return on}function formatTrace(an){const on=[];return an.forEach((sn,ln)=>{on.push(...ln===0?[]:[`
`],...formatTraceEntry(sn))}),on}function formatTraceEntry({vnode:an,recurseCount:on}){const sn=on>0?`... (${on} recursive calls)`:"",ln=an.component?an.component.parent==null:!1,cn=` at <${formatComponentName(an.component,an.type,ln)}`,un=">"+sn;return an.props?[cn,...formatProps(an.props),un]:[cn+un]}function formatProps(an){const on=[],sn=Object.keys(an);return sn.slice(0,3).forEach(ln=>{on.push(...formatProp(ln,an[ln]))}),sn.length>3&&on.push(" ..."),on}function formatProp(an,on,sn){return isString$1(on)?(on=JSON.stringify(on),sn?on:[`${an}=${on}`]):typeof on=="number"||typeof on=="boolean"||on==null?sn?on:[`${an}=${on}`]:isRef(on)?(on=formatProp(an,toRaw(on.value),!0),sn?on:[`${an}=Ref<`,on,">"]):isFunction(on)?[`${an}=fn${on.name?`<${on.name}>`:""}`]:(on=toRaw(on),sn?on:[`${an}=`,on])}function callWithErrorHandling(an,on,sn,ln){try{return ln?an(...ln):an()}catch(cn){handleError(cn,on,sn)}}function callWithAsyncErrorHandling(an,on,sn,ln){if(isFunction(an)){const cn=callWithErrorHandling(an,on,sn,ln);return cn&&isPromise(cn)&&cn.catch(un=>{handleError(un,on,sn)}),cn}if(isArray$1(an)){const cn=[];for(let un=0;un<an.length;un++)cn.push(callWithAsyncErrorHandling(an[un],on,sn,ln));return cn}}function handleError(an,on,sn,ln=!0){const cn=on?on.vnode:null,{errorHandler:un,throwUnhandledErrorInProduction:dn}=on&&on.appContext.config||EMPTY_OBJ;if(on){let hn=on.parent;const fn=on.proxy,pn=`https://vuejs.org/error-reference/#runtime-${sn}`;for(;hn;){const gn=hn.ec;if(gn){for(let mn=0;mn<gn.length;mn++)if(gn[mn](an,fn,pn)===!1)return}hn=hn.parent}if(un){pauseTracking(),callWithErrorHandling(un,null,10,[an,fn,pn]),resetTracking();return}}logError(an,sn,cn,ln,dn)}function logError(an,on,sn,ln=!0,cn=!1){if(cn)throw an;console.error(an)}const queue=[];let flushIndex=-1;const pendingPostFlushCbs=[];let activePostFlushCbs=null,postFlushIndex=0;const resolvedPromise=Promise.resolve();let currentFlushPromise=null;function nextTick(an){const on=currentFlushPromise||resolvedPromise;return an?on.then(this?an.bind(this):an):on}function findInsertionIndex(an){let on=flushIndex+1,sn=queue.length;for(;on<sn;){const ln=on+sn>>>1,cn=queue[ln],un=getId(cn);un<an||un===an&&cn.flags&2?on=ln+1:sn=ln}return on}function queueJob(an){if(!(an.flags&1)){const on=getId(an),sn=queue[queue.length-1];!sn||!(an.flags&2)&&on>=getId(sn)?queue.push(an):queue.splice(findInsertionIndex(on),0,an),an.flags|=1,queueFlush()}}function queueFlush(){currentFlushPromise||(currentFlushPromise=resolvedPromise.then(flushJobs))}function queuePostFlushCb(an){isArray$1(an)?pendingPostFlushCbs.push(...an):activePostFlushCbs&&an.id===-1?activePostFlushCbs.splice(postFlushIndex+1,0,an):an.flags&1||(pendingPostFlushCbs.push(an),an.flags|=1),queueFlush()}function flushPreFlushCbs(an,on,sn=flushIndex+1){for(;sn<queue.length;sn++){const ln=queue[sn];if(ln&&ln.flags&2){if(an&&ln.id!==an.uid)continue;queue.splice(sn,1),sn--,ln.flags&4&&(ln.flags&=-2),ln(),ln.flags&4||(ln.flags&=-2)}}}function flushPostFlushCbs(an){if(pendingPostFlushCbs.length){const on=[...new Set(pendingPostFlushCbs)].sort((sn,ln)=>getId(sn)-getId(ln));if(pendingPostFlushCbs.length=0,activePostFlushCbs){activePostFlushCbs.push(...on);return}for(activePostFlushCbs=on,postFlushIndex=0;postFlushIndex<activePostFlushCbs.length;postFlushIndex++){const sn=activePostFlushCbs[postFlushIndex];sn.flags&4&&(sn.flags&=-2),sn.flags&8||sn(),sn.flags&=-2}activePostFlushCbs=null,postFlushIndex=0}}const getId=an=>an.id==null?an.flags&2?-1:1/0:an.id;function flushJobs(an){try{for(flushIndex=0;flushIndex<queue.length;flushIndex++){const on=queue[flushIndex];on&&!(on.flags&8)&&(on.flags&4&&(on.flags&=-2),callWithErrorHandling(on,on.i,on.i?15:14),on.flags&4||(on.flags&=-2))}}finally{for(;flushIndex<queue.length;flushIndex++){const on=queue[flushIndex];on&&(on.flags&=-2)}flushIndex=-1,queue.length=0,flushPostFlushCbs(),currentFlushPromise=null,(queue.length||pendingPostFlushCbs.length)&&flushJobs()}}let currentRenderingInstance=null,currentScopeId=null;function setCurrentRenderingInstance(an){const on=currentRenderingInstance;return currentRenderingInstance=an,currentScopeId=an&&an.type.__scopeId||null,on}function withCtx(an,on=currentRenderingInstance,sn){if(!on||an._n)return an;const ln=(...cn)=>{ln._d&&setBlockTracking(-1);const un=setCurrentRenderingInstance(on);let dn;try{dn=an(...cn)}finally{setCurrentRenderingInstance(un),ln._d&&setBlockTracking(1)}return dn};return ln._n=!0,ln._c=!0,ln._d=!0,ln}function withDirectives(an,on){if(currentRenderingInstance===null)return an;const sn=getComponentPublicInstance(currentRenderingInstance),ln=an.dirs||(an.dirs=[]);for(let cn=0;cn<on.length;cn++){let[un,dn,hn,fn=EMPTY_OBJ]=on[cn];un&&(isFunction(un)&&(un={mounted:un,updated:un}),un.deep&&traverse(dn),ln.push({dir:un,instance:sn,value:dn,oldValue:void 0,arg:hn,modifiers:fn}))}return an}function invokeDirectiveHook(an,on,sn,ln){const cn=an.dirs,un=on&&on.dirs;for(let dn=0;dn<cn.length;dn++){const hn=cn[dn];un&&(hn.oldValue=un[dn].value);let fn=hn.dir[ln];fn&&(pauseTracking(),callWithAsyncErrorHandling(fn,sn,8,[an.el,hn,an,on]),resetTracking())}}const TeleportEndKey=Symbol("_vte"),isTeleport=an=>an.__isTeleport,isTeleportDisabled=an=>an&&(an.disabled||an.disabled===""),isTeleportDeferred=an=>an&&(an.defer||an.defer===""),isTargetSVG=an=>typeof SVGElement<"u"&&an instanceof SVGElement,isTargetMathML=an=>typeof MathMLElement=="function"&&an instanceof MathMLElement,resolveTarget=(an,on)=>{const sn=an&&an.to;return isString$1(sn)?on?on(sn):null:sn},TeleportImpl={name:"Teleport",__isTeleport:!0,process(an,on,sn,ln,cn,un,dn,hn,fn,pn){const{mc:gn,pc:mn,pbc:bn,o:{insert:vn,querySelector:yn,createText:wn,createComment:kn}}=pn,_n=isTeleportDisabled(on.props);let{shapeFlag:xn,children:En,dynamicChildren:Tn}=on;if(an==null){const Bn=on.el=wn(""),Nn=on.anchor=wn("");vn(Bn,sn,ln),vn(Nn,sn,ln);const Mn=(On,zn)=>{xn&16&&gn(En,On,zn,cn,un,dn,hn,fn)},Ln=()=>{const On=on.target=resolveTarget(on.props,yn),zn=prepareAnchor(On,on,wn,vn);On&&(dn!=="svg"&&isTargetSVG(On)?dn="svg":dn!=="mathml"&&isTargetMathML(On)&&(dn="mathml"),cn&&cn.isCE&&(cn.ce._teleportTargets||(cn.ce._teleportTargets=new Set)).add(On),_n||(Mn(On,zn),updateCssVars(on,!1)))};_n&&(Mn(sn,Nn),updateCssVars(on,!0)),isTeleportDeferred(on.props)?(on.el.__isMounted=!1,queuePostRenderEffect(()=>{Ln(),delete on.el.__isMounted},un)):Ln()}else{if(isTeleportDeferred(on.props)&&an.el.__isMounted===!1){queuePostRenderEffect(()=>{TeleportImpl.process(an,on,sn,ln,cn,un,dn,hn,fn,pn)},un);return}on.el=an.el,on.targetStart=an.targetStart;const Bn=on.anchor=an.anchor,Nn=on.target=an.target,Mn=on.targetAnchor=an.targetAnchor,Ln=isTeleportDisabled(an.props),On=Ln?sn:Nn,zn=Ln?Bn:Mn;if(dn==="svg"||isTargetSVG(Nn)?dn="svg":(dn==="mathml"||isTargetMathML(Nn))&&(dn="mathml"),Tn?(bn(an.dynamicChildren,Tn,On,cn,un,dn,hn),traverseStaticChildren(an,on,!0)):fn||mn(an,on,On,zn,cn,un,dn,hn,!1),_n)Ln?on.props&&an.props&&on.props.to!==an.props.to&&(on.props.to=an.props.to):moveTeleport(on,sn,Bn,pn,1);else if((on.props&&on.props.to)!==(an.props&&an.props.to)){const Pn=on.target=resolveTarget(on.props,yn);Pn&&moveTeleport(on,Pn,null,pn,0)}else Ln&&moveTeleport(on,Nn,Mn,pn,1);updateCssVars(on,_n)}},remove(an,on,sn,{um:ln,o:{remove:cn}},un){const{shapeFlag:dn,children:hn,anchor:fn,targetStart:pn,targetAnchor:gn,target:mn,props:bn}=an;if(mn&&(cn(pn),cn(gn)),un&&cn(fn),dn&16){const vn=un||!isTeleportDisabled(bn);for(let yn=0;yn<hn.length;yn++){const wn=hn[yn];ln(wn,on,sn,vn,!!wn.dynamicChildren)}}},move:moveTeleport,hydrate:hydrateTeleport};function moveTeleport(an,on,sn,{o:{insert:ln},m:cn},un=2){un===0&&ln(an.targetAnchor,on,sn);const{el:dn,anchor:hn,shapeFlag:fn,children:pn,props:gn}=an,mn=un===2;if(mn&&ln(dn,on,sn),(!mn||isTeleportDisabled(gn))&&fn&16)for(let bn=0;bn<pn.length;bn++)cn(pn[bn],on,sn,2);mn&&ln(hn,on,sn)}function hydrateTeleport(an,on,sn,ln,cn,un,{o:{nextSibling:dn,parentNode:hn,querySelector:fn,insert:pn,createText:gn}},mn){function bn(wn,kn,_n,xn){kn.anchor=mn(dn(wn),kn,hn(wn),sn,ln,cn,un),kn.targetStart=_n,kn.targetAnchor=xn}const vn=on.target=resolveTarget(on.props,fn),yn=isTeleportDisabled(on.props);if(vn){const wn=vn._lpa||vn.firstChild;if(on.shapeFlag&16)if(yn)bn(an,on,wn,wn&&dn(wn));else{on.anchor=dn(an);let kn=wn;for(;kn;){if(kn&&kn.nodeType===8){if(kn.data==="teleport start anchor")on.targetStart=kn;else if(kn.data==="teleport anchor"){on.targetAnchor=kn,vn._lpa=on.targetAnchor&&dn(on.targetAnchor);break}}kn=dn(kn)}on.targetAnchor||prepareAnchor(vn,on,gn,pn),mn(wn&&dn(wn),on,vn,sn,ln,cn,un)}updateCssVars(on,yn)}else yn&&on.shapeFlag&16&&bn(an,on,an,dn(an));return on.anchor&&dn(on.anchor)}const Teleport=TeleportImpl;function updateCssVars(an,on){const sn=an.ctx;if(sn&&sn.ut){let ln,cn;for(on?(ln=an.el,cn=an.anchor):(ln=an.targetStart,cn=an.targetAnchor);ln&&ln!==cn;)ln.nodeType===1&&ln.setAttribute("data-v-owner",sn.uid),ln=ln.nextSibling;sn.ut()}}function prepareAnchor(an,on,sn,ln){const cn=on.targetStart=sn(""),un=on.targetAnchor=sn("");return cn[TeleportEndKey]=un,an&&(ln(cn,an),ln(un,an)),un}const leaveCbKey=Symbol("_leaveCb"),enterCbKey=Symbol("_enterCb");function useTransitionState(){const an={isMounted:!1,isLeaving:!1,isUnmounting:!1,leavingVNodes:new Map};return onMounted(()=>{an.isMounted=!0}),onBeforeUnmount(()=>{an.isUnmounting=!0}),an}const TransitionHookValidator=[Function,Array],BaseTransitionPropsValidators={mode:String,appear:Boolean,persisted:Boolean,onBeforeEnter:TransitionHookValidator,onEnter:TransitionHookValidator,onAfterEnter:TransitionHookValidator,onEnterCancelled:TransitionHookValidator,onBeforeLeave:TransitionHookValidator,onLeave:TransitionHookValidator,onAfterLeave:TransitionHookValidator,onLeaveCancelled:TransitionHookValidator,onBeforeAppear:TransitionHookValidator,onAppear:TransitionHookValidator,onAfterAppear:TransitionHookValidator,onAppearCancelled:TransitionHookValidator},recursiveGetSubtree=an=>{const on=an.subTree;return on.component?recursiveGetSubtree(on.component):on},BaseTransitionImpl={name:"BaseTransition",props:BaseTransitionPropsValidators,setup(an,{slots:on}){const sn=getCurrentInstance(),ln=useTransitionState();return()=>{const cn=on.default&&getTransitionRawChildren(on.default(),!0);if(!cn||!cn.length)return;const un=findNonCommentChild(cn),dn=toRaw(an),{mode:hn}=dn;if(ln.isLeaving)return emptyPlaceholder(un);const fn=getInnerChild$1(un);if(!fn)return emptyPlaceholder(un);let pn=resolveTransitionHooks(fn,dn,ln,sn,mn=>pn=mn);fn.type!==Comment&&setTransitionHooks(fn,pn);let gn=sn.subTree&&getInnerChild$1(sn.subTree);if(gn&&gn.type!==Comment&&!isSameVNodeType(gn,fn)&&recursiveGetSubtree(sn).type!==Comment){let mn=resolveTransitionHooks(gn,dn,ln,sn);if(setTransitionHooks(gn,mn),hn==="out-in"&&fn.type!==Comment)return ln.isLeaving=!0,mn.afterLeave=()=>{ln.isLeaving=!1,sn.job.flags&8||sn.update(),delete mn.afterLeave,gn=void 0},emptyPlaceholder(un);hn==="in-out"&&fn.type!==Comment?mn.delayLeave=(bn,vn,yn)=>{const wn=getLeavingNodesForType(ln,gn);wn[String(gn.key)]=gn,bn[leaveCbKey]=()=>{vn(),bn[leaveCbKey]=void 0,delete pn.delayedLeave,gn=void 0},pn.delayedLeave=()=>{yn(),delete pn.delayedLeave,gn=void 0}}:gn=void 0}else gn&&(gn=void 0);return un}}};function findNonCommentChild(an){let on=an[0];if(an.length>1){for(const sn of an)if(sn.type!==Comment){on=sn;break}}return on}const BaseTransition=BaseTransitionImpl;function getLeavingNodesForType(an,on){const{leavingVNodes:sn}=an;let ln=sn.get(on.type);return ln||(ln=Object.create(null),sn.set(on.type,ln)),ln}function resolveTransitionHooks(an,on,sn,ln,cn){const{appear:un,mode:dn,persisted:hn=!1,onBeforeEnter:fn,onEnter:pn,onAfterEnter:gn,onEnterCancelled:mn,onBeforeLeave:bn,onLeave:vn,onAfterLeave:yn,onLeaveCancelled:wn,onBeforeAppear:kn,onAppear:_n,onAfterAppear:xn,onAppearCancelled:En}=on,Tn=String(an.key),Bn=getLeavingNodesForType(sn,an),Nn=(On,zn)=>{On&&callWithAsyncErrorHandling(On,ln,9,zn)},Mn=(On,zn)=>{const Pn=zn[1];Nn(On,zn),isArray$1(On)?On.every(An=>An.length<=1)&&Pn():On.length<=1&&Pn()},Ln={mode:dn,persisted:hn,beforeEnter(On){let zn=fn;if(!sn.isMounted)if(un)zn=kn||fn;else return;On[leaveCbKey]&&On[leaveCbKey](!0);const Pn=Bn[Tn];Pn&&isSameVNodeType(an,Pn)&&Pn.el[leaveCbKey]&&Pn.el[leaveCbKey](),Nn(zn,[On])},enter(On){let zn=pn,Pn=gn,An=mn;if(!sn.isMounted)if(un)zn=_n||pn,Pn=xn||gn,An=En||mn;else return;let Vn=!1;const Sn=On[enterCbKey]=Rn=>{Vn||(Vn=!0,Rn?Nn(An,[On]):Nn(Pn,[On]),Ln.delayedLeave&&Ln.delayedLeave(),On[enterCbKey]=void 0)};zn?Mn(zn,[On,Sn]):Sn()},leave(On,zn){const Pn=String(an.key);if(On[enterCbKey]&&On[enterCbKey](!0),sn.isUnmounting)return zn();Nn(bn,[On]);let An=!1;const Vn=On[leaveCbKey]=Sn=>{An||(An=!0,zn(),Sn?Nn(wn,[On]):Nn(yn,[On]),On[leaveCbKey]=void 0,Bn[Pn]===an&&delete Bn[Pn])};Bn[Pn]=an,vn?Mn(vn,[On,Vn]):Vn()},clone(On){const zn=resolveTransitionHooks(On,on,sn,ln,cn);return cn&&cn(zn),zn}};return Ln}function emptyPlaceholder(an){if(isKeepAlive(an))return an=cloneVNode(an),an.children=null,an}function getInnerChild$1(an){if(!isKeepAlive(an))return isTeleport(an.type)&&an.children?findNonCommentChild(an.children):an;if(an.component)return an.component.subTree;const{shapeFlag:on,children:sn}=an;if(sn){if(on&16)return sn[0];if(on&32&&isFunction(sn.default))return sn.default()}}function setTransitionHooks(an,on){an.shapeFlag&6&&an.component?(an.transition=on,setTransitionHooks(an.component.subTree,on)):an.shapeFlag&128?(an.ssContent.transition=on.clone(an.ssContent),an.ssFallback.transition=on.clone(an.ssFallback)):an.transition=on}function getTransitionRawChildren(an,on=!1,sn){let ln=[],cn=0;for(let un=0;un<an.length;un++){let dn=an[un];const hn=sn==null?dn.key:String(sn)+String(dn.key!=null?dn.key:un);dn.type===Fragment?(dn.patchFlag&128&&cn++,ln=ln.concat(getTransitionRawChildren(dn.children,on,hn))):(on||dn.type!==Comment)&&ln.push(hn!=null?cloneVNode(dn,{key:hn}):dn)}if(cn>1)for(let un=0;un<ln.length;un++)ln[un].patchFlag=-2;return ln}function defineComponent(an,on){return isFunction(an)?extend({name:an.name},on,{setup:an}):an}function markAsyncBoundary(an){an.ids=[an.ids[0]+an.ids[2]+++"-",0,0]}const pendingSetRefMap=new WeakMap;function setRef(an,on,sn,ln,cn=!1){if(isArray$1(an)){an.forEach((yn,wn)=>setRef(yn,on&&(isArray$1(on)?on[wn]:on),sn,ln,cn));return}if(isAsyncWrapper(ln)&&!cn){ln.shapeFlag&512&&ln.type.__asyncResolved&&ln.component.subTree.component&&setRef(an,on,sn,ln.component.subTree);return}const un=ln.shapeFlag&4?getComponentPublicInstance(ln.component):ln.el,dn=cn?null:un,{i:hn,r:fn}=an,pn=on&&on.r,gn=hn.refs===EMPTY_OBJ?hn.refs={}:hn.refs,mn=hn.setupState,bn=toRaw(mn),vn=mn===EMPTY_OBJ?NO:yn=>hasOwn(bn,yn);if(pn!=null&&pn!==fn){if(invalidatePendingSetRef(on),isString$1(pn))gn[pn]=null,vn(pn)&&(mn[pn]=null);else if(isRef(pn)){pn.value=null;const yn=on;yn.k&&(gn[yn.k]=null)}}if(isFunction(fn))callWithErrorHandling(fn,hn,12,[dn,gn]);else{const yn=isString$1(fn),wn=isRef(fn);if(yn||wn){const kn=()=>{if(an.f){const _n=yn?vn(fn)?mn[fn]:gn[fn]:fn.value;if(cn)isArray$1(_n)&&remove(_n,un);else if(isArray$1(_n))_n.includes(un)||_n.push(un);else if(yn)gn[fn]=[un],vn(fn)&&(mn[fn]=gn[fn]);else{const xn=[un];fn.value=xn,an.k&&(gn[an.k]=xn)}}else yn?(gn[fn]=dn,vn(fn)&&(mn[fn]=dn)):wn&&(fn.value=dn,an.k&&(gn[an.k]=dn))};if(dn){const _n=()=>{kn(),pendingSetRefMap.delete(an)};_n.id=-1,pendingSetRefMap.set(an,_n),queuePostRenderEffect(_n,sn)}else invalidatePendingSetRef(an),kn()}}}function invalidatePendingSetRef(an){const on=pendingSetRefMap.get(an);on&&(on.flags|=8,pendingSetRefMap.delete(an))}getGlobalThis().requestIdleCallback;getGlobalThis().cancelIdleCallback;const isAsyncWrapper=an=>!!an.type.__asyncLoader,isKeepAlive=an=>an.type.__isKeepAlive;function onActivated(an,on){registerKeepAliveHook(an,"a",on)}function onDeactivated(an,on){registerKeepAliveHook(an,"da",on)}function registerKeepAliveHook(an,on,sn=currentInstance){const ln=an.__wdc||(an.__wdc=()=>{let cn=sn;for(;cn;){if(cn.isDeactivated)return;cn=cn.parent}return an()});if(injectHook(on,ln,sn),sn){let cn=sn.parent;for(;cn&&cn.parent;)isKeepAlive(cn.parent.vnode)&&injectToKeepAliveRoot(ln,on,sn,cn),cn=cn.parent}}function injectToKeepAliveRoot(an,on,sn,ln){const cn=injectHook(on,an,ln,!0);onUnmounted(()=>{remove(ln[on],cn)},sn)}function injectHook(an,on,sn=currentInstance,ln=!1){if(sn){const cn=sn[an]||(sn[an]=[]),un=on.__weh||(on.__weh=(...dn)=>{pauseTracking();const hn=setCurrentInstance(sn),fn=callWithAsyncErrorHandling(on,sn,an,dn);return hn(),resetTracking(),fn});return ln?cn.unshift(un):cn.push(un),un}}const createHook=an=>(on,sn=currentInstance)=>{(!isInSSRComponentSetup||an==="sp")&&injectHook(an,(...ln)=>on(...ln),sn)},onBeforeMount=createHook("bm"),onMounted=createHook("m"),onBeforeUpdate=createHook("bu"),onUpdated=createHook("u"),onBeforeUnmount=createHook("bum"),onUnmounted=createHook("um"),onServerPrefetch=createHook("sp"),onRenderTriggered=createHook("rtg"),onRenderTracked=createHook("rtc");function onErrorCaptured(an,on=currentInstance){injectHook("ec",an,on)}const DIRECTIVES="directives",NULL_DYNAMIC_COMPONENT=Symbol.for("v-ndc");function resolveDirective(an){return resolveAsset(DIRECTIVES,an)}function resolveAsset(an,on,sn=!0,ln=!1){const cn=currentRenderingInstance||currentInstance;if(cn){const un=cn.type,dn=resolve(cn[an]||un[an],on)||resolve(cn.appContext[an],on);return!dn&&ln?un:dn}}function resolve(an,on){return an&&(an[on]||an[camelize(on)]||an[capitalize(camelize(on))])}function renderList(an,on,sn,ln){let cn;const un=sn,dn=isArray$1(an);if(dn||isString$1(an)){const hn=dn&&isReactive(an);let fn=!1,pn=!1;hn&&(fn=!isShallow(an),pn=isReadonly(an),an=shallowReadArray(an)),cn=new Array(an.length);for(let gn=0,mn=an.length;gn<mn;gn++)cn[gn]=on(fn?pn?toReadonly(toReactive(an[gn])):toReactive(an[gn]):an[gn],gn,void 0,un)}else if(typeof an=="number"){cn=new Array(an);for(let hn=0;hn<an;hn++)cn[hn]=on(hn+1,hn,void 0,un)}else if(isObject$2(an))if(an[Symbol.iterator])cn=Array.from(an,(hn,fn)=>on(hn,fn,void 0,un));else{const hn=Object.keys(an);cn=new Array(hn.length);for(let fn=0,pn=hn.length;fn<pn;fn++){const gn=hn[fn];cn[fn]=on(an[gn],gn,fn,un)}}else cn=[];return cn}const getPublicInstance=an=>an?isStatefulComponent(an)?getComponentPublicInstance(an):getPublicInstance(an.parent):null,publicPropertiesMap=extend(Object.create(null),{$:an=>an,$el:an=>an.vnode.el,$data:an=>an.data,$props:an=>an.props,$attrs:an=>an.attrs,$slots:an=>an.slots,$refs:an=>an.refs,$parent:an=>getPublicInstance(an.parent),$root:an=>getPublicInstance(an.root),$host:an=>an.ce,$emit:an=>an.emit,$options:an=>resolveMergedOptions(an),$forceUpdate:an=>an.f||(an.f=()=>{queueJob(an.update)}),$nextTick:an=>an.n||(an.n=nextTick.bind(an.proxy)),$watch:an=>instanceWatch.bind(an)}),hasSetupBinding=(an,on)=>an!==EMPTY_OBJ&&!an.__isScriptSetup&&hasOwn(an,on),PublicInstanceProxyHandlers={get({_:an},on){if(on==="__v_skip")return!0;const{ctx:sn,setupState:ln,data:cn,props:un,accessCache:dn,type:hn,appContext:fn}=an;let pn;if(on[0]!=="$"){const vn=dn[on];if(vn!==void 0)switch(vn){case 1:return ln[on];case 2:return cn[on];case 4:return sn[on];case 3:return un[on]}else{if(hasSetupBinding(ln,on))return dn[on]=1,ln[on];if(cn!==EMPTY_OBJ&&hasOwn(cn,on))return dn[on]=2,cn[on];if((pn=an.propsOptions[0])&&hasOwn(pn,on))return dn[on]=3,un[on];if(sn!==EMPTY_OBJ&&hasOwn(sn,on))return dn[on]=4,sn[on];shouldCacheAccess&&(dn[on]=0)}}const gn=publicPropertiesMap[on];let mn,bn;if(gn)return on==="$attrs"&&track(an.attrs,"get",""),gn(an);if((mn=hn.__cssModules)&&(mn=mn[on]))return mn;if(sn!==EMPTY_OBJ&&hasOwn(sn,on))return dn[on]=4,sn[on];if(bn=fn.config.globalProperties,hasOwn(bn,on))return bn[on]},set({_:an},on,sn){const{data:ln,setupState:cn,ctx:un}=an;return hasSetupBinding(cn,on)?(cn[on]=sn,!0):ln!==EMPTY_OBJ&&hasOwn(ln,on)?(ln[on]=sn,!0):hasOwn(an.props,on)||on[0]==="$"&&on.slice(1)in an?!1:(un[on]=sn,!0)},has({_:{data:an,setupState:on,accessCache:sn,ctx:ln,appContext:cn,propsOptions:un,type:dn}},hn){let fn,pn;return!!(sn[hn]||an!==EMPTY_OBJ&&hn[0]!=="$"&&hasOwn(an,hn)||hasSetupBinding(on,hn)||(fn=un[0])&&hasOwn(fn,hn)||hasOwn(ln,hn)||hasOwn(publicPropertiesMap,hn)||hasOwn(cn.config.globalProperties,hn)||(pn=dn.__cssModules)&&pn[hn])},defineProperty(an,on,sn){return sn.get!=null?an._.accessCache[on]=0:hasOwn(sn,"value")&&this.set(an,on,sn.value,null),Reflect.defineProperty(an,on,sn)}};function useSlots(){return getContext().slots}function getContext(an){const on=getCurrentInstance();return on.setupContext||(on.setupContext=createSetupContext(on))}function normalizePropsOrEmits(an){return isArray$1(an)?an.reduce((on,sn)=>(on[sn]=null,on),{}):an}let shouldCacheAccess=!0;function applyOptions(an){const on=resolveMergedOptions(an),sn=an.proxy,ln=an.ctx;shouldCacheAccess=!1,on.beforeCreate&&callHook$1(on.beforeCreate,an,"bc");const{data:cn,computed:un,methods:dn,watch:hn,provide:fn,inject:pn,created:gn,beforeMount:mn,mounted:bn,beforeUpdate:vn,updated:yn,activated:wn,deactivated:kn,beforeDestroy:_n,beforeUnmount:xn,destroyed:En,unmounted:Tn,render:Bn,renderTracked:Nn,renderTriggered:Mn,errorCaptured:Ln,serverPrefetch:On,expose:zn,inheritAttrs:Pn,components:An,directives:Vn,filters:Sn}=on;if(pn&&resolveInjections(pn,ln,null),dn)for(const Zn in dn){const Qn=dn[Zn];isFunction(Qn)&&(ln[Zn]=Qn.bind(sn))}if(cn){const Zn=cn.call(sn,sn);isObject$2(Zn)&&(an.data=reactive(Zn))}if(shouldCacheAccess=!0,un)for(const Zn in un){const Qn=un[Zn],Yn=isFunction(Qn)?Qn.bind(sn,sn):isFunction(Qn.get)?Qn.get.bind(sn,sn):NOOP,tr=!isFunction(Qn)&&isFunction(Qn.set)?Qn.set.bind(sn):NOOP,Un=computed({get:Yn,set:tr});Object.defineProperty(ln,Zn,{enumerable:!0,configurable:!0,get:()=>Un.value,set:Xn=>Un.value=Xn})}if(hn)for(const Zn in hn)createWatcher(hn[Zn],ln,sn,Zn);if(fn){const Zn=isFunction(fn)?fn.call(sn):fn;Reflect.ownKeys(Zn).forEach(Qn=>{provide(Qn,Zn[Qn])})}gn&&callHook$1(gn,an,"c");function Hn(Zn,Qn){isArray$1(Qn)?Qn.forEach(Yn=>Zn(Yn.bind(sn))):Qn&&Zn(Qn.bind(sn))}if(Hn(onBeforeMount,mn),Hn(onMounted,bn),Hn(onBeforeUpdate,vn),Hn(onUpdated,yn),Hn(onActivated,wn),Hn(onDeactivated,kn),Hn(onErrorCaptured,Ln),Hn(onRenderTracked,Nn),Hn(onRenderTriggered,Mn),Hn(onBeforeUnmount,xn),Hn(onUnmounted,Tn),Hn(onServerPrefetch,On),isArray$1(zn))if(zn.length){const Zn=an.exposed||(an.exposed={});zn.forEach(Qn=>{Object.defineProperty(Zn,Qn,{get:()=>sn[Qn],set:Yn=>sn[Qn]=Yn,enumerable:!0})})}else an.exposed||(an.exposed={});Bn&&an.render===NOOP&&(an.render=Bn),Pn!=null&&(an.inheritAttrs=Pn),An&&(an.components=An),Vn&&(an.directives=Vn),On&&markAsyncBoundary(an)}function resolveInjections(an,on,sn=NOOP){isArray$1(an)&&(an=normalizeInject(an));for(const ln in an){const cn=an[ln];let un;isObject$2(cn)?"default"in cn?un=inject(cn.from||ln,cn.default,!0):un=inject(cn.from||ln):un=inject(cn),isRef(un)?Object.defineProperty(on,ln,{enumerable:!0,configurable:!0,get:()=>un.value,set:dn=>un.value=dn}):on[ln]=un}}function callHook$1(an,on,sn){callWithAsyncErrorHandling(isArray$1(an)?an.map(ln=>ln.bind(on.proxy)):an.bind(on.proxy),on,sn)}function createWatcher(an,on,sn,ln){let cn=ln.includes(".")?createPathGetter(sn,ln):()=>sn[ln];if(isString$1(an)){const un=on[an];isFunction(un)&&watch(cn,un)}else if(isFunction(an))watch(cn,an.bind(sn));else if(isObject$2(an))if(isArray$1(an))an.forEach(un=>createWatcher(un,on,sn,ln));else{const un=isFunction(an.handler)?an.handler.bind(sn):on[an.handler];isFunction(un)&&watch(cn,un,an)}}function resolveMergedOptions(an){const on=an.type,{mixins:sn,extends:ln}=on,{mixins:cn,optionsCache:un,config:{optionMergeStrategies:dn}}=an.appContext,hn=un.get(on);let fn;return hn?fn=hn:!cn.length&&!sn&&!ln?fn=on:(fn={},cn.length&&cn.forEach(pn=>mergeOptions(fn,pn,dn,!0)),mergeOptions(fn,on,dn)),isObject$2(on)&&un.set(on,fn),fn}function mergeOptions(an,on,sn,ln=!1){const{mixins:cn,extends:un}=on;un&&mergeOptions(an,un,sn,!0),cn&&cn.forEach(dn=>mergeOptions(an,dn,sn,!0));for(const dn in on)if(!(ln&&dn==="expose")){const hn=internalOptionMergeStrats[dn]||sn&&sn[dn];an[dn]=hn?hn(an[dn],on[dn]):on[dn]}return an}const internalOptionMergeStrats={data:mergeDataFn,props:mergeEmitsOrPropsOptions,emits:mergeEmitsOrPropsOptions,methods:mergeObjectOptions,computed:mergeObjectOptions,beforeCreate:mergeAsArray,created:mergeAsArray,beforeMount:mergeAsArray,mounted:mergeAsArray,beforeUpdate:mergeAsArray,updated:mergeAsArray,beforeDestroy:mergeAsArray,beforeUnmount:mergeAsArray,destroyed:mergeAsArray,unmounted:mergeAsArray,activated:mergeAsArray,deactivated:mergeAsArray,errorCaptured:mergeAsArray,serverPrefetch:mergeAsArray,components:mergeObjectOptions,directives:mergeObjectOptions,watch:mergeWatchOptions,provide:mergeDataFn,inject:mergeInject};function mergeDataFn(an,on){return on?an?function(){return extend(isFunction(an)?an.call(this,this):an,isFunction(on)?on.call(this,this):on)}:on:an}function mergeInject(an,on){return mergeObjectOptions(normalizeInject(an),normalizeInject(on))}function normalizeInject(an){if(isArray$1(an)){const on={};for(let sn=0;sn<an.length;sn++)on[an[sn]]=an[sn];return on}return an}function mergeAsArray(an,on){return an?[...new Set([].concat(an,on))]:on}function mergeObjectOptions(an,on){return an?extend(Object.create(null),an,on):on}function mergeEmitsOrPropsOptions(an,on){return an?isArray$1(an)&&isArray$1(on)?[...new Set([...an,...on])]:extend(Object.create(null),normalizePropsOrEmits(an),normalizePropsOrEmits(on??{})):on}function mergeWatchOptions(an,on){if(!an)return on;if(!on)return an;const sn=extend(Object.create(null),an);for(const ln in on)sn[ln]=mergeAsArray(an[ln],on[ln]);return sn}function createAppContext(){return{app:null,config:{isNativeTag:NO,performance:!1,globalProperties:{},optionMergeStrategies:{},errorHandler:void 0,warnHandler:void 0,compilerOptions:{}},mixins:[],components:{},directives:{},provides:Object.create(null),optionsCache:new WeakMap,propsCache:new WeakMap,emitsCache:new WeakMap}}let uid$1=0;function createAppAPI(an,on){return function(ln,cn=null){isFunction(ln)||(ln=extend({},ln)),cn!=null&&!isObject$2(cn)&&(cn=null);const un=createAppContext(),dn=new WeakSet,hn=[];let fn=!1;const pn=un.app={_uid:uid$1++,_component:ln,_props:cn,_container:null,_context:un,_instance:null,version:version$1,get config(){return un.config},set config(gn){},use(gn,...mn){return dn.has(gn)||(gn&&isFunction(gn.install)?(dn.add(gn),gn.install(pn,...mn)):isFunction(gn)&&(dn.add(gn),gn(pn,...mn))),pn},mixin(gn){return un.mixins.includes(gn)||un.mixins.push(gn),pn},component(gn,mn){return mn?(un.components[gn]=mn,pn):un.components[gn]},directive(gn,mn){return mn?(un.directives[gn]=mn,pn):un.directives[gn]},mount(gn,mn,bn){if(!fn){const vn=pn._ceVNode||createVNode(ln,cn);return vn.appContext=un,bn===!0?bn="svg":bn===!1&&(bn=void 0),an(vn,gn,bn),fn=!0,pn._container=gn,gn.__vue_app__=pn,getComponentPublicInstance(vn.component)}},onUnmount(gn){hn.push(gn)},unmount(){fn&&(callWithAsyncErrorHandling(hn,pn._instance,16),an(null,pn._container),delete pn._container.__vue_app__)},provide(gn,mn){return un.provides[gn]=mn,pn},runWithContext(gn){const mn=currentApp;currentApp=pn;try{return gn()}finally{currentApp=mn}}};return pn}}let currentApp=null;function provide(an,on){if(currentInstance){let sn=currentInstance.provides;const ln=currentInstance.parent&&currentInstance.parent.provides;ln===sn&&(sn=currentInstance.provides=Object.create(ln)),sn[an]=on}}function inject(an,on,sn=!1){const ln=getCurrentInstance();if(ln||currentApp){let cn=currentApp?currentApp._context.provides:ln?ln.parent==null||ln.ce?ln.vnode.appContext&&ln.vnode.appContext.provides:ln.parent.provides:void 0;if(cn&&an in cn)return cn[an];if(arguments.length>1)return sn&&isFunction(on)?on.call(ln&&ln.proxy):on}}const internalObjectProto={},createInternalObject=()=>Object.create(internalObjectProto),isInternalObject=an=>Object.getPrototypeOf(an)===internalObjectProto;function initProps(an,on,sn,ln=!1){const cn={},un=createInternalObject();an.propsDefaults=Object.create(null),setFullProps(an,on,cn,un);for(const dn in an.propsOptions[0])dn in cn||(cn[dn]=void 0);sn?an.props=ln?cn:shallowReactive(cn):an.type.props?an.props=cn:an.props=un,an.attrs=un}function updateProps(an,on,sn,ln){const{props:cn,attrs:un,vnode:{patchFlag:dn}}=an,hn=toRaw(cn),[fn]=an.propsOptions;let pn=!1;if((ln||dn>0)&&!(dn&16)){if(dn&8){const gn=an.vnode.dynamicProps;for(let mn=0;mn<gn.length;mn++){let bn=gn[mn];if(isEmitListener(an.emitsOptions,bn))continue;const vn=on[bn];if(fn)if(hasOwn(un,bn))vn!==un[bn]&&(un[bn]=vn,pn=!0);else{const yn=camelize(bn);cn[yn]=resolvePropValue(fn,hn,yn,vn,an,!1)}else vn!==un[bn]&&(un[bn]=vn,pn=!0)}}}else{setFullProps(an,on,cn,un)&&(pn=!0);let gn;for(const mn in hn)(!on||!hasOwn(on,mn)&&((gn=hyphenate(mn))===mn||!hasOwn(on,gn)))&&(fn?sn&&(sn[mn]!==void 0||sn[gn]!==void 0)&&(cn[mn]=resolvePropValue(fn,hn,mn,void 0,an,!0)):delete cn[mn]);if(un!==hn)for(const mn in un)(!on||!hasOwn(on,mn))&&(delete un[mn],pn=!0)}pn&&trigger(an.attrs,"set","")}function setFullProps(an,on,sn,ln){const[cn,un]=an.propsOptions;let dn=!1,hn;if(on)for(let fn in on){if(isReservedProp(fn))continue;const pn=on[fn];let gn;cn&&hasOwn(cn,gn=camelize(fn))?!un||!un.includes(gn)?sn[gn]=pn:(hn||(hn={}))[gn]=pn:isEmitListener(an.emitsOptions,fn)||(!(fn in ln)||pn!==ln[fn])&&(ln[fn]=pn,dn=!0)}if(un){const fn=toRaw(sn),pn=hn||EMPTY_OBJ;for(let gn=0;gn<un.length;gn++){const mn=un[gn];sn[mn]=resolvePropValue(cn,fn,mn,pn[mn],an,!hasOwn(pn,mn))}}return dn}function resolvePropValue(an,on,sn,ln,cn,un){const dn=an[sn];if(dn!=null){const hn=hasOwn(dn,"default");if(hn&&ln===void 0){const fn=dn.default;if(dn.type!==Function&&!dn.skipFactory&&isFunction(fn)){const{propsDefaults:pn}=cn;if(sn in pn)ln=pn[sn];else{const gn=setCurrentInstance(cn);ln=pn[sn]=fn.call(null,on),gn()}}else ln=fn;cn.ce&&cn.ce._setProp(sn,ln)}dn[0]&&(un&&!hn?ln=!1:dn[1]&&(ln===""||ln===hyphenate(sn))&&(ln=!0))}return ln}const mixinPropsCache=new WeakMap;function normalizePropsOptions(an,on,sn=!1){const ln=sn?mixinPropsCache:on.propsCache,cn=ln.get(an);if(cn)return cn;const un=an.props,dn={},hn=[];let fn=!1;if(!isFunction(an)){const gn=mn=>{fn=!0;const[bn,vn]=normalizePropsOptions(mn,on,!0);extend(dn,bn),vn&&hn.push(...vn)};!sn&&on.mixins.length&&on.mixins.forEach(gn),an.extends&&gn(an.extends),an.mixins&&an.mixins.forEach(gn)}if(!un&&!fn)return isObject$2(an)&&ln.set(an,EMPTY_ARR),EMPTY_ARR;if(isArray$1(un))for(let gn=0;gn<un.length;gn++){const mn=camelize(un[gn]);validatePropName(mn)&&(dn[mn]=EMPTY_OBJ)}else if(un)for(const gn in un){const mn=camelize(gn);if(validatePropName(mn)){const bn=un[gn],vn=dn[mn]=isArray$1(bn)||isFunction(bn)?{type:bn}:extend({},bn),yn=vn.type;let wn=!1,kn=!0;if(isArray$1(yn))for(let _n=0;_n<yn.length;++_n){const xn=yn[_n],En=isFunction(xn)&&xn.name;if(En==="Boolean"){wn=!0;break}else En==="String"&&(kn=!1)}else wn=isFunction(yn)&&yn.name==="Boolean";vn[0]=wn,vn[1]=kn,(wn||hasOwn(vn,"default"))&&hn.push(mn)}}const pn=[dn,hn];return isObject$2(an)&&ln.set(an,pn),pn}function validatePropName(an){return an[0]!=="$"&&!isReservedProp(an)}const isInternalKey=an=>an==="_"||an==="_ctx"||an==="$stable",normalizeSlotValue=an=>isArray$1(an)?an.map(normalizeVNode):[normalizeVNode(an)],normalizeSlot=(an,on,sn)=>{if(on._n)return on;const ln=withCtx((...cn)=>normalizeSlotValue(on(...cn)),sn);return ln._c=!1,ln},normalizeObjectSlots=(an,on,sn)=>{const ln=an._ctx;for(const cn in an){if(isInternalKey(cn))continue;const un=an[cn];if(isFunction(un))on[cn]=normalizeSlot(cn,un,ln);else if(un!=null){const dn=normalizeSlotValue(un);on[cn]=()=>dn}}},normalizeVNodeSlots=(an,on)=>{const sn=normalizeSlotValue(on);an.slots.default=()=>sn},assignSlots=(an,on,sn)=>{for(const ln in on)(sn||!isInternalKey(ln))&&(an[ln]=on[ln])},initSlots=(an,on,sn)=>{const ln=an.slots=createInternalObject();if(an.vnode.shapeFlag&32){const cn=on._;cn?(assignSlots(ln,on,sn),sn&&def(ln,"_",cn,!0)):normalizeObjectSlots(on,ln)}else on&&normalizeVNodeSlots(an,on)},updateSlots=(an,on,sn)=>{const{vnode:ln,slots:cn}=an;let un=!0,dn=EMPTY_OBJ;if(ln.shapeFlag&32){const hn=on._;hn?sn&&hn===1?un=!1:assignSlots(cn,on,sn):(un=!on.$stable,normalizeObjectSlots(on,cn)),dn=on}else on&&(normalizeVNodeSlots(an,on),dn={default:1});if(un)for(const hn in cn)!isInternalKey(hn)&&dn[hn]==null&&delete cn[hn]},queuePostRenderEffect=queueEffectWithSuspense;function createRenderer(an){return baseCreateRenderer(an)}function baseCreateRenderer(an,on){const sn=getGlobalThis();sn.__VUE__=!0;const{insert:ln,remove:cn,patchProp:un,createElement:dn,createText:hn,createComment:fn,setText:pn,setElementText:gn,parentNode:mn,nextSibling:bn,setScopeId:vn=NOOP,insertStaticContent:yn}=an,wn=(Fn,Kn,Cn,qn=null,Gn=null,Dn=null,In=void 0,Wn=null,rr=!!Kn.dynamicChildren)=>{if(Fn===Kn)return;Fn&&!isSameVNodeType(Fn,Kn)&&(qn=$r(Fn),Xn(Fn,Gn,Dn,!0),Fn=null),Kn.patchFlag===-2&&(rr=!1,Kn.dynamicChildren=null);const{type:nr,ref:er,shapeFlag:ar}=Kn;switch(nr){case Text:kn(Fn,Kn,Cn,qn);break;case Comment:_n(Fn,Kn,Cn,qn);break;case Static:Fn==null&&xn(Kn,Cn,qn,In);break;case Fragment:An(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr);break;default:ar&1?Bn(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr):ar&6?Vn(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr):(ar&64||ar&128)&&nr.process(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr,gr)}er!=null&&Gn?setRef(er,Fn&&Fn.ref,Dn,Kn||Fn,!Kn):er==null&&Fn&&Fn.ref!=null&&setRef(Fn.ref,null,Dn,Fn,!0)},kn=(Fn,Kn,Cn,qn)=>{if(Fn==null)ln(Kn.el=hn(Kn.children),Cn,qn);else{const Gn=Kn.el=Fn.el;Kn.children!==Fn.children&&pn(Gn,Kn.children)}},_n=(Fn,Kn,Cn,qn)=>{Fn==null?ln(Kn.el=fn(Kn.children||""),Cn,qn):Kn.el=Fn.el},xn=(Fn,Kn,Cn,qn)=>{[Fn.el,Fn.anchor]=yn(Fn.children,Kn,Cn,qn,Fn.el,Fn.anchor)},En=({el:Fn,anchor:Kn},Cn,qn)=>{let Gn;for(;Fn&&Fn!==Kn;)Gn=bn(Fn),ln(Fn,Cn,qn),Fn=Gn;ln(Kn,Cn,qn)},Tn=({el:Fn,anchor:Kn})=>{let Cn;for(;Fn&&Fn!==Kn;)Cn=bn(Fn),cn(Fn),Fn=Cn;cn(Kn)},Bn=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr)=>{if(Kn.type==="svg"?In="svg":Kn.type==="math"&&(In="mathml"),Fn==null)Nn(Kn,Cn,qn,Gn,Dn,In,Wn,rr);else{const nr=Fn.el&&Fn.el._isVueCE?Fn.el:null;try{nr&&nr._beginPatch(),On(Fn,Kn,Gn,Dn,In,Wn,rr)}finally{nr&&nr._endPatch()}}},Nn=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn)=>{let rr,nr;const{props:er,shapeFlag:ar,transition:mr,dirs:fr}=Fn;if(rr=Fn.el=dn(Fn.type,Dn,er&&er.is,er),ar&8?gn(rr,Fn.children):ar&16&&Ln(Fn.children,rr,null,qn,Gn,resolveChildrenNamespace(Fn,Dn),In,Wn),fr&&invokeDirectiveHook(Fn,null,qn,"created"),Mn(rr,Fn,Fn.scopeId,In,qn),er){for(const Br in er)Br!=="value"&&!isReservedProp(Br)&&un(rr,Br,null,er[Br],Dn,qn);"value"in er&&un(rr,"value",null,er.value,Dn),(nr=er.onVnodeBeforeMount)&&invokeVNodeHook(nr,qn,Fn)}fr&&invokeDirectiveHook(Fn,null,qn,"beforeMount");const xr=needTransition(Gn,mr);xr&&mr.beforeEnter(rr),ln(rr,Kn,Cn),((nr=er&&er.onVnodeMounted)||xr||fr)&&queuePostRenderEffect(()=>{nr&&invokeVNodeHook(nr,qn,Fn),xr&&mr.enter(rr),fr&&invokeDirectiveHook(Fn,null,qn,"mounted")},Gn)},Mn=(Fn,Kn,Cn,qn,Gn)=>{if(Cn&&vn(Fn,Cn),qn)for(let Dn=0;Dn<qn.length;Dn++)vn(Fn,qn[Dn]);if(Gn){let Dn=Gn.subTree;if(Kn===Dn||isSuspense(Dn.type)&&(Dn.ssContent===Kn||Dn.ssFallback===Kn)){const In=Gn.vnode;Mn(Fn,In,In.scopeId,In.slotScopeIds,Gn.parent)}}},Ln=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr=0)=>{for(let nr=rr;nr<Fn.length;nr++){const er=Fn[nr]=Wn?cloneIfMounted(Fn[nr]):normalizeVNode(Fn[nr]);wn(null,er,Kn,Cn,qn,Gn,Dn,In,Wn)}},On=(Fn,Kn,Cn,qn,Gn,Dn,In)=>{const Wn=Kn.el=Fn.el;let{patchFlag:rr,dynamicChildren:nr,dirs:er}=Kn;rr|=Fn.patchFlag&16;const ar=Fn.props||EMPTY_OBJ,mr=Kn.props||EMPTY_OBJ;let fr;if(Cn&&toggleRecurse(Cn,!1),(fr=mr.onVnodeBeforeUpdate)&&invokeVNodeHook(fr,Cn,Kn,Fn),er&&invokeDirectiveHook(Kn,Fn,Cn,"beforeUpdate"),Cn&&toggleRecurse(Cn,!0),(ar.innerHTML&&mr.innerHTML==null||ar.textContent&&mr.textContent==null)&&gn(Wn,""),nr?zn(Fn.dynamicChildren,nr,Wn,Cn,qn,resolveChildrenNamespace(Kn,Gn),Dn):In||Qn(Fn,Kn,Wn,null,Cn,qn,resolveChildrenNamespace(Kn,Gn),Dn,!1),rr>0){if(rr&16)Pn(Wn,ar,mr,Cn,Gn);else if(rr&2&&ar.class!==mr.class&&un(Wn,"class",null,mr.class,Gn),rr&4&&un(Wn,"style",ar.style,mr.style,Gn),rr&8){const xr=Kn.dynamicProps;for(let Br=0;Br<xr.length;Br++){const Er=xr[Br],Or=ar[Er],Wr=mr[Er];(Wr!==Or||Er==="value")&&un(Wn,Er,Or,Wr,Gn,Cn)}}rr&1&&Fn.children!==Kn.children&&gn(Wn,Kn.children)}else!In&&nr==null&&Pn(Wn,ar,mr,Cn,Gn);((fr=mr.onVnodeUpdated)||er)&&queuePostRenderEffect(()=>{fr&&invokeVNodeHook(fr,Cn,Kn,Fn),er&&invokeDirectiveHook(Kn,Fn,Cn,"updated")},qn)},zn=(Fn,Kn,Cn,qn,Gn,Dn,In)=>{for(let Wn=0;Wn<Kn.length;Wn++){const rr=Fn[Wn],nr=Kn[Wn],er=rr.el&&(rr.type===Fragment||!isSameVNodeType(rr,nr)||rr.shapeFlag&198)?mn(rr.el):Cn;wn(rr,nr,er,null,qn,Gn,Dn,In,!0)}},Pn=(Fn,Kn,Cn,qn,Gn)=>{if(Kn!==Cn){if(Kn!==EMPTY_OBJ)for(const Dn in Kn)!isReservedProp(Dn)&&!(Dn in Cn)&&un(Fn,Dn,Kn[Dn],null,Gn,qn);for(const Dn in Cn){if(isReservedProp(Dn))continue;const In=Cn[Dn],Wn=Kn[Dn];In!==Wn&&Dn!=="value"&&un(Fn,Dn,Wn,In,Gn,qn)}"value"in Cn&&un(Fn,"value",Kn.value,Cn.value,Gn)}},An=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr)=>{const nr=Kn.el=Fn?Fn.el:hn(""),er=Kn.anchor=Fn?Fn.anchor:hn("");let{patchFlag:ar,dynamicChildren:mr,slotScopeIds:fr}=Kn;fr&&(Wn=Wn?Wn.concat(fr):fr),Fn==null?(ln(nr,Cn,qn),ln(er,Cn,qn),Ln(Kn.children||[],Cn,er,Gn,Dn,In,Wn,rr)):ar>0&&ar&64&&mr&&Fn.dynamicChildren?(zn(Fn.dynamicChildren,mr,Cn,Gn,Dn,In,Wn),(Kn.key!=null||Gn&&Kn===Gn.subTree)&&traverseStaticChildren(Fn,Kn,!0)):Qn(Fn,Kn,Cn,er,Gn,Dn,In,Wn,rr)},Vn=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr)=>{Kn.slotScopeIds=Wn,Fn==null?Kn.shapeFlag&512?Gn.ctx.activate(Kn,Cn,qn,In,rr):Sn(Kn,Cn,qn,Gn,Dn,In,rr):Rn(Fn,Kn,rr)},Sn=(Fn,Kn,Cn,qn,Gn,Dn,In)=>{const Wn=Fn.component=createComponentInstance(Fn,qn,Gn);if(isKeepAlive(Fn)&&(Wn.ctx.renderer=gr),setupComponent(Wn,!1,In),Wn.asyncDep){if(Gn&&Gn.registerDep(Wn,Hn,In),!Fn.el){const rr=Wn.subTree=createVNode(Comment);_n(null,rr,Kn,Cn),Fn.placeholder=rr.el}}else Hn(Wn,Fn,Kn,Cn,Gn,Dn,In)},Rn=(Fn,Kn,Cn)=>{const qn=Kn.component=Fn.component;if(shouldUpdateComponent(Fn,Kn,Cn))if(qn.asyncDep&&!qn.asyncResolved){Zn(qn,Kn,Cn);return}else qn.next=Kn,qn.update();else Kn.el=Fn.el,qn.vnode=Kn},Hn=(Fn,Kn,Cn,qn,Gn,Dn,In)=>{const Wn=()=>{if(Fn.isMounted){let{next:ar,bu:mr,u:fr,parent:xr,vnode:Br}=Fn;{const Jr=locateNonHydratedAsyncRoot(Fn);if(Jr){ar&&(ar.el=Br.el,Zn(Fn,ar,In)),Jr.asyncDep.then(()=>{Fn.isUnmounted||Wn()});return}}let Er=ar,Or;toggleRecurse(Fn,!1),ar?(ar.el=Br.el,Zn(Fn,ar,In)):ar=Br,mr&&invokeArrayFns(mr),(Or=ar.props&&ar.props.onVnodeBeforeUpdate)&&invokeVNodeHook(Or,xr,ar,Br),toggleRecurse(Fn,!0);const Wr=renderComponentRoot(Fn),Lr=Fn.subTree;Fn.subTree=Wr,wn(Lr,Wr,mn(Lr.el),$r(Lr),Fn,Gn,Dn),ar.el=Wr.el,Er===null&&updateHOCHostEl(Fn,Wr.el),fr&&queuePostRenderEffect(fr,Gn),(Or=ar.props&&ar.props.onVnodeUpdated)&&queuePostRenderEffect(()=>invokeVNodeHook(Or,xr,ar,Br),Gn)}else{let ar;const{el:mr,props:fr}=Kn,{bm:xr,m:Br,parent:Er,root:Or,type:Wr}=Fn,Lr=isAsyncWrapper(Kn);toggleRecurse(Fn,!1),xr&&invokeArrayFns(xr),!Lr&&(ar=fr&&fr.onVnodeBeforeMount)&&invokeVNodeHook(ar,Er,Kn),toggleRecurse(Fn,!0);{Or.ce&&Or.ce._def.shadowRoot!==!1&&Or.ce._injectChildStyle(Wr);const Jr=Fn.subTree=renderComponentRoot(Fn);wn(null,Jr,Cn,qn,Fn,Gn,Dn),Kn.el=Jr.el}if(Br&&queuePostRenderEffect(Br,Gn),!Lr&&(ar=fr&&fr.onVnodeMounted)){const Jr=Kn;queuePostRenderEffect(()=>invokeVNodeHook(ar,Er,Jr),Gn)}(Kn.shapeFlag&256||Er&&isAsyncWrapper(Er.vnode)&&Er.vnode.shapeFlag&256)&&Fn.a&&queuePostRenderEffect(Fn.a,Gn),Fn.isMounted=!0,Kn=Cn=qn=null}};Fn.scope.on();const rr=Fn.effect=new ReactiveEffect(Wn);Fn.scope.off();const nr=Fn.update=rr.run.bind(rr),er=Fn.job=rr.runIfDirty.bind(rr);er.i=Fn,er.id=Fn.uid,rr.scheduler=()=>queueJob(er),toggleRecurse(Fn,!0),nr()},Zn=(Fn,Kn,Cn)=>{Kn.component=Fn;const qn=Fn.vnode.props;Fn.vnode=Kn,Fn.next=null,updateProps(Fn,Kn.props,qn,Cn),updateSlots(Fn,Kn.children,Cn),pauseTracking(),flushPreFlushCbs(Fn),resetTracking()},Qn=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr=!1)=>{const nr=Fn&&Fn.children,er=Fn?Fn.shapeFlag:0,ar=Kn.children,{patchFlag:mr,shapeFlag:fr}=Kn;if(mr>0){if(mr&128){tr(nr,ar,Cn,qn,Gn,Dn,In,Wn,rr);return}else if(mr&256){Yn(nr,ar,Cn,qn,Gn,Dn,In,Wn,rr);return}}fr&8?(er&16&&Nr(nr,Gn,Dn),ar!==nr&&gn(Cn,ar)):er&16?fr&16?tr(nr,ar,Cn,qn,Gn,Dn,In,Wn,rr):Nr(nr,Gn,Dn,!0):(er&8&&gn(Cn,""),fr&16&&Ln(ar,Cn,qn,Gn,Dn,In,Wn,rr))},Yn=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr)=>{Fn=Fn||EMPTY_ARR,Kn=Kn||EMPTY_ARR;const nr=Fn.length,er=Kn.length,ar=Math.min(nr,er);let mr;for(mr=0;mr<ar;mr++){const fr=Kn[mr]=rr?cloneIfMounted(Kn[mr]):normalizeVNode(Kn[mr]);wn(Fn[mr],fr,Cn,null,Gn,Dn,In,Wn,rr)}nr>er?Nr(Fn,Gn,Dn,!0,!1,ar):Ln(Kn,Cn,qn,Gn,Dn,In,Wn,rr,ar)},tr=(Fn,Kn,Cn,qn,Gn,Dn,In,Wn,rr)=>{let nr=0;const er=Kn.length;let ar=Fn.length-1,mr=er-1;for(;nr<=ar&&nr<=mr;){const fr=Fn[nr],xr=Kn[nr]=rr?cloneIfMounted(Kn[nr]):normalizeVNode(Kn[nr]);if(isSameVNodeType(fr,xr))wn(fr,xr,Cn,null,Gn,Dn,In,Wn,rr);else break;nr++}for(;nr<=ar&&nr<=mr;){const fr=Fn[ar],xr=Kn[mr]=rr?cloneIfMounted(Kn[mr]):normalizeVNode(Kn[mr]);if(isSameVNodeType(fr,xr))wn(fr,xr,Cn,null,Gn,Dn,In,Wn,rr);else break;ar--,mr--}if(nr>ar){if(nr<=mr){const fr=mr+1,xr=fr<er?Kn[fr].el:qn;for(;nr<=mr;)wn(null,Kn[nr]=rr?cloneIfMounted(Kn[nr]):normalizeVNode(Kn[nr]),Cn,xr,Gn,Dn,In,Wn,rr),nr++}}else if(nr>mr)for(;nr<=ar;)Xn(Fn[nr],Gn,Dn,!0),nr++;else{const fr=nr,xr=nr,Br=new Map;for(nr=xr;nr<=mr;nr++){const Ur=Kn[nr]=rr?cloneIfMounted(Kn[nr]):normalizeVNode(Kn[nr]);Ur.key!=null&&Br.set(Ur.key,nr)}let Er,Or=0;const Wr=mr-xr+1;let Lr=!1,Jr=0;const Fr=new Array(Wr);for(nr=0;nr<Wr;nr++)Fr[nr]=0;for(nr=fr;nr<=ar;nr++){const Ur=Fn[nr];if(Or>=Wr){Xn(Ur,Gn,Dn,!0);continue}let Hr;if(Ur.key!=null)Hr=Br.get(Ur.key);else for(Er=xr;Er<=mr;Er++)if(Fr[Er-xr]===0&&isSameVNodeType(Ur,Kn[Er])){Hr=Er;break}Hr===void 0?Xn(Ur,Gn,Dn,!0):(Fr[Hr-xr]=nr+1,Hr>=Jr?Jr=Hr:Lr=!0,wn(Ur,Kn[Hr],Cn,null,Gn,Dn,In,Wn,rr),Or++)}const Co=Lr?getSequence(Fr):EMPTY_ARR;for(Er=Co.length-1,nr=Wr-1;nr>=0;nr--){const Ur=xr+nr,Hr=Kn[Ur],ro=Kn[Ur+1],oo=Ur+1<er?ro.el||ro.placeholder:qn;Fr[nr]===0?wn(null,Hr,Cn,oo,Gn,Dn,In,Wn,rr):Lr&&(Er<0||nr!==Co[Er]?Un(Hr,Cn,oo,2):Er--)}}},Un=(Fn,Kn,Cn,qn,Gn=null)=>{const{el:Dn,type:In,transition:Wn,children:rr,shapeFlag:nr}=Fn;if(nr&6){Un(Fn.component.subTree,Kn,Cn,qn);return}if(nr&128){Fn.suspense.move(Kn,Cn,qn);return}if(nr&64){In.move(Fn,Kn,Cn,gr);return}if(In===Fragment){ln(Dn,Kn,Cn);for(let ar=0;ar<rr.length;ar++)Un(rr[ar],Kn,Cn,qn);ln(Fn.anchor,Kn,Cn);return}if(In===Static){En(Fn,Kn,Cn);return}if(qn!==2&&nr&1&&Wn)if(qn===0)Wn.beforeEnter(Dn),ln(Dn,Kn,Cn),queuePostRenderEffect(()=>Wn.enter(Dn),Gn);else{const{leave:ar,delayLeave:mr,afterLeave:fr}=Wn,xr=()=>{Fn.ctx.isUnmounted?cn(Dn):ln(Dn,Kn,Cn)},Br=()=>{Dn._isLeaving&&Dn[leaveCbKey](!0),ar(Dn,()=>{xr(),fr&&fr()})};mr?mr(Dn,xr,Br):Br()}else ln(Dn,Kn,Cn)},Xn=(Fn,Kn,Cn,qn=!1,Gn=!1)=>{const{type:Dn,props:In,ref:Wn,children:rr,dynamicChildren:nr,shapeFlag:er,patchFlag:ar,dirs:mr,cacheIndex:fr}=Fn;if(ar===-2&&(Gn=!1),Wn!=null&&(pauseTracking(),setRef(Wn,null,Cn,Fn,!0),resetTracking()),fr!=null&&(Kn.renderCache[fr]=void 0),er&256){Kn.ctx.deactivate(Fn);return}const xr=er&1&&mr,Br=!isAsyncWrapper(Fn);let Er;if(Br&&(Er=In&&In.onVnodeBeforeUnmount)&&invokeVNodeHook(Er,Kn,Fn),er&6)wr(Fn.component,Cn,qn);else{if(er&128){Fn.suspense.unmount(Cn,qn);return}xr&&invokeDirectiveHook(Fn,null,Kn,"beforeUnmount"),er&64?Fn.type.remove(Fn,Kn,Cn,gr,qn):nr&&!nr.hasOnce&&(Dn!==Fragment||ar>0&&ar&64)?Nr(nr,Kn,Cn,!1,!0):(Dn===Fragment&&ar&384||!Gn&&er&16)&&Nr(rr,Kn,Cn),qn&&or(Fn)}(Br&&(Er=In&&In.onVnodeUnmounted)||xr)&&queuePostRenderEffect(()=>{Er&&invokeVNodeHook(Er,Kn,Fn),xr&&invokeDirectiveHook(Fn,null,Kn,"unmounted")},Cn)},or=Fn=>{const{type:Kn,el:Cn,anchor:qn,transition:Gn}=Fn;if(Kn===Fragment){kr(Cn,qn);return}if(Kn===Static){Tn(Fn);return}const Dn=()=>{cn(Cn),Gn&&!Gn.persisted&&Gn.afterLeave&&Gn.afterLeave()};if(Fn.shapeFlag&1&&Gn&&!Gn.persisted){const{leave:In,delayLeave:Wn}=Gn,rr=()=>In(Cn,Dn);Wn?Wn(Fn.el,Dn,rr):rr()}else Dn()},kr=(Fn,Kn)=>{let Cn;for(;Fn!==Kn;)Cn=bn(Fn),cn(Fn),Fn=Cn;cn(Kn)},wr=(Fn,Kn,Cn)=>{const{bum:qn,scope:Gn,job:Dn,subTree:In,um:Wn,m:rr,a:nr}=Fn;invalidateMount(rr),invalidateMount(nr),qn&&invokeArrayFns(qn),Gn.stop(),Dn&&(Dn.flags|=8,Xn(In,Fn,Kn,Cn)),Wn&&queuePostRenderEffect(Wn,Kn),queuePostRenderEffect(()=>{Fn.isUnmounted=!0},Kn)},Nr=(Fn,Kn,Cn,qn=!1,Gn=!1,Dn=0)=>{for(let In=Dn;In<Fn.length;In++)Xn(Fn[In],Kn,Cn,qn,Gn)},$r=Fn=>{if(Fn.shapeFlag&6)return $r(Fn.component.subTree);if(Fn.shapeFlag&128)return Fn.suspense.next();const Kn=bn(Fn.anchor||Fn.el),Cn=Kn&&Kn[TeleportEndKey];return Cn?bn(Cn):Kn};let cr=!1;const hr=(Fn,Kn,Cn)=>{Fn==null?Kn._vnode&&Xn(Kn._vnode,null,null,!0):wn(Kn._vnode||null,Fn,Kn,null,null,null,Cn),Kn._vnode=Fn,cr||(cr=!0,flushPreFlushCbs(),flushPostFlushCbs(),cr=!1)},gr={p:wn,um:Xn,m:Un,r:or,mt:Sn,mc:Ln,pc:Qn,pbc:zn,n:$r,o:an};return{render:hr,hydrate:void 0,createApp:createAppAPI(hr)}}function resolveChildrenNamespace({type:an,props:on},sn){return sn==="svg"&&an==="foreignObject"||sn==="mathml"&&an==="annotation-xml"&&on&&on.encoding&&on.encoding.includes("html")?void 0:sn}function toggleRecurse({effect:an,job:on},sn){sn?(an.flags|=32,on.flags|=4):(an.flags&=-33,on.flags&=-5)}function needTransition(an,on){return(!an||an&&!an.pendingBranch)&&on&&!on.persisted}function traverseStaticChildren(an,on,sn=!1){const ln=an.children,cn=on.children;if(isArray$1(ln)&&isArray$1(cn))for(let un=0;un<ln.length;un++){const dn=ln[un];let hn=cn[un];hn.shapeFlag&1&&!hn.dynamicChildren&&((hn.patchFlag<=0||hn.patchFlag===32)&&(hn=cn[un]=cloneIfMounted(cn[un]),hn.el=dn.el),!sn&&hn.patchFlag!==-2&&traverseStaticChildren(dn,hn)),hn.type===Text&&hn.patchFlag!==-1&&(hn.el=dn.el),hn.type===Comment&&!hn.el&&(hn.el=dn.el)}}function getSequence(an){const on=an.slice(),sn=[0];let ln,cn,un,dn,hn;const fn=an.length;for(ln=0;ln<fn;ln++){const pn=an[ln];if(pn!==0){if(cn=sn[sn.length-1],an[cn]<pn){on[ln]=cn,sn.push(ln);continue}for(un=0,dn=sn.length-1;un<dn;)hn=un+dn>>1,an[sn[hn]]<pn?un=hn+1:dn=hn;pn<an[sn[un]]&&(un>0&&(on[ln]=sn[un-1]),sn[un]=ln)}}for(un=sn.length,dn=sn[un-1];un-- >0;)sn[un]=dn,dn=on[dn];return sn}function locateNonHydratedAsyncRoot(an){const on=an.subTree.component;if(on)return on.asyncDep&&!on.asyncResolved?on:locateNonHydratedAsyncRoot(on)}function invalidateMount(an){if(an)for(let on=0;on<an.length;on++)an[on].flags|=8}const ssrContextKey=Symbol.for("v-scx"),useSSRContext=()=>inject(ssrContextKey);function watch(an,on,sn){return doWatch(an,on,sn)}function doWatch(an,on,sn=EMPTY_OBJ){const{immediate:ln,deep:cn,flush:un,once:dn}=sn,hn=extend({},sn),fn=on&&ln||!on&&un!=="post";let pn;if(isInSSRComponentSetup){if(un==="sync"){const vn=useSSRContext();pn=vn.__watcherHandles||(vn.__watcherHandles=[])}else if(!fn){const vn=()=>{};return vn.stop=NOOP,vn.resume=NOOP,vn.pause=NOOP,vn}}const gn=currentInstance;hn.call=(vn,yn,wn)=>callWithAsyncErrorHandling(vn,gn,yn,wn);let mn=!1;un==="post"?hn.scheduler=vn=>{queuePostRenderEffect(vn,gn&&gn.suspense)}:un!=="sync"&&(mn=!0,hn.scheduler=(vn,yn)=>{yn?vn():queueJob(vn)}),hn.augmentJob=vn=>{on&&(vn.flags|=4),mn&&(vn.flags|=2,gn&&(vn.id=gn.uid,vn.i=gn))};const bn=watch$1(an,on,hn);return isInSSRComponentSetup&&(pn?pn.push(bn):fn&&bn()),bn}function instanceWatch(an,on,sn){const ln=this.proxy,cn=isString$1(an)?an.includes(".")?createPathGetter(ln,an):()=>ln[an]:an.bind(ln,ln);let un;isFunction(on)?un=on:(un=on.handler,sn=on);const dn=setCurrentInstance(this),hn=doWatch(cn,un.bind(ln),sn);return dn(),hn}function createPathGetter(an,on){const sn=on.split(".");return()=>{let ln=an;for(let cn=0;cn<sn.length&&ln;cn++)ln=ln[sn[cn]];return ln}}const getModelModifiers=(an,on)=>on==="modelValue"||on==="model-value"?an.modelModifiers:an[`${on}Modifiers`]||an[`${camelize(on)}Modifiers`]||an[`${hyphenate(on)}Modifiers`];function emit(an,on,...sn){if(an.isUnmounted)return;const ln=an.vnode.props||EMPTY_OBJ;let cn=sn;const un=on.startsWith("update:"),dn=un&&getModelModifiers(ln,on.slice(7));dn&&(dn.trim&&(cn=sn.map(gn=>isString$1(gn)?gn.trim():gn)),dn.number&&(cn=sn.map(looseToNumber)));let hn,fn=ln[hn=toHandlerKey(on)]||ln[hn=toHandlerKey(camelize(on))];!fn&&un&&(fn=ln[hn=toHandlerKey(hyphenate(on))]),fn&&callWithAsyncErrorHandling(fn,an,6,cn);const pn=ln[hn+"Once"];if(pn){if(!an.emitted)an.emitted={};else if(an.emitted[hn])return;an.emitted[hn]=!0,callWithAsyncErrorHandling(pn,an,6,cn)}}const mixinEmitsCache=new WeakMap;function normalizeEmitsOptions(an,on,sn=!1){const ln=sn?mixinEmitsCache:on.emitsCache,cn=ln.get(an);if(cn!==void 0)return cn;const un=an.emits;let dn={},hn=!1;if(!isFunction(an)){const fn=pn=>{const gn=normalizeEmitsOptions(pn,on,!0);gn&&(hn=!0,extend(dn,gn))};!sn&&on.mixins.length&&on.mixins.forEach(fn),an.extends&&fn(an.extends),an.mixins&&an.mixins.forEach(fn)}return!un&&!hn?(isObject$2(an)&&ln.set(an,null),null):(isArray$1(un)?un.forEach(fn=>dn[fn]=null):extend(dn,un),isObject$2(an)&&ln.set(an,dn),dn)}function isEmitListener(an,on){return!an||!isOn(on)?!1:(on=on.slice(2).replace(/Once$/,""),hasOwn(an,on[0].toLowerCase()+on.slice(1))||hasOwn(an,hyphenate(on))||hasOwn(an,on))}function markAttrsAccessed(){}function renderComponentRoot(an){const{type:on,vnode:sn,proxy:ln,withProxy:cn,propsOptions:[un],slots:dn,attrs:hn,emit:fn,render:pn,renderCache:gn,props:mn,data:bn,setupState:vn,ctx:yn,inheritAttrs:wn}=an,kn=setCurrentRenderingInstance(an);let _n,xn;try{if(sn.shapeFlag&4){const Tn=cn||ln,Bn=Tn;_n=normalizeVNode(pn.call(Bn,Tn,gn,mn,vn,bn,yn)),xn=hn}else{const Tn=on;_n=normalizeVNode(Tn.length>1?Tn(mn,{attrs:hn,slots:dn,emit:fn}):Tn(mn,null)),xn=on.props?hn:getFunctionalFallthrough(hn)}}catch(Tn){blockStack.length=0,handleError(Tn,an,1),_n=createVNode(Comment)}let En=_n;if(xn&&wn!==!1){const Tn=Object.keys(xn),{shapeFlag:Bn}=En;Tn.length&&Bn&7&&(un&&Tn.some(isModelListener)&&(xn=filterModelListeners(xn,un)),En=cloneVNode(En,xn,!1,!0))}return sn.dirs&&(En=cloneVNode(En,null,!1,!0),En.dirs=En.dirs?En.dirs.concat(sn.dirs):sn.dirs),sn.transition&&setTransitionHooks(En,sn.transition),_n=En,setCurrentRenderingInstance(kn),_n}const getFunctionalFallthrough=an=>{let on;for(const sn in an)(sn==="class"||sn==="style"||isOn(sn))&&((on||(on={}))[sn]=an[sn]);return on},filterModelListeners=(an,on)=>{const sn={};for(const ln in an)(!isModelListener(ln)||!(ln.slice(9)in on))&&(sn[ln]=an[ln]);return sn};function shouldUpdateComponent(an,on,sn){const{props:ln,children:cn,component:un}=an,{props:dn,children:hn,patchFlag:fn}=on,pn=un.emitsOptions;if(on.dirs||on.transition)return!0;if(sn&&fn>=0){if(fn&1024)return!0;if(fn&16)return ln?hasPropsChanged(ln,dn,pn):!!dn;if(fn&8){const gn=on.dynamicProps;for(let mn=0;mn<gn.length;mn++){const bn=gn[mn];if(dn[bn]!==ln[bn]&&!isEmitListener(pn,bn))return!0}}}else return(cn||hn)&&(!hn||!hn.$stable)?!0:ln===dn?!1:ln?dn?hasPropsChanged(ln,dn,pn):!0:!!dn;return!1}function hasPropsChanged(an,on,sn){const ln=Object.keys(on);if(ln.length!==Object.keys(an).length)return!0;for(let cn=0;cn<ln.length;cn++){const un=ln[cn];if(on[un]!==an[un]&&!isEmitListener(sn,un))return!0}return!1}function updateHOCHostEl({vnode:an,parent:on},sn){for(;on;){const ln=on.subTree;if(ln.suspense&&ln.suspense.activeBranch===an&&(ln.el=an.el),ln===an)(an=on.vnode).el=sn,on=on.parent;else break}}const isSuspense=an=>an.__isSuspense;function queueEffectWithSuspense(an,on){on&&on.pendingBranch?isArray$1(an)?on.effects.push(...an):on.effects.push(an):queuePostFlushCb(an)}const Fragment=Symbol.for("v-fgt"),Text=Symbol.for("v-txt"),Comment=Symbol.for("v-cmt"),Static=Symbol.for("v-stc"),blockStack=[];let currentBlock=null;function openBlock$1(an=!1){blockStack.push(currentBlock=an?null:[])}function closeBlock(){blockStack.pop(),currentBlock=blockStack[blockStack.length-1]||null}let isBlockTreeEnabled=1;function setBlockTracking(an,on=!1){isBlockTreeEnabled+=an,an<0&&currentBlock&&on&&(currentBlock.hasOnce=!0)}function setupBlock(an){return an.dynamicChildren=isBlockTreeEnabled>0?currentBlock||EMPTY_ARR:null,closeBlock(),isBlockTreeEnabled>0&&currentBlock&&currentBlock.push(an),an}function createElementBlock(an,on,sn,ln,cn,un){return setupBlock(createBaseVNode(an,on,sn,ln,cn,un,!0))}function createBlock(an,on,sn,ln,cn){return setupBlock(createVNode(an,on,sn,ln,cn,!0))}function isVNode(an){return an?an.__v_isVNode===!0:!1}function isSameVNodeType(an,on){return an.type===on.type&&an.key===on.key}const normalizeKey=({key:an})=>an??null,normalizeRef=({ref:an,ref_key:on,ref_for:sn})=>(typeof an=="number"&&(an=""+an),an!=null?isString$1(an)||isRef(an)||isFunction(an)?{i:currentRenderingInstance,r:an,k:on,f:!!sn}:an:null);function createBaseVNode(an,on=null,sn=null,ln=0,cn=null,un=an===Fragment?0:1,dn=!1,hn=!1){const fn={__v_isVNode:!0,__v_skip:!0,type:an,props:on,key:on&&normalizeKey(on),ref:on&&normalizeRef(on),scopeId:currentScopeId,slotScopeIds:null,children:sn,component:null,suspense:null,ssContent:null,ssFallback:null,dirs:null,transition:null,el:null,anchor:null,target:null,targetStart:null,targetAnchor:null,staticCount:0,shapeFlag:un,patchFlag:ln,dynamicProps:cn,dynamicChildren:null,appContext:null,ctx:currentRenderingInstance};return hn?(normalizeChildren(fn,sn),un&128&&an.normalize(fn)):sn&&(fn.shapeFlag|=isString$1(sn)?8:16),isBlockTreeEnabled>0&&!dn&&currentBlock&&(fn.patchFlag>0||un&6)&&fn.patchFlag!==32&&currentBlock.push(fn),fn}const createVNode=_createVNode;function _createVNode(an,on=null,sn=null,ln=0,cn=null,un=!1){if((!an||an===NULL_DYNAMIC_COMPONENT)&&(an=Comment),isVNode(an)){const hn=cloneVNode(an,on,!0);return sn&&normalizeChildren(hn,sn),isBlockTreeEnabled>0&&!un&&currentBlock&&(hn.shapeFlag&6?currentBlock[currentBlock.indexOf(an)]=hn:currentBlock.push(hn)),hn.patchFlag=-2,hn}if(isClassComponent(an)&&(an=an.__vccOpts),on){on=guardReactiveProps(on);let{class:hn,style:fn}=on;hn&&!isString$1(hn)&&(on.class=normalizeClass(hn)),isObject$2(fn)&&(isProxy(fn)&&!isArray$1(fn)&&(fn=extend({},fn)),on.style=normalizeStyle(fn))}const dn=isString$1(an)?1:isSuspense(an)?128:isTeleport(an)?64:isObject$2(an)?4:isFunction(an)?2:0;return createBaseVNode(an,on,sn,ln,cn,dn,un,!0)}function guardReactiveProps(an){return an?isProxy(an)||isInternalObject(an)?extend({},an):an:null}function cloneVNode(an,on,sn=!1,ln=!1){const{props:cn,ref:un,patchFlag:dn,children:hn,transition:fn}=an,pn=on?mergeProps(cn||{},on):cn,gn={__v_isVNode:!0,__v_skip:!0,type:an.type,props:pn,key:pn&&normalizeKey(pn),ref:on&&on.ref?sn&&un?isArray$1(un)?un.concat(normalizeRef(on)):[un,normalizeRef(on)]:normalizeRef(on):un,scopeId:an.scopeId,slotScopeIds:an.slotScopeIds,children:hn,target:an.target,targetStart:an.targetStart,targetAnchor:an.targetAnchor,staticCount:an.staticCount,shapeFlag:an.shapeFlag,patchFlag:on&&an.type!==Fragment?dn===-1?16:dn|16:dn,dynamicProps:an.dynamicProps,dynamicChildren:an.dynamicChildren,appContext:an.appContext,dirs:an.dirs,transition:fn,component:an.component,suspense:an.suspense,ssContent:an.ssContent&&cloneVNode(an.ssContent),ssFallback:an.ssFallback&&cloneVNode(an.ssFallback),placeholder:an.placeholder,el:an.el,anchor:an.anchor,ctx:an.ctx,ce:an.ce};return fn&&ln&&setTransitionHooks(gn,fn.clone(gn)),gn}function createTextVNode(an=" ",on=0){return createVNode(Text,null,an,on)}function createStaticVNode(an,on){const sn=createVNode(Static,null,an);return sn.staticCount=on,sn}function createCommentVNode(an="",on=!1){return on?(openBlock$1(),createBlock(Comment,null,an)):createVNode(Comment,null,an)}function normalizeVNode(an){return an==null||typeof an=="boolean"?createVNode(Comment):isArray$1(an)?createVNode(Fragment,null,an.slice()):isVNode(an)?cloneIfMounted(an):createVNode(Text,null,String(an))}function cloneIfMounted(an){return an.el===null&&an.patchFlag!==-1||an.memo?an:cloneVNode(an)}function normalizeChildren(an,on){let sn=0;const{shapeFlag:ln}=an;if(on==null)on=null;else if(isArray$1(on))sn=16;else if(typeof on=="object")if(ln&65){const cn=on.default;cn&&(cn._c&&(cn._d=!1),normalizeChildren(an,cn()),cn._c&&(cn._d=!0));return}else{sn=32;const cn=on._;!cn&&!isInternalObject(on)?on._ctx=currentRenderingInstance:cn===3&&currentRenderingInstance&&(currentRenderingInstance.slots._===1?on._=1:(on._=2,an.patchFlag|=1024))}else isFunction(on)?(on={default:on,_ctx:currentRenderingInstance},sn=32):(on=String(on),ln&64?(sn=16,on=[createTextVNode(on)]):sn=8);an.children=on,an.shapeFlag|=sn}function mergeProps(...an){const on={};for(let sn=0;sn<an.length;sn++){const ln=an[sn];for(const cn in ln)if(cn==="class")on.class!==ln.class&&(on.class=normalizeClass([on.class,ln.class]));else if(cn==="style")on.style=normalizeStyle([on.style,ln.style]);else if(isOn(cn)){const un=on[cn],dn=ln[cn];dn&&un!==dn&&!(isArray$1(un)&&un.includes(dn))&&(on[cn]=un?[].concat(un,dn):dn)}else cn!==""&&(on[cn]=ln[cn])}return on}function invokeVNodeHook(an,on,sn,ln=null){callWithAsyncErrorHandling(an,on,7,[sn,ln])}const emptyAppContext=createAppContext();let uid=0;function createComponentInstance(an,on,sn){const ln=an.type,cn=(on?on.appContext:an.appContext)||emptyAppContext,un={uid:uid++,vnode:an,type:ln,parent:on,appContext:cn,root:null,next:null,subTree:null,effect:null,update:null,job:null,scope:new EffectScope(!0),render:null,proxy:null,exposed:null,exposeProxy:null,withProxy:null,provides:on?on.provides:Object.create(cn.provides),ids:on?on.ids:["",0,0],accessCache:null,renderCache:[],components:null,directives:null,propsOptions:normalizePropsOptions(ln,cn),emitsOptions:normalizeEmitsOptions(ln,cn),emit:null,emitted:null,propsDefaults:EMPTY_OBJ,inheritAttrs:ln.inheritAttrs,ctx:EMPTY_OBJ,data:EMPTY_OBJ,props:EMPTY_OBJ,attrs:EMPTY_OBJ,slots:EMPTY_OBJ,refs:EMPTY_OBJ,setupState:EMPTY_OBJ,setupContext:null,suspense:sn,suspenseId:sn?sn.pendingId:0,asyncDep:null,asyncResolved:!1,isMounted:!1,isUnmounted:!1,isDeactivated:!1,bc:null,c:null,bm:null,m:null,bu:null,u:null,um:null,bum:null,da:null,a:null,rtg:null,rtc:null,ec:null,sp:null};return un.ctx={_:un},un.root=on?on.root:un,un.emit=emit.bind(null,un),an.ce&&an.ce(un),un}let currentInstance=null;const getCurrentInstance=()=>currentInstance||currentRenderingInstance;let internalSetCurrentInstance,setInSSRSetupState;{const an=getGlobalThis(),on=(sn,ln)=>{let cn;return(cn=an[sn])||(cn=an[sn]=[]),cn.push(ln),un=>{cn.length>1?cn.forEach(dn=>dn(un)):cn[0](un)}};internalSetCurrentInstance=on("__VUE_INSTANCE_SETTERS__",sn=>currentInstance=sn),setInSSRSetupState=on("__VUE_SSR_SETTERS__",sn=>isInSSRComponentSetup=sn)}const setCurrentInstance=an=>{const on=currentInstance;return internalSetCurrentInstance(an),an.scope.on(),()=>{an.scope.off(),internalSetCurrentInstance(on)}},unsetCurrentInstance=()=>{currentInstance&&currentInstance.scope.off(),internalSetCurrentInstance(null)};function isStatefulComponent(an){return an.vnode.shapeFlag&4}let isInSSRComponentSetup=!1;function setupComponent(an,on=!1,sn=!1){on&&setInSSRSetupState(on);const{props:ln,children:cn}=an.vnode,un=isStatefulComponent(an);initProps(an,ln,un,on),initSlots(an,cn,sn||on);const dn=un?setupStatefulComponent(an,on):void 0;return on&&setInSSRSetupState(!1),dn}function setupStatefulComponent(an,on){const sn=an.type;an.accessCache=Object.create(null),an.proxy=new Proxy(an.ctx,PublicInstanceProxyHandlers);const{setup:ln}=sn;if(ln){pauseTracking();const cn=an.setupContext=ln.length>1?createSetupContext(an):null,un=setCurrentInstance(an),dn=callWithErrorHandling(ln,an,0,[an.props,cn]),hn=isPromise(dn);if(resetTracking(),un(),(hn||an.sp)&&!isAsyncWrapper(an)&&markAsyncBoundary(an),hn){if(dn.then(unsetCurrentInstance,unsetCurrentInstance),on)return dn.then(fn=>{handleSetupResult(an,fn)}).catch(fn=>{handleError(fn,an,0)});an.asyncDep=dn}else handleSetupResult(an,dn)}else finishComponentSetup(an)}function handleSetupResult(an,on,sn){isFunction(on)?an.type.__ssrInlineRender?an.ssrRender=on:an.render=on:isObject$2(on)&&(an.setupState=proxyRefs(on)),finishComponentSetup(an)}function finishComponentSetup(an,on,sn){const ln=an.type;an.render||(an.render=ln.render||NOOP);{const cn=setCurrentInstance(an);pauseTracking();try{applyOptions(an)}finally{resetTracking(),cn()}}}const attrsProxyHandlers={get(an,on){return track(an,"get",""),an[on]}};function createSetupContext(an){const on=sn=>{an.exposed=sn||{}};return{attrs:new Proxy(an.attrs,attrsProxyHandlers),slots:an.slots,emit:an.emit,expose:on}}function getComponentPublicInstance(an){return an.exposed?an.exposeProxy||(an.exposeProxy=new Proxy(proxyRefs(markRaw(an.exposed)),{get(on,sn){if(sn in on)return on[sn];if(sn in publicPropertiesMap)return publicPropertiesMap[sn](an)},has(on,sn){return sn in on||sn in publicPropertiesMap}})):an.proxy}const classifyRE=/(?:^|[-_])\w/g,classify=an=>an.replace(classifyRE,on=>on.toUpperCase()).replace(/[-_]/g,"");function getComponentName(an,on=!0){return isFunction(an)?an.displayName||an.name:an.name||on&&an.__name}function formatComponentName(an,on,sn=!1){let ln=getComponentName(on);if(!ln&&on.__file){const cn=on.__file.match(/([^/\\]+)\.\w+$/);cn&&(ln=cn[1])}if(!ln&&an&&an.parent){const cn=un=>{for(const dn in un)if(un[dn]===on)return dn};ln=cn(an.components||an.parent.type.components)||cn(an.appContext.components)}return ln?classify(ln):sn?"App":"Anonymous"}function isClassComponent(an){return isFunction(an)&&"__vccOpts"in an}const computed=(an,on)=>computed$1(an,on,isInSSRComponentSetup);function h$2(an,on,sn){try{setBlockTracking(-1);const ln=arguments.length;return ln===2?isObject$2(on)&&!isArray$1(on)?isVNode(on)?createVNode(an,null,[on]):createVNode(an,on):createVNode(an,null,on):(ln>3?sn=Array.prototype.slice.call(arguments,2):ln===3&&isVNode(sn)&&(sn=[sn]),createVNode(an,on,sn))}finally{setBlockTracking(1)}}const version$1="3.5.24";/**
* @vue/runtime-dom v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/let policy;const tt$1=typeof window<"u"&&window.trustedTypes;if(tt$1)try{policy=tt$1.createPolicy("vue",{createHTML:an=>an})}catch{}const unsafeToTrustedHTML=policy?an=>policy.createHTML(an):an=>an,svgNS="http://www.w3.org/2000/svg",mathmlNS="http://www.w3.org/1998/Math/MathML",doc=typeof document<"u"?document:null,templateContainer=doc&&doc.createElement("template"),nodeOps={insert:(an,on,sn)=>{on.insertBefore(an,sn||null)},remove:an=>{const on=an.parentNode;on&&on.removeChild(an)},createElement:(an,on,sn,ln)=>{const cn=on==="svg"?doc.createElementNS(svgNS,an):on==="mathml"?doc.createElementNS(mathmlNS,an):sn?doc.createElement(an,{is:sn}):doc.createElement(an);return an==="select"&&ln&&ln.multiple!=null&&cn.setAttribute("multiple",ln.multiple),cn},createText:an=>doc.createTextNode(an),createComment:an=>doc.createComment(an),setText:(an,on)=>{an.nodeValue=on},setElementText:(an,on)=>{an.textContent=on},parentNode:an=>an.parentNode,nextSibling:an=>an.nextSibling,querySelector:an=>doc.querySelector(an),setScopeId(an,on){an.setAttribute(on,"")},insertStaticContent(an,on,sn,ln,cn,un){const dn=sn?sn.previousSibling:on.lastChild;if(cn&&(cn===un||cn.nextSibling))for(;on.insertBefore(cn.cloneNode(!0),sn),!(cn===un||!(cn=cn.nextSibling)););else{templateContainer.innerHTML=unsafeToTrustedHTML(ln==="svg"?`<svg>${an}</svg>`:ln==="mathml"?`<math>${an}</math>`:an);const hn=templateContainer.content;if(ln==="svg"||ln==="mathml"){const fn=hn.firstChild;for(;fn.firstChild;)hn.appendChild(fn.firstChild);hn.removeChild(fn)}on.insertBefore(hn,sn)}return[dn?dn.nextSibling:on.firstChild,sn?sn.previousSibling:on.lastChild]}},TRANSITION="transition",ANIMATION="animation",vtcKey=Symbol("_vtc"),DOMTransitionPropsValidators={name:String,type:String,css:{type:Boolean,default:!0},duration:[String,Number,Object],enterFromClass:String,enterActiveClass:String,enterToClass:String,appearFromClass:String,appearActiveClass:String,appearToClass:String,leaveFromClass:String,leaveActiveClass:String,leaveToClass:String},TransitionPropsValidators=extend({},BaseTransitionPropsValidators,DOMTransitionPropsValidators),decorate$1=an=>(an.displayName="Transition",an.props=TransitionPropsValidators,an),Transition=decorate$1((an,{slots:on})=>h$2(BaseTransition,resolveTransitionProps(an),on)),callHook=(an,on=[])=>{isArray$1(an)?an.forEach(sn=>sn(...on)):an&&an(...on)},hasExplicitCallback=an=>an?isArray$1(an)?an.some(on=>on.length>1):an.length>1:!1;function resolveTransitionProps(an){const on={};for(const An in an)An in DOMTransitionPropsValidators||(on[An]=an[An]);if(an.css===!1)return on;const{name:sn="v",type:ln,duration:cn,enterFromClass:un=`${sn}-enter-from`,enterActiveClass:dn=`${sn}-enter-active`,enterToClass:hn=`${sn}-enter-to`,appearFromClass:fn=un,appearActiveClass:pn=dn,appearToClass:gn=hn,leaveFromClass:mn=`${sn}-leave-from`,leaveActiveClass:bn=`${sn}-leave-active`,leaveToClass:vn=`${sn}-leave-to`}=an,yn=normalizeDuration(cn),wn=yn&&yn[0],kn=yn&&yn[1],{onBeforeEnter:_n,onEnter:xn,onEnterCancelled:En,onLeave:Tn,onLeaveCancelled:Bn,onBeforeAppear:Nn=_n,onAppear:Mn=xn,onAppearCancelled:Ln=En}=on,On=(An,Vn,Sn,Rn)=>{An._enterCancelled=Rn,removeTransitionClass(An,Vn?gn:hn),removeTransitionClass(An,Vn?pn:dn),Sn&&Sn()},zn=(An,Vn)=>{An._isLeaving=!1,removeTransitionClass(An,mn),removeTransitionClass(An,vn),removeTransitionClass(An,bn),Vn&&Vn()},Pn=An=>(Vn,Sn)=>{const Rn=An?Mn:xn,Hn=()=>On(Vn,An,Sn);callHook(Rn,[Vn,Hn]),nextFrame(()=>{removeTransitionClass(Vn,An?fn:un),addTransitionClass(Vn,An?gn:hn),hasExplicitCallback(Rn)||whenTransitionEnds(Vn,ln,wn,Hn)})};return extend(on,{onBeforeEnter(An){callHook(_n,[An]),addTransitionClass(An,un),addTransitionClass(An,dn)},onBeforeAppear(An){callHook(Nn,[An]),addTransitionClass(An,fn),addTransitionClass(An,pn)},onEnter:Pn(!1),onAppear:Pn(!0),onLeave(An,Vn){An._isLeaving=!0;const Sn=()=>zn(An,Vn);addTransitionClass(An,mn),An._enterCancelled?(addTransitionClass(An,bn),forceReflow(An)):(forceReflow(An),addTransitionClass(An,bn)),nextFrame(()=>{An._isLeaving&&(removeTransitionClass(An,mn),addTransitionClass(An,vn),hasExplicitCallback(Tn)||whenTransitionEnds(An,ln,kn,Sn))}),callHook(Tn,[An,Sn])},onEnterCancelled(An){On(An,!1,void 0,!0),callHook(En,[An])},onAppearCancelled(An){On(An,!0,void 0,!0),callHook(Ln,[An])},onLeaveCancelled(An){zn(An),callHook(Bn,[An])}})}function normalizeDuration(an){if(an==null)return null;if(isObject$2(an))return[NumberOf(an.enter),NumberOf(an.leave)];{const on=NumberOf(an);return[on,on]}}function NumberOf(an){return toNumber(an)}function addTransitionClass(an,on){on.split(/\s+/).forEach(sn=>sn&&an.classList.add(sn)),(an[vtcKey]||(an[vtcKey]=new Set)).add(on)}function removeTransitionClass(an,on){on.split(/\s+/).forEach(ln=>ln&&an.classList.remove(ln));const sn=an[vtcKey];sn&&(sn.delete(on),sn.size||(an[vtcKey]=void 0))}function nextFrame(an){requestAnimationFrame(()=>{requestAnimationFrame(an)})}let endId=0;function whenTransitionEnds(an,on,sn,ln){const cn=an._endId=++endId,un=()=>{cn===an._endId&&ln()};if(sn!=null)return setTimeout(un,sn);const{type:dn,timeout:hn,propCount:fn}=getTransitionInfo(an,on);if(!dn)return ln();const pn=dn+"end";let gn=0;const mn=()=>{an.removeEventListener(pn,bn),un()},bn=vn=>{vn.target===an&&++gn>=fn&&mn()};setTimeout(()=>{gn<fn&&mn()},hn+1),an.addEventListener(pn,bn)}function getTransitionInfo(an,on){const sn=window.getComputedStyle(an),ln=yn=>(sn[yn]||"").split(", "),cn=ln(`${TRANSITION}Delay`),un=ln(`${TRANSITION}Duration`),dn=getTimeout(cn,un),hn=ln(`${ANIMATION}Delay`),fn=ln(`${ANIMATION}Duration`),pn=getTimeout(hn,fn);let gn=null,mn=0,bn=0;on===TRANSITION?dn>0&&(gn=TRANSITION,mn=dn,bn=un.length):on===ANIMATION?pn>0&&(gn=ANIMATION,mn=pn,bn=fn.length):(mn=Math.max(dn,pn),gn=mn>0?dn>pn?TRANSITION:ANIMATION:null,bn=gn?gn===TRANSITION?un.length:fn.length:0);const vn=gn===TRANSITION&&/\b(?:transform|all)(?:,|$)/.test(ln(`${TRANSITION}Property`).toString());return{type:gn,timeout:mn,propCount:bn,hasTransform:vn}}function getTimeout(an,on){for(;an.length<on.length;)an=an.concat(an);return Math.max(...on.map((sn,ln)=>toMs(sn)+toMs(an[ln])))}function toMs(an){return an==="auto"?0:Number(an.slice(0,-1).replace(",","."))*1e3}function forceReflow(an){return(an?an.ownerDocument:document).body.offsetHeight}function patchClass(an,on,sn){const ln=an[vtcKey];ln&&(on=(on?[on,...ln]:[...ln]).join(" ")),on==null?an.removeAttribute("class"):sn?an.setAttribute("class",on):an.className=on}const vShowOriginalDisplay=Symbol("_vod"),vShowHidden=Symbol("_vsh"),vShow={name:"show",beforeMount(an,{value:on},{transition:sn}){an[vShowOriginalDisplay]=an.style.display==="none"?"":an.style.display,sn&&on?sn.beforeEnter(an):setDisplay(an,on)},mounted(an,{value:on},{transition:sn}){sn&&on&&sn.enter(an)},updated(an,{value:on,oldValue:sn},{transition:ln}){!on!=!sn&&(ln?on?(ln.beforeEnter(an),setDisplay(an,!0),ln.enter(an)):ln.leave(an,()=>{setDisplay(an,!1)}):setDisplay(an,on))},beforeUnmount(an,{value:on}){setDisplay(an,on)}};function setDisplay(an,on){an.style.display=on?an[vShowOriginalDisplay]:"none",an[vShowHidden]=!on}const CSS_VAR_TEXT=Symbol(""),displayRE=/(?:^|;)\s*display\s*:/;function patchStyle(an,on,sn){const ln=an.style,cn=isString$1(sn);let un=!1;if(sn&&!cn){if(on)if(isString$1(on))for(const dn of on.split(";")){const hn=dn.slice(0,dn.indexOf(":")).trim();sn[hn]==null&&setStyle(ln,hn,"")}else for(const dn in on)sn[dn]==null&&setStyle(ln,dn,"");for(const dn in sn)dn==="display"&&(un=!0),setStyle(ln,dn,sn[dn])}else if(cn){if(on!==sn){const dn=ln[CSS_VAR_TEXT];dn&&(sn+=";"+dn),ln.cssText=sn,un=displayRE.test(sn)}}else on&&an.removeAttribute("style");vShowOriginalDisplay in an&&(an[vShowOriginalDisplay]=un?ln.display:"",an[vShowHidden]&&(ln.display="none"))}const importantRE=/\s*!important$/;function setStyle(an,on,sn){if(isArray$1(sn))sn.forEach(ln=>setStyle(an,on,ln));else if(sn==null&&(sn=""),on.startsWith("--"))an.setProperty(on,sn);else{const ln=autoPrefix(an,on);importantRE.test(sn)?an.setProperty(hyphenate(ln),sn.replace(importantRE,""),"important"):an[ln]=sn}}const prefixes=["Webkit","Moz","ms"],prefixCache={};function autoPrefix(an,on){const sn=prefixCache[on];if(sn)return sn;let ln=camelize(on);if(ln!=="filter"&&ln in an)return prefixCache[on]=ln;ln=capitalize(ln);for(let cn=0;cn<prefixes.length;cn++){const un=prefixes[cn]+ln;if(un in an)return prefixCache[on]=un}return on}const xlinkNS="http://www.w3.org/1999/xlink";function patchAttr(an,on,sn,ln,cn,un=isSpecialBooleanAttr(on)){ln&&on.startsWith("xlink:")?sn==null?an.removeAttributeNS(xlinkNS,on.slice(6,on.length)):an.setAttributeNS(xlinkNS,on,sn):sn==null||un&&!includeBooleanAttr(sn)?an.removeAttribute(on):an.setAttribute(on,un?"":isSymbol(sn)?String(sn):sn)}function patchDOMProp(an,on,sn,ln,cn){if(on==="innerHTML"||on==="textContent"){sn!=null&&(an[on]=on==="innerHTML"?unsafeToTrustedHTML(sn):sn);return}const un=an.tagName;if(on==="value"&&un!=="PROGRESS"&&!un.includes("-")){const hn=un==="OPTION"?an.getAttribute("value")||"":an.value,fn=sn==null?an.type==="checkbox"?"on":"":String(sn);(hn!==fn||!("_value"in an))&&(an.value=fn),sn==null&&an.removeAttribute(on),an._value=sn;return}let dn=!1;if(sn===""||sn==null){const hn=typeof an[on];hn==="boolean"?sn=includeBooleanAttr(sn):sn==null&&hn==="string"?(sn="",dn=!0):hn==="number"&&(sn=0,dn=!0)}try{an[on]=sn}catch{}dn&&an.removeAttribute(cn||on)}function addEventListener(an,on,sn,ln){an.addEventListener(on,sn,ln)}function removeEventListener(an,on,sn,ln){an.removeEventListener(on,sn,ln)}const veiKey=Symbol("_vei");function patchEvent(an,on,sn,ln,cn=null){const un=an[veiKey]||(an[veiKey]={}),dn=un[on];if(ln&&dn)dn.value=ln;else{const[hn,fn]=parseName(on);if(ln){const pn=un[on]=createInvoker(ln,cn);addEventListener(an,hn,pn,fn)}else dn&&(removeEventListener(an,hn,dn,fn),un[on]=void 0)}}const optionsModifierRE=/(?:Once|Passive|Capture)$/;function parseName(an){let on;if(optionsModifierRE.test(an)){on={};let ln;for(;ln=an.match(optionsModifierRE);)an=an.slice(0,an.length-ln[0].length),on[ln[0].toLowerCase()]=!0}return[an[2]===":"?an.slice(3):hyphenate(an.slice(2)),on]}let cachedNow=0;const p$2=Promise.resolve(),getNow=()=>cachedNow||(p$2.then(()=>cachedNow=0),cachedNow=Date.now());function createInvoker(an,on){const sn=ln=>{if(!ln._vts)ln._vts=Date.now();else if(ln._vts<=sn.attached)return;callWithAsyncErrorHandling(patchStopImmediatePropagation(ln,sn.value),on,5,[ln])};return sn.value=an,sn.attached=getNow(),sn}function patchStopImmediatePropagation(an,on){if(isArray$1(on)){const sn=an.stopImmediatePropagation;return an.stopImmediatePropagation=()=>{sn.call(an),an._stopped=!0},on.map(ln=>cn=>!cn._stopped&&ln&&ln(cn))}else return on}const isNativeOn=an=>an.charCodeAt(0)===111&&an.charCodeAt(1)===110&&an.charCodeAt(2)>96&&an.charCodeAt(2)<123,patchProp=(an,on,sn,ln,cn,un)=>{const dn=cn==="svg";on==="class"?patchClass(an,ln,dn):on==="style"?patchStyle(an,sn,ln):isOn(on)?isModelListener(on)||patchEvent(an,on,sn,ln,un):(on[0]==="."?(on=on.slice(1),!0):on[0]==="^"?(on=on.slice(1),!1):shouldSetAsProp(an,on,ln,dn))?(patchDOMProp(an,on,ln),!an.tagName.includes("-")&&(on==="value"||on==="checked"||on==="selected")&&patchAttr(an,on,ln,dn,un,on!=="value")):an._isVueCE&&(/[A-Z]/.test(on)||!isString$1(ln))?patchDOMProp(an,camelize(on),ln,un,on):(on==="true-value"?an._trueValue=ln:on==="false-value"&&(an._falseValue=ln),patchAttr(an,on,ln,dn))};function shouldSetAsProp(an,on,sn,ln){if(ln)return!!(on==="innerHTML"||on==="textContent"||on in an&&isNativeOn(on)&&isFunction(sn));if(on==="spellcheck"||on==="draggable"||on==="translate"||on==="autocorrect"||on==="sandbox"&&an.tagName==="IFRAME"||on==="form"||on==="list"&&an.tagName==="INPUT"||on==="type"&&an.tagName==="TEXTAREA")return!1;if(on==="width"||on==="height"){const cn=an.tagName;if(cn==="IMG"||cn==="VIDEO"||cn==="CANVAS"||cn==="SOURCE")return!1}return isNativeOn(on)&&isString$1(sn)?!1:on in an}const getModelAssigner=an=>{const on=an.props["onUpdate:modelValue"]||!1;return isArray$1(on)?sn=>invokeArrayFns(on,sn):on};function onCompositionStart(an){an.target.composing=!0}function onCompositionEnd(an){const on=an.target;on.composing&&(on.composing=!1,on.dispatchEvent(new Event("input")))}const assignKey=Symbol("_assign");function castValue(an,on,sn){return on&&(an=an.trim()),sn&&(an=looseToNumber(an)),an}const vModelText={created(an,{modifiers:{lazy:on,trim:sn,number:ln}},cn){an[assignKey]=getModelAssigner(cn);const un=ln||cn.props&&cn.props.type==="number";addEventListener(an,on?"change":"input",dn=>{dn.target.composing||an[assignKey](castValue(an.value,sn,un))}),(sn||un)&&addEventListener(an,"change",()=>{an.value=castValue(an.value,sn,un)}),on||(addEventListener(an,"compositionstart",onCompositionStart),addEventListener(an,"compositionend",onCompositionEnd),addEventListener(an,"change",onCompositionEnd))},mounted(an,{value:on}){an.value=on??""},beforeUpdate(an,{value:on,oldValue:sn,modifiers:{lazy:ln,trim:cn,number:un}},dn){if(an[assignKey]=getModelAssigner(dn),an.composing)return;const hn=(un||an.type==="number")&&!/^0\d/.test(an.value)?looseToNumber(an.value):an.value,fn=on??"";hn!==fn&&(document.activeElement===an&&an.type!=="range"&&(ln&&on===sn||cn&&an.value.trim()===fn)||(an.value=fn))}},vModelCheckbox={deep:!0,created(an,on,sn){an[assignKey]=getModelAssigner(sn),addEventListener(an,"change",()=>{const ln=an._modelValue,cn=getValue(an),un=an.checked,dn=an[assignKey];if(isArray$1(ln)){const hn=looseIndexOf(ln,cn),fn=hn!==-1;if(un&&!fn)dn(ln.concat(cn));else if(!un&&fn){const pn=[...ln];pn.splice(hn,1),dn(pn)}}else if(isSet(ln)){const hn=new Set(ln);un?hn.add(cn):hn.delete(cn),dn(hn)}else dn(getCheckboxValue(an,un))})},mounted:setChecked,beforeUpdate(an,on,sn){an[assignKey]=getModelAssigner(sn),setChecked(an,on,sn)}};function setChecked(an,{value:on,oldValue:sn},ln){an._modelValue=on;let cn;if(isArray$1(on))cn=looseIndexOf(on,ln.props.value)>-1;else if(isSet(on))cn=on.has(ln.props.value);else{if(on===sn)return;cn=looseEqual(on,getCheckboxValue(an,!0))}an.checked!==cn&&(an.checked=cn)}const vModelRadio={created(an,{value:on},sn){an.checked=looseEqual(on,sn.props.value),an[assignKey]=getModelAssigner(sn),addEventListener(an,"change",()=>{an[assignKey](getValue(an))})},beforeUpdate(an,{value:on,oldValue:sn},ln){an[assignKey]=getModelAssigner(ln),on!==sn&&(an.checked=looseEqual(on,ln.props.value))}},vModelSelect={deep:!0,created(an,{value:on,modifiers:{number:sn}},ln){const cn=isSet(on);addEventListener(an,"change",()=>{const un=Array.prototype.filter.call(an.options,dn=>dn.selected).map(dn=>sn?looseToNumber(getValue(dn)):getValue(dn));an[assignKey](an.multiple?cn?new Set(un):un:un[0]),an._assigning=!0,nextTick(()=>{an._assigning=!1})}),an[assignKey]=getModelAssigner(ln)},mounted(an,{value:on}){setSelected(an,on)},beforeUpdate(an,on,sn){an[assignKey]=getModelAssigner(sn)},updated(an,{value:on}){an._assigning||setSelected(an,on)}};function setSelected(an,on){const sn=an.multiple,ln=isArray$1(on);if(!(sn&&!ln&&!isSet(on))){for(let cn=0,un=an.options.length;cn<un;cn++){const dn=an.options[cn],hn=getValue(dn);if(sn)if(ln){const fn=typeof hn;fn==="string"||fn==="number"?dn.selected=on.some(pn=>String(pn)===String(hn)):dn.selected=looseIndexOf(on,hn)>-1}else dn.selected=on.has(hn);else if(looseEqual(getValue(dn),on)){an.selectedIndex!==cn&&(an.selectedIndex=cn);return}}!sn&&an.selectedIndex!==-1&&(an.selectedIndex=-1)}}function getValue(an){return"_value"in an?an._value:an.value}function getCheckboxValue(an,on){const sn=on?"_trueValue":"_falseValue";return sn in an?an[sn]:on}const vModelDynamic={created(an,on,sn){callModelHook(an,on,sn,null,"created")},mounted(an,on,sn){callModelHook(an,on,sn,null,"mounted")},beforeUpdate(an,on,sn,ln){callModelHook(an,on,sn,ln,"beforeUpdate")},updated(an,on,sn,ln){callModelHook(an,on,sn,ln,"updated")}};function resolveDynamicModel(an,on){switch(an){case"SELECT":return vModelSelect;case"TEXTAREA":return vModelText;default:switch(on){case"checkbox":return vModelCheckbox;case"radio":return vModelRadio;default:return vModelText}}}function callModelHook(an,on,sn,ln,cn){const dn=resolveDynamicModel(an.tagName,sn.props&&sn.props.type)[cn];dn&&dn(an,on,sn,ln)}const systemModifiers=["ctrl","shift","alt","meta"],modifierGuards={stop:an=>an.stopPropagation(),prevent:an=>an.preventDefault(),self:an=>an.target!==an.currentTarget,ctrl:an=>!an.ctrlKey,shift:an=>!an.shiftKey,alt:an=>!an.altKey,meta:an=>!an.metaKey,left:an=>"button"in an&&an.button!==0,middle:an=>"button"in an&&an.button!==1,right:an=>"button"in an&&an.button!==2,exact:(an,on)=>systemModifiers.some(sn=>an[`${sn}Key`]&&!on.includes(sn))},withModifiers=(an,on)=>{const sn=an._withMods||(an._withMods={}),ln=on.join(".");return sn[ln]||(sn[ln]=((cn,...un)=>{for(let dn=0;dn<on.length;dn++){const hn=modifierGuards[on[dn]];if(hn&&hn(cn,on))return}return an(cn,...un)}))},keyNames={esc:"escape",space:" ",up:"arrow-up",left:"arrow-left",right:"arrow-right",down:"arrow-down",delete:"backspace"},withKeys=(an,on)=>{const sn=an._withKeys||(an._withKeys={}),ln=on.join(".");return sn[ln]||(sn[ln]=(cn=>{if(!("key"in cn))return;const un=hyphenate(cn.key);if(on.some(dn=>dn===un||keyNames[dn]===un))return an(cn)}))},rendererOptions=extend({patchProp},nodeOps);let renderer;function ensureRenderer(){return renderer||(renderer=createRenderer(rendererOptions))}const createApp=((...an)=>{const on=ensureRenderer().createApp(...an),{mount:sn}=on;return on.mount=ln=>{const cn=normalizeContainer(ln);if(!cn)return;const un=on._component;!isFunction(un)&&!un.render&&!un.template&&(un.template=cn.innerHTML),cn.nodeType===1&&(cn.textContent="");const dn=sn(cn,!1,resolveRootNamespace(cn));return cn instanceof Element&&(cn.removeAttribute("v-cloak"),cn.setAttribute("data-v-app","")),dn},on});function resolveRootNamespace(an){if(an instanceof SVGElement)return"svg";if(typeof MathMLElement=="function"&&an instanceof MathMLElement)return"mathml"}function normalizeContainer(an){return isString$1(an)?document.querySelector(an):an}/**
* vue v3.5.24
* (c) 2018-present Yuxi (Evan) You and Vue contributors
* @license MIT
**/const vue_runtime_esmBundler=Object.freeze(Object.defineProperty({__proto__:null,BaseTransition,BaseTransitionPropsValidators,Comment,EffectScope,Fragment,ReactiveEffect,Static,Teleport,Text,Transition,callWithAsyncErrorHandling,callWithErrorHandling,camelize,capitalize,cloneVNode,computed,createApp,createBlock,createCommentVNode,createElementBlock,createElementVNode:createBaseVNode,createRenderer,createStaticVNode,createTextVNode,createVNode,defineComponent,getCurrentInstance,getCurrentScope,getTransitionRawChildren,guardReactiveProps,h:h$2,handleError,inject,isProxy,isReactive,isReadonly,isRef,isShallow,isVNode,markRaw,mergeProps,nextTick,normalizeClass,normalizeStyle,onActivated,onBeforeMount,onBeforeUnmount,onBeforeUpdate,onDeactivated,onErrorCaptured,onMounted,onRenderTracked,onRenderTriggered,onScopeDispose,onServerPrefetch,onUnmounted,onUpdated,onWatcherCleanup,openBlock:openBlock$1,provide,proxyRefs,queuePostFlushCb,reactive,readonly,ref,renderList,resolveDirective,resolveTransitionHooks,setBlockTracking,setTransitionHooks,shallowReactive,shallowReadonly,shallowRef,ssrContextKey,toDisplayString,toHandlerKey,toRaw,toValue,unref,useSSRContext,useSlots,useTransitionState,vModelCheckbox,vModelDynamic,vModelRadio,vModelSelect,vModelText,vShow,version:version$1,watch,withCtx,withDirectives,withKeys,withModifiers},Symbol.toStringTag,{value:"Module"}));function isPlainObject(an){if(an===null||typeof an!="object")return!1;const on=Object.getPrototypeOf(an);return on!==null&&on!==Object.prototype&&Object.getPrototypeOf(on)!==null||Symbol.iterator in an?!1:Symbol.toStringTag in an?Object.prototype.toString.call(an)==="[object Module]":!0}function _defu(an,on,sn=".",ln){if(!isPlainObject(on))return _defu(an,{},sn,ln);const cn=Object.assign({},on);for(const un in an){if(un==="__proto__"||un==="constructor")continue;const dn=an[un];dn!=null&&(ln&&ln(cn,un,dn,sn)||(Array.isArray(dn)&&Array.isArray(cn[un])?cn[un]=[...dn,...cn[un]]:isPlainObject(dn)&&isPlainObject(cn[un])?cn[un]=_defu(dn,cn[un],(sn?`${sn}.`:"")+un.toString(),ln):cn[un]=dn))}return cn}function createDefu(an){return(...on)=>on.reduce((sn,ln)=>_defu(sn,ln,"",an),{})}const defu=createDefu();function tryOnScopeDispose(an){return getCurrentScope()?(onScopeDispose(an),!0):!1}const isClient=typeof window<"u"&&typeof document<"u";typeof WorkerGlobalScope<"u"&&globalThis instanceof WorkerGlobalScope;const notNullish=an=>an!=null,toString$1=Object.prototype.toString,isObject$1=an=>toString$1.call(an)==="[object Object]",noop=()=>{};function toArray(an){return Array.isArray(an)?an:[an]}function getLifeCycleTarget(an){return getCurrentInstance()}function tryOnUnmounted(an,on){getLifeCycleTarget()&&onUnmounted(an,on)}function watchImmediate(an,on,sn){return watch(an,on,{...sn,immediate:!0})}const defaultWindow=isClient?window:void 0;function unrefElement(an){var on;const sn=toValue(an);return(on=sn==null?void 0:sn.$el)!=null?on:sn}function useEventListener(...an){const on=[],sn=()=>{on.forEach(hn=>hn()),on.length=0},ln=(hn,fn,pn,gn)=>(hn.addEventListener(fn,pn,gn),()=>hn.removeEventListener(fn,pn,gn)),cn=computed(()=>{const hn=toArray(toValue(an[0])).filter(fn=>fn!=null);return hn.every(fn=>typeof fn!="string")?hn:void 0}),un=watchImmediate(()=>{var hn,fn;return[(fn=(hn=cn.value)==null?void 0:hn.map(pn=>unrefElement(pn)))!=null?fn:[defaultWindow].filter(pn=>pn!=null),toArray(toValue(cn.value?an[1]:an[0])),toArray(unref(cn.value?an[2]:an[1])),toValue(cn.value?an[3]:an[2])]},([hn,fn,pn,gn])=>{if(sn(),!(hn!=null&&hn.length)||!(fn!=null&&fn.length)||!(pn!=null&&pn.length))return;const mn=isObject$1(gn)?{...gn}:gn;on.push(...hn.flatMap(bn=>fn.flatMap(vn=>pn.map(yn=>ln(bn,vn,yn,mn)))))},{flush:"post"}),dn=()=>{un(),sn()};return tryOnScopeDispose(sn),dn}function useMounted(){const an=shallowRef(!1),on=getCurrentInstance();return on&&onMounted(()=>{an.value=!0},on),an}function useSupported(an){const on=useMounted();return computed(()=>(on.value,!!an()))}function useIntersectionObserver(an,on,sn={}){const{root:ln,rootMargin:cn="0px",threshold:un=0,window:dn=defaultWindow,immediate:hn=!0}=sn,fn=useSupported(()=>dn&&"IntersectionObserver"in dn),pn=computed(()=>{const yn=toValue(an);return toArray(yn).map(unrefElement).filter(notNullish)});let gn=noop;const mn=shallowRef(hn),bn=fn.value?watch(()=>[pn.value,unrefElement(ln),mn.value],([yn,wn])=>{if(gn(),!mn.value||!yn.length)return;const kn=new IntersectionObserver(on,{root:unrefElement(wn),rootMargin:cn,threshold:un});yn.forEach(_n=>_n&&kn.observe(_n)),gn=()=>{kn.disconnect(),gn=noop}},{immediate:hn,flush:"post"}):noop,vn=()=>{gn(),bn(),mn.value=!1};return tryOnScopeDispose(vn),{isSupported:fn,isActive:mn,pause(){gn(),mn.value=!1},resume(){mn.value=!0},stop:vn}}const defaultTimestep=1/60*1e3,getCurrentTime=typeof performance<"u"?()=>performance.now():()=>Date.now(),onNextFrame=typeof window<"u"?an=>window.requestAnimationFrame(an):an=>setTimeout(()=>an(getCurrentTime()),defaultTimestep);function createRenderStep(an){let on=[],sn=[],ln=0,cn=!1,un=!1;const dn=new WeakSet,hn={schedule:(fn,pn=!1,gn=!1)=>{const mn=gn&&cn,bn=mn?on:sn;return pn&&dn.add(fn),bn.indexOf(fn)===-1&&(bn.push(fn),mn&&cn&&(ln=on.length)),fn},cancel:fn=>{const pn=sn.indexOf(fn);pn!==-1&&sn.splice(pn,1),dn.delete(fn)},process:fn=>{if(cn){un=!0;return}if(cn=!0,[on,sn]=[sn,on],sn.length=0,ln=on.length,ln)for(let pn=0;pn<ln;pn++){const gn=on[pn];gn(fn),dn.has(gn)&&(hn.schedule(gn),an())}cn=!1,un&&(un=!1,hn.process(fn))}};return hn}const maxElapsed=40;let useDefaultElapsed=!0,runNextFrame=!1,isProcessing=!1;const frame={delta:0,timestamp:0},stepsOrder=["read","update","preRender","render","postRender"],steps=stepsOrder.reduce((an,on)=>(an[on]=createRenderStep(()=>runNextFrame=!0),an),{}),sync=stepsOrder.reduce((an,on)=>{const sn=steps[on];return an[on]=(ln,cn=!1,un=!1)=>(runNextFrame||startLoop(),sn.schedule(ln,cn,un)),an},{}),cancelSync=stepsOrder.reduce((an,on)=>(an[on]=steps[on].cancel,an),{});stepsOrder.reduce((an,on)=>(an[on]=()=>steps[on].process(frame),an),{});const processStep=an=>steps[an].process(frame),processFrame=an=>{runNextFrame=!1,frame.delta=useDefaultElapsed?defaultTimestep:Math.max(Math.min(an-frame.timestamp,maxElapsed),1),frame.timestamp=an,isProcessing=!0,stepsOrder.forEach(processStep),isProcessing=!1,runNextFrame&&(useDefaultElapsed=!1,onNextFrame(processFrame))},startLoop=()=>{runNextFrame=!0,useDefaultElapsed=!0,isProcessing||onNextFrame(processFrame)},getFrameData=()=>frame;function __rest(an,on){var sn={};for(var ln in an)Object.prototype.hasOwnProperty.call(an,ln)&&on.indexOf(ln)<0&&(sn[ln]=an[ln]);if(an!=null&&typeof Object.getOwnPropertySymbols=="function")for(var cn=0,ln=Object.getOwnPropertySymbols(an);cn<ln.length;cn++)on.indexOf(ln[cn])<0&&Object.prototype.propertyIsEnumerable.call(an,ln[cn])&&(sn[ln[cn]]=an[ln[cn]]);return sn}var invariant=function(){};const clamp$1=(an,on,sn)=>Math.min(Math.max(sn,an),on),safeMin=.001,minDuration=.01,maxDuration=10,minDamping=.05,maxDamping=1;function findSpring({duration:an=800,bounce:on=.25,velocity:sn=0,mass:ln=1}){let cn,un,dn=1-on;dn=clamp$1(minDamping,maxDamping,dn),an=clamp$1(minDuration,maxDuration,an/1e3),dn<1?(cn=pn=>{const gn=pn*dn,mn=gn*an,bn=gn-sn,vn=calcAngularFreq(pn,dn),yn=Math.exp(-mn);return safeMin-bn/vn*yn},un=pn=>{const mn=pn*dn*an,bn=mn*sn+sn,vn=Math.pow(dn,2)*Math.pow(pn,2)*an,yn=Math.exp(-mn),wn=calcAngularFreq(Math.pow(pn,2),dn);return(-cn(pn)+safeMin>0?-1:1)*((bn-vn)*yn)/wn}):(cn=pn=>{const gn=Math.exp(-pn*an),mn=(pn-sn)*an+1;return-safeMin+gn*mn},un=pn=>{const gn=Math.exp(-pn*an),mn=(sn-pn)*(an*an);return gn*mn});const hn=5/an,fn=approximateRoot(cn,un,hn);if(an=an*1e3,isNaN(fn))return{stiffness:100,damping:10,duration:an};{const pn=Math.pow(fn,2)*ln;return{stiffness:pn,damping:dn*2*Math.sqrt(ln*pn),duration:an}}}const rootIterations=12;function approximateRoot(an,on,sn){let ln=sn;for(let cn=1;cn<rootIterations;cn++)ln=ln-an(ln)/on(ln);return ln}function calcAngularFreq(an,on){return an*Math.sqrt(1-on*on)}const durationKeys=["duration","bounce"],physicsKeys=["stiffness","damping","mass"];function isSpringType(an,on){return on.some(sn=>an[sn]!==void 0)}function getSpringOptions(an){let on=Object.assign({velocity:0,stiffness:100,damping:10,mass:1,isResolvedFromDuration:!1},an);if(!isSpringType(an,physicsKeys)&&isSpringType(an,durationKeys)){const sn=findSpring(an);on=Object.assign(Object.assign(Object.assign({},on),sn),{velocity:0,mass:1}),on.isResolvedFromDuration=!0}return on}function spring(an){var{from:on=0,to:sn=1,restSpeed:ln=2,restDelta:cn}=an,un=__rest(an,["from","to","restSpeed","restDelta"]);const dn={done:!1,value:on};let{stiffness:hn,damping:fn,mass:pn,velocity:gn,duration:mn,isResolvedFromDuration:bn}=getSpringOptions(un),vn=zero,yn=zero;function wn(){const kn=gn?-(gn/1e3):0,_n=sn-on,xn=fn/(2*Math.sqrt(hn*pn)),En=Math.sqrt(hn/pn)/1e3;if(cn===void 0&&(cn=Math.min(Math.abs(sn-on)/100,.4)),xn<1){const Tn=calcAngularFreq(En,xn);vn=Bn=>{const Nn=Math.exp(-xn*En*Bn);return sn-Nn*((kn+xn*En*_n)/Tn*Math.sin(Tn*Bn)+_n*Math.cos(Tn*Bn))},yn=Bn=>{const Nn=Math.exp(-xn*En*Bn);return xn*En*Nn*(Math.sin(Tn*Bn)*(kn+xn*En*_n)/Tn+_n*Math.cos(Tn*Bn))-Nn*(Math.cos(Tn*Bn)*(kn+xn*En*_n)-Tn*_n*Math.sin(Tn*Bn))}}else if(xn===1)vn=Tn=>sn-Math.exp(-En*Tn)*(_n+(kn+En*_n)*Tn);else{const Tn=En*Math.sqrt(xn*xn-1);vn=Bn=>{const Nn=Math.exp(-xn*En*Bn),Mn=Math.min(Tn*Bn,300);return sn-Nn*((kn+xn*En*_n)*Math.sinh(Mn)+Tn*_n*Math.cosh(Mn))/Tn}}}return wn(),{next:kn=>{const _n=vn(kn);if(bn)dn.done=kn>=mn;else{const xn=yn(kn)*1e3,En=Math.abs(xn)<=ln,Tn=Math.abs(sn-_n)<=cn;dn.done=En&&Tn}return dn.value=dn.done?sn:_n,dn},flipTarget:()=>{gn=-gn,[on,sn]=[sn,on],wn()}}}spring.needsInterpolation=(an,on)=>typeof an=="string"||typeof on=="string";const zero=an=>0,progress=(an,on,sn)=>{const ln=on-an;return ln===0?1:(sn-an)/ln},mix=(an,on,sn)=>-sn*an+sn*on+an,clamp=(an,on)=>sn=>Math.max(Math.min(sn,on),an),sanitize=an=>an%1?Number(an.toFixed(5)):an,floatRegex=/(-)?([\d]*\.?[\d])+/g,colorRegex=/(#[0-9a-f]{6}|#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))/gi,singleColorRegex=/^(#[0-9a-f]{3}|#(?:[0-9a-f]{2}){2,4}|(rgb|hsl)a?\((-?[\d\.]+%?[,\s]+){2}(-?[\d\.]+%?)\s*[\,\/]?\s*[\d\.]*%?\))$/i;function isString(an){return typeof an=="string"}const number={test:an=>typeof an=="number",parse:parseFloat,transform:an=>an},alpha=Object.assign(Object.assign({},number),{transform:clamp(0,1)}),scale=Object.assign(Object.assign({},number),{default:1}),createUnitType=an=>({test:on=>isString(on)&&on.endsWith(an)&&on.split(" ").length===1,parse:parseFloat,transform:on=>`${on}${an}`}),degrees=createUnitType("deg"),percent=createUnitType("%"),px=createUnitType("px"),progressPercentage=Object.assign(Object.assign({},percent),{parse:an=>percent.parse(an)/100,transform:an=>percent.transform(an*100)}),isColorString=(an,on)=>sn=>!!(isString(sn)&&singleColorRegex.test(sn)&&sn.startsWith(an)||on&&Object.prototype.hasOwnProperty.call(sn,on)),splitColor=(an,on,sn)=>ln=>{if(!isString(ln))return ln;const[cn,un,dn,hn]=ln.match(floatRegex);return{[an]:parseFloat(cn),[on]:parseFloat(un),[sn]:parseFloat(dn),alpha:hn!==void 0?parseFloat(hn):1}},hsla={test:isColorString("hsl","hue"),parse:splitColor("hue","saturation","lightness"),transform:({hue:an,saturation:on,lightness:sn,alpha:ln=1})=>"hsla("+Math.round(an)+", "+percent.transform(sanitize(on))+", "+percent.transform(sanitize(sn))+", "+sanitize(alpha.transform(ln))+")"},clampRgbUnit=clamp(0,255),rgbUnit=Object.assign(Object.assign({},number),{transform:an=>Math.round(clampRgbUnit(an))}),rgba={test:isColorString("rgb","red"),parse:splitColor("red","green","blue"),transform:({red:an,green:on,blue:sn,alpha:ln=1})=>"rgba("+rgbUnit.transform(an)+", "+rgbUnit.transform(on)+", "+rgbUnit.transform(sn)+", "+sanitize(alpha.transform(ln))+")"};function parseHex(an){let on="",sn="",ln="",cn="";return an.length>5?(on=an.substr(1,2),sn=an.substr(3,2),ln=an.substr(5,2),cn=an.substr(7,2)):(on=an.substr(1,1),sn=an.substr(2,1),ln=an.substr(3,1),cn=an.substr(4,1),on+=on,sn+=sn,ln+=ln,cn+=cn),{red:parseInt(on,16),green:parseInt(sn,16),blue:parseInt(ln,16),alpha:cn?parseInt(cn,16)/255:1}}const hex={test:isColorString("#"),parse:parseHex,transform:rgba.transform},color={test:an=>rgba.test(an)||hex.test(an)||hsla.test(an),parse:an=>rgba.test(an)?rgba.parse(an):hsla.test(an)?hsla.parse(an):hex.parse(an),transform:an=>isString(an)?an:an.hasOwnProperty("red")?rgba.transform(an):hsla.transform(an)},colorToken="${c}",numberToken="${n}";function test(an){var on,sn,ln,cn;return isNaN(an)&&isString(an)&&((sn=(on=an.match(floatRegex))===null||on===void 0?void 0:on.length)!==null&&sn!==void 0?sn:0)+((cn=(ln=an.match(colorRegex))===null||ln===void 0?void 0:ln.length)!==null&&cn!==void 0?cn:0)>0}function analyse$1(an){typeof an=="number"&&(an=`${an}`);const on=[];let sn=0;const ln=an.match(colorRegex);ln&&(sn=ln.length,an=an.replace(colorRegex,colorToken),on.push(...ln.map(color.parse)));const cn=an.match(floatRegex);return cn&&(an=an.replace(floatRegex,numberToken),on.push(...cn.map(number.parse))),{values:on,numColors:sn,tokenised:an}}function parse$1(an){return analyse$1(an).values}function createTransformer(an){const{values:on,numColors:sn,tokenised:ln}=analyse$1(an),cn=on.length;return un=>{let dn=ln;for(let hn=0;hn<cn;hn++)dn=dn.replace(hn<sn?colorToken:numberToken,hn<sn?color.transform(un[hn]):sanitize(un[hn]));return dn}}const convertNumbersToZero=an=>typeof an=="number"?0:an;function getAnimatableNone$1(an){const on=parse$1(an);return createTransformer(an)(on.map(convertNumbersToZero))}const complex={test,parse:parse$1,createTransformer,getAnimatableNone:getAnimatableNone$1},maxDefaults=new Set(["brightness","contrast","saturate","opacity"]);function applyDefaultFilter(an){let[on,sn]=an.slice(0,-1).split("(");if(on==="drop-shadow")return an;const[ln]=sn.match(floatRegex)||[];if(!ln)return an;const cn=sn.replace(ln,"");let un=maxDefaults.has(on)?1:0;return ln!==sn&&(un*=100),on+"("+un+cn+")"}const functionRegex=/([a-z-]*)\(.*?\)/g,filter$2=Object.assign(Object.assign({},complex),{getAnimatableNone:an=>{const on=an.match(functionRegex);return on?on.map(applyDefaultFilter).join(" "):an}});function hueToRgb(an,on,sn){return sn<0&&(sn+=1),sn>1&&(sn-=1),sn<1/6?an+(on-an)*6*sn:sn<1/2?on:sn<2/3?an+(on-an)*(2/3-sn)*6:an}function hslaToRgba({hue:an,saturation:on,lightness:sn,alpha:ln}){an/=360,on/=100,sn/=100;let cn=0,un=0,dn=0;if(!on)cn=un=dn=sn;else{const hn=sn<.5?sn*(1+on):sn+on-sn*on,fn=2*sn-hn;cn=hueToRgb(fn,hn,an+1/3),un=hueToRgb(fn,hn,an),dn=hueToRgb(fn,hn,an-1/3)}return{red:Math.round(cn*255),green:Math.round(un*255),blue:Math.round(dn*255),alpha:ln}}const mixLinearColor=(an,on,sn)=>{const ln=an*an,cn=on*on;return Math.sqrt(Math.max(0,sn*(cn-ln)+ln))},colorTypes=[hex,rgba,hsla],getColorType=an=>colorTypes.find(on=>on.test(an)),mixColor=(an,on)=>{let sn=getColorType(an),ln=getColorType(on),cn=sn.parse(an),un=ln.parse(on);sn===hsla&&(cn=hslaToRgba(cn),sn=rgba),ln===hsla&&(un=hslaToRgba(un),ln=rgba);const dn=Object.assign({},cn);return hn=>{for(const fn in dn)fn!=="alpha"&&(dn[fn]=mixLinearColor(cn[fn],un[fn],hn));return dn.alpha=mix(cn.alpha,un.alpha,hn),sn.transform(dn)}},isNum=an=>typeof an=="number",combineFunctions=(an,on)=>sn=>on(an(sn)),pipe=(...an)=>an.reduce(combineFunctions);function getMixer(an,on){return isNum(an)?sn=>mix(an,on,sn):color.test(an)?mixColor(an,on):mixComplex(an,on)}const mixArray=(an,on)=>{const sn=[...an],ln=sn.length,cn=an.map((un,dn)=>getMixer(un,on[dn]));return un=>{for(let dn=0;dn<ln;dn++)sn[dn]=cn[dn](un);return sn}},mixObject=(an,on)=>{const sn=Object.assign(Object.assign({},an),on),ln={};for(const cn in sn)an[cn]!==void 0&&on[cn]!==void 0&&(ln[cn]=getMixer(an[cn],on[cn]));return cn=>{for(const un in ln)sn[un]=ln[un](cn);return sn}};function analyse(an){const on=complex.parse(an),sn=on.length;let ln=0,cn=0,un=0;for(let dn=0;dn<sn;dn++)ln||typeof on[dn]=="number"?ln++:on[dn].hue!==void 0?un++:cn++;return{parsed:on,numNumbers:ln,numRGB:cn,numHSL:un}}const mixComplex=(an,on)=>{const sn=complex.createTransformer(on),ln=analyse(an),cn=analyse(on);return ln.numHSL===cn.numHSL&&ln.numRGB===cn.numRGB&&ln.numNumbers>=cn.numNumbers?pipe(mixArray(ln.parsed,cn.parsed),sn):dn=>`${dn>0?on:an}`},mixNumber=(an,on)=>sn=>mix(an,on,sn);function detectMixerFactory(an){if(typeof an=="number")return mixNumber;if(typeof an=="string")return color.test(an)?mixColor:mixComplex;if(Array.isArray(an))return mixArray;if(typeof an=="object")return mixObject}function createMixers(an,on,sn){const ln=[],cn=sn||detectMixerFactory(an[0]),un=an.length-1;for(let dn=0;dn<un;dn++){let hn=cn(an[dn],an[dn+1]);if(on){const fn=Array.isArray(on)?on[dn]:on;hn=pipe(fn,hn)}ln.push(hn)}return ln}function fastInterpolate([an,on],[sn]){return ln=>sn(progress(an,on,ln))}function slowInterpolate(an,on){const sn=an.length,ln=sn-1;return cn=>{let un=0,dn=!1;if(cn<=an[0]?dn=!0:cn>=an[ln]&&(un=ln-1,dn=!0),!dn){let fn=1;for(;fn<sn&&!(an[fn]>cn||fn===ln);fn++);un=fn-1}const hn=progress(an[un],an[un+1],cn);return on[un](hn)}}function interpolate(an,on,{clamp:sn=!0,ease:ln,mixer:cn}={}){const un=an.length;invariant(un===on.length),invariant(!ln||!Array.isArray(ln)||ln.length===un-1),an[0]>an[un-1]&&(an=[].concat(an),on=[].concat(on),an.reverse(),on.reverse());const dn=createMixers(on,ln,cn),hn=un===2?fastInterpolate(an,dn):slowInterpolate(an,dn);return sn?fn=>hn(clamp$1(an[0],an[un-1],fn)):hn}const reverseEasing=an=>on=>1-an(1-on),mirrorEasing=an=>on=>on<=.5?an(2*on)/2:(2-an(2*(1-on)))/2,createExpoIn=an=>on=>Math.pow(on,an),createBackIn=an=>on=>on*on*((an+1)*on-an),createAnticipate=an=>{const on=createBackIn(an);return sn=>(sn*=2)<1?.5*on(sn):.5*(2-Math.pow(2,-10*(sn-1)))},DEFAULT_OVERSHOOT_STRENGTH=1.525,BOUNCE_FIRST_THRESHOLD=4/11,BOUNCE_SECOND_THRESHOLD=8/11,BOUNCE_THIRD_THRESHOLD=9/10,linear=an=>an,easeIn=createExpoIn(2),easeOut=reverseEasing(easeIn),easeInOut=mirrorEasing(easeIn),circIn=an=>1-Math.sin(Math.acos(an)),circOut=reverseEasing(circIn),circInOut=mirrorEasing(circOut),backIn=createBackIn(DEFAULT_OVERSHOOT_STRENGTH),backOut=reverseEasing(backIn),backInOut=mirrorEasing(backIn),anticipate=createAnticipate(DEFAULT_OVERSHOOT_STRENGTH),ca=4356/361,cb=35442/1805,cc=16061/1805,bounceOut=an=>{if(an===1||an===0)return an;const on=an*an;return an<BOUNCE_FIRST_THRESHOLD?7.5625*on:an<BOUNCE_SECOND_THRESHOLD?9.075*on-9.9*an+3.4:an<BOUNCE_THIRD_THRESHOLD?ca*on-cb*an+cc:10.8*an*an-20.52*an+10.72},bounceIn=reverseEasing(bounceOut),bounceInOut=an=>an<.5?.5*(1-bounceOut(1-an*2)):.5*bounceOut(an*2-1)+.5;function defaultEasing(an,on){return an.map(()=>on||easeInOut).splice(0,an.length-1)}function defaultOffset(an){const on=an.length;return an.map((sn,ln)=>ln!==0?ln/(on-1):0)}function convertOffsetToTimes(an,on){return an.map(sn=>sn*on)}function keyframes$1({from:an=0,to:on=1,ease:sn,offset:ln,duration:cn=300}){const un={done:!1,value:an},dn=Array.isArray(on)?on:[an,on],hn=convertOffsetToTimes(ln&&ln.length===dn.length?ln:defaultOffset(dn),cn);function fn(){return interpolate(hn,dn,{ease:Array.isArray(sn)?sn:defaultEasing(dn,sn)})}let pn=fn();return{next:gn=>(un.value=pn(gn),un.done=gn>=cn,un),flipTarget:()=>{dn.reverse(),pn=fn()}}}function decay({velocity:an=0,from:on=0,power:sn=.8,timeConstant:ln=350,restDelta:cn=.5,modifyTarget:un}){const dn={done:!1,value:on};let hn=sn*an;const fn=on+hn,pn=un===void 0?fn:un(fn);return pn!==fn&&(hn=pn-on),{next:gn=>{const mn=-hn*Math.exp(-gn/ln);return dn.done=!(mn>cn||mn<-cn),dn.value=dn.done?pn:pn+mn,dn},flipTarget:()=>{}}}const types={keyframes:keyframes$1,spring,decay};function detectAnimationFromOptions(an){if(Array.isArray(an.to))return keyframes$1;if(types[an.type])return types[an.type];const on=new Set(Object.keys(an));return on.has("ease")||on.has("duration")&&!on.has("dampingRatio")?keyframes$1:on.has("dampingRatio")||on.has("stiffness")||on.has("mass")||on.has("damping")||on.has("restSpeed")||on.has("restDelta")?spring:keyframes$1}function loopElapsed(an,on,sn=0){return an-on-sn}function reverseElapsed(an,on,sn=0,ln=!0){return ln?loopElapsed(on+-an,on,sn):on-(an-on)+sn}function hasRepeatDelayElapsed(an,on,sn,ln){return ln?an>=on+sn:an<=-sn}const framesync=an=>{const on=({delta:sn})=>an(sn);return{start:()=>sync.update(on,!0),stop:()=>cancelSync.update(on)}};function animate$1(an){var on,sn,{from:ln,autoplay:cn=!0,driver:un=framesync,elapsed:dn=0,repeat:hn=0,repeatType:fn="loop",repeatDelay:pn=0,onPlay:gn,onStop:mn,onComplete:bn,onRepeat:vn,onUpdate:yn}=an,wn=__rest(an,["from","autoplay","driver","elapsed","repeat","repeatType","repeatDelay","onPlay","onStop","onComplete","onRepeat","onUpdate"]);let{to:kn}=wn,_n,xn=0,En=wn.duration,Tn,Bn=!1,Nn=!0,Mn;const Ln=detectAnimationFromOptions(wn);!((sn=(on=Ln).needsInterpolation)===null||sn===void 0)&&sn.call(on,ln,kn)&&(Mn=interpolate([0,100],[ln,kn],{clamp:!1}),ln=0,kn=100);const On=Ln(Object.assign(Object.assign({},wn),{from:ln,to:kn}));function zn(){xn++,fn==="reverse"?(Nn=xn%2===0,dn=reverseElapsed(dn,En,pn,Nn)):(dn=loopElapsed(dn,En,pn),fn==="mirror"&&On.flipTarget()),Bn=!1,vn&&vn()}function Pn(){_n.stop(),bn&&bn()}function An(Sn){if(Nn||(Sn=-Sn),dn+=Sn,!Bn){const Rn=On.next(Math.max(0,dn));Tn=Rn.value,Mn&&(Tn=Mn(Tn)),Bn=Nn?Rn.done:dn<=0}yn==null||yn(Tn),Bn&&(xn===0&&(En??(En=dn)),xn<hn?hasRepeatDelayElapsed(dn,En,pn,Nn)&&zn():Pn())}function Vn(){gn==null||gn(),_n=un(An),_n.start()}return cn&&Vn(),{stop:()=>{mn==null||mn(),_n.stop()}}}function velocityPerSecond(an,on){return on?an*(1e3/on):0}function inertia({from:an=0,velocity:on=0,min:sn,max:ln,power:cn=.8,timeConstant:un=750,bounceStiffness:dn=500,bounceDamping:hn=10,restDelta:fn=1,modifyTarget:pn,driver:gn,onUpdate:mn,onComplete:bn,onStop:vn}){let yn;function wn(En){return sn!==void 0&&En<sn||ln!==void 0&&En>ln}function kn(En){return sn===void 0?ln:ln===void 0||Math.abs(sn-En)<Math.abs(ln-En)?sn:ln}function _n(En){yn==null||yn.stop(),yn=animate$1(Object.assign(Object.assign({},En),{driver:gn,onUpdate:Tn=>{var Bn;mn==null||mn(Tn),(Bn=En.onUpdate)===null||Bn===void 0||Bn.call(En,Tn)},onComplete:bn,onStop:vn}))}function xn(En){_n(Object.assign({type:"spring",stiffness:dn,damping:hn,restDelta:fn},En))}if(wn(an))xn({from:an,velocity:on,to:kn(an)});else{let En=cn*on+an;typeof pn<"u"&&(En=pn(En));const Tn=kn(En),Bn=Tn===sn?-1:1;let Nn,Mn;const Ln=On=>{Nn=Mn,Mn=On,on=velocityPerSecond(On-Nn,getFrameData().delta),(Bn===1&&On>Tn||Bn===-1&&On<Tn)&&xn({from:On,to:Tn,velocity:on})};_n({type:"decay",from:an,velocity:on,timeConstant:un,power:cn,restDelta:fn,modifyTarget:pn,onUpdate:wn(En)?Ln:void 0})}return{stop:()=>yn==null?void 0:yn.stop()}}const a$2=(an,on)=>1-3*on+3*an,b$2=(an,on)=>3*on-6*an,c$2=an=>3*an,calcBezier=(an,on,sn)=>((a$2(on,sn)*an+b$2(on,sn))*an+c$2(on))*an,getSlope=(an,on,sn)=>3*a$2(on,sn)*an*an+2*b$2(on,sn)*an+c$2(on),subdivisionPrecision=1e-7,subdivisionMaxIterations=10;function binarySubdivide(an,on,sn,ln,cn){let un,dn,hn=0;do dn=on+(sn-on)/2,un=calcBezier(dn,ln,cn)-an,un>0?sn=dn:on=dn;while(Math.abs(un)>subdivisionPrecision&&++hn<subdivisionMaxIterations);return dn}const newtonIterations=8,newtonMinSlope=.001;function newtonRaphsonIterate(an,on,sn,ln){for(let cn=0;cn<newtonIterations;++cn){const un=getSlope(on,sn,ln);if(un===0)return on;const dn=calcBezier(on,sn,ln)-an;on-=dn/un}return on}const kSplineTableSize=11,kSampleStepSize=1/(kSplineTableSize-1);function cubicBezier(an,on,sn,ln){if(an===on&&sn===ln)return linear;const cn=new Float32Array(kSplineTableSize);for(let dn=0;dn<kSplineTableSize;++dn)cn[dn]=calcBezier(dn*kSampleStepSize,an,sn);function un(dn){let hn=0,fn=1;const pn=kSplineTableSize-1;for(;fn!==pn&&cn[fn]<=dn;++fn)hn+=kSampleStepSize;--fn;const gn=(dn-cn[fn])/(cn[fn+1]-cn[fn]),mn=hn+gn*kSampleStepSize,bn=getSlope(mn,an,sn);return bn>=newtonMinSlope?newtonRaphsonIterate(dn,mn,an,sn):bn===0?mn:binarySubdivide(dn,hn,hn+kSampleStepSize,an,sn)}return dn=>dn===0||dn===1?dn:calcBezier(un(dn),on,ln)}const __vite_import_meta_env__={},motionState={};class SubscriptionManager{constructor(){ir(this,"subscriptions",new Set)}add(on){return this.subscriptions.add(on),()=>this.subscriptions.delete(on)}notify(on,sn,ln){if(this.subscriptions.size)for(const cn of this.subscriptions)cn(on,sn,ln)}clear(){this.subscriptions.clear()}}function isFloat(an){return!Number.isNaN(Number.parseFloat(an))}class MotionValue{constructor(on){ir(this,"current");ir(this,"prev");ir(this,"timeDelta",0);ir(this,"lastUpdated",0);ir(this,"updateSubscribers",new SubscriptionManager);ir(this,"stopAnimation");ir(this,"canTrackVelocity",!1);ir(this,"updateAndNotify",on=>{this.prev=this.current,this.current=on;const{delta:sn,timestamp:ln}=getFrameData();this.lastUpdated!==ln&&(this.timeDelta=sn,this.lastUpdated=ln),sync.postRender(this.scheduleVelocityCheck),this.updateSubscribers.notify(this.current)});ir(this,"scheduleVelocityCheck",()=>sync.postRender(this.velocityCheck));ir(this,"velocityCheck",({timestamp:on})=>{this.canTrackVelocity||(this.canTrackVelocity=isFloat(this.current)),on!==this.lastUpdated&&(this.prev=this.current)});this.prev=this.current=on,this.canTrackVelocity=isFloat(this.current)}onChange(on){return this.updateSubscribers.add(on)}clearListeners(){this.updateSubscribers.clear()}set(on){this.updateAndNotify(on)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){return this.canTrackVelocity?velocityPerSecond(Number.parseFloat(this.current)-Number.parseFloat(this.prev),this.timeDelta):0}start(on){return this.stop(),new Promise(sn=>{const{stop:ln}=on(sn);this.stopAnimation=ln}).then(()=>this.clearAnimation())}stop(){this.stopAnimation&&this.stopAnimation(),this.clearAnimation()}isAnimating(){return!!this.stopAnimation}clearAnimation(){this.stopAnimation=null}destroy(){this.updateSubscribers.clear(),this.stop()}}function getMotionValue(an){return new MotionValue(an)}const{isArray}=Array;function useMotionValues(){const an=ref({}),on=ln=>{const cn=un=>{an.value[un]&&(an.value[un].stop(),an.value[un].destroy(),delete an.value[un])};ln?isArray(ln)?ln.forEach(cn):cn(ln):Object.keys(an.value).forEach(cn)},sn=(ln,cn,un)=>{if(an.value[ln])return an.value[ln];const dn=getMotionValue(cn);return dn.onChange(hn=>un[ln]=hn),an.value[ln]=dn,dn};return tryOnUnmounted(on),{motionValues:an,get:sn,stop:on}}function isKeyframesTarget(an){return Array.isArray(an)}function underDampedSpring(){return{type:"spring",stiffness:500,damping:25,restDelta:.5,restSpeed:10}}function criticallyDampedSpring(an){return{type:"spring",stiffness:550,damping:an===0?2*Math.sqrt(550):30,restDelta:.01,restSpeed:10}}function overDampedSpring(an){return{type:"spring",stiffness:550,damping:an===0?100:30,restDelta:.01,restSpeed:10}}function linearTween(){return{type:"keyframes",ease:"linear",duration:300}}function keyframes(an){return{type:"keyframes",duration:800,values:an}}const defaultTransitions={default:overDampedSpring,x:underDampedSpring,y:underDampedSpring,z:underDampedSpring,rotate:underDampedSpring,rotateX:underDampedSpring,rotateY:underDampedSpring,rotateZ:underDampedSpring,scaleX:criticallyDampedSpring,scaleY:criticallyDampedSpring,scale:criticallyDampedSpring,backgroundColor:linearTween,color:linearTween,opacity:linearTween};function getDefaultTransition(an,on){let sn;return isKeyframesTarget(on)?sn=keyframes:sn=defaultTransitions[an]||defaultTransitions.default,{to:on,...sn(on)}}const int={...number,transform:Math.round},valueTypes={color,backgroundColor:color,outlineColor:color,fill:color,stroke:color,borderColor:color,borderTopColor:color,borderRightColor:color,borderBottomColor:color,borderLeftColor:color,borderWidth:px,borderTopWidth:px,borderRightWidth:px,borderBottomWidth:px,borderLeftWidth:px,borderRadius:px,radius:px,borderTopLeftRadius:px,borderTopRightRadius:px,borderBottomRightRadius:px,borderBottomLeftRadius:px,width:px,maxWidth:px,height:px,maxHeight:px,size:px,top:px,right:px,bottom:px,left:px,padding:px,paddingTop:px,paddingRight:px,paddingBottom:px,paddingLeft:px,margin:px,marginTop:px,marginRight:px,marginBottom:px,marginLeft:px,rotate:degrees,rotateX:degrees,rotateY:degrees,rotateZ:degrees,scale,scaleX:scale,scaleY:scale,scaleZ:scale,skew:degrees,skewX:degrees,skewY:degrees,distance:px,translateX:px,translateY:px,translateZ:px,x:px,y:px,z:px,perspective:px,transformPerspective:px,opacity:alpha,originX:progressPercentage,originY:progressPercentage,originZ:px,zIndex:int,filter:filter$2,WebkitFilter:filter$2,fillOpacity:alpha,strokeOpacity:alpha,numOctaves:int},getValueType=an=>valueTypes[an];function getValueAsType(an,on){return on&&typeof an=="number"&&on.transform?on.transform(an):an}function getAnimatableNone(an,on){let sn=getValueType(an);return sn!==filter$2&&(sn=complex),sn.getAnimatableNone?sn.getAnimatableNone(on):void 0}const easingLookup={linear,easeIn,easeInOut,easeOut,circIn,circInOut,circOut,backIn,backInOut,backOut,anticipate,bounceIn,bounceInOut,bounceOut};function easingDefinitionToFunction(an){if(Array.isArray(an)){const[on,sn,ln,cn]=an;return cubicBezier(on,sn,ln,cn)}else if(typeof an=="string")return easingLookup[an];return an}function isEasingArray(an){return Array.isArray(an)&&typeof an[0]!="number"}function isAnimatable(an,on){return an==="zIndex"?!1:!!(typeof on=="number"||Array.isArray(on)||typeof on=="string"&&complex.test(on)&&!on.startsWith("url("))}function hydrateKeyframes(an){return Array.isArray(an.to)&&an.to[0]===null&&(an.to=[...an.to],an.to[0]=an.from),an}function convertTransitionToAnimationOptions({ease:an,times:on,delay:sn,...ln}){const cn={...ln};return on&&(cn.offset=on),an&&(cn.ease=isEasingArray(an)?an.map(easingDefinitionToFunction):easingDefinitionToFunction(an)),sn&&(cn.elapsed=-sn),cn}function getPopmotionAnimationOptions(an,on,sn){return Array.isArray(on.to)&&(an.duration||(an.duration=800)),hydrateKeyframes(on),isTransitionDefined(an)||(an={...an,...getDefaultTransition(sn,on.to)}),{...on,...convertTransitionToAnimationOptions(an)}}function isTransitionDefined({delay:an,repeat:on,repeatType:sn,repeatDelay:ln,from:cn,...un}){return!!Object.keys(un).length}function getValueTransition(an,on){return an[on]||an.default||an}function getAnimation(an,on,sn,ln,cn){const un=getValueTransition(ln,an);let dn=un.from===null||un.from===void 0?on.get():un.from;const hn=isAnimatable(an,sn);dn==="none"&&hn&&typeof sn=="string"&&(dn=getAnimatableNone(an,sn));const fn=isAnimatable(an,dn);function pn(mn){const bn={from:dn,to:sn,velocity:ln.velocity?ln.velocity:on.getVelocity(),onUpdate:vn=>on.set(vn)};return un.type==="inertia"||un.type==="decay"?inertia({...bn,...un}):animate$1({...getPopmotionAnimationOptions(un,bn,an),onUpdate:vn=>{bn.onUpdate(vn),un.onUpdate&&un.onUpdate(vn)},onComplete:()=>{cn&&cn(),mn&&mn()}})}function gn(mn){return on.set(sn),cn&&cn(),mn&&mn(),{stop:()=>{}}}return!fn||!hn||un.type===!1?gn:pn}function useMotionTransitions(){const{motionValues:an,stop:on,get:sn}=useMotionValues();return{motionValues:an,stop:on,push:(cn,un,dn,hn={},fn)=>{const pn=dn[cn],gn=sn(cn,pn,dn);if(hn&&hn.immediate){gn.set(un);return}const mn=getAnimation(cn,gn,un,hn,fn);gn.start(mn)}}}function useMotionControls(an,on={},{motionValues:sn,push:ln,stop:cn}=useMotionTransitions()){const un=unref(on),dn=ref(!1);watch(sn,mn=>{dn.value=Object.values(mn).filter(bn=>bn.isAnimating()).length>0},{immediate:!0,deep:!0});const hn=mn=>{if(!un||!un[mn])throw new Error(`The variant ${mn} does not exist.`);return un[mn]},fn=mn=>{typeof mn=="string"&&(mn=hn(mn));const bn=Object.entries(mn).map(([yn,wn])=>{if(yn!=="transition")return new Promise(kn=>ln(yn,wn,an,mn.transition||getDefaultTransition(yn,mn[yn]),kn))}).filter(Boolean);async function vn(){var yn,wn;await Promise.all(bn),(wn=(yn=mn.transition)==null?void 0:yn.onComplete)==null||wn.call(yn)}return Promise.all([vn()])};return{isAnimating:dn,apply:fn,set:mn=>{const bn=isObject$1(mn)?mn:hn(mn);Object.entries(bn).forEach(([vn,yn])=>{vn!=="transition"&&ln(vn,yn,an,{immediate:!0})})},leave:async mn=>{let bn;if(un&&(un.leave&&(bn=un.leave),!un.leave&&un.initial&&(bn=un.initial)),!bn){mn();return}await fn(bn),mn()},stop:cn}}const isBrowser=typeof window<"u",supportsPointerEvents=()=>isBrowser&&(window.onpointerdown===null||(__vite_import_meta_env__==null?void 0:__vite_import_meta_env__.TEST)),supportsTouchEvents=()=>isBrowser&&(window.ontouchstart===null||(__vite_import_meta_env__==null?void 0:__vite_import_meta_env__.TEST)),supportsMouseEvents=()=>isBrowser&&(window.onmousedown===null||(__vite_import_meta_env__==null?void 0:__vite_import_meta_env__.TEST));function registerEventListeners({target:an,state:on,variants:sn,apply:ln}){const cn=unref(sn),un=ref(!1),dn=ref(!1),hn=ref(!1),fn=computed(()=>{let gn=[...Object.keys(on.value||{})];return cn&&(cn.hovered&&(gn=[...gn,...Object.keys(cn.hovered)]),cn.tapped&&(gn=[...gn,...Object.keys(cn.tapped)]),cn.focused&&(gn=[...gn,...Object.keys(cn.focused)])),gn}),pn=computed(()=>{const gn={};Object.assign(gn,on.value),un.value&&cn.hovered&&Object.assign(gn,cn.hovered),dn.value&&cn.tapped&&Object.assign(gn,cn.tapped),hn.value&&cn.focused&&Object.assign(gn,cn.focused);for(const mn in gn)fn.value.includes(mn)||delete gn[mn];return gn});cn.hovered&&(useEventListener(an,"mouseenter",()=>un.value=!0),useEventListener(an,"mouseleave",()=>{un.value=!1,dn.value=!1})),cn.tapped&&(supportsMouseEvents()&&(useEventListener(an,"mousedown",()=>dn.value=!0),useEventListener(an,"mouseup",()=>dn.value=!1)),supportsPointerEvents()&&(useEventListener(an,"pointerdown",()=>dn.value=!0),useEventListener(an,"pointerup",()=>dn.value=!1)),supportsTouchEvents()&&(useEventListener(an,"touchstart",()=>dn.value=!0),useEventListener(an,"touchend",()=>dn.value=!1))),cn.focused&&(useEventListener(an,"focus",()=>hn.value=!0),useEventListener(an,"blur",()=>hn.value=!1)),watch([un,dn,hn],()=>{ln(pn.value)})}function registerLifeCycleHooks({set:an,target:on,variants:sn,variant:ln}){const cn=unref(sn);watch(()=>on,()=>{cn&&(cn.initial&&(an("initial"),ln.value="initial"),cn.enter&&(ln.value="enter"))},{immediate:!0,flush:"pre"})}function registerVariantsSync({state:an,apply:on}){watch(an,sn=>{sn&&on(sn)},{immediate:!0})}function registerVisibilityHooks({target:an,variants:on,variant:sn}){const ln=unref(on);ln&&(ln.visible||ln.visibleOnce)&&useIntersectionObserver(an,([{isIntersecting:cn}])=>{ln.visible?cn?sn.value="visible":sn.value="initial":ln.visibleOnce&&(cn&&sn.value!=="visibleOnce"?sn.value="visibleOnce":sn.value||(sn.value="initial"))})}function useMotionFeatures(an,on={syncVariants:!0,lifeCycleHooks:!0,visibilityHooks:!0,eventListeners:!0}){on.lifeCycleHooks&&registerLifeCycleHooks(an),on.syncVariants&&registerVariantsSync(an),on.visibilityHooks&&registerVisibilityHooks(an),on.eventListeners&&registerEventListeners(an)}function reactiveStyle(an={}){const on=reactive({...an}),sn=ref({});return watch(on,()=>{const ln={};for(const[cn,un]of Object.entries(on)){const dn=getValueType(cn),hn=getValueAsType(un,dn);ln[cn]=hn}sn.value=ln},{immediate:!0,deep:!0}),{state:on,style:sn}}function usePermissiveTarget(an,on){watch(()=>unrefElement(an),sn=>{sn&&on(sn)},{immediate:!0})}const translateAlias={x:"translateX",y:"translateY",z:"translateZ"};function reactiveTransform(an={},on=!0){const sn=reactive({...an}),ln=ref("");return watch(sn,cn=>{let un="",dn=!1;if(on&&(cn.x||cn.y||cn.z)){const hn=[cn.x||0,cn.y||0,cn.z||0].map(fn=>getValueAsType(fn,px)).join(",");un+=`translate3d(${hn}) `,dn=!0}for(const[hn,fn]of Object.entries(cn)){if(on&&(hn==="x"||hn==="y"||hn==="z"))continue;const pn=getValueType(hn),gn=getValueAsType(fn,pn);un+=`${translateAlias[hn]||hn}(${gn}) `}on&&!dn&&(un+="translateZ(0px) "),ln.value=un.trim()},{immediate:!0,deep:!0}),{state:sn,transform:ln}}const transformAxes=["","X","Y","Z"],order=["perspective","translate","scale","rotate","skew"],transformProps=["transformPerspective","x","y","z"];order.forEach(an=>{transformAxes.forEach(on=>{const sn=an+on;transformProps.push(sn)})});const transformPropSet=new Set(transformProps);function isTransformProp(an){return transformPropSet.has(an)}const transformOriginProps=new Set(["originX","originY","originZ"]);function isTransformOriginProp(an){return transformOriginProps.has(an)}function splitValues(an){const on={},sn={};return Object.entries(an).forEach(([ln,cn])=>{isTransformProp(ln)||isTransformOriginProp(ln)?on[ln]=cn:sn[ln]=cn}),{transform:on,style:sn}}function variantToStyle(an){const{transform:on,style:sn}=splitValues(an),{transform:ln}=reactiveTransform(on),{style:cn}=reactiveStyle(sn);return ln.value&&(cn.value.transform=ln.value),cn.value}function useElementStyle(an,on){let sn,ln;const{state:cn,style:un}=reactiveStyle();return usePermissiveTarget(an,dn=>{ln=dn;for(const hn of Object.keys(valueTypes))dn.style[hn]===null||dn.style[hn]===""||isTransformProp(hn)||isTransformOriginProp(hn)||(cn[hn]=dn.style[hn]);sn&&Object.entries(sn).forEach(([hn,fn])=>dn.style[hn]=fn),on&&on(cn)}),watch(un,dn=>{if(!ln){sn=dn;return}for(const hn in dn)ln.style[hn]=dn[hn]},{immediate:!0}),{style:cn}}function parseTransform(an){const on=an.trim().split(/\) |\)/);if(on.length===1)return{};const sn=ln=>ln.endsWith("px")||ln.endsWith("deg")?Number.parseFloat(ln):Number.isNaN(Number(ln))?Number(ln):ln;return on.reduce((ln,cn)=>{if(!cn)return ln;const[un,dn]=cn.split("("),fn=dn.split(",").map(gn=>sn(gn.endsWith(")")?gn.replace(")",""):gn.trim())),pn=fn.length===1?fn[0]:fn;return{...ln,[un]:pn}},{})}function stateFromTransform(an,on){Object.entries(parseTransform(on)).forEach(([sn,ln])=>{const cn=["x","y","z"];if(sn==="translate3d"){if(ln===0){cn.forEach(un=>an[un]=0);return}ln.forEach((un,dn)=>an[cn[dn]]=un);return}if(ln=Number.parseFloat(`${ln}`),sn==="translateX"){an.x=ln;return}if(sn==="translateY"){an.y=ln;return}if(sn==="translateZ"){an.z=ln;return}an[sn]=ln})}function useElementTransform(an,on){let sn,ln;const{state:cn,transform:un}=reactiveTransform();return usePermissiveTarget(an,dn=>{ln=dn,dn.style.transform&&stateFromTransform(cn,dn.style.transform),sn&&(dn.style.transform=sn),on&&on(cn)}),watch(un,dn=>{if(!ln){sn=dn;return}ln.style.transform=dn},{immediate:!0}),{transform:cn}}function objectEntries(an){return Object.entries(an)}function useMotionProperties(an,on){const sn=reactive({}),ln=dn=>Object.entries(dn).forEach(([hn,fn])=>sn[hn]=fn),{style:cn}=useElementStyle(an,ln),{transform:un}=useElementTransform(an,ln);return watch(sn,dn=>{objectEntries(dn).forEach(([hn,fn])=>{const pn=isTransformProp(hn)?un:cn;pn[hn]&&pn[hn]===fn||(pn[hn]=fn)})},{immediate:!0,deep:!0}),usePermissiveTarget(an,()=>on),{motionProperties:sn,style:cn,transform:un}}function useMotionVariants(an={}){const on=unref(an),sn=ref();return{state:computed(()=>{if(sn.value)return on[sn.value]}),variant:sn}}function useMotion(an,on={},sn){const{motionProperties:ln}=useMotionProperties(an),{variant:cn,state:un}=useMotionVariants(on),dn=useMotionControls(ln,on),hn={target:an,variant:cn,variants:on,state:un,motionProperties:ln,...dn};return useMotionFeatures(hn,sn),hn}const transitionKeys=["delay","duration"],directivePropsKeys=["initial","enter","leave","visible","visible-once","visibleOnce","hovered","tapped","focused",...transitionKeys];function isTransitionKey(an){return transitionKeys.includes(an)}function resolveVariants(an,on){const sn=an.props?an.props:an.data&&an.data.attrs?an.data.attrs:{};if(sn){sn.variants&&isObject$1(sn.variants)&&(on.value={...on.value,...sn.variants});for(let ln of directivePropsKeys)if(!(!sn||!sn[ln])){if(isTransitionKey(ln)&&typeof sn[ln]=="number"){for(const cn of["enter","visible","visibleOnce"]){const un=on.value[cn];un!=null&&(un.transition??(un.transition={}),un.transition[ln]=sn[ln])}continue}if(isObject$1(sn[ln])){const cn=sn[ln];ln==="visible-once"&&(ln="visibleOnce"),on.value[ln]=cn}}}}function directive(an,on=!1){return{created:(cn,un,dn)=>{const hn=un.value&&typeof un.value=="string"?un.value:dn.key;hn&&motionState[hn]&&motionState[hn].stop();const fn=on?structuredClone(toRaw(an)||{}):an||{},pn=ref(fn);typeof un.value=="object"&&(pn.value=un.value),resolveVariants(dn,pn);const mn=useMotion(cn,pn,{eventListeners:!0,lifeCycleHooks:!0,syncVariants:!0,visibilityHooks:!1});cn.motionInstance=mn,hn&&(motionState[hn]=mn)},mounted:(cn,un,dn)=>{cn.motionInstance&&registerVisibilityHooks(cn.motionInstance)},getSSRProps(cn,un){let{initial:dn}=cn.value||un&&(un==null?void 0:un.props)||{};dn=unref(dn);const hn=defu({},(an==null?void 0:an.initial)||{},dn||{});return!hn||Object.keys(hn).length===0?void 0:{style:variantToStyle(hn)}}}}const fade={initial:{opacity:0},enter:{opacity:1}},fadeVisible={initial:{opacity:0},visible:{opacity:1}},fadeVisibleOnce={initial:{opacity:0},visibleOnce:{opacity:1}},pop={initial:{scale:0,opacity:0},enter:{scale:1,opacity:1}},popVisible={initial:{scale:0,opacity:0},visible:{scale:1,opacity:1}},popVisibleOnce={initial:{scale:0,opacity:0},visibleOnce:{scale:1,opacity:1}},rollLeft={initial:{x:-100,rotate:90,opacity:0},enter:{x:0,rotate:0,opacity:1}},rollVisibleLeft={initial:{x:-100,rotate:90,opacity:0},visible:{x:0,rotate:0,opacity:1}},rollVisibleOnceLeft={initial:{x:-100,rotate:90,opacity:0},visibleOnce:{x:0,rotate:0,opacity:1}},rollRight={initial:{x:100,rotate:-90,opacity:0},enter:{x:0,rotate:0,opacity:1}},rollVisibleRight={initial:{x:100,rotate:-90,opacity:0},visible:{x:0,rotate:0,opacity:1}},rollVisibleOnceRight={initial:{x:100,rotate:-90,opacity:0},visibleOnce:{x:0,rotate:0,opacity:1}},rollTop={initial:{y:-100,rotate:-90,opacity:0},enter:{y:0,rotate:0,opacity:1}},rollVisibleTop={initial:{y:-100,rotate:-90,opacity:0},visible:{y:0,rotate:0,opacity:1}},rollVisibleOnceTop={initial:{y:-100,rotate:-90,opacity:0},visibleOnce:{y:0,rotate:0,opacity:1}},rollBottom={initial:{y:100,rotate:90,opacity:0},enter:{y:0,rotate:0,opacity:1}},rollVisibleBottom={initial:{y:100,rotate:90,opacity:0},visible:{y:0,rotate:0,opacity:1}},rollVisibleOnceBottom={initial:{y:100,rotate:90,opacity:0},visibleOnce:{y:0,rotate:0,opacity:1}},slideLeft={initial:{x:-100,opacity:0},enter:{x:0,opacity:1}},slideVisibleLeft={initial:{x:-100,opacity:0},visible:{x:0,opacity:1}},slideVisibleOnceLeft={initial:{x:-100,opacity:0},visibleOnce:{x:0,opacity:1}},slideRight={initial:{x:100,opacity:0},enter:{x:0,opacity:1}},slideVisibleRight={initial:{x:100,opacity:0},visible:{x:0,opacity:1}},slideVisibleOnceRight={initial:{x:100,opacity:0},visibleOnce:{x:0,opacity:1}},slideTop={initial:{y:-100,opacity:0},enter:{y:0,opacity:1}},slideVisibleTop={initial:{y:-100,opacity:0},visible:{y:0,opacity:1}},slideVisibleOnceTop={initial:{y:-100,opacity:0},visibleOnce:{y:0,opacity:1}},slideBottom={initial:{y:100,opacity:0},enter:{y:0,opacity:1}},slideVisibleBottom={initial:{y:100,opacity:0},visible:{y:0,opacity:1}},slideVisibleOnceBottom={initial:{y:100,opacity:0},visibleOnce:{y:0,opacity:1}},presets={__proto__:null,fade,fadeVisible,fadeVisibleOnce,pop,popVisible,popVisibleOnce,rollBottom,rollLeft,rollRight,rollTop,rollVisibleBottom,rollVisibleLeft,rollVisibleOnceBottom,rollVisibleOnceLeft,rollVisibleOnceRight,rollVisibleOnceTop,rollVisibleRight,rollVisibleTop,slideBottom,slideLeft,slideRight,slideTop,slideVisibleBottom,slideVisibleLeft,slideVisibleOnceBottom,slideVisibleOnceLeft,slideVisibleOnceRight,slideVisibleOnceTop,slideVisibleRight,slideVisibleTop};function slugify(an){const on="/_,:;",sn="aaaaaaaaaacccddeeeeeeeegghiiiiiilmnnnnoooooooooprrsssssttuuuuuuuuuwxyyzzz------",ln=new RegExp(on.split("").join("|"),"g");return an.toString().replace(/[A-Z]/g,cn=>`-${cn}`).toLowerCase().replace(/\s+/g,"-").replace(ln,cn=>sn.charAt(on.indexOf(cn))).replace(/&/g,"-and-").replace(/[^\w\-]+/g,"").replace(/-{2,}/g,"-").replace(/^-+/,"").replace(/-+$/,"")}const CUSTOM_PRESETS=Symbol(""),MotionComponentProps={preset:{type:String,required:!1},instance:{type:Object,required:!1},variants:{type:Object,required:!1},initial:{type:Object,required:!1},enter:{type:Object,required:!1},leave:{type:Object,required:!1},visible:{type:Object,required:!1},visibleOnce:{type:Object,required:!1},hovered:{type:Object,required:!1},tapped:{type:Object,required:!1},focused:{type:Object,required:!1},delay:{type:[Number,String],required:!1},duration:{type:[Number,String],required:!1}};function isObject(an){return Object.prototype.toString.call(an)==="[object Object]"}function clone(an){if(Array.isArray(an))return an.map(clone);if(isObject(an)){const on={};for(const sn in an)on[sn]=clone(an[sn]);return on}return an}function setupMotionComponent(an){const on=reactive({}),sn=inject(CUSTOM_PRESETS,{}),ln=computed(()=>an.preset==null?{}:sn!=null&&an.preset in sn?structuredClone(toRaw(sn)[an.preset]):an.preset in presets?structuredClone(presets[an.preset]):{}),cn=computed(()=>({initial:an.initial,enter:an.enter,leave:an.leave,visible:an.visible,visibleOnce:an.visibleOnce,hovered:an.hovered,tapped:an.tapped,focused:an.focused}));function un(fn,pn){for(const gn of["delay","duration"]){if(pn[gn]==null)continue;const mn=Number.parseInt(pn[gn]);for(const bn of["enter","visible","visibleOnce"]){const vn=fn[bn];vn!=null&&(vn.transition??(vn.transition={}),vn.transition[gn]=mn)}}return fn}const dn=computed(()=>{const fn=defu({},cn.value,ln.value,an.variants||{});return un({...fn},an)});function hn(fn,pn,gn){var bn;fn.props??(fn.props={}),(bn=fn.props).style??(bn.style={}),fn.props.style={...fn.props.style,...gn};const mn=un(clone(dn.value),fn.props);return fn.props.onVnodeMounted=({el:vn})=>{on[pn]=useMotion(vn,mn)},fn.props.onVnodeUpdated=({el:vn})=>{const yn=variantToStyle(on[pn].state);for(const[wn,kn]of Object.entries(yn))vn.style[wn]=kn},fn}return{motionConfig:dn,setNodeInstance:hn}}const MotionComponent=defineComponent({name:"Motion",props:{...MotionComponentProps,is:{type:[String,Object],default:"div"}},setup(an){const on=useSlots(),{motionConfig:sn,setNodeInstance:ln}=setupMotionComponent(an);return()=>{const cn=variantToStyle(sn.value.initial||{}),un=h$2(an.is,void 0,on);return ln(un,0,cn),un}}}),MotionGroupComponent=defineComponent({name:"MotionGroup",props:{...MotionComponentProps,is:{type:[String,Object],required:!1}},setup(an){const on=useSlots(),{motionConfig:sn,setNodeInstance:ln}=setupMotionComponent(an);return()=>{var dn;const cn=variantToStyle(sn.value.initial||{}),un=((dn=on.default)==null?void 0:dn.call(on))||[];for(let hn=0;hn<un.length;hn++){const fn=un[hn];fn.type===Fragment&&Array.isArray(fn.children)?fn.children.forEach(function pn(gn,mn){if(gn!=null){if(Array.isArray(gn)){pn(gn,mn);return}typeof gn=="object"&&ln(gn,mn,cn)}}):ln(fn,hn,cn)}return an.is?h$2(an.is,void 0,un):un}}}),MotionPlugin={install(an,on){if(an.directive("motion",directive()),!on||on&&!on.excludePresets)for(const sn in presets){const ln=presets[sn];an.directive(`motion-${slugify(sn)}`,directive(ln,!0))}if(on&&on.directives)for(const sn in on.directives){const ln=on.directives[sn];ln.initial,an.directive(`motion-${sn}`,directive(ln,!0))}an.provide(CUSTOM_PRESETS,on==null?void 0:on.directives),an.component("Motion",MotionComponent),an.component("MotionGroup",MotionGroupComponent)}};var commonjsGlobal=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function getDefaultExportFromCjs(an){return an&&an.__esModule&&Object.prototype.hasOwnProperty.call(an,"default")?an.default:an}function commonjsRequire(an){throw new Error('Could not dynamically require "'+an+'". Please configure the dynamicRequireTargets or/and ignoreDynamicRequires option of @rollup/plugin-commonjs appropriately for this require call to work.')}var jszip_min$1={exports:{}};/*!

JSZip v3.10.1 - A JavaScript class for generating and reading zip files
<http://stuartk.com/jszip>

(c) 2009-2016 Stuart Knightley <stuart [at] stuartk.com>
Dual licenced under the MIT license or GPLv3. See https://raw.github.com/Stuk/jszip/main/LICENSE.markdown.

JSZip uses the library pako released under the MIT license :
https://github.com/nodeca/pako/blob/main/LICENSE
*/var hasRequiredJszip_min;function requireJszip_min(){return hasRequiredJszip_min||(hasRequiredJszip_min=1,(function(an,on){(function(sn){an.exports=sn()})(function(){return(function sn(ln,cn,un){function dn(pn,gn){if(!cn[pn]){if(!ln[pn]){var mn=typeof commonjsRequire=="function"&&commonjsRequire;if(!gn&&mn)return mn(pn,!0);if(hn)return hn(pn,!0);var bn=new Error("Cannot find module '"+pn+"'");throw bn.code="MODULE_NOT_FOUND",bn}var vn=cn[pn]={exports:{}};ln[pn][0].call(vn.exports,function(yn){var wn=ln[pn][1][yn];return dn(wn||yn)},vn,vn.exports,sn,ln,cn,un)}return cn[pn].exports}for(var hn=typeof commonjsRequire=="function"&&commonjsRequire,fn=0;fn<un.length;fn++)dn(un[fn]);return dn})({1:[function(sn,ln,cn){var un=sn("./utils"),dn=sn("./support"),hn="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";cn.encode=function(fn){for(var pn,gn,mn,bn,vn,yn,wn,kn=[],_n=0,xn=fn.length,En=xn,Tn=un.getTypeOf(fn)!=="string";_n<fn.length;)En=xn-_n,mn=Tn?(pn=fn[_n++],gn=_n<xn?fn[_n++]:0,_n<xn?fn[_n++]:0):(pn=fn.charCodeAt(_n++),gn=_n<xn?fn.charCodeAt(_n++):0,_n<xn?fn.charCodeAt(_n++):0),bn=pn>>2,vn=(3&pn)<<4|gn>>4,yn=1<En?(15&gn)<<2|mn>>6:64,wn=2<En?63&mn:64,kn.push(hn.charAt(bn)+hn.charAt(vn)+hn.charAt(yn)+hn.charAt(wn));return kn.join("")},cn.decode=function(fn){var pn,gn,mn,bn,vn,yn,wn=0,kn=0,_n="data:";if(fn.substr(0,_n.length)===_n)throw new Error("Invalid base64 input, it looks like a data url.");var xn,En=3*(fn=fn.replace(/[^A-Za-z0-9+/=]/g,"")).length/4;if(fn.charAt(fn.length-1)===hn.charAt(64)&&En--,fn.charAt(fn.length-2)===hn.charAt(64)&&En--,En%1!=0)throw new Error("Invalid base64 input, bad content length.");for(xn=dn.uint8array?new Uint8Array(0|En):new Array(0|En);wn<fn.length;)pn=hn.indexOf(fn.charAt(wn++))<<2|(bn=hn.indexOf(fn.charAt(wn++)))>>4,gn=(15&bn)<<4|(vn=hn.indexOf(fn.charAt(wn++)))>>2,mn=(3&vn)<<6|(yn=hn.indexOf(fn.charAt(wn++))),xn[kn++]=pn,vn!==64&&(xn[kn++]=gn),yn!==64&&(xn[kn++]=mn);return xn}},{"./support":30,"./utils":32}],2:[function(sn,ln,cn){var un=sn("./external"),dn=sn("./stream/DataWorker"),hn=sn("./stream/Crc32Probe"),fn=sn("./stream/DataLengthProbe");function pn(gn,mn,bn,vn,yn){this.compressedSize=gn,this.uncompressedSize=mn,this.crc32=bn,this.compression=vn,this.compressedContent=yn}pn.prototype={getContentWorker:function(){var gn=new dn(un.Promise.resolve(this.compressedContent)).pipe(this.compression.uncompressWorker()).pipe(new fn("data_length")),mn=this;return gn.on("end",function(){if(this.streamInfo.data_length!==mn.uncompressedSize)throw new Error("Bug : uncompressed data size mismatch")}),gn},getCompressedWorker:function(){return new dn(un.Promise.resolve(this.compressedContent)).withStreamInfo("compressedSize",this.compressedSize).withStreamInfo("uncompressedSize",this.uncompressedSize).withStreamInfo("crc32",this.crc32).withStreamInfo("compression",this.compression)}},pn.createWorkerFrom=function(gn,mn,bn){return gn.pipe(new hn).pipe(new fn("uncompressedSize")).pipe(mn.compressWorker(bn)).pipe(new fn("compressedSize")).withStreamInfo("compression",mn)},ln.exports=pn},{"./external":6,"./stream/Crc32Probe":25,"./stream/DataLengthProbe":26,"./stream/DataWorker":27}],3:[function(sn,ln,cn){var un=sn("./stream/GenericWorker");cn.STORE={magic:"\0\0",compressWorker:function(){return new un("STORE compression")},uncompressWorker:function(){return new un("STORE decompression")}},cn.DEFLATE=sn("./flate")},{"./flate":7,"./stream/GenericWorker":28}],4:[function(sn,ln,cn){var un=sn("./utils"),dn=(function(){for(var hn,fn=[],pn=0;pn<256;pn++){hn=pn;for(var gn=0;gn<8;gn++)hn=1&hn?3988292384^hn>>>1:hn>>>1;fn[pn]=hn}return fn})();ln.exports=function(hn,fn){return hn!==void 0&&hn.length?un.getTypeOf(hn)!=="string"?(function(pn,gn,mn,bn){var vn=dn,yn=bn+mn;pn^=-1;for(var wn=bn;wn<yn;wn++)pn=pn>>>8^vn[255&(pn^gn[wn])];return-1^pn})(0|fn,hn,hn.length,0):(function(pn,gn,mn,bn){var vn=dn,yn=bn+mn;pn^=-1;for(var wn=bn;wn<yn;wn++)pn=pn>>>8^vn[255&(pn^gn.charCodeAt(wn))];return-1^pn})(0|fn,hn,hn.length,0):0}},{"./utils":32}],5:[function(sn,ln,cn){cn.base64=!1,cn.binary=!1,cn.dir=!1,cn.createFolders=!0,cn.date=null,cn.compression=null,cn.compressionOptions=null,cn.comment=null,cn.unixPermissions=null,cn.dosPermissions=null},{}],6:[function(sn,ln,cn){var un=null;un=typeof Promise<"u"?Promise:sn("lie"),ln.exports={Promise:un}},{lie:37}],7:[function(sn,ln,cn){var un=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Uint32Array<"u",dn=sn("pako"),hn=sn("./utils"),fn=sn("./stream/GenericWorker"),pn=un?"uint8array":"array";function gn(mn,bn){fn.call(this,"FlateWorker/"+mn),this._pako=null,this._pakoAction=mn,this._pakoOptions=bn,this.meta={}}cn.magic="\b\0",hn.inherits(gn,fn),gn.prototype.processChunk=function(mn){this.meta=mn.meta,this._pako===null&&this._createPako(),this._pako.push(hn.transformTo(pn,mn.data),!1)},gn.prototype.flush=function(){fn.prototype.flush.call(this),this._pako===null&&this._createPako(),this._pako.push([],!0)},gn.prototype.cleanUp=function(){fn.prototype.cleanUp.call(this),this._pako=null},gn.prototype._createPako=function(){this._pako=new dn[this._pakoAction]({raw:!0,level:this._pakoOptions.level||-1});var mn=this;this._pako.onData=function(bn){mn.push({data:bn,meta:mn.meta})}},cn.compressWorker=function(mn){return new gn("Deflate",mn)},cn.uncompressWorker=function(){return new gn("Inflate",{})}},{"./stream/GenericWorker":28,"./utils":32,pako:38}],8:[function(sn,ln,cn){function un(vn,yn){var wn,kn="";for(wn=0;wn<yn;wn++)kn+=String.fromCharCode(255&vn),vn>>>=8;return kn}function dn(vn,yn,wn,kn,_n,xn){var En,Tn,Bn=vn.file,Nn=vn.compression,Mn=xn!==pn.utf8encode,Ln=hn.transformTo("string",xn(Bn.name)),On=hn.transformTo("string",pn.utf8encode(Bn.name)),zn=Bn.comment,Pn=hn.transformTo("string",xn(zn)),An=hn.transformTo("string",pn.utf8encode(zn)),Vn=On.length!==Bn.name.length,Sn=An.length!==zn.length,Rn="",Hn="",Zn="",Qn=Bn.dir,Yn=Bn.date,tr={crc32:0,compressedSize:0,uncompressedSize:0};yn&&!wn||(tr.crc32=vn.crc32,tr.compressedSize=vn.compressedSize,tr.uncompressedSize=vn.uncompressedSize);var Un=0;yn&&(Un|=8),Mn||!Vn&&!Sn||(Un|=2048);var Xn=0,or=0;Qn&&(Xn|=16),_n==="UNIX"?(or=798,Xn|=(function(wr,Nr){var $r=wr;return wr||($r=Nr?16893:33204),(65535&$r)<<16})(Bn.unixPermissions,Qn)):(or=20,Xn|=(function(wr){return 63&(wr||0)})(Bn.dosPermissions)),En=Yn.getUTCHours(),En<<=6,En|=Yn.getUTCMinutes(),En<<=5,En|=Yn.getUTCSeconds()/2,Tn=Yn.getUTCFullYear()-1980,Tn<<=4,Tn|=Yn.getUTCMonth()+1,Tn<<=5,Tn|=Yn.getUTCDate(),Vn&&(Hn=un(1,1)+un(gn(Ln),4)+On,Rn+="up"+un(Hn.length,2)+Hn),Sn&&(Zn=un(1,1)+un(gn(Pn),4)+An,Rn+="uc"+un(Zn.length,2)+Zn);var kr="";return kr+=`
\0`,kr+=un(Un,2),kr+=Nn.magic,kr+=un(En,2),kr+=un(Tn,2),kr+=un(tr.crc32,4),kr+=un(tr.compressedSize,4),kr+=un(tr.uncompressedSize,4),kr+=un(Ln.length,2),kr+=un(Rn.length,2),{fileRecord:mn.LOCAL_FILE_HEADER+kr+Ln+Rn,dirRecord:mn.CENTRAL_FILE_HEADER+un(or,2)+kr+un(Pn.length,2)+"\0\0\0\0"+un(Xn,4)+un(kn,4)+Ln+Rn+Pn}}var hn=sn("../utils"),fn=sn("../stream/GenericWorker"),pn=sn("../utf8"),gn=sn("../crc32"),mn=sn("../signature");function bn(vn,yn,wn,kn){fn.call(this,"ZipFileWorker"),this.bytesWritten=0,this.zipComment=yn,this.zipPlatform=wn,this.encodeFileName=kn,this.streamFiles=vn,this.accumulate=!1,this.contentBuffer=[],this.dirRecords=[],this.currentSourceOffset=0,this.entriesCount=0,this.currentFile=null,this._sources=[]}hn.inherits(bn,fn),bn.prototype.push=function(vn){var yn=vn.meta.percent||0,wn=this.entriesCount,kn=this._sources.length;this.accumulate?this.contentBuffer.push(vn):(this.bytesWritten+=vn.data.length,fn.prototype.push.call(this,{data:vn.data,meta:{currentFile:this.currentFile,percent:wn?(yn+100*(wn-kn-1))/wn:100}}))},bn.prototype.openedSource=function(vn){this.currentSourceOffset=this.bytesWritten,this.currentFile=vn.file.name;var yn=this.streamFiles&&!vn.file.dir;if(yn){var wn=dn(vn,yn,!1,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);this.push({data:wn.fileRecord,meta:{percent:0}})}else this.accumulate=!0},bn.prototype.closedSource=function(vn){this.accumulate=!1;var yn=this.streamFiles&&!vn.file.dir,wn=dn(vn,yn,!0,this.currentSourceOffset,this.zipPlatform,this.encodeFileName);if(this.dirRecords.push(wn.dirRecord),yn)this.push({data:(function(kn){return mn.DATA_DESCRIPTOR+un(kn.crc32,4)+un(kn.compressedSize,4)+un(kn.uncompressedSize,4)})(vn),meta:{percent:100}});else for(this.push({data:wn.fileRecord,meta:{percent:0}});this.contentBuffer.length;)this.push(this.contentBuffer.shift());this.currentFile=null},bn.prototype.flush=function(){for(var vn=this.bytesWritten,yn=0;yn<this.dirRecords.length;yn++)this.push({data:this.dirRecords[yn],meta:{percent:100}});var wn=this.bytesWritten-vn,kn=(function(_n,xn,En,Tn,Bn){var Nn=hn.transformTo("string",Bn(Tn));return mn.CENTRAL_DIRECTORY_END+"\0\0\0\0"+un(_n,2)+un(_n,2)+un(xn,4)+un(En,4)+un(Nn.length,2)+Nn})(this.dirRecords.length,wn,vn,this.zipComment,this.encodeFileName);this.push({data:kn,meta:{percent:100}})},bn.prototype.prepareNextSource=function(){this.previous=this._sources.shift(),this.openedSource(this.previous.streamInfo),this.isPaused?this.previous.pause():this.previous.resume()},bn.prototype.registerPrevious=function(vn){this._sources.push(vn);var yn=this;return vn.on("data",function(wn){yn.processChunk(wn)}),vn.on("end",function(){yn.closedSource(yn.previous.streamInfo),yn._sources.length?yn.prepareNextSource():yn.end()}),vn.on("error",function(wn){yn.error(wn)}),this},bn.prototype.resume=function(){return!!fn.prototype.resume.call(this)&&(!this.previous&&this._sources.length?(this.prepareNextSource(),!0):this.previous||this._sources.length||this.generatedError?void 0:(this.end(),!0))},bn.prototype.error=function(vn){var yn=this._sources;if(!fn.prototype.error.call(this,vn))return!1;for(var wn=0;wn<yn.length;wn++)try{yn[wn].error(vn)}catch{}return!0},bn.prototype.lock=function(){fn.prototype.lock.call(this);for(var vn=this._sources,yn=0;yn<vn.length;yn++)vn[yn].lock()},ln.exports=bn},{"../crc32":4,"../signature":23,"../stream/GenericWorker":28,"../utf8":31,"../utils":32}],9:[function(sn,ln,cn){var un=sn("../compressions"),dn=sn("./ZipFileWorker");cn.generateWorker=function(hn,fn,pn){var gn=new dn(fn.streamFiles,pn,fn.platform,fn.encodeFileName),mn=0;try{hn.forEach(function(bn,vn){mn++;var yn=(function(xn,En){var Tn=xn||En,Bn=un[Tn];if(!Bn)throw new Error(Tn+" is not a valid compression method !");return Bn})(vn.options.compression,fn.compression),wn=vn.options.compressionOptions||fn.compressionOptions||{},kn=vn.dir,_n=vn.date;vn._compressWorker(yn,wn).withStreamInfo("file",{name:bn,dir:kn,date:_n,comment:vn.comment||"",unixPermissions:vn.unixPermissions,dosPermissions:vn.dosPermissions}).pipe(gn)}),gn.entriesCount=mn}catch(bn){gn.error(bn)}return gn}},{"../compressions":3,"./ZipFileWorker":8}],10:[function(sn,ln,cn){function un(){if(!(this instanceof un))return new un;if(arguments.length)throw new Error("The constructor with parameters has been removed in JSZip 3.0, please check the upgrade guide.");this.files=Object.create(null),this.comment=null,this.root="",this.clone=function(){var dn=new un;for(var hn in this)typeof this[hn]!="function"&&(dn[hn]=this[hn]);return dn}}(un.prototype=sn("./object")).loadAsync=sn("./load"),un.support=sn("./support"),un.defaults=sn("./defaults"),un.version="3.10.1",un.loadAsync=function(dn,hn){return new un().loadAsync(dn,hn)},un.external=sn("./external"),ln.exports=un},{"./defaults":5,"./external":6,"./load":11,"./object":15,"./support":30}],11:[function(sn,ln,cn){var un=sn("./utils"),dn=sn("./external"),hn=sn("./utf8"),fn=sn("./zipEntries"),pn=sn("./stream/Crc32Probe"),gn=sn("./nodejsUtils");function mn(bn){return new dn.Promise(function(vn,yn){var wn=bn.decompressed.getContentWorker().pipe(new pn);wn.on("error",function(kn){yn(kn)}).on("end",function(){wn.streamInfo.crc32!==bn.decompressed.crc32?yn(new Error("Corrupted zip : CRC32 mismatch")):vn()}).resume()})}ln.exports=function(bn,vn){var yn=this;return vn=un.extend(vn||{},{base64:!1,checkCRC32:!1,optimizedBinaryString:!1,createFolders:!1,decodeFileName:hn.utf8decode}),gn.isNode&&gn.isStream(bn)?dn.Promise.reject(new Error("JSZip can't accept a stream when loading a zip file.")):un.prepareContent("the loaded zip file",bn,!0,vn.optimizedBinaryString,vn.base64).then(function(wn){var kn=new fn(vn);return kn.load(wn),kn}).then(function(wn){var kn=[dn.Promise.resolve(wn)],_n=wn.files;if(vn.checkCRC32)for(var xn=0;xn<_n.length;xn++)kn.push(mn(_n[xn]));return dn.Promise.all(kn)}).then(function(wn){for(var kn=wn.shift(),_n=kn.files,xn=0;xn<_n.length;xn++){var En=_n[xn],Tn=En.fileNameStr,Bn=un.resolve(En.fileNameStr);yn.file(Bn,En.decompressed,{binary:!0,optimizedBinaryString:!0,date:En.date,dir:En.dir,comment:En.fileCommentStr.length?En.fileCommentStr:null,unixPermissions:En.unixPermissions,dosPermissions:En.dosPermissions,createFolders:vn.createFolders}),En.dir||(yn.file(Bn).unsafeOriginalName=Tn)}return kn.zipComment.length&&(yn.comment=kn.zipComment),yn})}},{"./external":6,"./nodejsUtils":14,"./stream/Crc32Probe":25,"./utf8":31,"./utils":32,"./zipEntries":33}],12:[function(sn,ln,cn){var un=sn("../utils"),dn=sn("../stream/GenericWorker");function hn(fn,pn){dn.call(this,"Nodejs stream input adapter for "+fn),this._upstreamEnded=!1,this._bindStream(pn)}un.inherits(hn,dn),hn.prototype._bindStream=function(fn){var pn=this;(this._stream=fn).pause(),fn.on("data",function(gn){pn.push({data:gn,meta:{percent:0}})}).on("error",function(gn){pn.isPaused?this.generatedError=gn:pn.error(gn)}).on("end",function(){pn.isPaused?pn._upstreamEnded=!0:pn.end()})},hn.prototype.pause=function(){return!!dn.prototype.pause.call(this)&&(this._stream.pause(),!0)},hn.prototype.resume=function(){return!!dn.prototype.resume.call(this)&&(this._upstreamEnded?this.end():this._stream.resume(),!0)},ln.exports=hn},{"../stream/GenericWorker":28,"../utils":32}],13:[function(sn,ln,cn){var un=sn("readable-stream").Readable;function dn(hn,fn,pn){un.call(this,fn),this._helper=hn;var gn=this;hn.on("data",function(mn,bn){gn.push(mn)||gn._helper.pause(),pn&&pn(bn)}).on("error",function(mn){gn.emit("error",mn)}).on("end",function(){gn.push(null)})}sn("../utils").inherits(dn,un),dn.prototype._read=function(){this._helper.resume()},ln.exports=dn},{"../utils":32,"readable-stream":16}],14:[function(sn,ln,cn){ln.exports={isNode:typeof Buffer<"u",newBufferFrom:function(un,dn){if(Buffer.from&&Buffer.from!==Uint8Array.from)return Buffer.from(un,dn);if(typeof un=="number")throw new Error('The "data" argument must not be a number');return new Buffer(un,dn)},allocBuffer:function(un){if(Buffer.alloc)return Buffer.alloc(un);var dn=new Buffer(un);return dn.fill(0),dn},isBuffer:function(un){return Buffer.isBuffer(un)},isStream:function(un){return un&&typeof un.on=="function"&&typeof un.pause=="function"&&typeof un.resume=="function"}}},{}],15:[function(sn,ln,cn){function un(Bn,Nn,Mn){var Ln,On=hn.getTypeOf(Nn),zn=hn.extend(Mn||{},gn);zn.date=zn.date||new Date,zn.compression!==null&&(zn.compression=zn.compression.toUpperCase()),typeof zn.unixPermissions=="string"&&(zn.unixPermissions=parseInt(zn.unixPermissions,8)),zn.unixPermissions&&16384&zn.unixPermissions&&(zn.dir=!0),zn.dosPermissions&&16&zn.dosPermissions&&(zn.dir=!0),zn.dir&&(Bn=_n(Bn)),zn.createFolders&&(Ln=kn(Bn))&&xn.call(this,Ln,!0);var Pn=On==="string"&&zn.binary===!1&&zn.base64===!1;Mn&&Mn.binary!==void 0||(zn.binary=!Pn),(Nn instanceof mn&&Nn.uncompressedSize===0||zn.dir||!Nn||Nn.length===0)&&(zn.base64=!1,zn.binary=!0,Nn="",zn.compression="STORE",On="string");var An=null;An=Nn instanceof mn||Nn instanceof fn?Nn:yn.isNode&&yn.isStream(Nn)?new wn(Bn,Nn):hn.prepareContent(Bn,Nn,zn.binary,zn.optimizedBinaryString,zn.base64);var Vn=new bn(Bn,An,zn);this.files[Bn]=Vn}var dn=sn("./utf8"),hn=sn("./utils"),fn=sn("./stream/GenericWorker"),pn=sn("./stream/StreamHelper"),gn=sn("./defaults"),mn=sn("./compressedObject"),bn=sn("./zipObject"),vn=sn("./generate"),yn=sn("./nodejsUtils"),wn=sn("./nodejs/NodejsStreamInputAdapter"),kn=function(Bn){Bn.slice(-1)==="/"&&(Bn=Bn.substring(0,Bn.length-1));var Nn=Bn.lastIndexOf("/");return 0<Nn?Bn.substring(0,Nn):""},_n=function(Bn){return Bn.slice(-1)!=="/"&&(Bn+="/"),Bn},xn=function(Bn,Nn){return Nn=Nn!==void 0?Nn:gn.createFolders,Bn=_n(Bn),this.files[Bn]||un.call(this,Bn,null,{dir:!0,createFolders:Nn}),this.files[Bn]};function En(Bn){return Object.prototype.toString.call(Bn)==="[object RegExp]"}var Tn={load:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},forEach:function(Bn){var Nn,Mn,Ln;for(Nn in this.files)Ln=this.files[Nn],(Mn=Nn.slice(this.root.length,Nn.length))&&Nn.slice(0,this.root.length)===this.root&&Bn(Mn,Ln)},filter:function(Bn){var Nn=[];return this.forEach(function(Mn,Ln){Bn(Mn,Ln)&&Nn.push(Ln)}),Nn},file:function(Bn,Nn,Mn){if(arguments.length!==1)return Bn=this.root+Bn,un.call(this,Bn,Nn,Mn),this;if(En(Bn)){var Ln=Bn;return this.filter(function(zn,Pn){return!Pn.dir&&Ln.test(zn)})}var On=this.files[this.root+Bn];return On&&!On.dir?On:null},folder:function(Bn){if(!Bn)return this;if(En(Bn))return this.filter(function(On,zn){return zn.dir&&Bn.test(On)});var Nn=this.root+Bn,Mn=xn.call(this,Nn),Ln=this.clone();return Ln.root=Mn.name,Ln},remove:function(Bn){Bn=this.root+Bn;var Nn=this.files[Bn];if(Nn||(Bn.slice(-1)!=="/"&&(Bn+="/"),Nn=this.files[Bn]),Nn&&!Nn.dir)delete this.files[Bn];else for(var Mn=this.filter(function(On,zn){return zn.name.slice(0,Bn.length)===Bn}),Ln=0;Ln<Mn.length;Ln++)delete this.files[Mn[Ln].name];return this},generate:function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},generateInternalStream:function(Bn){var Nn,Mn={};try{if((Mn=hn.extend(Bn||{},{streamFiles:!1,compression:"STORE",compressionOptions:null,type:"",platform:"DOS",comment:null,mimeType:"application/zip",encodeFileName:dn.utf8encode})).type=Mn.type.toLowerCase(),Mn.compression=Mn.compression.toUpperCase(),Mn.type==="binarystring"&&(Mn.type="string"),!Mn.type)throw new Error("No output type specified.");hn.checkSupport(Mn.type),Mn.platform!=="darwin"&&Mn.platform!=="freebsd"&&Mn.platform!=="linux"&&Mn.platform!=="sunos"||(Mn.platform="UNIX"),Mn.platform==="win32"&&(Mn.platform="DOS");var Ln=Mn.comment||this.comment||"";Nn=vn.generateWorker(this,Mn,Ln)}catch(On){(Nn=new fn("error")).error(On)}return new pn(Nn,Mn.type||"string",Mn.mimeType)},generateAsync:function(Bn,Nn){return this.generateInternalStream(Bn).accumulate(Nn)},generateNodeStream:function(Bn,Nn){return(Bn=Bn||{}).type||(Bn.type="nodebuffer"),this.generateInternalStream(Bn).toNodejsStream(Nn)}};ln.exports=Tn},{"./compressedObject":2,"./defaults":5,"./generate":9,"./nodejs/NodejsStreamInputAdapter":12,"./nodejsUtils":14,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31,"./utils":32,"./zipObject":35}],16:[function(sn,ln,cn){ln.exports=sn("stream")},{stream:void 0}],17:[function(sn,ln,cn){var un=sn("./DataReader");function dn(hn){un.call(this,hn);for(var fn=0;fn<this.data.length;fn++)hn[fn]=255&hn[fn]}sn("../utils").inherits(dn,un),dn.prototype.byteAt=function(hn){return this.data[this.zero+hn]},dn.prototype.lastIndexOfSignature=function(hn){for(var fn=hn.charCodeAt(0),pn=hn.charCodeAt(1),gn=hn.charCodeAt(2),mn=hn.charCodeAt(3),bn=this.length-4;0<=bn;--bn)if(this.data[bn]===fn&&this.data[bn+1]===pn&&this.data[bn+2]===gn&&this.data[bn+3]===mn)return bn-this.zero;return-1},dn.prototype.readAndCheckSignature=function(hn){var fn=hn.charCodeAt(0),pn=hn.charCodeAt(1),gn=hn.charCodeAt(2),mn=hn.charCodeAt(3),bn=this.readData(4);return fn===bn[0]&&pn===bn[1]&&gn===bn[2]&&mn===bn[3]},dn.prototype.readData=function(hn){if(this.checkOffset(hn),hn===0)return[];var fn=this.data.slice(this.zero+this.index,this.zero+this.index+hn);return this.index+=hn,fn},ln.exports=dn},{"../utils":32,"./DataReader":18}],18:[function(sn,ln,cn){var un=sn("../utils");function dn(hn){this.data=hn,this.length=hn.length,this.index=0,this.zero=0}dn.prototype={checkOffset:function(hn){this.checkIndex(this.index+hn)},checkIndex:function(hn){if(this.length<this.zero+hn||hn<0)throw new Error("End of data reached (data length = "+this.length+", asked index = "+hn+"). Corrupted zip ?")},setIndex:function(hn){this.checkIndex(hn),this.index=hn},skip:function(hn){this.setIndex(this.index+hn)},byteAt:function(){},readInt:function(hn){var fn,pn=0;for(this.checkOffset(hn),fn=this.index+hn-1;fn>=this.index;fn--)pn=(pn<<8)+this.byteAt(fn);return this.index+=hn,pn},readString:function(hn){return un.transformTo("string",this.readData(hn))},readData:function(){},lastIndexOfSignature:function(){},readAndCheckSignature:function(){},readDate:function(){var hn=this.readInt(4);return new Date(Date.UTC(1980+(hn>>25&127),(hn>>21&15)-1,hn>>16&31,hn>>11&31,hn>>5&63,(31&hn)<<1))}},ln.exports=dn},{"../utils":32}],19:[function(sn,ln,cn){var un=sn("./Uint8ArrayReader");function dn(hn){un.call(this,hn)}sn("../utils").inherits(dn,un),dn.prototype.readData=function(hn){this.checkOffset(hn);var fn=this.data.slice(this.zero+this.index,this.zero+this.index+hn);return this.index+=hn,fn},ln.exports=dn},{"../utils":32,"./Uint8ArrayReader":21}],20:[function(sn,ln,cn){var un=sn("./DataReader");function dn(hn){un.call(this,hn)}sn("../utils").inherits(dn,un),dn.prototype.byteAt=function(hn){return this.data.charCodeAt(this.zero+hn)},dn.prototype.lastIndexOfSignature=function(hn){return this.data.lastIndexOf(hn)-this.zero},dn.prototype.readAndCheckSignature=function(hn){return hn===this.readData(4)},dn.prototype.readData=function(hn){this.checkOffset(hn);var fn=this.data.slice(this.zero+this.index,this.zero+this.index+hn);return this.index+=hn,fn},ln.exports=dn},{"../utils":32,"./DataReader":18}],21:[function(sn,ln,cn){var un=sn("./ArrayReader");function dn(hn){un.call(this,hn)}sn("../utils").inherits(dn,un),dn.prototype.readData=function(hn){if(this.checkOffset(hn),hn===0)return new Uint8Array(0);var fn=this.data.subarray(this.zero+this.index,this.zero+this.index+hn);return this.index+=hn,fn},ln.exports=dn},{"../utils":32,"./ArrayReader":17}],22:[function(sn,ln,cn){var un=sn("../utils"),dn=sn("../support"),hn=sn("./ArrayReader"),fn=sn("./StringReader"),pn=sn("./NodeBufferReader"),gn=sn("./Uint8ArrayReader");ln.exports=function(mn){var bn=un.getTypeOf(mn);return un.checkSupport(bn),bn!=="string"||dn.uint8array?bn==="nodebuffer"?new pn(mn):dn.uint8array?new gn(un.transformTo("uint8array",mn)):new hn(un.transformTo("array",mn)):new fn(mn)}},{"../support":30,"../utils":32,"./ArrayReader":17,"./NodeBufferReader":19,"./StringReader":20,"./Uint8ArrayReader":21}],23:[function(sn,ln,cn){cn.LOCAL_FILE_HEADER="PK",cn.CENTRAL_FILE_HEADER="PK",cn.CENTRAL_DIRECTORY_END="PK",cn.ZIP64_CENTRAL_DIRECTORY_LOCATOR="PK\x07",cn.ZIP64_CENTRAL_DIRECTORY_END="PK",cn.DATA_DESCRIPTOR="PK\x07\b"},{}],24:[function(sn,ln,cn){var un=sn("./GenericWorker"),dn=sn("../utils");function hn(fn){un.call(this,"ConvertWorker to "+fn),this.destType=fn}dn.inherits(hn,un),hn.prototype.processChunk=function(fn){this.push({data:dn.transformTo(this.destType,fn.data),meta:fn.meta})},ln.exports=hn},{"../utils":32,"./GenericWorker":28}],25:[function(sn,ln,cn){var un=sn("./GenericWorker"),dn=sn("../crc32");function hn(){un.call(this,"Crc32Probe"),this.withStreamInfo("crc32",0)}sn("../utils").inherits(hn,un),hn.prototype.processChunk=function(fn){this.streamInfo.crc32=dn(fn.data,this.streamInfo.crc32||0),this.push(fn)},ln.exports=hn},{"../crc32":4,"../utils":32,"./GenericWorker":28}],26:[function(sn,ln,cn){var un=sn("../utils"),dn=sn("./GenericWorker");function hn(fn){dn.call(this,"DataLengthProbe for "+fn),this.propName=fn,this.withStreamInfo(fn,0)}un.inherits(hn,dn),hn.prototype.processChunk=function(fn){if(fn){var pn=this.streamInfo[this.propName]||0;this.streamInfo[this.propName]=pn+fn.data.length}dn.prototype.processChunk.call(this,fn)},ln.exports=hn},{"../utils":32,"./GenericWorker":28}],27:[function(sn,ln,cn){var un=sn("../utils"),dn=sn("./GenericWorker");function hn(fn){dn.call(this,"DataWorker");var pn=this;this.dataIsReady=!1,this.index=0,this.max=0,this.data=null,this.type="",this._tickScheduled=!1,fn.then(function(gn){pn.dataIsReady=!0,pn.data=gn,pn.max=gn&&gn.length||0,pn.type=un.getTypeOf(gn),pn.isPaused||pn._tickAndRepeat()},function(gn){pn.error(gn)})}un.inherits(hn,dn),hn.prototype.cleanUp=function(){dn.prototype.cleanUp.call(this),this.data=null},hn.prototype.resume=function(){return!!dn.prototype.resume.call(this)&&(!this._tickScheduled&&this.dataIsReady&&(this._tickScheduled=!0,un.delay(this._tickAndRepeat,[],this)),!0)},hn.prototype._tickAndRepeat=function(){this._tickScheduled=!1,this.isPaused||this.isFinished||(this._tick(),this.isFinished||(un.delay(this._tickAndRepeat,[],this),this._tickScheduled=!0))},hn.prototype._tick=function(){if(this.isPaused||this.isFinished)return!1;var fn=null,pn=Math.min(this.max,this.index+16384);if(this.index>=this.max)return this.end();switch(this.type){case"string":fn=this.data.substring(this.index,pn);break;case"uint8array":fn=this.data.subarray(this.index,pn);break;case"array":case"nodebuffer":fn=this.data.slice(this.index,pn)}return this.index=pn,this.push({data:fn,meta:{percent:this.max?this.index/this.max*100:0}})},ln.exports=hn},{"../utils":32,"./GenericWorker":28}],28:[function(sn,ln,cn){function un(dn){this.name=dn||"default",this.streamInfo={},this.generatedError=null,this.extraStreamInfo={},this.isPaused=!0,this.isFinished=!1,this.isLocked=!1,this._listeners={data:[],end:[],error:[]},this.previous=null}un.prototype={push:function(dn){this.emit("data",dn)},end:function(){if(this.isFinished)return!1;this.flush();try{this.emit("end"),this.cleanUp(),this.isFinished=!0}catch(dn){this.emit("error",dn)}return!0},error:function(dn){return!this.isFinished&&(this.isPaused?this.generatedError=dn:(this.isFinished=!0,this.emit("error",dn),this.previous&&this.previous.error(dn),this.cleanUp()),!0)},on:function(dn,hn){return this._listeners[dn].push(hn),this},cleanUp:function(){this.streamInfo=this.generatedError=this.extraStreamInfo=null,this._listeners=[]},emit:function(dn,hn){if(this._listeners[dn])for(var fn=0;fn<this._listeners[dn].length;fn++)this._listeners[dn][fn].call(this,hn)},pipe:function(dn){return dn.registerPrevious(this)},registerPrevious:function(dn){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.streamInfo=dn.streamInfo,this.mergeStreamInfo(),this.previous=dn;var hn=this;return dn.on("data",function(fn){hn.processChunk(fn)}),dn.on("end",function(){hn.end()}),dn.on("error",function(fn){hn.error(fn)}),this},pause:function(){return!this.isPaused&&!this.isFinished&&(this.isPaused=!0,this.previous&&this.previous.pause(),!0)},resume:function(){if(!this.isPaused||this.isFinished)return!1;var dn=this.isPaused=!1;return this.generatedError&&(this.error(this.generatedError),dn=!0),this.previous&&this.previous.resume(),!dn},flush:function(){},processChunk:function(dn){this.push(dn)},withStreamInfo:function(dn,hn){return this.extraStreamInfo[dn]=hn,this.mergeStreamInfo(),this},mergeStreamInfo:function(){for(var dn in this.extraStreamInfo)Object.prototype.hasOwnProperty.call(this.extraStreamInfo,dn)&&(this.streamInfo[dn]=this.extraStreamInfo[dn])},lock:function(){if(this.isLocked)throw new Error("The stream '"+this+"' has already been used.");this.isLocked=!0,this.previous&&this.previous.lock()},toString:function(){var dn="Worker "+this.name;return this.previous?this.previous+" -> "+dn:dn}},ln.exports=un},{}],29:[function(sn,ln,cn){var un=sn("../utils"),dn=sn("./ConvertWorker"),hn=sn("./GenericWorker"),fn=sn("../base64"),pn=sn("../support"),gn=sn("../external"),mn=null;if(pn.nodestream)try{mn=sn("../nodejs/NodejsStreamOutputAdapter")}catch{}function bn(yn,wn){return new gn.Promise(function(kn,_n){var xn=[],En=yn._internalType,Tn=yn._outputType,Bn=yn._mimeType;yn.on("data",function(Nn,Mn){xn.push(Nn),wn&&wn(Mn)}).on("error",function(Nn){xn=[],_n(Nn)}).on("end",function(){try{var Nn=(function(Mn,Ln,On){switch(Mn){case"blob":return un.newBlob(un.transformTo("arraybuffer",Ln),On);case"base64":return fn.encode(Ln);default:return un.transformTo(Mn,Ln)}})(Tn,(function(Mn,Ln){var On,zn=0,Pn=null,An=0;for(On=0;On<Ln.length;On++)An+=Ln[On].length;switch(Mn){case"string":return Ln.join("");case"array":return Array.prototype.concat.apply([],Ln);case"uint8array":for(Pn=new Uint8Array(An),On=0;On<Ln.length;On++)Pn.set(Ln[On],zn),zn+=Ln[On].length;return Pn;case"nodebuffer":return Buffer.concat(Ln);default:throw new Error("concat : unsupported type '"+Mn+"'")}})(En,xn),Bn);kn(Nn)}catch(Mn){_n(Mn)}xn=[]}).resume()})}function vn(yn,wn,kn){var _n=wn;switch(wn){case"blob":case"arraybuffer":_n="uint8array";break;case"base64":_n="string"}try{this._internalType=_n,this._outputType=wn,this._mimeType=kn,un.checkSupport(_n),this._worker=yn.pipe(new dn(_n)),yn.lock()}catch(xn){this._worker=new hn("error"),this._worker.error(xn)}}vn.prototype={accumulate:function(yn){return bn(this,yn)},on:function(yn,wn){var kn=this;return yn==="data"?this._worker.on(yn,function(_n){wn.call(kn,_n.data,_n.meta)}):this._worker.on(yn,function(){un.delay(wn,arguments,kn)}),this},resume:function(){return un.delay(this._worker.resume,[],this._worker),this},pause:function(){return this._worker.pause(),this},toNodejsStream:function(yn){if(un.checkSupport("nodestream"),this._outputType!=="nodebuffer")throw new Error(this._outputType+" is not supported by this method");return new mn(this,{objectMode:this._outputType!=="nodebuffer"},yn)}},ln.exports=vn},{"../base64":1,"../external":6,"../nodejs/NodejsStreamOutputAdapter":13,"../support":30,"../utils":32,"./ConvertWorker":24,"./GenericWorker":28}],30:[function(sn,ln,cn){if(cn.base64=!0,cn.array=!0,cn.string=!0,cn.arraybuffer=typeof ArrayBuffer<"u"&&typeof Uint8Array<"u",cn.nodebuffer=typeof Buffer<"u",cn.uint8array=typeof Uint8Array<"u",typeof ArrayBuffer>"u")cn.blob=!1;else{var un=new ArrayBuffer(0);try{cn.blob=new Blob([un],{type:"application/zip"}).size===0}catch{try{var dn=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);dn.append(un),cn.blob=dn.getBlob("application/zip").size===0}catch{cn.blob=!1}}}try{cn.nodestream=!!sn("readable-stream").Readable}catch{cn.nodestream=!1}},{"readable-stream":16}],31:[function(sn,ln,cn){for(var un=sn("./utils"),dn=sn("./support"),hn=sn("./nodejsUtils"),fn=sn("./stream/GenericWorker"),pn=new Array(256),gn=0;gn<256;gn++)pn[gn]=252<=gn?6:248<=gn?5:240<=gn?4:224<=gn?3:192<=gn?2:1;pn[254]=pn[254]=1;function mn(){fn.call(this,"utf-8 decode"),this.leftOver=null}function bn(){fn.call(this,"utf-8 encode")}cn.utf8encode=function(vn){return dn.nodebuffer?hn.newBufferFrom(vn,"utf-8"):(function(yn){var wn,kn,_n,xn,En,Tn=yn.length,Bn=0;for(xn=0;xn<Tn;xn++)(64512&(kn=yn.charCodeAt(xn)))==55296&&xn+1<Tn&&(64512&(_n=yn.charCodeAt(xn+1)))==56320&&(kn=65536+(kn-55296<<10)+(_n-56320),xn++),Bn+=kn<128?1:kn<2048?2:kn<65536?3:4;for(wn=dn.uint8array?new Uint8Array(Bn):new Array(Bn),xn=En=0;En<Bn;xn++)(64512&(kn=yn.charCodeAt(xn)))==55296&&xn+1<Tn&&(64512&(_n=yn.charCodeAt(xn+1)))==56320&&(kn=65536+(kn-55296<<10)+(_n-56320),xn++),kn<128?wn[En++]=kn:(kn<2048?wn[En++]=192|kn>>>6:(kn<65536?wn[En++]=224|kn>>>12:(wn[En++]=240|kn>>>18,wn[En++]=128|kn>>>12&63),wn[En++]=128|kn>>>6&63),wn[En++]=128|63&kn);return wn})(vn)},cn.utf8decode=function(vn){return dn.nodebuffer?un.transformTo("nodebuffer",vn).toString("utf-8"):(function(yn){var wn,kn,_n,xn,En=yn.length,Tn=new Array(2*En);for(wn=kn=0;wn<En;)if((_n=yn[wn++])<128)Tn[kn++]=_n;else if(4<(xn=pn[_n]))Tn[kn++]=65533,wn+=xn-1;else{for(_n&=xn===2?31:xn===3?15:7;1<xn&&wn<En;)_n=_n<<6|63&yn[wn++],xn--;1<xn?Tn[kn++]=65533:_n<65536?Tn[kn++]=_n:(_n-=65536,Tn[kn++]=55296|_n>>10&1023,Tn[kn++]=56320|1023&_n)}return Tn.length!==kn&&(Tn.subarray?Tn=Tn.subarray(0,kn):Tn.length=kn),un.applyFromCharCode(Tn)})(vn=un.transformTo(dn.uint8array?"uint8array":"array",vn))},un.inherits(mn,fn),mn.prototype.processChunk=function(vn){var yn=un.transformTo(dn.uint8array?"uint8array":"array",vn.data);if(this.leftOver&&this.leftOver.length){if(dn.uint8array){var wn=yn;(yn=new Uint8Array(wn.length+this.leftOver.length)).set(this.leftOver,0),yn.set(wn,this.leftOver.length)}else yn=this.leftOver.concat(yn);this.leftOver=null}var kn=(function(xn,En){var Tn;for((En=En||xn.length)>xn.length&&(En=xn.length),Tn=En-1;0<=Tn&&(192&xn[Tn])==128;)Tn--;return Tn<0||Tn===0?En:Tn+pn[xn[Tn]]>En?Tn:En})(yn),_n=yn;kn!==yn.length&&(dn.uint8array?(_n=yn.subarray(0,kn),this.leftOver=yn.subarray(kn,yn.length)):(_n=yn.slice(0,kn),this.leftOver=yn.slice(kn,yn.length))),this.push({data:cn.utf8decode(_n),meta:vn.meta})},mn.prototype.flush=function(){this.leftOver&&this.leftOver.length&&(this.push({data:cn.utf8decode(this.leftOver),meta:{}}),this.leftOver=null)},cn.Utf8DecodeWorker=mn,un.inherits(bn,fn),bn.prototype.processChunk=function(vn){this.push({data:cn.utf8encode(vn.data),meta:vn.meta})},cn.Utf8EncodeWorker=bn},{"./nodejsUtils":14,"./stream/GenericWorker":28,"./support":30,"./utils":32}],32:[function(sn,ln,cn){var un=sn("./support"),dn=sn("./base64"),hn=sn("./nodejsUtils"),fn=sn("./external");function pn(wn){return wn}function gn(wn,kn){for(var _n=0;_n<wn.length;++_n)kn[_n]=255&wn.charCodeAt(_n);return kn}sn("setimmediate"),cn.newBlob=function(wn,kn){cn.checkSupport("blob");try{return new Blob([wn],{type:kn})}catch{try{var _n=new(self.BlobBuilder||self.WebKitBlobBuilder||self.MozBlobBuilder||self.MSBlobBuilder);return _n.append(wn),_n.getBlob(kn)}catch{throw new Error("Bug : can't construct the Blob.")}}};var mn={stringifyByChunk:function(wn,kn,_n){var xn=[],En=0,Tn=wn.length;if(Tn<=_n)return String.fromCharCode.apply(null,wn);for(;En<Tn;)kn==="array"||kn==="nodebuffer"?xn.push(String.fromCharCode.apply(null,wn.slice(En,Math.min(En+_n,Tn)))):xn.push(String.fromCharCode.apply(null,wn.subarray(En,Math.min(En+_n,Tn)))),En+=_n;return xn.join("")},stringifyByChar:function(wn){for(var kn="",_n=0;_n<wn.length;_n++)kn+=String.fromCharCode(wn[_n]);return kn},applyCanBeUsed:{uint8array:(function(){try{return un.uint8array&&String.fromCharCode.apply(null,new Uint8Array(1)).length===1}catch{return!1}})(),nodebuffer:(function(){try{return un.nodebuffer&&String.fromCharCode.apply(null,hn.allocBuffer(1)).length===1}catch{return!1}})()}};function bn(wn){var kn=65536,_n=cn.getTypeOf(wn),xn=!0;if(_n==="uint8array"?xn=mn.applyCanBeUsed.uint8array:_n==="nodebuffer"&&(xn=mn.applyCanBeUsed.nodebuffer),xn)for(;1<kn;)try{return mn.stringifyByChunk(wn,_n,kn)}catch{kn=Math.floor(kn/2)}return mn.stringifyByChar(wn)}function vn(wn,kn){for(var _n=0;_n<wn.length;_n++)kn[_n]=wn[_n];return kn}cn.applyFromCharCode=bn;var yn={};yn.string={string:pn,array:function(wn){return gn(wn,new Array(wn.length))},arraybuffer:function(wn){return yn.string.uint8array(wn).buffer},uint8array:function(wn){return gn(wn,new Uint8Array(wn.length))},nodebuffer:function(wn){return gn(wn,hn.allocBuffer(wn.length))}},yn.array={string:bn,array:pn,arraybuffer:function(wn){return new Uint8Array(wn).buffer},uint8array:function(wn){return new Uint8Array(wn)},nodebuffer:function(wn){return hn.newBufferFrom(wn)}},yn.arraybuffer={string:function(wn){return bn(new Uint8Array(wn))},array:function(wn){return vn(new Uint8Array(wn),new Array(wn.byteLength))},arraybuffer:pn,uint8array:function(wn){return new Uint8Array(wn)},nodebuffer:function(wn){return hn.newBufferFrom(new Uint8Array(wn))}},yn.uint8array={string:bn,array:function(wn){return vn(wn,new Array(wn.length))},arraybuffer:function(wn){return wn.buffer},uint8array:pn,nodebuffer:function(wn){return hn.newBufferFrom(wn)}},yn.nodebuffer={string:bn,array:function(wn){return vn(wn,new Array(wn.length))},arraybuffer:function(wn){return yn.nodebuffer.uint8array(wn).buffer},uint8array:function(wn){return vn(wn,new Uint8Array(wn.length))},nodebuffer:pn},cn.transformTo=function(wn,kn){if(kn=kn||"",!wn)return kn;cn.checkSupport(wn);var _n=cn.getTypeOf(kn);return yn[_n][wn](kn)},cn.resolve=function(wn){for(var kn=wn.split("/"),_n=[],xn=0;xn<kn.length;xn++){var En=kn[xn];En==="."||En===""&&xn!==0&&xn!==kn.length-1||(En===".."?_n.pop():_n.push(En))}return _n.join("/")},cn.getTypeOf=function(wn){return typeof wn=="string"?"string":Object.prototype.toString.call(wn)==="[object Array]"?"array":un.nodebuffer&&hn.isBuffer(wn)?"nodebuffer":un.uint8array&&wn instanceof Uint8Array?"uint8array":un.arraybuffer&&wn instanceof ArrayBuffer?"arraybuffer":void 0},cn.checkSupport=function(wn){if(!un[wn.toLowerCase()])throw new Error(wn+" is not supported by this platform")},cn.MAX_VALUE_16BITS=65535,cn.MAX_VALUE_32BITS=-1,cn.pretty=function(wn){var kn,_n,xn="";for(_n=0;_n<(wn||"").length;_n++)xn+="\\x"+((kn=wn.charCodeAt(_n))<16?"0":"")+kn.toString(16).toUpperCase();return xn},cn.delay=function(wn,kn,_n){setImmediate(function(){wn.apply(_n||null,kn||[])})},cn.inherits=function(wn,kn){function _n(){}_n.prototype=kn.prototype,wn.prototype=new _n},cn.extend=function(){var wn,kn,_n={};for(wn=0;wn<arguments.length;wn++)for(kn in arguments[wn])Object.prototype.hasOwnProperty.call(arguments[wn],kn)&&_n[kn]===void 0&&(_n[kn]=arguments[wn][kn]);return _n},cn.prepareContent=function(wn,kn,_n,xn,En){return fn.Promise.resolve(kn).then(function(Tn){return un.blob&&(Tn instanceof Blob||["[object File]","[object Blob]"].indexOf(Object.prototype.toString.call(Tn))!==-1)&&typeof FileReader<"u"?new fn.Promise(function(Bn,Nn){var Mn=new FileReader;Mn.onload=function(Ln){Bn(Ln.target.result)},Mn.onerror=function(Ln){Nn(Ln.target.error)},Mn.readAsArrayBuffer(Tn)}):Tn}).then(function(Tn){var Bn=cn.getTypeOf(Tn);return Bn?(Bn==="arraybuffer"?Tn=cn.transformTo("uint8array",Tn):Bn==="string"&&(En?Tn=dn.decode(Tn):_n&&xn!==!0&&(Tn=(function(Nn){return gn(Nn,un.uint8array?new Uint8Array(Nn.length):new Array(Nn.length))})(Tn))),Tn):fn.Promise.reject(new Error("Can't read the data of '"+wn+"'. Is it in a supported JavaScript type (String, Blob, ArrayBuffer, etc) ?"))})}},{"./base64":1,"./external":6,"./nodejsUtils":14,"./support":30,setimmediate:54}],33:[function(sn,ln,cn){var un=sn("./reader/readerFor"),dn=sn("./utils"),hn=sn("./signature"),fn=sn("./zipEntry"),pn=sn("./support");function gn(mn){this.files=[],this.loadOptions=mn}gn.prototype={checkSignature:function(mn){if(!this.reader.readAndCheckSignature(mn)){this.reader.index-=4;var bn=this.reader.readString(4);throw new Error("Corrupted zip or bug: unexpected signature ("+dn.pretty(bn)+", expected "+dn.pretty(mn)+")")}},isSignature:function(mn,bn){var vn=this.reader.index;this.reader.setIndex(mn);var yn=this.reader.readString(4)===bn;return this.reader.setIndex(vn),yn},readBlockEndOfCentral:function(){this.diskNumber=this.reader.readInt(2),this.diskWithCentralDirStart=this.reader.readInt(2),this.centralDirRecordsOnThisDisk=this.reader.readInt(2),this.centralDirRecords=this.reader.readInt(2),this.centralDirSize=this.reader.readInt(4),this.centralDirOffset=this.reader.readInt(4),this.zipCommentLength=this.reader.readInt(2);var mn=this.reader.readData(this.zipCommentLength),bn=pn.uint8array?"uint8array":"array",vn=dn.transformTo(bn,mn);this.zipComment=this.loadOptions.decodeFileName(vn)},readBlockZip64EndOfCentral:function(){this.zip64EndOfCentralSize=this.reader.readInt(8),this.reader.skip(4),this.diskNumber=this.reader.readInt(4),this.diskWithCentralDirStart=this.reader.readInt(4),this.centralDirRecordsOnThisDisk=this.reader.readInt(8),this.centralDirRecords=this.reader.readInt(8),this.centralDirSize=this.reader.readInt(8),this.centralDirOffset=this.reader.readInt(8),this.zip64ExtensibleData={};for(var mn,bn,vn,yn=this.zip64EndOfCentralSize-44;0<yn;)mn=this.reader.readInt(2),bn=this.reader.readInt(4),vn=this.reader.readData(bn),this.zip64ExtensibleData[mn]={id:mn,length:bn,value:vn}},readBlockZip64EndOfCentralLocator:function(){if(this.diskWithZip64CentralDirStart=this.reader.readInt(4),this.relativeOffsetEndOfZip64CentralDir=this.reader.readInt(8),this.disksCount=this.reader.readInt(4),1<this.disksCount)throw new Error("Multi-volumes zip are not supported")},readLocalFiles:function(){var mn,bn;for(mn=0;mn<this.files.length;mn++)bn=this.files[mn],this.reader.setIndex(bn.localHeaderOffset),this.checkSignature(hn.LOCAL_FILE_HEADER),bn.readLocalPart(this.reader),bn.handleUTF8(),bn.processAttributes()},readCentralDir:function(){var mn;for(this.reader.setIndex(this.centralDirOffset);this.reader.readAndCheckSignature(hn.CENTRAL_FILE_HEADER);)(mn=new fn({zip64:this.zip64},this.loadOptions)).readCentralPart(this.reader),this.files.push(mn);if(this.centralDirRecords!==this.files.length&&this.centralDirRecords!==0&&this.files.length===0)throw new Error("Corrupted zip or bug: expected "+this.centralDirRecords+" records in central dir, got "+this.files.length)},readEndOfCentral:function(){var mn=this.reader.lastIndexOfSignature(hn.CENTRAL_DIRECTORY_END);if(mn<0)throw this.isSignature(0,hn.LOCAL_FILE_HEADER)?new Error("Corrupted zip: can't find end of central directory"):new Error("Can't find end of central directory : is this a zip file ? If it is, see https://stuk.github.io/jszip/documentation/howto/read_zip.html");this.reader.setIndex(mn);var bn=mn;if(this.checkSignature(hn.CENTRAL_DIRECTORY_END),this.readBlockEndOfCentral(),this.diskNumber===dn.MAX_VALUE_16BITS||this.diskWithCentralDirStart===dn.MAX_VALUE_16BITS||this.centralDirRecordsOnThisDisk===dn.MAX_VALUE_16BITS||this.centralDirRecords===dn.MAX_VALUE_16BITS||this.centralDirSize===dn.MAX_VALUE_32BITS||this.centralDirOffset===dn.MAX_VALUE_32BITS){if(this.zip64=!0,(mn=this.reader.lastIndexOfSignature(hn.ZIP64_CENTRAL_DIRECTORY_LOCATOR))<0)throw new Error("Corrupted zip: can't find the ZIP64 end of central directory locator");if(this.reader.setIndex(mn),this.checkSignature(hn.ZIP64_CENTRAL_DIRECTORY_LOCATOR),this.readBlockZip64EndOfCentralLocator(),!this.isSignature(this.relativeOffsetEndOfZip64CentralDir,hn.ZIP64_CENTRAL_DIRECTORY_END)&&(this.relativeOffsetEndOfZip64CentralDir=this.reader.lastIndexOfSignature(hn.ZIP64_CENTRAL_DIRECTORY_END),this.relativeOffsetEndOfZip64CentralDir<0))throw new Error("Corrupted zip: can't find the ZIP64 end of central directory");this.reader.setIndex(this.relativeOffsetEndOfZip64CentralDir),this.checkSignature(hn.ZIP64_CENTRAL_DIRECTORY_END),this.readBlockZip64EndOfCentral()}var vn=this.centralDirOffset+this.centralDirSize;this.zip64&&(vn+=20,vn+=12+this.zip64EndOfCentralSize);var yn=bn-vn;if(0<yn)this.isSignature(bn,hn.CENTRAL_FILE_HEADER)||(this.reader.zero=yn);else if(yn<0)throw new Error("Corrupted zip: missing "+Math.abs(yn)+" bytes.")},prepareReader:function(mn){this.reader=un(mn)},load:function(mn){this.prepareReader(mn),this.readEndOfCentral(),this.readCentralDir(),this.readLocalFiles()}},ln.exports=gn},{"./reader/readerFor":22,"./signature":23,"./support":30,"./utils":32,"./zipEntry":34}],34:[function(sn,ln,cn){var un=sn("./reader/readerFor"),dn=sn("./utils"),hn=sn("./compressedObject"),fn=sn("./crc32"),pn=sn("./utf8"),gn=sn("./compressions"),mn=sn("./support");function bn(vn,yn){this.options=vn,this.loadOptions=yn}bn.prototype={isEncrypted:function(){return(1&this.bitFlag)==1},useUTF8:function(){return(2048&this.bitFlag)==2048},readLocalPart:function(vn){var yn,wn;if(vn.skip(22),this.fileNameLength=vn.readInt(2),wn=vn.readInt(2),this.fileName=vn.readData(this.fileNameLength),vn.skip(wn),this.compressedSize===-1||this.uncompressedSize===-1)throw new Error("Bug or corrupted zip : didn't get enough information from the central directory (compressedSize === -1 || uncompressedSize === -1)");if((yn=(function(kn){for(var _n in gn)if(Object.prototype.hasOwnProperty.call(gn,_n)&&gn[_n].magic===kn)return gn[_n];return null})(this.compressionMethod))===null)throw new Error("Corrupted zip : compression "+dn.pretty(this.compressionMethod)+" unknown (inner file : "+dn.transformTo("string",this.fileName)+")");this.decompressed=new hn(this.compressedSize,this.uncompressedSize,this.crc32,yn,vn.readData(this.compressedSize))},readCentralPart:function(vn){this.versionMadeBy=vn.readInt(2),vn.skip(2),this.bitFlag=vn.readInt(2),this.compressionMethod=vn.readString(2),this.date=vn.readDate(),this.crc32=vn.readInt(4),this.compressedSize=vn.readInt(4),this.uncompressedSize=vn.readInt(4);var yn=vn.readInt(2);if(this.extraFieldsLength=vn.readInt(2),this.fileCommentLength=vn.readInt(2),this.diskNumberStart=vn.readInt(2),this.internalFileAttributes=vn.readInt(2),this.externalFileAttributes=vn.readInt(4),this.localHeaderOffset=vn.readInt(4),this.isEncrypted())throw new Error("Encrypted zip are not supported");vn.skip(yn),this.readExtraFields(vn),this.parseZIP64ExtraField(vn),this.fileComment=vn.readData(this.fileCommentLength)},processAttributes:function(){this.unixPermissions=null,this.dosPermissions=null;var vn=this.versionMadeBy>>8;this.dir=!!(16&this.externalFileAttributes),vn==0&&(this.dosPermissions=63&this.externalFileAttributes),vn==3&&(this.unixPermissions=this.externalFileAttributes>>16&65535),this.dir||this.fileNameStr.slice(-1)!=="/"||(this.dir=!0)},parseZIP64ExtraField:function(){if(this.extraFields[1]){var vn=un(this.extraFields[1].value);this.uncompressedSize===dn.MAX_VALUE_32BITS&&(this.uncompressedSize=vn.readInt(8)),this.compressedSize===dn.MAX_VALUE_32BITS&&(this.compressedSize=vn.readInt(8)),this.localHeaderOffset===dn.MAX_VALUE_32BITS&&(this.localHeaderOffset=vn.readInt(8)),this.diskNumberStart===dn.MAX_VALUE_32BITS&&(this.diskNumberStart=vn.readInt(4))}},readExtraFields:function(vn){var yn,wn,kn,_n=vn.index+this.extraFieldsLength;for(this.extraFields||(this.extraFields={});vn.index+4<_n;)yn=vn.readInt(2),wn=vn.readInt(2),kn=vn.readData(wn),this.extraFields[yn]={id:yn,length:wn,value:kn};vn.setIndex(_n)},handleUTF8:function(){var vn=mn.uint8array?"uint8array":"array";if(this.useUTF8())this.fileNameStr=pn.utf8decode(this.fileName),this.fileCommentStr=pn.utf8decode(this.fileComment);else{var yn=this.findExtraFieldUnicodePath();if(yn!==null)this.fileNameStr=yn;else{var wn=dn.transformTo(vn,this.fileName);this.fileNameStr=this.loadOptions.decodeFileName(wn)}var kn=this.findExtraFieldUnicodeComment();if(kn!==null)this.fileCommentStr=kn;else{var _n=dn.transformTo(vn,this.fileComment);this.fileCommentStr=this.loadOptions.decodeFileName(_n)}}},findExtraFieldUnicodePath:function(){var vn=this.extraFields[28789];if(vn){var yn=un(vn.value);return yn.readInt(1)!==1||fn(this.fileName)!==yn.readInt(4)?null:pn.utf8decode(yn.readData(vn.length-5))}return null},findExtraFieldUnicodeComment:function(){var vn=this.extraFields[25461];if(vn){var yn=un(vn.value);return yn.readInt(1)!==1||fn(this.fileComment)!==yn.readInt(4)?null:pn.utf8decode(yn.readData(vn.length-5))}return null}},ln.exports=bn},{"./compressedObject":2,"./compressions":3,"./crc32":4,"./reader/readerFor":22,"./support":30,"./utf8":31,"./utils":32}],35:[function(sn,ln,cn){function un(yn,wn,kn){this.name=yn,this.dir=kn.dir,this.date=kn.date,this.comment=kn.comment,this.unixPermissions=kn.unixPermissions,this.dosPermissions=kn.dosPermissions,this._data=wn,this._dataBinary=kn.binary,this.options={compression:kn.compression,compressionOptions:kn.compressionOptions}}var dn=sn("./stream/StreamHelper"),hn=sn("./stream/DataWorker"),fn=sn("./utf8"),pn=sn("./compressedObject"),gn=sn("./stream/GenericWorker");un.prototype={internalStream:function(yn){var wn=null,kn="string";try{if(!yn)throw new Error("No output type specified.");var _n=(kn=yn.toLowerCase())==="string"||kn==="text";kn!=="binarystring"&&kn!=="text"||(kn="string"),wn=this._decompressWorker();var xn=!this._dataBinary;xn&&!_n&&(wn=wn.pipe(new fn.Utf8EncodeWorker)),!xn&&_n&&(wn=wn.pipe(new fn.Utf8DecodeWorker))}catch(En){(wn=new gn("error")).error(En)}return new dn(wn,kn,"")},async:function(yn,wn){return this.internalStream(yn).accumulate(wn)},nodeStream:function(yn,wn){return this.internalStream(yn||"nodebuffer").toNodejsStream(wn)},_compressWorker:function(yn,wn){if(this._data instanceof pn&&this._data.compression.magic===yn.magic)return this._data.getCompressedWorker();var kn=this._decompressWorker();return this._dataBinary||(kn=kn.pipe(new fn.Utf8EncodeWorker)),pn.createWorkerFrom(kn,yn,wn)},_decompressWorker:function(){return this._data instanceof pn?this._data.getContentWorker():this._data instanceof gn?this._data:new hn(this._data)}};for(var mn=["asText","asBinary","asNodeBuffer","asUint8Array","asArrayBuffer"],bn=function(){throw new Error("This method has been removed in JSZip 3.0, please check the upgrade guide.")},vn=0;vn<mn.length;vn++)un.prototype[mn[vn]]=bn;ln.exports=un},{"./compressedObject":2,"./stream/DataWorker":27,"./stream/GenericWorker":28,"./stream/StreamHelper":29,"./utf8":31}],36:[function(sn,ln,cn){(function(un){var dn,hn,fn=un.MutationObserver||un.WebKitMutationObserver;if(fn){var pn=0,gn=new fn(yn),mn=un.document.createTextNode("");gn.observe(mn,{characterData:!0}),dn=function(){mn.data=pn=++pn%2}}else if(un.setImmediate||un.MessageChannel===void 0)dn="document"in un&&"onreadystatechange"in un.document.createElement("script")?function(){var wn=un.document.createElement("script");wn.onreadystatechange=function(){yn(),wn.onreadystatechange=null,wn.parentNode.removeChild(wn),wn=null},un.document.documentElement.appendChild(wn)}:function(){setTimeout(yn,0)};else{var bn=new un.MessageChannel;bn.port1.onmessage=yn,dn=function(){bn.port2.postMessage(0)}}var vn=[];function yn(){var wn,kn;hn=!0;for(var _n=vn.length;_n;){for(kn=vn,vn=[],wn=-1;++wn<_n;)kn[wn]();_n=vn.length}hn=!1}ln.exports=function(wn){vn.push(wn)!==1||hn||dn()}}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}],37:[function(sn,ln,cn){var un=sn("immediate");function dn(){}var hn={},fn=["REJECTED"],pn=["FULFILLED"],gn=["PENDING"];function mn(_n){if(typeof _n!="function")throw new TypeError("resolver must be a function");this.state=gn,this.queue=[],this.outcome=void 0,_n!==dn&&wn(this,_n)}function bn(_n,xn,En){this.promise=_n,typeof xn=="function"&&(this.onFulfilled=xn,this.callFulfilled=this.otherCallFulfilled),typeof En=="function"&&(this.onRejected=En,this.callRejected=this.otherCallRejected)}function vn(_n,xn,En){un(function(){var Tn;try{Tn=xn(En)}catch(Bn){return hn.reject(_n,Bn)}Tn===_n?hn.reject(_n,new TypeError("Cannot resolve promise with itself")):hn.resolve(_n,Tn)})}function yn(_n){var xn=_n&&_n.then;if(_n&&(typeof _n=="object"||typeof _n=="function")&&typeof xn=="function")return function(){xn.apply(_n,arguments)}}function wn(_n,xn){var En=!1;function Tn(Mn){En||(En=!0,hn.reject(_n,Mn))}function Bn(Mn){En||(En=!0,hn.resolve(_n,Mn))}var Nn=kn(function(){xn(Bn,Tn)});Nn.status==="error"&&Tn(Nn.value)}function kn(_n,xn){var En={};try{En.value=_n(xn),En.status="success"}catch(Tn){En.status="error",En.value=Tn}return En}(ln.exports=mn).prototype.finally=function(_n){if(typeof _n!="function")return this;var xn=this.constructor;return this.then(function(En){return xn.resolve(_n()).then(function(){return En})},function(En){return xn.resolve(_n()).then(function(){throw En})})},mn.prototype.catch=function(_n){return this.then(null,_n)},mn.prototype.then=function(_n,xn){if(typeof _n!="function"&&this.state===pn||typeof xn!="function"&&this.state===fn)return this;var En=new this.constructor(dn);return this.state!==gn?vn(En,this.state===pn?_n:xn,this.outcome):this.queue.push(new bn(En,_n,xn)),En},bn.prototype.callFulfilled=function(_n){hn.resolve(this.promise,_n)},bn.prototype.otherCallFulfilled=function(_n){vn(this.promise,this.onFulfilled,_n)},bn.prototype.callRejected=function(_n){hn.reject(this.promise,_n)},bn.prototype.otherCallRejected=function(_n){vn(this.promise,this.onRejected,_n)},hn.resolve=function(_n,xn){var En=kn(yn,xn);if(En.status==="error")return hn.reject(_n,En.value);var Tn=En.value;if(Tn)wn(_n,Tn);else{_n.state=pn,_n.outcome=xn;for(var Bn=-1,Nn=_n.queue.length;++Bn<Nn;)_n.queue[Bn].callFulfilled(xn)}return _n},hn.reject=function(_n,xn){_n.state=fn,_n.outcome=xn;for(var En=-1,Tn=_n.queue.length;++En<Tn;)_n.queue[En].callRejected(xn);return _n},mn.resolve=function(_n){return _n instanceof this?_n:hn.resolve(new this(dn),_n)},mn.reject=function(_n){var xn=new this(dn);return hn.reject(xn,_n)},mn.all=function(_n){var xn=this;if(Object.prototype.toString.call(_n)!=="[object Array]")return this.reject(new TypeError("must be an array"));var En=_n.length,Tn=!1;if(!En)return this.resolve([]);for(var Bn=new Array(En),Nn=0,Mn=-1,Ln=new this(dn);++Mn<En;)On(_n[Mn],Mn);return Ln;function On(zn,Pn){xn.resolve(zn).then(function(An){Bn[Pn]=An,++Nn!==En||Tn||(Tn=!0,hn.resolve(Ln,Bn))},function(An){Tn||(Tn=!0,hn.reject(Ln,An))})}},mn.race=function(_n){var xn=this;if(Object.prototype.toString.call(_n)!=="[object Array]")return this.reject(new TypeError("must be an array"));var En=_n.length,Tn=!1;if(!En)return this.resolve([]);for(var Bn=-1,Nn=new this(dn);++Bn<En;)Mn=_n[Bn],xn.resolve(Mn).then(function(Ln){Tn||(Tn=!0,hn.resolve(Nn,Ln))},function(Ln){Tn||(Tn=!0,hn.reject(Nn,Ln))});var Mn;return Nn}},{immediate:36}],38:[function(sn,ln,cn){var un={};(0,sn("./lib/utils/common").assign)(un,sn("./lib/deflate"),sn("./lib/inflate"),sn("./lib/zlib/constants")),ln.exports=un},{"./lib/deflate":39,"./lib/inflate":40,"./lib/utils/common":41,"./lib/zlib/constants":44}],39:[function(sn,ln,cn){var un=sn("./zlib/deflate"),dn=sn("./utils/common"),hn=sn("./utils/strings"),fn=sn("./zlib/messages"),pn=sn("./zlib/zstream"),gn=Object.prototype.toString,mn=0,bn=-1,vn=0,yn=8;function wn(_n){if(!(this instanceof wn))return new wn(_n);this.options=dn.assign({level:bn,method:yn,chunkSize:16384,windowBits:15,memLevel:8,strategy:vn,to:""},_n||{});var xn=this.options;xn.raw&&0<xn.windowBits?xn.windowBits=-xn.windowBits:xn.gzip&&0<xn.windowBits&&xn.windowBits<16&&(xn.windowBits+=16),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new pn,this.strm.avail_out=0;var En=un.deflateInit2(this.strm,xn.level,xn.method,xn.windowBits,xn.memLevel,xn.strategy);if(En!==mn)throw new Error(fn[En]);if(xn.header&&un.deflateSetHeader(this.strm,xn.header),xn.dictionary){var Tn;if(Tn=typeof xn.dictionary=="string"?hn.string2buf(xn.dictionary):gn.call(xn.dictionary)==="[object ArrayBuffer]"?new Uint8Array(xn.dictionary):xn.dictionary,(En=un.deflateSetDictionary(this.strm,Tn))!==mn)throw new Error(fn[En]);this._dict_set=!0}}function kn(_n,xn){var En=new wn(xn);if(En.push(_n,!0),En.err)throw En.msg||fn[En.err];return En.result}wn.prototype.push=function(_n,xn){var En,Tn,Bn=this.strm,Nn=this.options.chunkSize;if(this.ended)return!1;Tn=xn===~~xn?xn:xn===!0?4:0,typeof _n=="string"?Bn.input=hn.string2buf(_n):gn.call(_n)==="[object ArrayBuffer]"?Bn.input=new Uint8Array(_n):Bn.input=_n,Bn.next_in=0,Bn.avail_in=Bn.input.length;do{if(Bn.avail_out===0&&(Bn.output=new dn.Buf8(Nn),Bn.next_out=0,Bn.avail_out=Nn),(En=un.deflate(Bn,Tn))!==1&&En!==mn)return this.onEnd(En),!(this.ended=!0);Bn.avail_out!==0&&(Bn.avail_in!==0||Tn!==4&&Tn!==2)||(this.options.to==="string"?this.onData(hn.buf2binstring(dn.shrinkBuf(Bn.output,Bn.next_out))):this.onData(dn.shrinkBuf(Bn.output,Bn.next_out)))}while((0<Bn.avail_in||Bn.avail_out===0)&&En!==1);return Tn===4?(En=un.deflateEnd(this.strm),this.onEnd(En),this.ended=!0,En===mn):Tn!==2||(this.onEnd(mn),!(Bn.avail_out=0))},wn.prototype.onData=function(_n){this.chunks.push(_n)},wn.prototype.onEnd=function(_n){_n===mn&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=dn.flattenChunks(this.chunks)),this.chunks=[],this.err=_n,this.msg=this.strm.msg},cn.Deflate=wn,cn.deflate=kn,cn.deflateRaw=function(_n,xn){return(xn=xn||{}).raw=!0,kn(_n,xn)},cn.gzip=function(_n,xn){return(xn=xn||{}).gzip=!0,kn(_n,xn)}},{"./utils/common":41,"./utils/strings":42,"./zlib/deflate":46,"./zlib/messages":51,"./zlib/zstream":53}],40:[function(sn,ln,cn){var un=sn("./zlib/inflate"),dn=sn("./utils/common"),hn=sn("./utils/strings"),fn=sn("./zlib/constants"),pn=sn("./zlib/messages"),gn=sn("./zlib/zstream"),mn=sn("./zlib/gzheader"),bn=Object.prototype.toString;function vn(wn){if(!(this instanceof vn))return new vn(wn);this.options=dn.assign({chunkSize:16384,windowBits:0,to:""},wn||{});var kn=this.options;kn.raw&&0<=kn.windowBits&&kn.windowBits<16&&(kn.windowBits=-kn.windowBits,kn.windowBits===0&&(kn.windowBits=-15)),!(0<=kn.windowBits&&kn.windowBits<16)||wn&&wn.windowBits||(kn.windowBits+=32),15<kn.windowBits&&kn.windowBits<48&&(15&kn.windowBits)==0&&(kn.windowBits|=15),this.err=0,this.msg="",this.ended=!1,this.chunks=[],this.strm=new gn,this.strm.avail_out=0;var _n=un.inflateInit2(this.strm,kn.windowBits);if(_n!==fn.Z_OK)throw new Error(pn[_n]);this.header=new mn,un.inflateGetHeader(this.strm,this.header)}function yn(wn,kn){var _n=new vn(kn);if(_n.push(wn,!0),_n.err)throw _n.msg||pn[_n.err];return _n.result}vn.prototype.push=function(wn,kn){var _n,xn,En,Tn,Bn,Nn,Mn=this.strm,Ln=this.options.chunkSize,On=this.options.dictionary,zn=!1;if(this.ended)return!1;xn=kn===~~kn?kn:kn===!0?fn.Z_FINISH:fn.Z_NO_FLUSH,typeof wn=="string"?Mn.input=hn.binstring2buf(wn):bn.call(wn)==="[object ArrayBuffer]"?Mn.input=new Uint8Array(wn):Mn.input=wn,Mn.next_in=0,Mn.avail_in=Mn.input.length;do{if(Mn.avail_out===0&&(Mn.output=new dn.Buf8(Ln),Mn.next_out=0,Mn.avail_out=Ln),(_n=un.inflate(Mn,fn.Z_NO_FLUSH))===fn.Z_NEED_DICT&&On&&(Nn=typeof On=="string"?hn.string2buf(On):bn.call(On)==="[object ArrayBuffer]"?new Uint8Array(On):On,_n=un.inflateSetDictionary(this.strm,Nn)),_n===fn.Z_BUF_ERROR&&zn===!0&&(_n=fn.Z_OK,zn=!1),_n!==fn.Z_STREAM_END&&_n!==fn.Z_OK)return this.onEnd(_n),!(this.ended=!0);Mn.next_out&&(Mn.avail_out!==0&&_n!==fn.Z_STREAM_END&&(Mn.avail_in!==0||xn!==fn.Z_FINISH&&xn!==fn.Z_SYNC_FLUSH)||(this.options.to==="string"?(En=hn.utf8border(Mn.output,Mn.next_out),Tn=Mn.next_out-En,Bn=hn.buf2string(Mn.output,En),Mn.next_out=Tn,Mn.avail_out=Ln-Tn,Tn&&dn.arraySet(Mn.output,Mn.output,En,Tn,0),this.onData(Bn)):this.onData(dn.shrinkBuf(Mn.output,Mn.next_out)))),Mn.avail_in===0&&Mn.avail_out===0&&(zn=!0)}while((0<Mn.avail_in||Mn.avail_out===0)&&_n!==fn.Z_STREAM_END);return _n===fn.Z_STREAM_END&&(xn=fn.Z_FINISH),xn===fn.Z_FINISH?(_n=un.inflateEnd(this.strm),this.onEnd(_n),this.ended=!0,_n===fn.Z_OK):xn!==fn.Z_SYNC_FLUSH||(this.onEnd(fn.Z_OK),!(Mn.avail_out=0))},vn.prototype.onData=function(wn){this.chunks.push(wn)},vn.prototype.onEnd=function(wn){wn===fn.Z_OK&&(this.options.to==="string"?this.result=this.chunks.join(""):this.result=dn.flattenChunks(this.chunks)),this.chunks=[],this.err=wn,this.msg=this.strm.msg},cn.Inflate=vn,cn.inflate=yn,cn.inflateRaw=function(wn,kn){return(kn=kn||{}).raw=!0,yn(wn,kn)},cn.ungzip=yn},{"./utils/common":41,"./utils/strings":42,"./zlib/constants":44,"./zlib/gzheader":47,"./zlib/inflate":49,"./zlib/messages":51,"./zlib/zstream":53}],41:[function(sn,ln,cn){var un=typeof Uint8Array<"u"&&typeof Uint16Array<"u"&&typeof Int32Array<"u";cn.assign=function(fn){for(var pn=Array.prototype.slice.call(arguments,1);pn.length;){var gn=pn.shift();if(gn){if(typeof gn!="object")throw new TypeError(gn+"must be non-object");for(var mn in gn)gn.hasOwnProperty(mn)&&(fn[mn]=gn[mn])}}return fn},cn.shrinkBuf=function(fn,pn){return fn.length===pn?fn:fn.subarray?fn.subarray(0,pn):(fn.length=pn,fn)};var dn={arraySet:function(fn,pn,gn,mn,bn){if(pn.subarray&&fn.subarray)fn.set(pn.subarray(gn,gn+mn),bn);else for(var vn=0;vn<mn;vn++)fn[bn+vn]=pn[gn+vn]},flattenChunks:function(fn){var pn,gn,mn,bn,vn,yn;for(pn=mn=0,gn=fn.length;pn<gn;pn++)mn+=fn[pn].length;for(yn=new Uint8Array(mn),pn=bn=0,gn=fn.length;pn<gn;pn++)vn=fn[pn],yn.set(vn,bn),bn+=vn.length;return yn}},hn={arraySet:function(fn,pn,gn,mn,bn){for(var vn=0;vn<mn;vn++)fn[bn+vn]=pn[gn+vn]},flattenChunks:function(fn){return[].concat.apply([],fn)}};cn.setTyped=function(fn){fn?(cn.Buf8=Uint8Array,cn.Buf16=Uint16Array,cn.Buf32=Int32Array,cn.assign(cn,dn)):(cn.Buf8=Array,cn.Buf16=Array,cn.Buf32=Array,cn.assign(cn,hn))},cn.setTyped(un)},{}],42:[function(sn,ln,cn){var un=sn("./common"),dn=!0,hn=!0;try{String.fromCharCode.apply(null,[0])}catch{dn=!1}try{String.fromCharCode.apply(null,new Uint8Array(1))}catch{hn=!1}for(var fn=new un.Buf8(256),pn=0;pn<256;pn++)fn[pn]=252<=pn?6:248<=pn?5:240<=pn?4:224<=pn?3:192<=pn?2:1;function gn(mn,bn){if(bn<65537&&(mn.subarray&&hn||!mn.subarray&&dn))return String.fromCharCode.apply(null,un.shrinkBuf(mn,bn));for(var vn="",yn=0;yn<bn;yn++)vn+=String.fromCharCode(mn[yn]);return vn}fn[254]=fn[254]=1,cn.string2buf=function(mn){var bn,vn,yn,wn,kn,_n=mn.length,xn=0;for(wn=0;wn<_n;wn++)(64512&(vn=mn.charCodeAt(wn)))==55296&&wn+1<_n&&(64512&(yn=mn.charCodeAt(wn+1)))==56320&&(vn=65536+(vn-55296<<10)+(yn-56320),wn++),xn+=vn<128?1:vn<2048?2:vn<65536?3:4;for(bn=new un.Buf8(xn),wn=kn=0;kn<xn;wn++)(64512&(vn=mn.charCodeAt(wn)))==55296&&wn+1<_n&&(64512&(yn=mn.charCodeAt(wn+1)))==56320&&(vn=65536+(vn-55296<<10)+(yn-56320),wn++),vn<128?bn[kn++]=vn:(vn<2048?bn[kn++]=192|vn>>>6:(vn<65536?bn[kn++]=224|vn>>>12:(bn[kn++]=240|vn>>>18,bn[kn++]=128|vn>>>12&63),bn[kn++]=128|vn>>>6&63),bn[kn++]=128|63&vn);return bn},cn.buf2binstring=function(mn){return gn(mn,mn.length)},cn.binstring2buf=function(mn){for(var bn=new un.Buf8(mn.length),vn=0,yn=bn.length;vn<yn;vn++)bn[vn]=mn.charCodeAt(vn);return bn},cn.buf2string=function(mn,bn){var vn,yn,wn,kn,_n=bn||mn.length,xn=new Array(2*_n);for(vn=yn=0;vn<_n;)if((wn=mn[vn++])<128)xn[yn++]=wn;else if(4<(kn=fn[wn]))xn[yn++]=65533,vn+=kn-1;else{for(wn&=kn===2?31:kn===3?15:7;1<kn&&vn<_n;)wn=wn<<6|63&mn[vn++],kn--;1<kn?xn[yn++]=65533:wn<65536?xn[yn++]=wn:(wn-=65536,xn[yn++]=55296|wn>>10&1023,xn[yn++]=56320|1023&wn)}return gn(xn,yn)},cn.utf8border=function(mn,bn){var vn;for((bn=bn||mn.length)>mn.length&&(bn=mn.length),vn=bn-1;0<=vn&&(192&mn[vn])==128;)vn--;return vn<0||vn===0?bn:vn+fn[mn[vn]]>bn?vn:bn}},{"./common":41}],43:[function(sn,ln,cn){ln.exports=function(un,dn,hn,fn){for(var pn=65535&un|0,gn=un>>>16&65535|0,mn=0;hn!==0;){for(hn-=mn=2e3<hn?2e3:hn;gn=gn+(pn=pn+dn[fn++]|0)|0,--mn;);pn%=65521,gn%=65521}return pn|gn<<16|0}},{}],44:[function(sn,ln,cn){ln.exports={Z_NO_FLUSH:0,Z_PARTIAL_FLUSH:1,Z_SYNC_FLUSH:2,Z_FULL_FLUSH:3,Z_FINISH:4,Z_BLOCK:5,Z_TREES:6,Z_OK:0,Z_STREAM_END:1,Z_NEED_DICT:2,Z_ERRNO:-1,Z_STREAM_ERROR:-2,Z_DATA_ERROR:-3,Z_BUF_ERROR:-5,Z_NO_COMPRESSION:0,Z_BEST_SPEED:1,Z_BEST_COMPRESSION:9,Z_DEFAULT_COMPRESSION:-1,Z_FILTERED:1,Z_HUFFMAN_ONLY:2,Z_RLE:3,Z_FIXED:4,Z_DEFAULT_STRATEGY:0,Z_BINARY:0,Z_TEXT:1,Z_UNKNOWN:2,Z_DEFLATED:8}},{}],45:[function(sn,ln,cn){var un=(function(){for(var dn,hn=[],fn=0;fn<256;fn++){dn=fn;for(var pn=0;pn<8;pn++)dn=1&dn?3988292384^dn>>>1:dn>>>1;hn[fn]=dn}return hn})();ln.exports=function(dn,hn,fn,pn){var gn=un,mn=pn+fn;dn^=-1;for(var bn=pn;bn<mn;bn++)dn=dn>>>8^gn[255&(dn^hn[bn])];return-1^dn}},{}],46:[function(sn,ln,cn){var un,dn=sn("../utils/common"),hn=sn("./trees"),fn=sn("./adler32"),pn=sn("./crc32"),gn=sn("./messages"),mn=0,bn=4,vn=0,yn=-2,wn=-1,kn=4,_n=2,xn=8,En=9,Tn=286,Bn=30,Nn=19,Mn=2*Tn+1,Ln=15,On=3,zn=258,Pn=zn+On+1,An=42,Vn=113,Sn=1,Rn=2,Hn=3,Zn=4;function Qn(Cn,qn){return Cn.msg=gn[qn],qn}function Yn(Cn){return(Cn<<1)-(4<Cn?9:0)}function tr(Cn){for(var qn=Cn.length;0<=--qn;)Cn[qn]=0}function Un(Cn){var qn=Cn.state,Gn=qn.pending;Gn>Cn.avail_out&&(Gn=Cn.avail_out),Gn!==0&&(dn.arraySet(Cn.output,qn.pending_buf,qn.pending_out,Gn,Cn.next_out),Cn.next_out+=Gn,qn.pending_out+=Gn,Cn.total_out+=Gn,Cn.avail_out-=Gn,qn.pending-=Gn,qn.pending===0&&(qn.pending_out=0))}function Xn(Cn,qn){hn._tr_flush_block(Cn,0<=Cn.block_start?Cn.block_start:-1,Cn.strstart-Cn.block_start,qn),Cn.block_start=Cn.strstart,Un(Cn.strm)}function or(Cn,qn){Cn.pending_buf[Cn.pending++]=qn}function kr(Cn,qn){Cn.pending_buf[Cn.pending++]=qn>>>8&255,Cn.pending_buf[Cn.pending++]=255&qn}function wr(Cn,qn){var Gn,Dn,In=Cn.max_chain_length,Wn=Cn.strstart,rr=Cn.prev_length,nr=Cn.nice_match,er=Cn.strstart>Cn.w_size-Pn?Cn.strstart-(Cn.w_size-Pn):0,ar=Cn.window,mr=Cn.w_mask,fr=Cn.prev,xr=Cn.strstart+zn,Br=ar[Wn+rr-1],Er=ar[Wn+rr];Cn.prev_length>=Cn.good_match&&(In>>=2),nr>Cn.lookahead&&(nr=Cn.lookahead);do if(ar[(Gn=qn)+rr]===Er&&ar[Gn+rr-1]===Br&&ar[Gn]===ar[Wn]&&ar[++Gn]===ar[Wn+1]){Wn+=2,Gn++;do;while(ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&ar[++Wn]===ar[++Gn]&&Wn<xr);if(Dn=zn-(xr-Wn),Wn=xr-zn,rr<Dn){if(Cn.match_start=qn,nr<=(rr=Dn))break;Br=ar[Wn+rr-1],Er=ar[Wn+rr]}}while((qn=fr[qn&mr])>er&&--In!=0);return rr<=Cn.lookahead?rr:Cn.lookahead}function Nr(Cn){var qn,Gn,Dn,In,Wn,rr,nr,er,ar,mr,fr=Cn.w_size;do{if(In=Cn.window_size-Cn.lookahead-Cn.strstart,Cn.strstart>=fr+(fr-Pn)){for(dn.arraySet(Cn.window,Cn.window,fr,fr,0),Cn.match_start-=fr,Cn.strstart-=fr,Cn.block_start-=fr,qn=Gn=Cn.hash_size;Dn=Cn.head[--qn],Cn.head[qn]=fr<=Dn?Dn-fr:0,--Gn;);for(qn=Gn=fr;Dn=Cn.prev[--qn],Cn.prev[qn]=fr<=Dn?Dn-fr:0,--Gn;);In+=fr}if(Cn.strm.avail_in===0)break;if(rr=Cn.strm,nr=Cn.window,er=Cn.strstart+Cn.lookahead,ar=In,mr=void 0,mr=rr.avail_in,ar<mr&&(mr=ar),Gn=mr===0?0:(rr.avail_in-=mr,dn.arraySet(nr,rr.input,rr.next_in,mr,er),rr.state.wrap===1?rr.adler=fn(rr.adler,nr,mr,er):rr.state.wrap===2&&(rr.adler=pn(rr.adler,nr,mr,er)),rr.next_in+=mr,rr.total_in+=mr,mr),Cn.lookahead+=Gn,Cn.lookahead+Cn.insert>=On)for(Wn=Cn.strstart-Cn.insert,Cn.ins_h=Cn.window[Wn],Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Wn+1])&Cn.hash_mask;Cn.insert&&(Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Wn+On-1])&Cn.hash_mask,Cn.prev[Wn&Cn.w_mask]=Cn.head[Cn.ins_h],Cn.head[Cn.ins_h]=Wn,Wn++,Cn.insert--,!(Cn.lookahead+Cn.insert<On)););}while(Cn.lookahead<Pn&&Cn.strm.avail_in!==0)}function $r(Cn,qn){for(var Gn,Dn;;){if(Cn.lookahead<Pn){if(Nr(Cn),Cn.lookahead<Pn&&qn===mn)return Sn;if(Cn.lookahead===0)break}if(Gn=0,Cn.lookahead>=On&&(Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Cn.strstart+On-1])&Cn.hash_mask,Gn=Cn.prev[Cn.strstart&Cn.w_mask]=Cn.head[Cn.ins_h],Cn.head[Cn.ins_h]=Cn.strstart),Gn!==0&&Cn.strstart-Gn<=Cn.w_size-Pn&&(Cn.match_length=wr(Cn,Gn)),Cn.match_length>=On)if(Dn=hn._tr_tally(Cn,Cn.strstart-Cn.match_start,Cn.match_length-On),Cn.lookahead-=Cn.match_length,Cn.match_length<=Cn.max_lazy_match&&Cn.lookahead>=On){for(Cn.match_length--;Cn.strstart++,Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Cn.strstart+On-1])&Cn.hash_mask,Gn=Cn.prev[Cn.strstart&Cn.w_mask]=Cn.head[Cn.ins_h],Cn.head[Cn.ins_h]=Cn.strstart,--Cn.match_length!=0;);Cn.strstart++}else Cn.strstart+=Cn.match_length,Cn.match_length=0,Cn.ins_h=Cn.window[Cn.strstart],Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Cn.strstart+1])&Cn.hash_mask;else Dn=hn._tr_tally(Cn,0,Cn.window[Cn.strstart]),Cn.lookahead--,Cn.strstart++;if(Dn&&(Xn(Cn,!1),Cn.strm.avail_out===0))return Sn}return Cn.insert=Cn.strstart<On-1?Cn.strstart:On-1,qn===bn?(Xn(Cn,!0),Cn.strm.avail_out===0?Hn:Zn):Cn.last_lit&&(Xn(Cn,!1),Cn.strm.avail_out===0)?Sn:Rn}function cr(Cn,qn){for(var Gn,Dn,In;;){if(Cn.lookahead<Pn){if(Nr(Cn),Cn.lookahead<Pn&&qn===mn)return Sn;if(Cn.lookahead===0)break}if(Gn=0,Cn.lookahead>=On&&(Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Cn.strstart+On-1])&Cn.hash_mask,Gn=Cn.prev[Cn.strstart&Cn.w_mask]=Cn.head[Cn.ins_h],Cn.head[Cn.ins_h]=Cn.strstart),Cn.prev_length=Cn.match_length,Cn.prev_match=Cn.match_start,Cn.match_length=On-1,Gn!==0&&Cn.prev_length<Cn.max_lazy_match&&Cn.strstart-Gn<=Cn.w_size-Pn&&(Cn.match_length=wr(Cn,Gn),Cn.match_length<=5&&(Cn.strategy===1||Cn.match_length===On&&4096<Cn.strstart-Cn.match_start)&&(Cn.match_length=On-1)),Cn.prev_length>=On&&Cn.match_length<=Cn.prev_length){for(In=Cn.strstart+Cn.lookahead-On,Dn=hn._tr_tally(Cn,Cn.strstart-1-Cn.prev_match,Cn.prev_length-On),Cn.lookahead-=Cn.prev_length-1,Cn.prev_length-=2;++Cn.strstart<=In&&(Cn.ins_h=(Cn.ins_h<<Cn.hash_shift^Cn.window[Cn.strstart+On-1])&Cn.hash_mask,Gn=Cn.prev[Cn.strstart&Cn.w_mask]=Cn.head[Cn.ins_h],Cn.head[Cn.ins_h]=Cn.strstart),--Cn.prev_length!=0;);if(Cn.match_available=0,Cn.match_length=On-1,Cn.strstart++,Dn&&(Xn(Cn,!1),Cn.strm.avail_out===0))return Sn}else if(Cn.match_available){if((Dn=hn._tr_tally(Cn,0,Cn.window[Cn.strstart-1]))&&Xn(Cn,!1),Cn.strstart++,Cn.lookahead--,Cn.strm.avail_out===0)return Sn}else Cn.match_available=1,Cn.strstart++,Cn.lookahead--}return Cn.match_available&&(Dn=hn._tr_tally(Cn,0,Cn.window[Cn.strstart-1]),Cn.match_available=0),Cn.insert=Cn.strstart<On-1?Cn.strstart:On-1,qn===bn?(Xn(Cn,!0),Cn.strm.avail_out===0?Hn:Zn):Cn.last_lit&&(Xn(Cn,!1),Cn.strm.avail_out===0)?Sn:Rn}function hr(Cn,qn,Gn,Dn,In){this.good_length=Cn,this.max_lazy=qn,this.nice_length=Gn,this.max_chain=Dn,this.func=In}function gr(){this.strm=null,this.status=0,this.pending_buf=null,this.pending_buf_size=0,this.pending_out=0,this.pending=0,this.wrap=0,this.gzhead=null,this.gzindex=0,this.method=xn,this.last_flush=-1,this.w_size=0,this.w_bits=0,this.w_mask=0,this.window=null,this.window_size=0,this.prev=null,this.head=null,this.ins_h=0,this.hash_size=0,this.hash_bits=0,this.hash_mask=0,this.hash_shift=0,this.block_start=0,this.match_length=0,this.prev_match=0,this.match_available=0,this.strstart=0,this.match_start=0,this.lookahead=0,this.prev_length=0,this.max_chain_length=0,this.max_lazy_match=0,this.level=0,this.strategy=0,this.good_match=0,this.nice_match=0,this.dyn_ltree=new dn.Buf16(2*Mn),this.dyn_dtree=new dn.Buf16(2*(2*Bn+1)),this.bl_tree=new dn.Buf16(2*(2*Nn+1)),tr(this.dyn_ltree),tr(this.dyn_dtree),tr(this.bl_tree),this.l_desc=null,this.d_desc=null,this.bl_desc=null,this.bl_count=new dn.Buf16(Ln+1),this.heap=new dn.Buf16(2*Tn+1),tr(this.heap),this.heap_len=0,this.heap_max=0,this.depth=new dn.Buf16(2*Tn+1),tr(this.depth),this.l_buf=0,this.lit_bufsize=0,this.last_lit=0,this.d_buf=0,this.opt_len=0,this.static_len=0,this.matches=0,this.insert=0,this.bi_buf=0,this.bi_valid=0}function Jn(Cn){var qn;return Cn&&Cn.state?(Cn.total_in=Cn.total_out=0,Cn.data_type=_n,(qn=Cn.state).pending=0,qn.pending_out=0,qn.wrap<0&&(qn.wrap=-qn.wrap),qn.status=qn.wrap?An:Vn,Cn.adler=qn.wrap===2?0:1,qn.last_flush=mn,hn._tr_init(qn),vn):Qn(Cn,yn)}function Fn(Cn){var qn=Jn(Cn);return qn===vn&&(function(Gn){Gn.window_size=2*Gn.w_size,tr(Gn.head),Gn.max_lazy_match=un[Gn.level].max_lazy,Gn.good_match=un[Gn.level].good_length,Gn.nice_match=un[Gn.level].nice_length,Gn.max_chain_length=un[Gn.level].max_chain,Gn.strstart=0,Gn.block_start=0,Gn.lookahead=0,Gn.insert=0,Gn.match_length=Gn.prev_length=On-1,Gn.match_available=0,Gn.ins_h=0})(Cn.state),qn}function Kn(Cn,qn,Gn,Dn,In,Wn){if(!Cn)return yn;var rr=1;if(qn===wn&&(qn=6),Dn<0?(rr=0,Dn=-Dn):15<Dn&&(rr=2,Dn-=16),In<1||En<In||Gn!==xn||Dn<8||15<Dn||qn<0||9<qn||Wn<0||kn<Wn)return Qn(Cn,yn);Dn===8&&(Dn=9);var nr=new gr;return(Cn.state=nr).strm=Cn,nr.wrap=rr,nr.gzhead=null,nr.w_bits=Dn,nr.w_size=1<<nr.w_bits,nr.w_mask=nr.w_size-1,nr.hash_bits=In+7,nr.hash_size=1<<nr.hash_bits,nr.hash_mask=nr.hash_size-1,nr.hash_shift=~~((nr.hash_bits+On-1)/On),nr.window=new dn.Buf8(2*nr.w_size),nr.head=new dn.Buf16(nr.hash_size),nr.prev=new dn.Buf16(nr.w_size),nr.lit_bufsize=1<<In+6,nr.pending_buf_size=4*nr.lit_bufsize,nr.pending_buf=new dn.Buf8(nr.pending_buf_size),nr.d_buf=1*nr.lit_bufsize,nr.l_buf=3*nr.lit_bufsize,nr.level=qn,nr.strategy=Wn,nr.method=Gn,Fn(Cn)}un=[new hr(0,0,0,0,function(Cn,qn){var Gn=65535;for(Gn>Cn.pending_buf_size-5&&(Gn=Cn.pending_buf_size-5);;){if(Cn.lookahead<=1){if(Nr(Cn),Cn.lookahead===0&&qn===mn)return Sn;if(Cn.lookahead===0)break}Cn.strstart+=Cn.lookahead,Cn.lookahead=0;var Dn=Cn.block_start+Gn;if((Cn.strstart===0||Cn.strstart>=Dn)&&(Cn.lookahead=Cn.strstart-Dn,Cn.strstart=Dn,Xn(Cn,!1),Cn.strm.avail_out===0)||Cn.strstart-Cn.block_start>=Cn.w_size-Pn&&(Xn(Cn,!1),Cn.strm.avail_out===0))return Sn}return Cn.insert=0,qn===bn?(Xn(Cn,!0),Cn.strm.avail_out===0?Hn:Zn):(Cn.strstart>Cn.block_start&&(Xn(Cn,!1),Cn.strm.avail_out),Sn)}),new hr(4,4,8,4,$r),new hr(4,5,16,8,$r),new hr(4,6,32,32,$r),new hr(4,4,16,16,cr),new hr(8,16,32,32,cr),new hr(8,16,128,128,cr),new hr(8,32,128,256,cr),new hr(32,128,258,1024,cr),new hr(32,258,258,4096,cr)],cn.deflateInit=function(Cn,qn){return Kn(Cn,qn,xn,15,8,0)},cn.deflateInit2=Kn,cn.deflateReset=Fn,cn.deflateResetKeep=Jn,cn.deflateSetHeader=function(Cn,qn){return Cn&&Cn.state?Cn.state.wrap!==2?yn:(Cn.state.gzhead=qn,vn):yn},cn.deflate=function(Cn,qn){var Gn,Dn,In,Wn;if(!Cn||!Cn.state||5<qn||qn<0)return Cn?Qn(Cn,yn):yn;if(Dn=Cn.state,!Cn.output||!Cn.input&&Cn.avail_in!==0||Dn.status===666&&qn!==bn)return Qn(Cn,Cn.avail_out===0?-5:yn);if(Dn.strm=Cn,Gn=Dn.last_flush,Dn.last_flush=qn,Dn.status===An)if(Dn.wrap===2)Cn.adler=0,or(Dn,31),or(Dn,139),or(Dn,8),Dn.gzhead?(or(Dn,(Dn.gzhead.text?1:0)+(Dn.gzhead.hcrc?2:0)+(Dn.gzhead.extra?4:0)+(Dn.gzhead.name?8:0)+(Dn.gzhead.comment?16:0)),or(Dn,255&Dn.gzhead.time),or(Dn,Dn.gzhead.time>>8&255),or(Dn,Dn.gzhead.time>>16&255),or(Dn,Dn.gzhead.time>>24&255),or(Dn,Dn.level===9?2:2<=Dn.strategy||Dn.level<2?4:0),or(Dn,255&Dn.gzhead.os),Dn.gzhead.extra&&Dn.gzhead.extra.length&&(or(Dn,255&Dn.gzhead.extra.length),or(Dn,Dn.gzhead.extra.length>>8&255)),Dn.gzhead.hcrc&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending,0)),Dn.gzindex=0,Dn.status=69):(or(Dn,0),or(Dn,0),or(Dn,0),or(Dn,0),or(Dn,0),or(Dn,Dn.level===9?2:2<=Dn.strategy||Dn.level<2?4:0),or(Dn,3),Dn.status=Vn);else{var rr=xn+(Dn.w_bits-8<<4)<<8;rr|=(2<=Dn.strategy||Dn.level<2?0:Dn.level<6?1:Dn.level===6?2:3)<<6,Dn.strstart!==0&&(rr|=32),rr+=31-rr%31,Dn.status=Vn,kr(Dn,rr),Dn.strstart!==0&&(kr(Dn,Cn.adler>>>16),kr(Dn,65535&Cn.adler)),Cn.adler=1}if(Dn.status===69)if(Dn.gzhead.extra){for(In=Dn.pending;Dn.gzindex<(65535&Dn.gzhead.extra.length)&&(Dn.pending!==Dn.pending_buf_size||(Dn.gzhead.hcrc&&Dn.pending>In&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending-In,In)),Un(Cn),In=Dn.pending,Dn.pending!==Dn.pending_buf_size));)or(Dn,255&Dn.gzhead.extra[Dn.gzindex]),Dn.gzindex++;Dn.gzhead.hcrc&&Dn.pending>In&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending-In,In)),Dn.gzindex===Dn.gzhead.extra.length&&(Dn.gzindex=0,Dn.status=73)}else Dn.status=73;if(Dn.status===73)if(Dn.gzhead.name){In=Dn.pending;do{if(Dn.pending===Dn.pending_buf_size&&(Dn.gzhead.hcrc&&Dn.pending>In&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending-In,In)),Un(Cn),In=Dn.pending,Dn.pending===Dn.pending_buf_size)){Wn=1;break}Wn=Dn.gzindex<Dn.gzhead.name.length?255&Dn.gzhead.name.charCodeAt(Dn.gzindex++):0,or(Dn,Wn)}while(Wn!==0);Dn.gzhead.hcrc&&Dn.pending>In&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending-In,In)),Wn===0&&(Dn.gzindex=0,Dn.status=91)}else Dn.status=91;if(Dn.status===91)if(Dn.gzhead.comment){In=Dn.pending;do{if(Dn.pending===Dn.pending_buf_size&&(Dn.gzhead.hcrc&&Dn.pending>In&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending-In,In)),Un(Cn),In=Dn.pending,Dn.pending===Dn.pending_buf_size)){Wn=1;break}Wn=Dn.gzindex<Dn.gzhead.comment.length?255&Dn.gzhead.comment.charCodeAt(Dn.gzindex++):0,or(Dn,Wn)}while(Wn!==0);Dn.gzhead.hcrc&&Dn.pending>In&&(Cn.adler=pn(Cn.adler,Dn.pending_buf,Dn.pending-In,In)),Wn===0&&(Dn.status=103)}else Dn.status=103;if(Dn.status===103&&(Dn.gzhead.hcrc?(Dn.pending+2>Dn.pending_buf_size&&Un(Cn),Dn.pending+2<=Dn.pending_buf_size&&(or(Dn,255&Cn.adler),or(Dn,Cn.adler>>8&255),Cn.adler=0,Dn.status=Vn)):Dn.status=Vn),Dn.pending!==0){if(Un(Cn),Cn.avail_out===0)return Dn.last_flush=-1,vn}else if(Cn.avail_in===0&&Yn(qn)<=Yn(Gn)&&qn!==bn)return Qn(Cn,-5);if(Dn.status===666&&Cn.avail_in!==0)return Qn(Cn,-5);if(Cn.avail_in!==0||Dn.lookahead!==0||qn!==mn&&Dn.status!==666){var nr=Dn.strategy===2?(function(er,ar){for(var mr;;){if(er.lookahead===0&&(Nr(er),er.lookahead===0)){if(ar===mn)return Sn;break}if(er.match_length=0,mr=hn._tr_tally(er,0,er.window[er.strstart]),er.lookahead--,er.strstart++,mr&&(Xn(er,!1),er.strm.avail_out===0))return Sn}return er.insert=0,ar===bn?(Xn(er,!0),er.strm.avail_out===0?Hn:Zn):er.last_lit&&(Xn(er,!1),er.strm.avail_out===0)?Sn:Rn})(Dn,qn):Dn.strategy===3?(function(er,ar){for(var mr,fr,xr,Br,Er=er.window;;){if(er.lookahead<=zn){if(Nr(er),er.lookahead<=zn&&ar===mn)return Sn;if(er.lookahead===0)break}if(er.match_length=0,er.lookahead>=On&&0<er.strstart&&(fr=Er[xr=er.strstart-1])===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]){Br=er.strstart+zn;do;while(fr===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]&&fr===Er[++xr]&&xr<Br);er.match_length=zn-(Br-xr),er.match_length>er.lookahead&&(er.match_length=er.lookahead)}if(er.match_length>=On?(mr=hn._tr_tally(er,1,er.match_length-On),er.lookahead-=er.match_length,er.strstart+=er.match_length,er.match_length=0):(mr=hn._tr_tally(er,0,er.window[er.strstart]),er.lookahead--,er.strstart++),mr&&(Xn(er,!1),er.strm.avail_out===0))return Sn}return er.insert=0,ar===bn?(Xn(er,!0),er.strm.avail_out===0?Hn:Zn):er.last_lit&&(Xn(er,!1),er.strm.avail_out===0)?Sn:Rn})(Dn,qn):un[Dn.level].func(Dn,qn);if(nr!==Hn&&nr!==Zn||(Dn.status=666),nr===Sn||nr===Hn)return Cn.avail_out===0&&(Dn.last_flush=-1),vn;if(nr===Rn&&(qn===1?hn._tr_align(Dn):qn!==5&&(hn._tr_stored_block(Dn,0,0,!1),qn===3&&(tr(Dn.head),Dn.lookahead===0&&(Dn.strstart=0,Dn.block_start=0,Dn.insert=0))),Un(Cn),Cn.avail_out===0))return Dn.last_flush=-1,vn}return qn!==bn?vn:Dn.wrap<=0?1:(Dn.wrap===2?(or(Dn,255&Cn.adler),or(Dn,Cn.adler>>8&255),or(Dn,Cn.adler>>16&255),or(Dn,Cn.adler>>24&255),or(Dn,255&Cn.total_in),or(Dn,Cn.total_in>>8&255),or(Dn,Cn.total_in>>16&255),or(Dn,Cn.total_in>>24&255)):(kr(Dn,Cn.adler>>>16),kr(Dn,65535&Cn.adler)),Un(Cn),0<Dn.wrap&&(Dn.wrap=-Dn.wrap),Dn.pending!==0?vn:1)},cn.deflateEnd=function(Cn){var qn;return Cn&&Cn.state?(qn=Cn.state.status)!==An&&qn!==69&&qn!==73&&qn!==91&&qn!==103&&qn!==Vn&&qn!==666?Qn(Cn,yn):(Cn.state=null,qn===Vn?Qn(Cn,-3):vn):yn},cn.deflateSetDictionary=function(Cn,qn){var Gn,Dn,In,Wn,rr,nr,er,ar,mr=qn.length;if(!Cn||!Cn.state||(Wn=(Gn=Cn.state).wrap)===2||Wn===1&&Gn.status!==An||Gn.lookahead)return yn;for(Wn===1&&(Cn.adler=fn(Cn.adler,qn,mr,0)),Gn.wrap=0,mr>=Gn.w_size&&(Wn===0&&(tr(Gn.head),Gn.strstart=0,Gn.block_start=0,Gn.insert=0),ar=new dn.Buf8(Gn.w_size),dn.arraySet(ar,qn,mr-Gn.w_size,Gn.w_size,0),qn=ar,mr=Gn.w_size),rr=Cn.avail_in,nr=Cn.next_in,er=Cn.input,Cn.avail_in=mr,Cn.next_in=0,Cn.input=qn,Nr(Gn);Gn.lookahead>=On;){for(Dn=Gn.strstart,In=Gn.lookahead-(On-1);Gn.ins_h=(Gn.ins_h<<Gn.hash_shift^Gn.window[Dn+On-1])&Gn.hash_mask,Gn.prev[Dn&Gn.w_mask]=Gn.head[Gn.ins_h],Gn.head[Gn.ins_h]=Dn,Dn++,--In;);Gn.strstart=Dn,Gn.lookahead=On-1,Nr(Gn)}return Gn.strstart+=Gn.lookahead,Gn.block_start=Gn.strstart,Gn.insert=Gn.lookahead,Gn.lookahead=0,Gn.match_length=Gn.prev_length=On-1,Gn.match_available=0,Cn.next_in=nr,Cn.input=er,Cn.avail_in=rr,Gn.wrap=Wn,vn},cn.deflateInfo="pako deflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./messages":51,"./trees":52}],47:[function(sn,ln,cn){ln.exports=function(){this.text=0,this.time=0,this.xflags=0,this.os=0,this.extra=null,this.extra_len=0,this.name="",this.comment="",this.hcrc=0,this.done=!1}},{}],48:[function(sn,ln,cn){ln.exports=function(un,dn){var hn,fn,pn,gn,mn,bn,vn,yn,wn,kn,_n,xn,En,Tn,Bn,Nn,Mn,Ln,On,zn,Pn,An,Vn,Sn,Rn;hn=un.state,fn=un.next_in,Sn=un.input,pn=fn+(un.avail_in-5),gn=un.next_out,Rn=un.output,mn=gn-(dn-un.avail_out),bn=gn+(un.avail_out-257),vn=hn.dmax,yn=hn.wsize,wn=hn.whave,kn=hn.wnext,_n=hn.window,xn=hn.hold,En=hn.bits,Tn=hn.lencode,Bn=hn.distcode,Nn=(1<<hn.lenbits)-1,Mn=(1<<hn.distbits)-1;e:do{En<15&&(xn+=Sn[fn++]<<En,En+=8,xn+=Sn[fn++]<<En,En+=8),Ln=Tn[xn&Nn];t:for(;;){if(xn>>>=On=Ln>>>24,En-=On,(On=Ln>>>16&255)===0)Rn[gn++]=65535&Ln;else{if(!(16&On)){if((64&On)==0){Ln=Tn[(65535&Ln)+(xn&(1<<On)-1)];continue t}if(32&On){hn.mode=12;break e}un.msg="invalid literal/length code",hn.mode=30;break e}zn=65535&Ln,(On&=15)&&(En<On&&(xn+=Sn[fn++]<<En,En+=8),zn+=xn&(1<<On)-1,xn>>>=On,En-=On),En<15&&(xn+=Sn[fn++]<<En,En+=8,xn+=Sn[fn++]<<En,En+=8),Ln=Bn[xn&Mn];n:for(;;){if(xn>>>=On=Ln>>>24,En-=On,!(16&(On=Ln>>>16&255))){if((64&On)==0){Ln=Bn[(65535&Ln)+(xn&(1<<On)-1)];continue n}un.msg="invalid distance code",hn.mode=30;break e}if(Pn=65535&Ln,En<(On&=15)&&(xn+=Sn[fn++]<<En,(En+=8)<On&&(xn+=Sn[fn++]<<En,En+=8)),vn<(Pn+=xn&(1<<On)-1)){un.msg="invalid distance too far back",hn.mode=30;break e}if(xn>>>=On,En-=On,(On=gn-mn)<Pn){if(wn<(On=Pn-On)&&hn.sane){un.msg="invalid distance too far back",hn.mode=30;break e}if(Vn=_n,(An=0)===kn){if(An+=yn-On,On<zn){for(zn-=On;Rn[gn++]=_n[An++],--On;);An=gn-Pn,Vn=Rn}}else if(kn<On){if(An+=yn+kn-On,(On-=kn)<zn){for(zn-=On;Rn[gn++]=_n[An++],--On;);if(An=0,kn<zn){for(zn-=On=kn;Rn[gn++]=_n[An++],--On;);An=gn-Pn,Vn=Rn}}}else if(An+=kn-On,On<zn){for(zn-=On;Rn[gn++]=_n[An++],--On;);An=gn-Pn,Vn=Rn}for(;2<zn;)Rn[gn++]=Vn[An++],Rn[gn++]=Vn[An++],Rn[gn++]=Vn[An++],zn-=3;zn&&(Rn[gn++]=Vn[An++],1<zn&&(Rn[gn++]=Vn[An++]))}else{for(An=gn-Pn;Rn[gn++]=Rn[An++],Rn[gn++]=Rn[An++],Rn[gn++]=Rn[An++],2<(zn-=3););zn&&(Rn[gn++]=Rn[An++],1<zn&&(Rn[gn++]=Rn[An++]))}break}}break}}while(fn<pn&&gn<bn);fn-=zn=En>>3,xn&=(1<<(En-=zn<<3))-1,un.next_in=fn,un.next_out=gn,un.avail_in=fn<pn?pn-fn+5:5-(fn-pn),un.avail_out=gn<bn?bn-gn+257:257-(gn-bn),hn.hold=xn,hn.bits=En}},{}],49:[function(sn,ln,cn){var un=sn("../utils/common"),dn=sn("./adler32"),hn=sn("./crc32"),fn=sn("./inffast"),pn=sn("./inftrees"),gn=1,mn=2,bn=0,vn=-2,yn=1,wn=852,kn=592;function _n(An){return(An>>>24&255)+(An>>>8&65280)+((65280&An)<<8)+((255&An)<<24)}function xn(){this.mode=0,this.last=!1,this.wrap=0,this.havedict=!1,this.flags=0,this.dmax=0,this.check=0,this.total=0,this.head=null,this.wbits=0,this.wsize=0,this.whave=0,this.wnext=0,this.window=null,this.hold=0,this.bits=0,this.length=0,this.offset=0,this.extra=0,this.lencode=null,this.distcode=null,this.lenbits=0,this.distbits=0,this.ncode=0,this.nlen=0,this.ndist=0,this.have=0,this.next=null,this.lens=new un.Buf16(320),this.work=new un.Buf16(288),this.lendyn=null,this.distdyn=null,this.sane=0,this.back=0,this.was=0}function En(An){var Vn;return An&&An.state?(Vn=An.state,An.total_in=An.total_out=Vn.total=0,An.msg="",Vn.wrap&&(An.adler=1&Vn.wrap),Vn.mode=yn,Vn.last=0,Vn.havedict=0,Vn.dmax=32768,Vn.head=null,Vn.hold=0,Vn.bits=0,Vn.lencode=Vn.lendyn=new un.Buf32(wn),Vn.distcode=Vn.distdyn=new un.Buf32(kn),Vn.sane=1,Vn.back=-1,bn):vn}function Tn(An){var Vn;return An&&An.state?((Vn=An.state).wsize=0,Vn.whave=0,Vn.wnext=0,En(An)):vn}function Bn(An,Vn){var Sn,Rn;return An&&An.state?(Rn=An.state,Vn<0?(Sn=0,Vn=-Vn):(Sn=1+(Vn>>4),Vn<48&&(Vn&=15)),Vn&&(Vn<8||15<Vn)?vn:(Rn.window!==null&&Rn.wbits!==Vn&&(Rn.window=null),Rn.wrap=Sn,Rn.wbits=Vn,Tn(An))):vn}function Nn(An,Vn){var Sn,Rn;return An?(Rn=new xn,(An.state=Rn).window=null,(Sn=Bn(An,Vn))!==bn&&(An.state=null),Sn):vn}var Mn,Ln,On=!0;function zn(An){if(On){var Vn;for(Mn=new un.Buf32(512),Ln=new un.Buf32(32),Vn=0;Vn<144;)An.lens[Vn++]=8;for(;Vn<256;)An.lens[Vn++]=9;for(;Vn<280;)An.lens[Vn++]=7;for(;Vn<288;)An.lens[Vn++]=8;for(pn(gn,An.lens,0,288,Mn,0,An.work,{bits:9}),Vn=0;Vn<32;)An.lens[Vn++]=5;pn(mn,An.lens,0,32,Ln,0,An.work,{bits:5}),On=!1}An.lencode=Mn,An.lenbits=9,An.distcode=Ln,An.distbits=5}function Pn(An,Vn,Sn,Rn){var Hn,Zn=An.state;return Zn.window===null&&(Zn.wsize=1<<Zn.wbits,Zn.wnext=0,Zn.whave=0,Zn.window=new un.Buf8(Zn.wsize)),Rn>=Zn.wsize?(un.arraySet(Zn.window,Vn,Sn-Zn.wsize,Zn.wsize,0),Zn.wnext=0,Zn.whave=Zn.wsize):(Rn<(Hn=Zn.wsize-Zn.wnext)&&(Hn=Rn),un.arraySet(Zn.window,Vn,Sn-Rn,Hn,Zn.wnext),(Rn-=Hn)?(un.arraySet(Zn.window,Vn,Sn-Rn,Rn,0),Zn.wnext=Rn,Zn.whave=Zn.wsize):(Zn.wnext+=Hn,Zn.wnext===Zn.wsize&&(Zn.wnext=0),Zn.whave<Zn.wsize&&(Zn.whave+=Hn))),0}cn.inflateReset=Tn,cn.inflateReset2=Bn,cn.inflateResetKeep=En,cn.inflateInit=function(An){return Nn(An,15)},cn.inflateInit2=Nn,cn.inflate=function(An,Vn){var Sn,Rn,Hn,Zn,Qn,Yn,tr,Un,Xn,or,kr,wr,Nr,$r,cr,hr,gr,Jn,Fn,Kn,Cn,qn,Gn,Dn,In=0,Wn=new un.Buf8(4),rr=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];if(!An||!An.state||!An.output||!An.input&&An.avail_in!==0)return vn;(Sn=An.state).mode===12&&(Sn.mode=13),Qn=An.next_out,Hn=An.output,tr=An.avail_out,Zn=An.next_in,Rn=An.input,Yn=An.avail_in,Un=Sn.hold,Xn=Sn.bits,or=Yn,kr=tr,qn=bn;e:for(;;)switch(Sn.mode){case yn:if(Sn.wrap===0){Sn.mode=13;break}for(;Xn<16;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(2&Sn.wrap&&Un===35615){Wn[Sn.check=0]=255&Un,Wn[1]=Un>>>8&255,Sn.check=hn(Sn.check,Wn,2,0),Xn=Un=0,Sn.mode=2;break}if(Sn.flags=0,Sn.head&&(Sn.head.done=!1),!(1&Sn.wrap)||(((255&Un)<<8)+(Un>>8))%31){An.msg="incorrect header check",Sn.mode=30;break}if((15&Un)!=8){An.msg="unknown compression method",Sn.mode=30;break}if(Xn-=4,Cn=8+(15&(Un>>>=4)),Sn.wbits===0)Sn.wbits=Cn;else if(Cn>Sn.wbits){An.msg="invalid window size",Sn.mode=30;break}Sn.dmax=1<<Cn,An.adler=Sn.check=1,Sn.mode=512&Un?10:12,Xn=Un=0;break;case 2:for(;Xn<16;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(Sn.flags=Un,(255&Sn.flags)!=8){An.msg="unknown compression method",Sn.mode=30;break}if(57344&Sn.flags){An.msg="unknown header flags set",Sn.mode=30;break}Sn.head&&(Sn.head.text=Un>>8&1),512&Sn.flags&&(Wn[0]=255&Un,Wn[1]=Un>>>8&255,Sn.check=hn(Sn.check,Wn,2,0)),Xn=Un=0,Sn.mode=3;case 3:for(;Xn<32;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Sn.head&&(Sn.head.time=Un),512&Sn.flags&&(Wn[0]=255&Un,Wn[1]=Un>>>8&255,Wn[2]=Un>>>16&255,Wn[3]=Un>>>24&255,Sn.check=hn(Sn.check,Wn,4,0)),Xn=Un=0,Sn.mode=4;case 4:for(;Xn<16;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Sn.head&&(Sn.head.xflags=255&Un,Sn.head.os=Un>>8),512&Sn.flags&&(Wn[0]=255&Un,Wn[1]=Un>>>8&255,Sn.check=hn(Sn.check,Wn,2,0)),Xn=Un=0,Sn.mode=5;case 5:if(1024&Sn.flags){for(;Xn<16;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Sn.length=Un,Sn.head&&(Sn.head.extra_len=Un),512&Sn.flags&&(Wn[0]=255&Un,Wn[1]=Un>>>8&255,Sn.check=hn(Sn.check,Wn,2,0)),Xn=Un=0}else Sn.head&&(Sn.head.extra=null);Sn.mode=6;case 6:if(1024&Sn.flags&&(Yn<(wr=Sn.length)&&(wr=Yn),wr&&(Sn.head&&(Cn=Sn.head.extra_len-Sn.length,Sn.head.extra||(Sn.head.extra=new Array(Sn.head.extra_len)),un.arraySet(Sn.head.extra,Rn,Zn,wr,Cn)),512&Sn.flags&&(Sn.check=hn(Sn.check,Rn,wr,Zn)),Yn-=wr,Zn+=wr,Sn.length-=wr),Sn.length))break e;Sn.length=0,Sn.mode=7;case 7:if(2048&Sn.flags){if(Yn===0)break e;for(wr=0;Cn=Rn[Zn+wr++],Sn.head&&Cn&&Sn.length<65536&&(Sn.head.name+=String.fromCharCode(Cn)),Cn&&wr<Yn;);if(512&Sn.flags&&(Sn.check=hn(Sn.check,Rn,wr,Zn)),Yn-=wr,Zn+=wr,Cn)break e}else Sn.head&&(Sn.head.name=null);Sn.length=0,Sn.mode=8;case 8:if(4096&Sn.flags){if(Yn===0)break e;for(wr=0;Cn=Rn[Zn+wr++],Sn.head&&Cn&&Sn.length<65536&&(Sn.head.comment+=String.fromCharCode(Cn)),Cn&&wr<Yn;);if(512&Sn.flags&&(Sn.check=hn(Sn.check,Rn,wr,Zn)),Yn-=wr,Zn+=wr,Cn)break e}else Sn.head&&(Sn.head.comment=null);Sn.mode=9;case 9:if(512&Sn.flags){for(;Xn<16;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(Un!==(65535&Sn.check)){An.msg="header crc mismatch",Sn.mode=30;break}Xn=Un=0}Sn.head&&(Sn.head.hcrc=Sn.flags>>9&1,Sn.head.done=!0),An.adler=Sn.check=0,Sn.mode=12;break;case 10:for(;Xn<32;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}An.adler=Sn.check=_n(Un),Xn=Un=0,Sn.mode=11;case 11:if(Sn.havedict===0)return An.next_out=Qn,An.avail_out=tr,An.next_in=Zn,An.avail_in=Yn,Sn.hold=Un,Sn.bits=Xn,2;An.adler=Sn.check=1,Sn.mode=12;case 12:if(Vn===5||Vn===6)break e;case 13:if(Sn.last){Un>>>=7&Xn,Xn-=7&Xn,Sn.mode=27;break}for(;Xn<3;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}switch(Sn.last=1&Un,Xn-=1,3&(Un>>>=1)){case 0:Sn.mode=14;break;case 1:if(zn(Sn),Sn.mode=20,Vn!==6)break;Un>>>=2,Xn-=2;break e;case 2:Sn.mode=17;break;case 3:An.msg="invalid block type",Sn.mode=30}Un>>>=2,Xn-=2;break;case 14:for(Un>>>=7&Xn,Xn-=7&Xn;Xn<32;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if((65535&Un)!=(Un>>>16^65535)){An.msg="invalid stored block lengths",Sn.mode=30;break}if(Sn.length=65535&Un,Xn=Un=0,Sn.mode=15,Vn===6)break e;case 15:Sn.mode=16;case 16:if(wr=Sn.length){if(Yn<wr&&(wr=Yn),tr<wr&&(wr=tr),wr===0)break e;un.arraySet(Hn,Rn,Zn,wr,Qn),Yn-=wr,Zn+=wr,tr-=wr,Qn+=wr,Sn.length-=wr;break}Sn.mode=12;break;case 17:for(;Xn<14;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(Sn.nlen=257+(31&Un),Un>>>=5,Xn-=5,Sn.ndist=1+(31&Un),Un>>>=5,Xn-=5,Sn.ncode=4+(15&Un),Un>>>=4,Xn-=4,286<Sn.nlen||30<Sn.ndist){An.msg="too many length or distance symbols",Sn.mode=30;break}Sn.have=0,Sn.mode=18;case 18:for(;Sn.have<Sn.ncode;){for(;Xn<3;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Sn.lens[rr[Sn.have++]]=7&Un,Un>>>=3,Xn-=3}for(;Sn.have<19;)Sn.lens[rr[Sn.have++]]=0;if(Sn.lencode=Sn.lendyn,Sn.lenbits=7,Gn={bits:Sn.lenbits},qn=pn(0,Sn.lens,0,19,Sn.lencode,0,Sn.work,Gn),Sn.lenbits=Gn.bits,qn){An.msg="invalid code lengths set",Sn.mode=30;break}Sn.have=0,Sn.mode=19;case 19:for(;Sn.have<Sn.nlen+Sn.ndist;){for(;hr=(In=Sn.lencode[Un&(1<<Sn.lenbits)-1])>>>16&255,gr=65535&In,!((cr=In>>>24)<=Xn);){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(gr<16)Un>>>=cr,Xn-=cr,Sn.lens[Sn.have++]=gr;else{if(gr===16){for(Dn=cr+2;Xn<Dn;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(Un>>>=cr,Xn-=cr,Sn.have===0){An.msg="invalid bit length repeat",Sn.mode=30;break}Cn=Sn.lens[Sn.have-1],wr=3+(3&Un),Un>>>=2,Xn-=2}else if(gr===17){for(Dn=cr+3;Xn<Dn;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Xn-=cr,Cn=0,wr=3+(7&(Un>>>=cr)),Un>>>=3,Xn-=3}else{for(Dn=cr+7;Xn<Dn;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Xn-=cr,Cn=0,wr=11+(127&(Un>>>=cr)),Un>>>=7,Xn-=7}if(Sn.have+wr>Sn.nlen+Sn.ndist){An.msg="invalid bit length repeat",Sn.mode=30;break}for(;wr--;)Sn.lens[Sn.have++]=Cn}}if(Sn.mode===30)break;if(Sn.lens[256]===0){An.msg="invalid code -- missing end-of-block",Sn.mode=30;break}if(Sn.lenbits=9,Gn={bits:Sn.lenbits},qn=pn(gn,Sn.lens,0,Sn.nlen,Sn.lencode,0,Sn.work,Gn),Sn.lenbits=Gn.bits,qn){An.msg="invalid literal/lengths set",Sn.mode=30;break}if(Sn.distbits=6,Sn.distcode=Sn.distdyn,Gn={bits:Sn.distbits},qn=pn(mn,Sn.lens,Sn.nlen,Sn.ndist,Sn.distcode,0,Sn.work,Gn),Sn.distbits=Gn.bits,qn){An.msg="invalid distances set",Sn.mode=30;break}if(Sn.mode=20,Vn===6)break e;case 20:Sn.mode=21;case 21:if(6<=Yn&&258<=tr){An.next_out=Qn,An.avail_out=tr,An.next_in=Zn,An.avail_in=Yn,Sn.hold=Un,Sn.bits=Xn,fn(An,kr),Qn=An.next_out,Hn=An.output,tr=An.avail_out,Zn=An.next_in,Rn=An.input,Yn=An.avail_in,Un=Sn.hold,Xn=Sn.bits,Sn.mode===12&&(Sn.back=-1);break}for(Sn.back=0;hr=(In=Sn.lencode[Un&(1<<Sn.lenbits)-1])>>>16&255,gr=65535&In,!((cr=In>>>24)<=Xn);){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(hr&&(240&hr)==0){for(Jn=cr,Fn=hr,Kn=gr;hr=(In=Sn.lencode[Kn+((Un&(1<<Jn+Fn)-1)>>Jn)])>>>16&255,gr=65535&In,!(Jn+(cr=In>>>24)<=Xn);){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Un>>>=Jn,Xn-=Jn,Sn.back+=Jn}if(Un>>>=cr,Xn-=cr,Sn.back+=cr,Sn.length=gr,hr===0){Sn.mode=26;break}if(32&hr){Sn.back=-1,Sn.mode=12;break}if(64&hr){An.msg="invalid literal/length code",Sn.mode=30;break}Sn.extra=15&hr,Sn.mode=22;case 22:if(Sn.extra){for(Dn=Sn.extra;Xn<Dn;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Sn.length+=Un&(1<<Sn.extra)-1,Un>>>=Sn.extra,Xn-=Sn.extra,Sn.back+=Sn.extra}Sn.was=Sn.length,Sn.mode=23;case 23:for(;hr=(In=Sn.distcode[Un&(1<<Sn.distbits)-1])>>>16&255,gr=65535&In,!((cr=In>>>24)<=Xn);){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if((240&hr)==0){for(Jn=cr,Fn=hr,Kn=gr;hr=(In=Sn.distcode[Kn+((Un&(1<<Jn+Fn)-1)>>Jn)])>>>16&255,gr=65535&In,!(Jn+(cr=In>>>24)<=Xn);){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Un>>>=Jn,Xn-=Jn,Sn.back+=Jn}if(Un>>>=cr,Xn-=cr,Sn.back+=cr,64&hr){An.msg="invalid distance code",Sn.mode=30;break}Sn.offset=gr,Sn.extra=15&hr,Sn.mode=24;case 24:if(Sn.extra){for(Dn=Sn.extra;Xn<Dn;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}Sn.offset+=Un&(1<<Sn.extra)-1,Un>>>=Sn.extra,Xn-=Sn.extra,Sn.back+=Sn.extra}if(Sn.offset>Sn.dmax){An.msg="invalid distance too far back",Sn.mode=30;break}Sn.mode=25;case 25:if(tr===0)break e;if(wr=kr-tr,Sn.offset>wr){if((wr=Sn.offset-wr)>Sn.whave&&Sn.sane){An.msg="invalid distance too far back",Sn.mode=30;break}Nr=wr>Sn.wnext?(wr-=Sn.wnext,Sn.wsize-wr):Sn.wnext-wr,wr>Sn.length&&(wr=Sn.length),$r=Sn.window}else $r=Hn,Nr=Qn-Sn.offset,wr=Sn.length;for(tr<wr&&(wr=tr),tr-=wr,Sn.length-=wr;Hn[Qn++]=$r[Nr++],--wr;);Sn.length===0&&(Sn.mode=21);break;case 26:if(tr===0)break e;Hn[Qn++]=Sn.length,tr--,Sn.mode=21;break;case 27:if(Sn.wrap){for(;Xn<32;){if(Yn===0)break e;Yn--,Un|=Rn[Zn++]<<Xn,Xn+=8}if(kr-=tr,An.total_out+=kr,Sn.total+=kr,kr&&(An.adler=Sn.check=Sn.flags?hn(Sn.check,Hn,kr,Qn-kr):dn(Sn.check,Hn,kr,Qn-kr)),kr=tr,(Sn.flags?Un:_n(Un))!==Sn.check){An.msg="incorrect data check",Sn.mode=30;break}Xn=Un=0}Sn.mode=28;case 28:if(Sn.wrap&&Sn.flags){for(;Xn<32;){if(Yn===0)break e;Yn--,Un+=Rn[Zn++]<<Xn,Xn+=8}if(Un!==(4294967295&Sn.total)){An.msg="incorrect length check",Sn.mode=30;break}Xn=Un=0}Sn.mode=29;case 29:qn=1;break e;case 30:qn=-3;break e;case 31:return-4;case 32:default:return vn}return An.next_out=Qn,An.avail_out=tr,An.next_in=Zn,An.avail_in=Yn,Sn.hold=Un,Sn.bits=Xn,(Sn.wsize||kr!==An.avail_out&&Sn.mode<30&&(Sn.mode<27||Vn!==4))&&Pn(An,An.output,An.next_out,kr-An.avail_out)?(Sn.mode=31,-4):(or-=An.avail_in,kr-=An.avail_out,An.total_in+=or,An.total_out+=kr,Sn.total+=kr,Sn.wrap&&kr&&(An.adler=Sn.check=Sn.flags?hn(Sn.check,Hn,kr,An.next_out-kr):dn(Sn.check,Hn,kr,An.next_out-kr)),An.data_type=Sn.bits+(Sn.last?64:0)+(Sn.mode===12?128:0)+(Sn.mode===20||Sn.mode===15?256:0),(or==0&&kr===0||Vn===4)&&qn===bn&&(qn=-5),qn)},cn.inflateEnd=function(An){if(!An||!An.state)return vn;var Vn=An.state;return Vn.window&&(Vn.window=null),An.state=null,bn},cn.inflateGetHeader=function(An,Vn){var Sn;return An&&An.state?(2&(Sn=An.state).wrap)==0?vn:((Sn.head=Vn).done=!1,bn):vn},cn.inflateSetDictionary=function(An,Vn){var Sn,Rn=Vn.length;return An&&An.state?(Sn=An.state).wrap!==0&&Sn.mode!==11?vn:Sn.mode===11&&dn(1,Vn,Rn,0)!==Sn.check?-3:Pn(An,Vn,Rn,Rn)?(Sn.mode=31,-4):(Sn.havedict=1,bn):vn},cn.inflateInfo="pako inflate (from Nodeca project)"},{"../utils/common":41,"./adler32":43,"./crc32":45,"./inffast":48,"./inftrees":50}],50:[function(sn,ln,cn){var un=sn("../utils/common"),dn=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],hn=[16,16,16,16,16,16,16,16,17,17,17,17,18,18,18,18,19,19,19,19,20,20,20,20,21,21,21,21,16,72,78],fn=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577,0,0],pn=[16,16,16,16,17,17,18,18,19,19,20,20,21,21,22,22,23,23,24,24,25,25,26,26,27,27,28,28,29,29,64,64];ln.exports=function(gn,mn,bn,vn,yn,wn,kn,_n){var xn,En,Tn,Bn,Nn,Mn,Ln,On,zn,Pn=_n.bits,An=0,Vn=0,Sn=0,Rn=0,Hn=0,Zn=0,Qn=0,Yn=0,tr=0,Un=0,Xn=null,or=0,kr=new un.Buf16(16),wr=new un.Buf16(16),Nr=null,$r=0;for(An=0;An<=15;An++)kr[An]=0;for(Vn=0;Vn<vn;Vn++)kr[mn[bn+Vn]]++;for(Hn=Pn,Rn=15;1<=Rn&&kr[Rn]===0;Rn--);if(Rn<Hn&&(Hn=Rn),Rn===0)return yn[wn++]=20971520,yn[wn++]=20971520,_n.bits=1,0;for(Sn=1;Sn<Rn&&kr[Sn]===0;Sn++);for(Hn<Sn&&(Hn=Sn),An=Yn=1;An<=15;An++)if(Yn<<=1,(Yn-=kr[An])<0)return-1;if(0<Yn&&(gn===0||Rn!==1))return-1;for(wr[1]=0,An=1;An<15;An++)wr[An+1]=wr[An]+kr[An];for(Vn=0;Vn<vn;Vn++)mn[bn+Vn]!==0&&(kn[wr[mn[bn+Vn]]++]=Vn);if(Mn=gn===0?(Xn=Nr=kn,19):gn===1?(Xn=dn,or-=257,Nr=hn,$r-=257,256):(Xn=fn,Nr=pn,-1),An=Sn,Nn=wn,Qn=Vn=Un=0,Tn=-1,Bn=(tr=1<<(Zn=Hn))-1,gn===1&&852<tr||gn===2&&592<tr)return 1;for(;;){for(Ln=An-Qn,zn=kn[Vn]<Mn?(On=0,kn[Vn]):kn[Vn]>Mn?(On=Nr[$r+kn[Vn]],Xn[or+kn[Vn]]):(On=96,0),xn=1<<An-Qn,Sn=En=1<<Zn;yn[Nn+(Un>>Qn)+(En-=xn)]=Ln<<24|On<<16|zn|0,En!==0;);for(xn=1<<An-1;Un&xn;)xn>>=1;if(xn!==0?(Un&=xn-1,Un+=xn):Un=0,Vn++,--kr[An]==0){if(An===Rn)break;An=mn[bn+kn[Vn]]}if(Hn<An&&(Un&Bn)!==Tn){for(Qn===0&&(Qn=Hn),Nn+=Sn,Yn=1<<(Zn=An-Qn);Zn+Qn<Rn&&!((Yn-=kr[Zn+Qn])<=0);)Zn++,Yn<<=1;if(tr+=1<<Zn,gn===1&&852<tr||gn===2&&592<tr)return 1;yn[Tn=Un&Bn]=Hn<<24|Zn<<16|Nn-wn|0}}return Un!==0&&(yn[Nn+Un]=An-Qn<<24|64<<16|0),_n.bits=Hn,0}},{"../utils/common":41}],51:[function(sn,ln,cn){ln.exports={2:"need dictionary",1:"stream end",0:"","-1":"file error","-2":"stream error","-3":"data error","-4":"insufficient memory","-5":"buffer error","-6":"incompatible version"}},{}],52:[function(sn,ln,cn){var un=sn("../utils/common"),dn=0,hn=1;function fn(In){for(var Wn=In.length;0<=--Wn;)In[Wn]=0}var pn=0,gn=29,mn=256,bn=mn+1+gn,vn=30,yn=19,wn=2*bn+1,kn=15,_n=16,xn=7,En=256,Tn=16,Bn=17,Nn=18,Mn=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0],Ln=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],On=[0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,2,3,7],zn=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15],Pn=new Array(2*(bn+2));fn(Pn);var An=new Array(2*vn);fn(An);var Vn=new Array(512);fn(Vn);var Sn=new Array(256);fn(Sn);var Rn=new Array(gn);fn(Rn);var Hn,Zn,Qn,Yn=new Array(vn);function tr(In,Wn,rr,nr,er){this.static_tree=In,this.extra_bits=Wn,this.extra_base=rr,this.elems=nr,this.max_length=er,this.has_stree=In&&In.length}function Un(In,Wn){this.dyn_tree=In,this.max_code=0,this.stat_desc=Wn}function Xn(In){return In<256?Vn[In]:Vn[256+(In>>>7)]}function or(In,Wn){In.pending_buf[In.pending++]=255&Wn,In.pending_buf[In.pending++]=Wn>>>8&255}function kr(In,Wn,rr){In.bi_valid>_n-rr?(In.bi_buf|=Wn<<In.bi_valid&65535,or(In,In.bi_buf),In.bi_buf=Wn>>_n-In.bi_valid,In.bi_valid+=rr-_n):(In.bi_buf|=Wn<<In.bi_valid&65535,In.bi_valid+=rr)}function wr(In,Wn,rr){kr(In,rr[2*Wn],rr[2*Wn+1])}function Nr(In,Wn){for(var rr=0;rr|=1&In,In>>>=1,rr<<=1,0<--Wn;);return rr>>>1}function $r(In,Wn,rr){var nr,er,ar=new Array(kn+1),mr=0;for(nr=1;nr<=kn;nr++)ar[nr]=mr=mr+rr[nr-1]<<1;for(er=0;er<=Wn;er++){var fr=In[2*er+1];fr!==0&&(In[2*er]=Nr(ar[fr]++,fr))}}function cr(In){var Wn;for(Wn=0;Wn<bn;Wn++)In.dyn_ltree[2*Wn]=0;for(Wn=0;Wn<vn;Wn++)In.dyn_dtree[2*Wn]=0;for(Wn=0;Wn<yn;Wn++)In.bl_tree[2*Wn]=0;In.dyn_ltree[2*En]=1,In.opt_len=In.static_len=0,In.last_lit=In.matches=0}function hr(In){8<In.bi_valid?or(In,In.bi_buf):0<In.bi_valid&&(In.pending_buf[In.pending++]=In.bi_buf),In.bi_buf=0,In.bi_valid=0}function gr(In,Wn,rr,nr){var er=2*Wn,ar=2*rr;return In[er]<In[ar]||In[er]===In[ar]&&nr[Wn]<=nr[rr]}function Jn(In,Wn,rr){for(var nr=In.heap[rr],er=rr<<1;er<=In.heap_len&&(er<In.heap_len&&gr(Wn,In.heap[er+1],In.heap[er],In.depth)&&er++,!gr(Wn,nr,In.heap[er],In.depth));)In.heap[rr]=In.heap[er],rr=er,er<<=1;In.heap[rr]=nr}function Fn(In,Wn,rr){var nr,er,ar,mr,fr=0;if(In.last_lit!==0)for(;nr=In.pending_buf[In.d_buf+2*fr]<<8|In.pending_buf[In.d_buf+2*fr+1],er=In.pending_buf[In.l_buf+fr],fr++,nr===0?wr(In,er,Wn):(wr(In,(ar=Sn[er])+mn+1,Wn),(mr=Mn[ar])!==0&&kr(In,er-=Rn[ar],mr),wr(In,ar=Xn(--nr),rr),(mr=Ln[ar])!==0&&kr(In,nr-=Yn[ar],mr)),fr<In.last_lit;);wr(In,En,Wn)}function Kn(In,Wn){var rr,nr,er,ar=Wn.dyn_tree,mr=Wn.stat_desc.static_tree,fr=Wn.stat_desc.has_stree,xr=Wn.stat_desc.elems,Br=-1;for(In.heap_len=0,In.heap_max=wn,rr=0;rr<xr;rr++)ar[2*rr]!==0?(In.heap[++In.heap_len]=Br=rr,In.depth[rr]=0):ar[2*rr+1]=0;for(;In.heap_len<2;)ar[2*(er=In.heap[++In.heap_len]=Br<2?++Br:0)]=1,In.depth[er]=0,In.opt_len--,fr&&(In.static_len-=mr[2*er+1]);for(Wn.max_code=Br,rr=In.heap_len>>1;1<=rr;rr--)Jn(In,ar,rr);for(er=xr;rr=In.heap[1],In.heap[1]=In.heap[In.heap_len--],Jn(In,ar,1),nr=In.heap[1],In.heap[--In.heap_max]=rr,In.heap[--In.heap_max]=nr,ar[2*er]=ar[2*rr]+ar[2*nr],In.depth[er]=(In.depth[rr]>=In.depth[nr]?In.depth[rr]:In.depth[nr])+1,ar[2*rr+1]=ar[2*nr+1]=er,In.heap[1]=er++,Jn(In,ar,1),2<=In.heap_len;);In.heap[--In.heap_max]=In.heap[1],(function(Er,Or){var Wr,Lr,Jr,Fr,Co,Ur,Hr=Or.dyn_tree,ro=Or.max_code,oo=Or.stat_desc.static_tree,Ci=Or.stat_desc.has_stree,ss=Or.stat_desc.extra_bits,Ks=Or.stat_desc.extra_base,Ho=Or.stat_desc.max_length,is=0;for(Fr=0;Fr<=kn;Fr++)Er.bl_count[Fr]=0;for(Hr[2*Er.heap[Er.heap_max]+1]=0,Wr=Er.heap_max+1;Wr<wn;Wr++)Ho<(Fr=Hr[2*Hr[2*(Lr=Er.heap[Wr])+1]+1]+1)&&(Fr=Ho,is++),Hr[2*Lr+1]=Fr,ro<Lr||(Er.bl_count[Fr]++,Co=0,Ks<=Lr&&(Co=ss[Lr-Ks]),Ur=Hr[2*Lr],Er.opt_len+=Ur*(Fr+Co),Ci&&(Er.static_len+=Ur*(oo[2*Lr+1]+Co)));if(is!==0){do{for(Fr=Ho-1;Er.bl_count[Fr]===0;)Fr--;Er.bl_count[Fr]--,Er.bl_count[Fr+1]+=2,Er.bl_count[Ho]--,is-=2}while(0<is);for(Fr=Ho;Fr!==0;Fr--)for(Lr=Er.bl_count[Fr];Lr!==0;)ro<(Jr=Er.heap[--Wr])||(Hr[2*Jr+1]!==Fr&&(Er.opt_len+=(Fr-Hr[2*Jr+1])*Hr[2*Jr],Hr[2*Jr+1]=Fr),Lr--)}})(In,Wn),$r(ar,Br,In.bl_count)}function Cn(In,Wn,rr){var nr,er,ar=-1,mr=Wn[1],fr=0,xr=7,Br=4;for(mr===0&&(xr=138,Br=3),Wn[2*(rr+1)+1]=65535,nr=0;nr<=rr;nr++)er=mr,mr=Wn[2*(nr+1)+1],++fr<xr&&er===mr||(fr<Br?In.bl_tree[2*er]+=fr:er!==0?(er!==ar&&In.bl_tree[2*er]++,In.bl_tree[2*Tn]++):fr<=10?In.bl_tree[2*Bn]++:In.bl_tree[2*Nn]++,ar=er,Br=(fr=0)===mr?(xr=138,3):er===mr?(xr=6,3):(xr=7,4))}function qn(In,Wn,rr){var nr,er,ar=-1,mr=Wn[1],fr=0,xr=7,Br=4;for(mr===0&&(xr=138,Br=3),nr=0;nr<=rr;nr++)if(er=mr,mr=Wn[2*(nr+1)+1],!(++fr<xr&&er===mr)){if(fr<Br)for(;wr(In,er,In.bl_tree),--fr!=0;);else er!==0?(er!==ar&&(wr(In,er,In.bl_tree),fr--),wr(In,Tn,In.bl_tree),kr(In,fr-3,2)):fr<=10?(wr(In,Bn,In.bl_tree),kr(In,fr-3,3)):(wr(In,Nn,In.bl_tree),kr(In,fr-11,7));ar=er,Br=(fr=0)===mr?(xr=138,3):er===mr?(xr=6,3):(xr=7,4)}}fn(Yn);var Gn=!1;function Dn(In,Wn,rr,nr){kr(In,(pn<<1)+(nr?1:0),3),(function(er,ar,mr,fr){hr(er),or(er,mr),or(er,~mr),un.arraySet(er.pending_buf,er.window,ar,mr,er.pending),er.pending+=mr})(In,Wn,rr)}cn._tr_init=function(In){Gn||((function(){var Wn,rr,nr,er,ar,mr=new Array(kn+1);for(er=nr=0;er<gn-1;er++)for(Rn[er]=nr,Wn=0;Wn<1<<Mn[er];Wn++)Sn[nr++]=er;for(Sn[nr-1]=er,er=ar=0;er<16;er++)for(Yn[er]=ar,Wn=0;Wn<1<<Ln[er];Wn++)Vn[ar++]=er;for(ar>>=7;er<vn;er++)for(Yn[er]=ar<<7,Wn=0;Wn<1<<Ln[er]-7;Wn++)Vn[256+ar++]=er;for(rr=0;rr<=kn;rr++)mr[rr]=0;for(Wn=0;Wn<=143;)Pn[2*Wn+1]=8,Wn++,mr[8]++;for(;Wn<=255;)Pn[2*Wn+1]=9,Wn++,mr[9]++;for(;Wn<=279;)Pn[2*Wn+1]=7,Wn++,mr[7]++;for(;Wn<=287;)Pn[2*Wn+1]=8,Wn++,mr[8]++;for($r(Pn,bn+1,mr),Wn=0;Wn<vn;Wn++)An[2*Wn+1]=5,An[2*Wn]=Nr(Wn,5);Hn=new tr(Pn,Mn,mn+1,bn,kn),Zn=new tr(An,Ln,0,vn,kn),Qn=new tr(new Array(0),On,0,yn,xn)})(),Gn=!0),In.l_desc=new Un(In.dyn_ltree,Hn),In.d_desc=new Un(In.dyn_dtree,Zn),In.bl_desc=new Un(In.bl_tree,Qn),In.bi_buf=0,In.bi_valid=0,cr(In)},cn._tr_stored_block=Dn,cn._tr_flush_block=function(In,Wn,rr,nr){var er,ar,mr=0;0<In.level?(In.strm.data_type===2&&(In.strm.data_type=(function(fr){var xr,Br=4093624447;for(xr=0;xr<=31;xr++,Br>>>=1)if(1&Br&&fr.dyn_ltree[2*xr]!==0)return dn;if(fr.dyn_ltree[18]!==0||fr.dyn_ltree[20]!==0||fr.dyn_ltree[26]!==0)return hn;for(xr=32;xr<mn;xr++)if(fr.dyn_ltree[2*xr]!==0)return hn;return dn})(In)),Kn(In,In.l_desc),Kn(In,In.d_desc),mr=(function(fr){var xr;for(Cn(fr,fr.dyn_ltree,fr.l_desc.max_code),Cn(fr,fr.dyn_dtree,fr.d_desc.max_code),Kn(fr,fr.bl_desc),xr=yn-1;3<=xr&&fr.bl_tree[2*zn[xr]+1]===0;xr--);return fr.opt_len+=3*(xr+1)+5+5+4,xr})(In),er=In.opt_len+3+7>>>3,(ar=In.static_len+3+7>>>3)<=er&&(er=ar)):er=ar=rr+5,rr+4<=er&&Wn!==-1?Dn(In,Wn,rr,nr):In.strategy===4||ar===er?(kr(In,2+(nr?1:0),3),Fn(In,Pn,An)):(kr(In,4+(nr?1:0),3),(function(fr,xr,Br,Er){var Or;for(kr(fr,xr-257,5),kr(fr,Br-1,5),kr(fr,Er-4,4),Or=0;Or<Er;Or++)kr(fr,fr.bl_tree[2*zn[Or]+1],3);qn(fr,fr.dyn_ltree,xr-1),qn(fr,fr.dyn_dtree,Br-1)})(In,In.l_desc.max_code+1,In.d_desc.max_code+1,mr+1),Fn(In,In.dyn_ltree,In.dyn_dtree)),cr(In),nr&&hr(In)},cn._tr_tally=function(In,Wn,rr){return In.pending_buf[In.d_buf+2*In.last_lit]=Wn>>>8&255,In.pending_buf[In.d_buf+2*In.last_lit+1]=255&Wn,In.pending_buf[In.l_buf+In.last_lit]=255&rr,In.last_lit++,Wn===0?In.dyn_ltree[2*rr]++:(In.matches++,Wn--,In.dyn_ltree[2*(Sn[rr]+mn+1)]++,In.dyn_dtree[2*Xn(Wn)]++),In.last_lit===In.lit_bufsize-1},cn._tr_align=function(In){kr(In,2,3),wr(In,En,Pn),(function(Wn){Wn.bi_valid===16?(or(Wn,Wn.bi_buf),Wn.bi_buf=0,Wn.bi_valid=0):8<=Wn.bi_valid&&(Wn.pending_buf[Wn.pending++]=255&Wn.bi_buf,Wn.bi_buf>>=8,Wn.bi_valid-=8)})(In)}},{"../utils/common":41}],53:[function(sn,ln,cn){ln.exports=function(){this.input=null,this.next_in=0,this.avail_in=0,this.total_in=0,this.output=null,this.next_out=0,this.avail_out=0,this.total_out=0,this.msg="",this.state=null,this.data_type=2,this.adler=0}},{}],54:[function(sn,ln,cn){(function(un){(function(dn,hn){if(!dn.setImmediate){var fn,pn,gn,mn,bn=1,vn={},yn=!1,wn=dn.document,kn=Object.getPrototypeOf&&Object.getPrototypeOf(dn);kn=kn&&kn.setTimeout?kn:dn,fn={}.toString.call(dn.process)==="[object process]"?function(Tn){process.nextTick(function(){xn(Tn)})}:(function(){if(dn.postMessage&&!dn.importScripts){var Tn=!0,Bn=dn.onmessage;return dn.onmessage=function(){Tn=!1},dn.postMessage("","*"),dn.onmessage=Bn,Tn}})()?(mn="setImmediate$"+Math.random()+"$",dn.addEventListener?dn.addEventListener("message",En,!1):dn.attachEvent("onmessage",En),function(Tn){dn.postMessage(mn+Tn,"*")}):dn.MessageChannel?((gn=new MessageChannel).port1.onmessage=function(Tn){xn(Tn.data)},function(Tn){gn.port2.postMessage(Tn)}):wn&&"onreadystatechange"in wn.createElement("script")?(pn=wn.documentElement,function(Tn){var Bn=wn.createElement("script");Bn.onreadystatechange=function(){xn(Tn),Bn.onreadystatechange=null,pn.removeChild(Bn),Bn=null},pn.appendChild(Bn)}):function(Tn){setTimeout(xn,0,Tn)},kn.setImmediate=function(Tn){typeof Tn!="function"&&(Tn=new Function(""+Tn));for(var Bn=new Array(arguments.length-1),Nn=0;Nn<Bn.length;Nn++)Bn[Nn]=arguments[Nn+1];var Mn={callback:Tn,args:Bn};return vn[bn]=Mn,fn(bn),bn++},kn.clearImmediate=_n}function _n(Tn){delete vn[Tn]}function xn(Tn){if(yn)setTimeout(xn,0,Tn);else{var Bn=vn[Tn];if(Bn){yn=!0;try{(function(Nn){var Mn=Nn.callback,Ln=Nn.args;switch(Ln.length){case 0:Mn();break;case 1:Mn(Ln[0]);break;case 2:Mn(Ln[0],Ln[1]);break;case 3:Mn(Ln[0],Ln[1],Ln[2]);break;default:Mn.apply(hn,Ln)}})(Bn)}finally{_n(Tn),yn=!1}}}}function En(Tn){Tn.source===dn&&typeof Tn.data=="string"&&Tn.data.indexOf(mn)===0&&xn(+Tn.data.slice(mn.length))}})(typeof self>"u"?un===void 0?this:un:self)}).call(this,typeof commonjsGlobal<"u"?commonjsGlobal:typeof self<"u"?self:typeof window<"u"?window:{})},{}]},{},[10])(10)})})(jszip_min$1)),jszip_min$1.exports}var jszip_minExports=requireJszip_min();const JSZip=getDefaultExportFromCjs(jszip_minExports),jszip_min=_mergeNamespaces({__proto__:null,default:JSZip},[jszip_minExports]);class RuleDetector{static detect(on,sn){if(!on)return 0;const ln=on.trim();return ln[0]==="/"||ln.startsWith("@XPath:")?2:ln[0]==="$"||ln.startsWith("@Json:")||ln.startsWith("@JSon:")?1:ln.includes("<js>")?3:sn?1:0}static clean(on){const sn=on.trim();for(const[ln,cn]of[["@XPath:",7],["@Json:",6],["@JSon:",6],["@CSS:",5],["@@",2]])if(sn.startsWith(ln))return sn.substring(cn);return sn}}class RuleAnalyzer{constructor(on){this.queue=on}splitRule(...on){if(!this.queue)return{rules:[],type:""};for(const sn of on){const ln=this.split(sn);if(ln.length>1)return{rules:ln.filter(Boolean),type:sn}}return{rules:[this.queue],type:""}}split(on){const sn=[],ln=this.queue.length,cn=on.length;let un=0,dn=null,hn="",fn=0;for(;fn<ln;){const pn=this.queue[fn];if((pn==='"'||pn==="'")&&(dn=dn===pn?null:dn||pn),!dn&&"([{".includes(pn)?un++:!dn&&")]}".includes(pn)&&un--,!dn&&un===0&&this.queue.substring(fn,fn+cn)===on){sn.push(hn.trim()),hn="",fn+=cn;continue}hn+=pn,fn++}return hn&&sn.push(hn.trim()),sn}innerRule(on,sn,ln){const cn=[],un=this.queue.length,dn=on.length;let hn=0,fn=0;for(;fn<un;){const pn=this.queue.indexOf(on,fn);if(pn===-1)break;let gn=pn+dn,mn=1;for(;mn>0&&gn<un;){const bn=this.queue.indexOf(on,gn),vn=this.queue.indexOf(sn,gn);if(vn===-1)break;bn!==-1&&bn<vn?(mn++,gn=bn+dn):(mn--,gn=vn+(mn===0?0:sn.length))}if(mn===0){const bn=ln(this.queue.substring(pn+dn,gn));if(bn!=null){cn.push(this.queue.substring(hn,pn),bn),hn=gn+sn.length,fn=hn;continue}}fn=pn+1}return hn===0?"":cn.concat(this.queue.substring(hn)).join("")}}class JsonPathParser{constructor(on){ir(this,"data");var sn;try{if(this.data=typeof on=="object"&&on!==null?on:typeof on=="string"?JSON.parse(on):on,(sn=this.data)!=null&&sn.body&&typeof this.data.body=="string")try{const ln=JSON.parse(this.data.body);ln&&typeof ln=="object"&&(this.data={...this.data,...ln})}catch{}}catch{this.data={}}}getString(on){if(!on)return"";const{rules:sn,type:ln}=new RuleAnalyzer(on).splitRule("&&","||");if(sn.length===1)return new RuleAnalyzer(on).innerRule("{$.","}",dn=>this.getString(dn))||this.getSingleValue(sn[0]);const cn=[];for(const un of sn){const dn=this.getSingleValue(un);if(dn&&(cn.push(dn),ln==="||"))break}return cn.join(`
`)}getList(on){if(!on)return[];const{rules:sn,type:ln}=new RuleAnalyzer(on).splitRule("&&","||","%%");if(sn.length===1){const un=new RuleAnalyzer(on).innerRule("{$.","}",dn=>this.getString(dn));if(un)return[un];try{const dn=this.getValueByPath(sn[0]);return Array.isArray(dn)?dn:dn!=null?[dn]:[]}catch{return[]}}const cn=[];for(const un of sn)try{const dn=this.getValueByPath(un),hn=Array.isArray(dn)?dn:dn!=null?[dn]:[];if(hn.length&&(cn.push(hn),ln==="||"))break}catch{}if(!cn.length)return[];if(ln==="%%"){const un=[],dn=Math.max(...cn.map(hn=>hn.length));for(let hn=0;hn<dn;hn++)for(const fn of cn)hn<fn.length&&un.push(fn[hn]);return un}return cn.flat()}getSingleValue(on){try{const sn=this.getValueByPath(on);return sn==null?"":Array.isArray(sn)?sn.join(`
`):String(sn)}catch{return""}}getValueByPath(on){if(!on||!this.data)return null;if(on==="$"||on==="$[*]")return Array.isArray(this.data)?this.data:[this.data];if(on=on.replace(/^\$\./,"").replace(/^\$\[/,"["),!on)return this.data;if(on[0]===".")return this.recursiveSearch(this.data,on.substring(1));if(on[0]==="["){if(on==="[*]")return Array.isArray(this.data)?this.data:[this.data];const ln=on.match(/^\[(\d+)\](.*)/);if(ln){const cn=Array.isArray(this.data)?this.data[parseInt(ln[1])]:null;return ln[2]?new JsonPathParser(cn).getValueByPath(ln[2]):cn}}let sn=this.data;for(const ln of on.split(".")){if(sn==null)return null;const cn=ln.match(/^(\w+)\[(\d+|\*)\]$/);cn?(sn=sn[cn[1]],cn[2]!=="*"&&(sn=sn==null?void 0:sn[parseInt(cn[2])])):sn=sn[ln]}return sn}recursiveSearch(on,sn){if(!on||typeof on!="object")return null;if(sn in on)return on[sn];for(const ln in on)if(typeof on[ln]=="object"){const cn=this.recursiveSearch(on[ln],sn);if(cn!==null)return cn}return null}}class CssParser{constructor(on){ir(this,"doc");this.doc=typeof on=="string"?new DOMParser().parseFromString(on,"text/html"):on}getElements(on){if(!on)return[];const sn=on.toLowerCase().startsWith("@css:"),ln=sn?on.substring(5).trim():on,{rules:cn,type:un}=new RuleAnalyzer(ln).splitRule("&&","||","%%");if(cn.length===1)return sn?this.selectCss(cn[0]):this.selectChain(cn[0]);const dn=[];for(const hn of cn){const fn=sn?this.selectCss(hn):this.selectChain(hn);if(fn.length&&(dn.push(fn),un==="||"))break}if(un==="%%"){const hn=[],fn=Math.max(...dn.map(pn=>pn.length));for(let pn=0;pn<fn;pn++)for(const gn of dn)pn<gn.length&&hn.push(gn[pn]);return hn}return dn.flat()}selectCss(on){try{return Array.from(this.doc.querySelectorAll(on))}catch{return[]}}selectChain(on){var hn;if(!on)return[];const sn=on.split("@").map(fn=>fn.trim()).filter(Boolean);if(!sn.length)return[];const ln=sn[sn.length-1],cn=/^(text|textNodes|ownText|html|all|href|src|title|alt|class|id|name|value|data-\w+)$/.test(ln),un=cn?sn.slice(0,-1):sn;if(!un.length)return this.doc instanceof Element?[this.doc]:[];let dn=[this.doc];for(let fn=0;fn<un.length;fn++){const pn=un[fn];if(pn){if(pn.includes(" ")&&pn.includes("!")){dn=pn.split(/\s+/).reduce((gn,mn)=>{const bn=mn.includes("!")?mn.match(/^([^!]+)(!.+)$/):null;return bn?gn.flatMap(vn=>this.applyFilter(Array.from(vn.querySelectorAll(bn[1])),"["+bn[2].substring(1)+"]")):gn.flatMap(vn=>Array.from(vn.querySelectorAll(mn)))},dn);continue}if(dn=dn.flatMap(gn=>fn>0&&this.matches(gn,pn)?[gn]:this.select(pn,gn)),!dn.length)break}}if(!cn&&dn.length===1){const fn=dn[0],pn=fn.tagName.toLowerCase(),gn={ul:"li",ol:"li",tbody:"tr",table:"tr"}[pn];if(gn){const bn=Array.from(pn==="table"?((hn=fn.querySelector("tbody"))==null?void 0:hn.children)||[]:fn.children).filter(vn=>vn.tagName.toLowerCase()===gn);if(bn.length)return bn}}return dn}matches(on,sn){try{if(sn.startsWith("class."))return sn.substring(6).trim().split(/\s+/).every(ln=>on.classList.contains(ln));if(sn.startsWith("id."))return on.id===sn.substring(3);if(sn.startsWith("tag.")){const ln=sn.match(/^tag\.([^.]+)/);return ln?on.tagName.toLowerCase()===ln[1].toLowerCase():!1}return on.matches(sn)}catch{return!1}}getString(on){var mn;const sn=on.indexOf("@js:");if(sn!==-1){let bn=sn>0?this.getString(on.substring(0,sn)):"";const vn=on.substring(sn+4).replace(/\n/g," ").trim();if(vn)try{const yn=vn.split(";").map(xn=>xn.trim()).filter(Boolean),kn=(vn.includes(";")||/\b(var|let|const)\b/.test(vn))&&yn.length>1?`${yn.slice(0,-1).join(";")}; return (${yn[yn.length-1]});`:`return (${yn[0]||vn});`,_n=new Function("result",kn)(bn);_n!=null&&(bn=String(_n))}catch(yn){console.error("[JS]",yn)}return bn}const ln=/^(text|href|src|html|all|textNodes|ownText|data-\w+)$/.test(on),cn=ln?[this.doc instanceof Element?this.doc:((mn=this.doc.body)==null?void 0:mn.firstElementChild)||this.doc.documentElement]:this.getElements(on);if(!cn.length)return"";const un=(bn,vn)=>{var yn;if(vn==="text")return((yn=bn.textContent)==null?void 0:yn.trim())||"";if(vn==="html"){const wn=bn.cloneNode(!0);return wn.querySelectorAll("script, style").forEach(kn=>kn.remove()),wn.innerHTML}return vn==="all"?bn.outerHTML:vn==="textNodes"?Array.from(bn.childNodes).filter(wn=>wn.nodeType===3).map(wn=>{var kn;return(kn=wn.textContent)==null?void 0:kn.trim()}).filter(Boolean).join(`
`):vn==="ownText"?Array.from(bn.childNodes).filter(wn=>wn.nodeType===3).map(wn=>{var kn;return(kn=wn.textContent)==null?void 0:kn.trim()}).filter(Boolean).join(""):vn==="src"&&bn.tagName==="IMG"?bn.getAttribute("data-src")||bn.getAttribute("data-original")||bn.getAttribute("data-lazy-src")||bn.getAttribute("src")||"":bn.getAttribute(vn)||""},dn=on.includes("@href")||on==="href",hn=on.includes("@src")||on==="src",fn=on.includes("@text")||on==="text",gn=cn.map(bn=>{var vn,yn;return ln?un(bn,on):(vn=on.match(/@([\w-]+)(?!.*@)/))!=null&&vn[1]?un(bn,on.match(/@([\w-]+)(?!.*@)/)[1]):((yn=bn.textContent)==null?void 0:yn.trim())||""}).filter(bn=>bn&&!(dn&&(bn.startsWith("javascript:")||bn==="#"))&&!(fn&&/^(|||||)$/i.test(bn.trim())));return dn||hn||fn?gn[0]||"":gn.join(`
`)}select(on,sn=this.doc){try{if(!on)return[];const ln=/^[a-z]+\.\d+$/i.test(on)?on.match(/^([a-z]+)\.(\d+)$/i):null;if(ln){const un=Array.from(sn.getElementsByTagName(ln[1])),dn=parseInt(ln[2]);return dn>=0&&dn<un.length?[un[dn]]:[]}if(on.startsWith("tag.")){const un=on.substring(4).match(/^([^:\[.]+)(?:\.(\d+)|(\[.+\]))?(.*)/);if(un){const dn=Array.from(sn.getElementsByTagName(un[1]));if(un[2]!==void 0){const hn=parseInt(un[2]);return hn>=0&&hn<dn.length?[dn[hn]]:[]}return un[3]?this.applyFilter(dn,un[3]+un[4]):un[4]?this.applyFilter(dn,un[4]):dn}}if(on.startsWith("class.")){const un=on.substring(6),dn=un.match(/^(.+?)\.(\d+)$/),hn=dn?null:un.match(/^(.+?)(\[.+\])$/),pn=(dn?dn[1]:hn?hn[1]:un).trim().split(/\s+/).map(mn=>`.${mn}`).join(""),gn=Array.from(sn.querySelectorAll(pn));if(dn){const mn=parseInt(dn[2]);return mn>=0&&mn<gn.length?[gn[mn]]:[]}return hn?this.applyFilter(gn,hn[2]):gn}if(on.startsWith("id.")){const un=on.substring(3),dn=un.match(/^([^.:\[]+)\.(\d+)$/),hn=dn?null:un.match(/^([^.:\[]+)(\[.+\])$/),fn=dn?dn[1]:hn?hn[1]:un.split(/[.:\[]/)[0],pn=sn.querySelector(`#${fn}`);return pn?dn?parseInt(dn[2])===0?[pn]:[]:hn?this.applyFilter([pn],hn[2]):[pn]:[]}const cn=on.match(/^(.+):eq\((\d+)\)$/);if(cn){const un=Array.from(sn.querySelectorAll(cn[1])),dn=parseInt(cn[2]);return dn<un.length?[un[dn]]:[]}if(on.endsWith(":first")){const un=Array.from(sn.querySelectorAll(on.slice(0,-6)));return un[0]?[un[0]]:[]}if(on.endsWith(":last")){const un=Array.from(sn.querySelectorAll(on.slice(0,-5)));return un.length?[un[un.length-1]]:[]}return Array.from(sn.querySelectorAll(on))}catch{return[]}}applyFilter(on,sn){return sn?sn[0]==="["&&sn[sn.length-1]==="]"?this.filterArray(on,sn.slice(1,-1)):sn[0]==="."||sn[0]==="!"||sn[0]===":"?this.filterColon(on,sn):on:on}filterArray(on,sn){const ln=sn[0]==="!",cn=new Set;for(const un of sn.replace(/^!/,"").split(",").map(dn=>dn.trim()))if(un.includes(":")){const dn=un.split(":");let hn=dn[0]?parseInt(dn[0]):0,fn=dn[1]?parseInt(dn[1]):on.length-1,pn=dn[2]?parseInt(dn[2]):1;if(hn<0&&(hn=on.length+hn),fn<0&&(fn=on.length+fn),fn>=hn)for(let gn=hn;gn<=fn;gn+=pn)gn>=0&&gn<on.length&&cn.add(gn);else for(let gn=hn;gn>=fn;gn-=pn)gn>=0&&gn<on.length&&cn.add(gn)}else{let dn=parseInt(un);dn<0&&(dn=on.length+dn),dn>=0&&dn<on.length&&cn.add(dn)}return ln?on.filter((un,dn)=>!cn.has(dn)):Array.from(cn).sort((un,dn)=>un-dn).map(un=>on[un])}filterColon(on,sn){const ln=sn[0]==="!",cn=new Set(sn.replace(/^[.!]/,"").split(":").map(un=>parseInt(un.trim())).filter(un=>!isNaN(un)).map(un=>un<0?on.length+un:un).filter(un=>un>=0&&un<on.length));return ln?on.filter((un,dn)=>!cn.has(dn)):Array.from(cn).map(un=>on[un])}}class RuleParser{constructor(){ir(this,"ruleData",new Map)}getString(on,sn,ln=!1){var gn;if(!sn)return"";if(sn.includes("<js>")){const[mn,bn]=[sn.split("<js>")[0].trim(),((gn=sn.split("<js>")[1])==null?void 0:gn.split("</js>")[0])||""];let vn=mn?this.getString(on,mn,ln):"";if(bn)try{const yn=new Map,wn={put:(_n,xn)=>yn.set(_n,xn),get:_n=>yn.get(_n)||"",getString:_n=>yn.get(_n)||""},kn=bn.trim().split(`
`).map(_n=>_n.trim()).filter(Boolean);if(kn.length){const _n=kn[kn.length-1],En=(_n.includes('"')||_n.includes("'")||_n.includes("`"))&&!/^\s*\w+\s*=/.test(_n)&&!_n.startsWith("java.")&&!_n.startsWith("return")?kn.length>1?`${kn.slice(0,-1).join(`
`)}
return ${_n.replace(/;$/,"")};`:`return ${_n.replace(/;$/,"")};`:bn,Tn=new Function("result","java",En)(vn,wn);Tn!=null&&(vn=String(Tn))}}catch(yn){console.error("[JS]",yn)}return vn}if(sn.includes("{{")&&sn.includes("}}")&&(sn=this.replaceTemplate(sn,on),!sn.includes("$.")&&!sn.includes("@")&&!sn.includes("<js>")&&!sn.includes("##")))return sn;const cn=RuleDetector.detect(sn,ln);let un=RuleDetector.clean(sn);un=this.processPutRule(un),un=this.processGetRule(un);const[dn,hn,fn=""]=un.split("##");let pn="";try{cn===1?pn=new JsonPathParser(on).getString(dn):cn!==2&&cn!==3&&(pn=new CssParser(on).getString(dn))}catch(mn){console.error("[]",mn)}if(hn&&pn)try{pn=pn.replace(new RegExp(hn,un.split("##").length>3?"":"g"),fn)}catch{}return pn}getElements(on,sn){if(!sn)return[];const ln=typeof on=="string"&&(on.trim()[0]==="{"||on.trim()[0]==="[");if(sn.includes("<js>")){const dn=sn.substring(0,sn.indexOf("<js>")).trim();if(dn)return new CssParser(on).getElements(dn)}const cn=RuleDetector.detect(sn,ln);let un=RuleDetector.clean(sn);un=this.processPutRule(un),un=this.processGetRule(un);try{return cn===1?new JsonPathParser(on).getList(un).map((dn,hn)=>{const fn=document.createElement("div");return fn.setAttribute("data-json",JSON.stringify(dn)),fn.setAttribute("data-index",String(hn)),fn}):new CssParser(on).getElements(un)}catch(dn){return console.error("[]",dn),[]}}replaceTemplate(on,sn){let ln=on;for(const cn of on.matchAll(/\{\{(\$[^}]+)\}\}/g))try{const un=new JsonPathParser(sn).getString(cn[1]);ln=ln.replace(cn[0],un||"")}catch{ln=ln.replace(cn[0],"")}return ln}processPutRule(on){let sn=on;for(const ln of on.matchAll(/@put:\{([^}]+)\}/gi))try{for(const[cn,un]of Object.entries(JSON.parse(`{${ln[1]}}`)))this.ruleData.set(cn,String(un));sn=sn.replace(ln[0],"")}catch{}return sn}processGetRule(on){return on.replace(/@get:\{([^}]+)\}|\{\{([^}]+)\}\}/g,(sn,ln,cn)=>this.ruleData.get(ln||cn)||sn)}clearRuleData(){this.ruleData.clear()}setRuleData(on,sn){this.ruleData.set(on,sn)}getRuleData(on){return this.ruleData.get(on)}static cleanContent(on){return on?on.replace(/<script[^>]*>[\s\S]*?<\/script>/gi,"").replace(/<style[^>]*>[\s\S]*?<\/style>/gi,"").replace(/<!--[\s\S]*?-->/g,"").replace(/&nbsp;/g," ").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&amp;/g,"&").replace(/&quot;/g,'"').replace(/&#(\d+);/g,(sn,ln)=>String.fromCharCode(parseInt(ln))).replace(/&#x([0-9a-f]+);/gi,(sn,ln)=>String.fromCharCode(parseInt(ln,16))).replace(/\r\n/g,`
`).replace(/\r/g,`
`).replace(/[ \t]+/g," ").trim():""}static toParagraphs(on){return on?on.split(/\n+/).map(sn=>sn.trim()).filter(Boolean):[]}static isImage(on){return!!on&&(/^<img\s/i.test(on)||/\.(jpg|jpeg|png|gif|webp|svg|bmp|ico)(\?.*)?$/i.test(on)||/^data:image\//i.test(on))}static extractImageUrl(on){if(!on)return"";const sn=on.match(/<img[^>]+src=["']([^"']+)["']/i);if(sn)return sn[1];const ln=on.match(/data-src=["']([^"']+)["']/i);return ln?ln[1]:/^(https?:\/\/|data:image\/)/.test(on)?on:""}static processContent(on){return this.toParagraphs(this.cleanContent(on))}}const ruleParser=new RuleParser;class RuleEngine{constructor(){ir(this,"jsonData",null)}replaceVariables(on,sn){if(!on)return"";let ln=on.replace(/\{\{cookie\.[^}]+\}\}/g,"");return ln=ln.replace(/\{\{([^}]+)\}\}/g,(cn,un)=>{try{if(/^\w+$/.test(un))return String(sn[un]||"");let dn=un;for(const[hn,fn]of Object.entries(sn)){const pn=Number(fn);!isNaN(pn)&&(dn=dn.replace(new RegExp(`\\b${hn}\\b`,"g"),String(pn)))}return String(Function(`'use strict'; return (${dn})`)())}catch{return cn}}),this.jsonData&&(ln=ln.replace(/\{\$\.([^}]+)\}/g,(cn,un)=>{try{return String(this.getJsonValue(this.jsonData,un)||"")}catch{return cn}})),ln}getJsonValue(on,sn){return sn.split(".").reduce((ln,cn)=>(ln||{})[cn],on)}parseHeader(on){if(!on)return{};if(on.startsWith("@js:"))try{const sn=new Function(`try{${on.substring(4).trim()}}catch{return{}}`)();return typeof sn=="string"?JSON.parse(sn):sn}catch{return{}}try{return JSON.parse(on)}catch{return{}}}}const ruleEngine=new RuleEngine;class BookSourceManager{constructor(){ir(this,"snippets",[])}async request(an,on={},sn="GET",ln="",cn=3e4){var un;try{const dn={url:an,method:sn,contentType:"text/html",headers:Object.entries(on).map(([fn,pn])=>({name:fn,value:pn})),timeout:cn};sn==="POST"&&ln&&(dn.body=ln);const hn=await siyuan.fetchSyncPost("/api/network/forwardProxy",dn);return(hn==null?void 0:hn.code)!==0?(console.error("[]",{url:an,code:hn==null?void 0:hn.code,msg:hn==null?void 0:hn.msg}),""):((un=hn.data)==null?void 0:un.body)||""}catch(dn){return console.error("[]",{url:an,error:dn.message}),""}}async loadSources(){var an;const res=await siyuan.fetchSyncPost("/api/snippet/getSnippet",{type:"all",enabled:2});if(res.code===0&&((an=res.data)!=null&&an.snippets)){this.snippets=res.data.snippets;const snippet=this.snippets.find(on=>{var sn;return on.type==="js"&&on.enabled&&((sn=on.content)==null?void 0:sn.includes("siyuanBookSources"))});if(snippet){const t={};eval(snippet.content.replace(/window\./g,"t.")),window.siyuanBookSources=t.siyuanBookSources||{sources:[]};return}}window.siyuanBookSources={sources:[]}}getSources(){var an;return((an=window.siyuanBookSources)==null?void 0:an.sources)||[]}getEnabledSources(){return this.getSources().filter(an=>an.enabled)}exportSources(){return JSON.stringify(this.getSources(),null,2)}getSource(an){return this.getSources().find(on=>on.bookSourceUrl===an)}addSource(an){const on=this.getSources(),sn=on.findIndex(ln=>ln.bookSourceUrl===an.bookSourceUrl);sn>=0?on[sn]=an:on.push(an),this.save()}removeSource(an){window.siyuanBookSources.sources=this.getSources().filter(on=>on.bookSourceUrl!==an),this.save()}importSources(an){try{const on=JSON.parse(an),sn=Array.isArray(on)?on:on.sources||[],ln=this.getSources(),cn=sn.filter(un=>un.bookSourceUrl&&!ln.some(dn=>dn.bookSourceUrl===un.bookSourceUrl));return cn.length&&(ln.push(...cn),this.save()),cn.length}catch{return 0}}save(){const an=this.getSources(),on=this.snippets.find(cn=>{var un;return cn.type==="js"&&cn.enabled&&((un=cn.content)==null?void 0:un.includes("siyuanBookSources"))}),ln=`${`//  - 
// ==SiReaderBookSources==
// @name         SiReader 
// @version      2.0.0
// @description  
// @updateTime   ${new Date().toISOString().split("T")[0]}
// @count        ${an.length}
// ==/SiReaderBookSources==

`}window.siyuanBookSources = {
  sources: ${JSON.stringify(an,null,2)},
  loaded: true,
  version: '2.0.0'
};`;on?on.content=ln:this.snippets.push({id:Date.now().toString(),name:"SiReader ",type:"js",enabled:!0,content:ln}),siyuan.fetchPost("/api/snippet/setSnippet",{snippets:this.snippets},()=>{})}async*searchBooksStream(an,on,sn=1,ln=!1){const cn=on?[this.getSource(on)].filter(Boolean):this.getEnabledSources();if(ln&&!on)try{const{annaArchive:un}=await Promise.resolve().then(()=>anna),dn=await un.search(an,sn);if(dn.length>0){const hn=un.getCurrentSource().name;yield dn.map(pn=>({name:pn.name,author:pn.author,bookUrl:pn.bookUrl,coverUrl:pn.coverUrl,intro:pn.intro,extension:pn.extension,fileSize:pn.fileSize,language:pn.language,year:pn.year,kind:[pn.extension,pn.language,pn.year].filter(Boolean).join("  "),sourceName:hn,sourceUrl:"ebook://search"}))}}catch(un){console.error("[EBook Search] :",un)}for(let un=0;un<cn.length;un+=10){const dn=await Promise.allSettled(cn.slice(un,un+10).map(hn=>this.searchInSource(hn,an,sn)));for(const hn of dn)hn.status==="fulfilled"&&hn.value.length&&(yield hn.value)}}async searchBooks(an,on,sn=1,ln=!1){const cn=[];for await(const un of this.searchBooksStream(an,on,sn,ln))cn.push(...un);return cn}parseField(an,on,sn=!1){return on?ruleParser.getString(an,on,sn):""}cleanField(an,on="text"){var sn;return an&&(on==="url"&&an[0]==="/"&&an[1]==="/"?"https:"+an:on==="intro"&&an.length>500?an.substring(0,500)+"...":on==="text"&&((sn=an.replace(/\s*([^/\n]+).*/,"$1").split(`
`).filter(ln=>ln.trim())[0])==null?void 0:sn.trim())||an)}async searchInSource(an,on,sn=1){try{if(an.searchUrl.includes("<js>"))return[];let ln=an.searchUrl,cn="GET",un="";if(ln.includes(",{")){const[mn,bn]=ln.split(",{");ln=mn;try{const vn=JSON.parse("{"+bn);cn=vn.method||"GET",un=vn.body||""}catch{}}if(ln=this.resolveUrl(ruleEngine.replaceVariables(ln,{key:encodeURIComponent(on),page:sn}),an.bookSourceUrl),un=ruleEngine.replaceVariables(un,{key:encodeURIComponent(on),page:sn}),!ln.startsWith("http"))return[];const dn=ruleEngine.parseHeader(an.header||"");dn["User-Agent"]||(dn["User-Agent"]="Mozilla/5.0"),cn==="POST"&&un&&(dn["Content-Type"]="application/x-www-form-urlencoded");const hn=await this.request(ln,dn,cn,un);if(!hn||!hn.trim()[0].match(/[{\[]/)&&hn.length<100)return[];const fn=hn.trim()[0]==="{"||hn.trim()[0]==="[",pn=ruleParser.getElements(hn,an.ruleSearch.bookList);if(!pn.length)return[];const gn=(mn,bn)=>(mn==null?void 0:mn.trim().length)>=2&&!/^(|||??|??||||||||[]|||[]|||)$|^\d+$/.test(mn.trim())&&!!(bn!=null&&bn.trim());return pn.slice(0,5).map(mn=>{var bn;try{const vn=(bn=mn.getAttribute)==null?void 0:bn.call(mn,"data-json"),yn=vn?(()=>{try{return JSON.parse(vn)}catch{return mn.outerHTML}})():mn.outerHTML,wn=kn=>this.parseField(yn,an.ruleSearch[kn],fn||!!vn);return{name:wn("name"),author:this.cleanField(wn("author"),"text"),bookUrl:this.resolveUrl(wn("bookUrl"),an.bookSourceUrl),coverUrl:this.cleanField(wn("coverUrl"),"url"),intro:this.cleanField(wn("intro"),"intro"),lastChapter:wn("lastChapter")||void 0,kind:wn("kind")||void 0,sourceName:an.bookSourceName,sourceUrl:an.bookSourceUrl}}catch{return null}}).filter(mn=>mn&&gn(mn.name,mn.bookUrl))}catch(ln){return console.error(`[] ${an.bookSourceName}:`,ln),[]}}async getBookInfo(an,on){const sn=this.getSource(an);if(!sn)throw new Error("");if(!sn.ruleBookInfo||!Object.keys(sn.ruleBookInfo).length||!sn.ruleBookInfo.tocUrl)return{name:"",author:"",intro:"",coverUrl:"",tocUrl:on,bookUrl:on,sourceName:sn.bookSourceName,sourceUrl:sn.bookSourceUrl};let ln=await this.request(on,ruleEngine.parseHeader(sn.header||""));const cn=ln.trim()[0]==="{"||ln.trim()[0]==="[";if(cn&&sn.ruleBookInfo.init)try{const dn=JSON.parse(ln);sn.ruleBookInfo.init==="data"&&dn.data&&(ln=JSON.stringify(dn.data))}catch(dn){console.error("[] init:",dn)}const un=dn=>this.parseField(ln,dn,cn);return{name:un(sn.ruleBookInfo.name),author:this.cleanField(un(sn.ruleBookInfo.author),"text"),intro:this.cleanField(un(sn.ruleBookInfo.intro),"intro"),coverUrl:this.cleanField(un(sn.ruleBookInfo.coverUrl),"url"),tocUrl:this.resolveUrl(un(sn.ruleBookInfo.tocUrl),on),lastChapter:un(sn.ruleBookInfo.lastChapter)||void 0,kind:un(sn.ruleBookInfo.kind)||void 0,bookUrl:on,sourceName:sn.bookSourceName,sourceUrl:sn.bookSourceUrl}}async getChapters(an,on){var fn;const sn=this.getSource(an);if(!sn)throw new Error("");let ln=await this.request(on,ruleEngine.parseHeader(sn.header||""));const cn=ln.trim()[0]==="{"||ln.trim()[0]==="[";let un=sn.ruleToc.chapterList;if(cn)try{const pn=JSON.parse(ln);pn.data&&Array.isArray(pn.data)&&un==="data"&&(ln=JSON.stringify(pn.data),un="$[*]")}catch{}const dn=ruleParser.getElements(ln,un);if(!dn.length)throw new Error("");let hn="";if((fn=sn.ruleToc.chapterUrl)!=null&&fn.includes("java.get")){const pn=on.match(/[?&]bookid=([^&]+)/);pn&&(hn=pn[1])}return dn.map((pn,gn)=>{const mn=pn.getAttribute("data-json"),bn=mn?JSON.parse(mn):pn.outerHTML;let vn=sn.ruleToc.chapterUrl;return hn&&(vn!=null&&vn.includes("java.get"))&&(vn=vn.replace(/java\.get\(['"]bookid['"]\)/g,`"${hn}"`)),{name:this.parseField(bn,sn.ruleToc.chapterName,cn),url:this.resolveUrl(this.parseField(bn,vn,cn),on),index:gn}})}async getChapterContent(an,on){const sn=this.getSource(an);if(!sn)throw new Error("");const ln=await this.request(on,ruleEngine.parseHeader(sn.header||""));if(!ln)return"";const cn=ln.trim()[0]==="{"||ln.trim()[0]==="[";let un=this.parseField(ln,sn.ruleContent.content,cn);if(un&&/^(\/|https?:\/\/)/.test(un)){const dn=await this.request(this.resolveUrl(un,on),ruleEngine.parseHeader(sn.header||"")),hn=dn.match(/callback\(\{content:\'(.*)\'\}\)/);un=hn?hn[1]:dn}return un}resolveUrl(an,on){if(!an)return"";const sn=on.split("#")[0].split("?")[0];if(an.startsWith("http://")||an.startsWith("https://"))return an;if(an[0]==="/"&&an[1]==="/")return"https:"+an;if(an[0]==="/")try{const ln=new URL(sn);return`${ln.protocol}//${ln.host}${an}`}catch{return""}try{return new URL(an,sn).href}catch{return""}}}const bookSourceManager=new BookSourceManager;async function request(an,on){let sn=await siyuan.fetchSyncPost(an,on);return sn.code===0?sn.data:null}async function upload(an,on){let sn=new FormData;sn.append("assetsDirPath",an);for(let cn of on)sn.append("file[]",cn);return request("/api/asset/upload",sn)}async function appendBlock(an,on,sn){return request("/api/block/appendBlock",{dataType:an,data:on,parentID:sn})}async function deleteBlock(an){return request("/api/block/deleteBlock",{id:an})}async function getChildBlocks(an){return request("/api/block/getChildBlocks",{id:an})}async function getFile(an){let on={path:an},sn="/api/file/getFile";try{return await siyuan.fetchSyncPost(sn,on)}catch{return null}}async function putFile(an,on,sn){let ln=new FormData;return ln.append("path",an),ln.append("isDir",on.toString()),ln.append("modTime",Math.floor(Date.now()/1e3).toString()),ln.append("file",sn),request("/api/file/putFile",ln)}async function removeFile(an){return request("/api/file/removeFile",{path:an})}const api=Object.freeze(Object.defineProperty({__proto__:null,appendBlock,deleteBlock,getChildBlocks,getFile,putFile,removeFile,upload},Symbol.toStringTag,{value:"Module"})),STORAGE_PATH={BOOKS:"/data/storage/petal/siyuan-sireader/books",INDEX:"/data/storage/petal/siyuan-sireader/index.json"};class BookshelfManager{constructor(){ir(this,"index",[]);ir(this,"initialized",!1)}async init(on=!1){if(!(this.initialized&&!on)){await putFile(`${STORAGE_PATH.BOOKS}/`,!0,new File([],"")).catch(()=>{});try{const sn=await getFile(STORAGE_PATH.INDEX);this.index=Array.isArray(sn)?sn:[]}catch{this.index=[]}this.initialized=!0}}getHash(on){let sn=0;for(let ln=0;ln<on.length;ln++)sn=(sn<<5)-sn+on.charCodeAt(ln)|0;return Math.abs(sn).toString(36)}sanitizeName(on){return on.replace(/[<>:"/\\|?*\x00-\x1f()[\]{}]/g,"").replace(/\s+/g,"_").replace(/[._-]+/g,"_").replace(/^[._-]+|[._-]+$/g,"").slice(0,50)||"book"}getFileName(on,sn,ln){return`${this.sanitizeName(on)}_${sn}.${ln}`}async saveCoverFile(on,sn,ln){const cn=this.getFileName(on,sn,"jpg"),un=`${STORAGE_PATH.BOOKS}/${cn}`;return await putFile(un,!1,new File([ln],cn,{type:"image/jpeg"})),un}async processCover(on,sn,ln){if(sn)try{if(sn.startsWith("data:image/")){const cn=Uint8Array.from(atob(sn.split(",")[1]),un=>un.charCodeAt(0));return await this.saveCoverFile(ln,on,new Blob([cn]))}return sn.startsWith("http")?await this.saveCoverFile(ln,on,await(await fetch(sn)).blob()):sn}catch{}}async saveIndex(){await putFile(STORAGE_PATH.INDEX,!1,new File([JSON.stringify(this.index,null,2)],"index.json",{type:"application/json"}))}async getBook(on){try{const sn=this.index.find(dn=>dn.bookUrl===on);if(!sn)return null;const ln=this.getHash(on),cn=this.getFileName(sn.name,ln,"json");return await getFile(`${STORAGE_PATH.BOOKS}/${cn}`)||null}catch{return null}}async saveBook(on){const sn=this.getHash(on.bookUrl),ln=["epub","mobi","azw3","fb2","pdf","cbz"].includes(on.format),cn=this.getFileName(on.name,sn,"json"),un={...on,chapters:ln?[]:on.chapters,coverUrl:void 0};await putFile(`${STORAGE_PATH.BOOKS}/${cn}`,!1,new File([JSON.stringify(un,null,2)],cn,{type:"application/json"})),this.updateIndex(on,await this.processCover(sn,on.coverUrl||"",on.name)),await this.saveIndex()}async updateBook(on,sn){const ln=await this.getBook(on);if(!ln)throw new Error("");await this.saveBook({...ln,...sn})}async addBook(on){if(!on.bookUrl)throw new Error("URL");if(this.index.some(un=>un.bookUrl===on.bookUrl))throw new Error("");const sn=on.format||"online",ln=["epub","mobi","azw3","fb2","pdf","cbz","txt"].includes(sn),cn=Date.now();await this.saveBook({...on,bookUrl:on.bookUrl,tocUrl:on.tocUrl||"",origin:on.origin||"",originName:on.originName||"",name:on.name||"",author:on.author||"",chapters:ln?[]:on.chapters||[],totalChapterNum:on.totalChapterNum||0,latestChapterTitle:"",latestChapterTime:cn,durChapterIndex:0,durChapterTitle:"",durChapterPos:0,durChapterTime:cn,addTime:cn,lastCheckTime:cn,lastCheckCount:0,canUpdate:sn==="online",format:sn,epubProgress:0,epubBookmarks:[],txtBookmarks:[]})}async extractMetadata(on,sn,ln){if(!["epub","mobi","azw3","fb2","cbz"].includes(sn))return{title:ln,author:"",chapters:[]};try{const cn=document.createElement("foliate-view");await cn.open(on);const{metadata:un={},toc:dn=[]}=cn.book||{},hn=bn=>typeof bn=="string"?bn:(bn==null?void 0:bn["zh-CN"])||(bn==null?void 0:bn.zh)||(bn==null?void 0:bn.en)||Object.values(bn||{})[0]||"",fn=bn=>bn?Array.isArray(bn)?bn:[bn]:[],pn=bn=>fn(bn).map(vn=>typeof vn=="string"?vn:hn(vn==null?void 0:vn.name)).filter(Boolean).join(", ")||void 0,gn=dn.map((bn,vn)=>({index:vn,title:hn(bn.label)||`${vn+1}`,url:bn.href||""})).filter(bn=>bn.url),mn=sn==="epub"?await this.extractEpubCover(on):void 0;return cn.remove(),{title:hn(un.title)||ln,subtitle:hn(un.subtitle),author:pn(un.author)||"",publisher:pn(un.publisher),published:un.published instanceof Date?un.published.toISOString().split("T")[0]:un.published?String(un.published):void 0,language:fn(un.language)[0],identifier:fn(un.identifier)[0],intro:un.description,subjects:fn(un.subject).map(bn=>typeof bn=="string"?bn:hn(bn==null?void 0:bn.name)).filter(Boolean),series:Array.isArray(un.belongsTo)?un.belongsTo[0]:un.belongsTo,coverBlob:mn,chapters:gn}}catch(cn){return console.error("[Metadata] :",cn),{title:ln,author:"",chapters:[]}}}async extractEpubCover(on){var sn,ln,cn,un,dn,hn,fn,pn,gn,mn,bn;try{const vn=await JSZip.loadAsync(on),yn=await((sn=vn.file("META-INF/container.xml"))==null?void 0:sn.async("text")),wn=(ln=yn==null?void 0:yn.match(/full-path="([^"]+)"/))==null?void 0:ln[1];if(!wn)return;const kn=await((cn=vn.file(wn))==null?void 0:cn.async("text"));if(!kn)return;const _n=wn.replace(/[^/]+$/,""),xn=Bn=>(_n+Bn).replace(/\/+/g,"/"),En=async Bn=>{var Nn;return await((Nn=vn.file(xn(Bn)))==null?void 0:Nn.async("blob"))};let Tn=((un=kn.match(/<item[^>]+properties="cover-image"[^>]+href="([^"]+)"/))==null?void 0:un[1])||((dn=kn.match(/<item[^>]+href="([^"]+)"[^>]+properties="cover-image"/))==null?void 0:dn[1]);if(!Tn){const Bn=(hn=kn.match(/<item[^>]+id="cover(-image)?"[^>]+href="([^"]+)"/i))==null?void 0:hn[2];if(Bn&&/\.(xhtml|html)$/i.test(Bn)){const Nn=await((fn=vn.file(xn(Bn)))==null?void 0:fn.async("text")),Mn=(pn=Nn==null?void 0:Nn.match(/<(?:img|image)[^>]+(?:src|(?:xlink:)?href)="([^"]+)"/i))==null?void 0:pn[1];Tn=Mn?(Bn.replace(/[^/]+$/,"")+Mn).replace(/^\.\//,"").replace(/^\//,""):void 0}else Tn=Bn}if(!Tn){const Bn=(gn=kn.match(/<meta\s+name="cover"\s+content="([^"]+)"/i))==null?void 0:gn[1];Tn=Bn?(mn=kn.match(new RegExp(`<item[^>]+id="${Bn}"[^>]+href="([^"]+)"`,"i")))==null?void 0:mn[1]:void 0}return Tn||(Tn=((bn=kn.match(/<item[^>]+href="([^"]+\.(?:jpg|jpeg|png|gif))"/i))==null?void 0:bn[1])||["cover.jpg","cover.jpeg","cover.png"].find(Bn=>[Bn,"Images/"+Bn,"images/"+Bn].some(Nn=>vn.file(xn(Nn))))),Tn?await En(Tn):void 0}catch{}}getFormatFromPath(on){var cn;const sn=((cn=on.split(".").pop())==null?void 0:cn.toLowerCase())||"";return{epub:"epub",pdf:"pdf",mobi:"mobi",azw3:"azw3",azw:"azw3",fb2:"fb2",cbz:"cbz",txt:"txt"}[sn]||"epub"}async getEpubChapters(on){return[]}async addLocalBook(on){var gn;const sn=this.getFormatFromPath(on.name),ln=on.name.replace(/\.[^.]+$/,""),cn=await this.extractMetadata(on,sn,ln),un=cn.title||ln,dn=`${sn}://${on.name}_${on.size}`,hn=this.getHash(dn),fn=this.getFileName(un,hn,sn),pn=`${STORAGE_PATH.BOOKS}/${fn}`;await putFile(pn,!1,on),await this.addBook({bookUrl:dn,name:un,author:cn.author,intro:cn.intro,coverUrl:cn.coverBlob?await this.saveCoverFile(un,hn,cn.coverBlob):void 0,origin:sn,originName:sn.toUpperCase(),format:sn,filePath:pn,totalChapterNum:((gn=cn.chapters)==null?void 0:gn.length)||0,subtitle:cn.subtitle,publisher:cn.publisher,published:cn.published,language:cn.language,identifier:cn.identifier,subjects:cn.subjects,series:cn.series})}async removeBook(on){const sn=this.index.find(ln=>ln.bookUrl===on);if(sn){const ln=this.getHash(on),cn=`${STORAGE_PATH.BOOKS}/${this.sanitizeName(sn.name)}_${ln}`;await Promise.all([`${cn}.json`,`${cn}.jpg`,`${cn}.${sn.format}`].map(un=>removeFile(un).catch(()=>{})))}this.index=this.index.filter(ln=>ln.bookUrl!==on),await this.saveIndex()}async cacheChapterContent(on,sn,ln){const cn=await this.getBook(on);cn!=null&&cn.chapters[sn]&&(cn.chapters[sn].content=ln,await this.saveBook(cn))}getBooks(){return[...this.index]}hasBook(on){return this.index.some(sn=>sn.bookUrl===on)}async sortBooks(on){const sn={time:(ln,cn)=>cn.durChapterTime-ln.durChapterTime,name:(ln,cn)=>ln.name.localeCompare(cn.name,"zh-CN"),author:(ln,cn)=>ln.author.localeCompare(cn.author,"zh-CN"),update:(ln,cn)=>cn.addTime-ln.addTime};this.index.sort(sn[on]),await this.saveIndex()}searchBooks(on){const sn=on.toLowerCase();return on?this.index.filter(ln=>ln.name.toLowerCase().includes(sn)||ln.author.toLowerCase().includes(sn)):this.getBooks()}async checkUpdate(on){const sn=await this.getBook(on);if(!(sn!=null&&sn.canUpdate))return{bookUrl:on,hasUpdate:!1,newChapters:0,latestChapterTitle:""};try{const ln=await bookSourceManager.getChapters(sn.origin,sn.tocUrl||sn.bookUrl),cn=ln.length-sn.totalChapterNum,un=Date.now();return cn>0?(sn.chapters.push(...ln.slice(sn.totalChapterNum).map((dn,hn)=>({index:sn.totalChapterNum+hn,title:dn.name||`${sn.totalChapterNum+hn+1}`,url:dn.url||""}))),Object.assign(sn,{totalChapterNum:ln.length,latestChapterTitle:ln[ln.length-1].name,latestChapterTime:un,lastCheckCount:cn,lastCheckTime:un})):Object.assign(sn,{lastCheckCount:0,lastCheckTime:un}),await this.saveBook(sn),{bookUrl:on,hasUpdate:cn>0,newChapters:cn,latestChapterTitle:sn.latestChapterTitle||""}}catch{return{bookUrl:on,hasUpdate:!1,newChapters:0,latestChapterTitle:""}}}async checkAllUpdates(){return Promise.all(this.index.map(on=>this.checkUpdate(on.bookUrl)))}updateIndex(on,sn){var un;const ln=this.index.findIndex(dn=>dn.bookUrl===on.bookUrl),cn={bookUrl:on.bookUrl,name:on.name,author:on.author,coverUrl:sn||((un=this.index[ln])==null?void 0:un.coverUrl),durChapterIndex:on.durChapterIndex,totalChapterNum:on.totalChapterNum,durChapterTime:on.durChapterTime,addTime:on.addTime,lastCheckCount:on.lastCheckCount,format:on.format,epubProgress:on.epubProgress};ln>=0?this.index[ln]=cn:this.index.push(cn)}}const bookshelfManager=new BookshelfManager,loadBookData=async an=>await bookshelfManager.getBook(an)||{},saveBookData=async(an,on)=>{const sn=await bookshelfManager.getBook(an);sn&&(Object.entries(on).forEach(([ln,cn])=>cn!==void 0&&(sn[ln]=cn)),await bookshelfManager.saveBook(sn))},bookshelf=Object.freeze(Object.defineProperty({__proto__:null,STORAGE_PATH,bookshelfManager,loadBookData,saveBookData},Symbol.toStringTag,{value:"Module"})),DEFAULT_DOMAINS=["https://annas-archive.se","https://annas-archive.li","https://annas-archive.gs","https://annas-archive.org"];class AnnaArchiveAdapter{constructor(){ir(this,"config",{filters:{extensions:[],language:void 0}});this.loadConfig()}loadConfig(){try{const on=localStorage.getItem("anna_config");on&&(this.config={...this.config,...JSON.parse(on)}),this.config.currentDomain||(this.config.currentDomain=DEFAULT_DOMAINS[0])}catch{}}saveConfig(on){this.config={...this.config,...on},localStorage.setItem("anna_config",JSON.stringify(this.config))}getConfig(){return{...this.config}}getCurrentDomain(){return this.config.currentDomain||DEFAULT_DOMAINS[0]}getAllDomains(){return[...this.config.customDomains||[],...DEFAULT_DOMAINS]}addCustomDomain(on){const sn=this.config.customDomains||[];!sn.includes(on)&&!DEFAULT_DOMAINS.includes(on)&&(sn.push(on),this.saveConfig({customDomains:sn}))}removeCustomDomain(on){const ln=(this.config.customDomains||[]).filter(cn=>cn!==on);this.saveConfig({customDomains:ln})}switchDomain(on){this.saveConfig({currentDomain:on})}async testDomain(on){try{return(await fetch(on,{method:"HEAD",signal:AbortSignal.timeout(5e3)})).ok}catch{return!1}}async autoSwitchDomain(){const on=this.getAllDomains();for(const sn of on)if(await this.testDomain(sn))return this.switchDomain(sn),sn;return null}setExtensionFilter(on){this.saveConfig({filters:{...this.config.filters,extensions:on}})}setLanguageFilter(on){this.saveConfig({filters:{...this.config.filters,language:on}})}getCurrentSource(){return{name:"Anna's Archive",url:this.getCurrentDomain(),type:"anna"}}async search(on,sn=1){var hn,fn;const ln=this.getCurrentDomain();let cn=`${ln}/search?q=${encodeURIComponent(on)}&page=${sn}`;const un=((hn=this.config.filters)==null?void 0:hn.extensions)||[];un.length>0&&(cn+=`&ext=${un.join(",")}`);const dn=(fn=this.config.filters)==null?void 0:fn.language;dn&&(cn+=`&lang=${dn}`);try{const pn=await this.request(cn);if(!pn||pn.length<100)throw new Error("");return this.parseResults(pn,ln)}catch(pn){if(pn.message.includes("HTTP")||pn.message.includes("")){const gn=await this.autoSwitchDomain();if(gn&&gn!==ln)return this.search(on,sn)}throw pn}}async request(on,sn=3e4){const ln=new AbortController,cn=setTimeout(()=>ln.abort(),sn);try{const un=await fetch(on,{method:"GET",headers:{"User-Agent":"Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36",Accept:"text/html,application/xhtml+xml,application/xml;q=0.9,*/*;q=0.8"},signal:ln.signal,mode:"cors"});if(clearTimeout(cn),!un.ok)throw new Error(`HTTP ${un.status}`);return await un.text()}catch(un){throw clearTimeout(cn),un.name==="AbortError"?new Error(""):un}}parseResults(on,sn){const cn=new DOMParser().parseFromString(on,"text/html"),un=[],dn=cn.querySelectorAll('a[href^="/md5/"]');return dn.length===0?[]:(dn.forEach((hn,fn)=>{var pn,gn,mn,bn,vn;try{const yn=hn.getAttribute("href")||"",wn=((pn=yn.split("/md5/")[1])==null?void 0:pn.split("/")[0])||`anna-${fn}`,kn=((gn=hn.textContent)==null?void 0:gn.trim())||"";if(!kn||kn.length<2)return;const _n=hn.parentElement;if(!_n)return;const xn=_n.querySelector("div.text-gray-500"),En=((mn=xn==null?void 0:xn.textContent)==null?void 0:mn.trim())||"";let Tn;const Bn=En.match(/\.(pdf|epub|mobi|azw3|djvu|fb2|txt|doc|docx|cbr|cbz)$/i);Bn&&(Tn=Bn[1].toUpperCase());const Nn=((bn=this.config.filters)==null?void 0:bn.extensions)||[];if(Nn.length>0&&Tn&&!Nn.some(Rn=>Rn.toLowerCase()===Tn.toLowerCase()))return;let Mn="";const Ln=_n.querySelector('a[href^="/search?q="]');if(Ln){const Rn=(vn=Ln.textContent)==null?void 0:vn.trim();Rn&&Rn!=="Unknown"&&Rn.length>0&&(Mn=Rn)}let On=_n.parentElement,zn,Pn,An;if(On){const Rn=On.textContent||"",Hn=Rn.match(/\b(19|20)\d{2}\b/);Hn&&(zn=Hn[0]);const Zn=Rn.match(/\b(English|Chinese|Japanese|Korean|French|German|Spanish|Russian||||)\b/i);Zn&&(Pn=Zn[0]);const Qn=Rn.match(/([\d.]+\s*[KMGT]i?B)/i);Qn&&(An=Qn[1])}let Vn,Sn=_n;for(let Rn=0;Rn<3&&Sn;Rn++){const Hn=Sn.querySelector("img");if(Hn){const Zn=Hn.getAttribute("src")||Hn.getAttribute("data-src")||Hn.getAttribute("data-lazy-src");if(Zn&&!Zn.includes("data:image")){Vn=Zn.startsWith("http")?Zn:sn+Zn;break}}Sn=Sn.parentElement}un.push({id:wn,name:kn,author:Mn,bookUrl:sn+yn,coverUrl:Vn,intro:void 0,year:zn,language:Pn,fileSize:An,extension:Tn})}catch{}}),un)}async getBookInfo(on){var Ln,On,zn,Pn;const sn=await this.request(on),cn=new DOMParser().parseFromString(sn,"text/html"),un=new URL(on),dn=`${un.protocol}//${un.host}`,hn=cn.querySelector('h1, .book-title, [itemprop="name"]'),fn=((Ln=hn==null?void 0:hn.textContent)==null?void 0:Ln.trim())||"",pn=cn.querySelector('.author, .authors, [itemprop="author"]'),gn=((On=pn==null?void 0:pn.textContent)==null?void 0:On.trim())||"",mn=cn.querySelector('.description, .book-description, [itemprop="description"]'),bn=((zn=mn==null?void 0:mn.textContent)==null?void 0:zn.trim())||"";let vn;const yn=cn.querySelector('img[itemprop="image"], .book-cover img, img[alt*="cover"]');if(yn){const An=yn.getAttribute("src")||yn.getAttribute("data-src");An&&(vn=An.startsWith("http")?An:dn+An)}const wn=((Pn=cn.body)==null?void 0:Pn.textContent)||"",kn=wn.match(/\b(19|20)\d{2}\b/),_n=kn?kn[0]:void 0,xn=wn.match(/Language:\s*([^\n]+)/i),En=xn?xn[1].trim():void 0,Tn=wn.match(/Extension:\s*([^\n]+)/i),Bn=Tn?Tn[1].trim().toUpperCase():void 0,Nn=wn.match(/Size:\s*([\d.]+\s*[KMGT]i?B)/i),Mn=Nn?Nn[1]:void 0;return{name:fn,author:gn,intro:bn,bookUrl:on,coverUrl:vn,year:_n,language:En,extension:Bn,fileSize:Mn}}}const annaArchive=new AnnaArchiveAdapter,anna=Object.freeze(Object.defineProperty({__proto__:null,annaArchive},Symbol.toStringTag,{value:"Module"})),_hoisted_1$9={class:"sr-toolbar"},_hoisted_2$8=["aria-label"],_hoisted_3$8={style:{display:"flex",gap:"4px","margin-bottom":"8px"}},_hoisted_4$8=["onClick"],_hoisted_5$8=["value"],_hoisted_6$8={class:"sr-list"},_hoisted_7$8=["checked","onChange"],_hoisted_8$8={key:0,class:"sr-icon spin"},_hoisted_9$8={key:1,class:"sr-icon ok"},_hoisted_10$8={key:2,class:"sr-icon no"},_hoisted_11$8=["onClick"],_hoisted_12$8={class:"sr-name"},_hoisted_13$8={class:"sr-url"},_hoisted_14$7=["onClick"],_hoisted_15$7=["onClick"],_hoisted_16$7={key:0,class:"sr-empty"},_sfc_main$9=defineComponent({__name:"SourceMgr",props:{i18n:{}},emits:["close"],setup(an,{emit:on}){const sn=an,ln=on,cn=ref([]),un=ref({}),dn=ref(!1),hn=ref(""),fn=ref(new Set),pn=ref(!1),gn=ref(localStorage.getItem("anna_enabled")==="true"),mn=ref(!1),bn=ref([]),vn=ref(""),yn=ref([]),wn=ref(""),kn=()=>{var Yn;const Qn=annaArchive.getConfig();bn.value=((Yn=Qn.filters)==null?void 0:Yn.extensions)||[],vn.value=Qn.currentDomain||"",yn.value=annaArchive.getAllDomains()},_n=Qn=>{const Yn=bn.value.indexOf(Qn);Yn>-1?bn.value.splice(Yn,1):bn.value.push(Qn),annaArchive.setExtensionFilter(bn.value)},xn=()=>{annaArchive.switchDomain(vn.value),siyuan.showMessage("",1500)},En=()=>{if(!wn.value.startsWith("http"))return siyuan.showMessage("URL",2e3,"error");annaArchive.addCustomDomain(wn.value),yn.value=annaArchive.getAllDomains(),wn.value="",siyuan.showMessage("",1500)},Tn=computed(()=>{if(!hn.value)return cn.value;const Qn=hn.value.toLowerCase();return cn.value.filter(Yn=>{var tr;return Yn.bookSourceName.toLowerCase().includes(Qn)||Yn.bookSourceUrl.toLowerCase().includes(Qn)||((tr=Yn.bookSourceGroup)==null?void 0:tr.toLowerCase().includes(Qn))})}),Bn=computed(()=>cn.value.filter(Qn=>un.value[Qn.bookSourceUrl]==="invalid").length),Nn=Qn=>fn.value.has(Qn),Mn=()=>cn.value=bookSourceManager.getSources(),Ln=Qn=>fn.value.has(Qn)?fn.value.delete(Qn):fn.value.add(Qn),On=Qn=>{let Yn=0;fn.value.forEach(tr=>{const Un=cn.value.find(Xn=>Xn.bookSourceUrl===tr);Un&&Un.enabled!==Qn&&(Un.enabled=Qn,bookSourceManager.addSource(Un),Yn++)}),Mn(),fn.value.clear(),siyuan.showMessage(`${Qn?"":""} ${Yn} `)},zn=()=>{const Qn=fn.value.size;new siyuan.Dialog({title:"",content:`<div class="b3-dialog__content"> ${Qn} </div>`,width:"400px",destroyCallback:Yn=>{Yn!=null&&Yn.confirm&&(fn.value.forEach(tr=>{bookSourceManager.removeSource(tr),delete un.value[tr]}),Mn(),fn.value.clear(),siyuan.showMessage(` ${Qn} `))}})},Pn=Qn=>{Qn.enabled=!Qn.enabled,bookSourceManager.addSource(Qn),Mn()},An=Qn=>{new siyuan.Dialog({title:"",content:`<div class="b3-dialog__content">${Qn.bookSourceName}</div>`,width:"400px",destroyCallback:Yn=>{Yn!=null&&Yn.confirm&&(bookSourceManager.removeSource(Qn.bookSourceUrl),delete un.value[Qn.bookSourceUrl],Mn())}})},Vn=()=>{const Qn=cn.value.filter(Yn=>un.value[Yn.bookSourceUrl]==="invalid");new siyuan.Dialog({title:"",content:`<div class="b3-dialog__content"> ${Qn.length} </div>`,width:"400px",destroyCallback:Yn=>{Yn!=null&&Yn.confirm&&(Qn.forEach(tr=>{bookSourceManager.removeSource(tr.bookSourceUrl),delete un.value[tr.bookSourceUrl]}),Mn(),siyuan.showMessage(` ${Qn.length} `))}})},Sn=["","","",""],Rn=async Qn=>{if(!pn.value){un.value[Qn.bookSourceUrl]="checking";for(const Yn of Sn){if(pn.value)return;try{if((await Promise.race([bookSourceManager.searchBooks(Yn,Qn.bookSourceUrl),new Promise((Un,Xn)=>setTimeout(()=>Xn(),12e3))])).length>0){un.value[Qn.bookSourceUrl]="valid";return}}catch{}}pn.value||(un.value[Qn.bookSourceUrl]="invalid")}},Hn=async()=>{pn.value=!1,dn.value=!0;const Qn=cn.value.filter(Un=>Un.enabled),Yn=5;for(let Un=0;Un<Qn.length&&!pn.value;Un+=Yn)await Promise.allSettled(Qn.slice(Un,Un+Yn).map(Rn));dn.value=!1;const tr=Qn.filter(Un=>un.value[Un.bookSourceUrl]==="valid").length;siyuan.showMessage(pn.value?`: ${tr} `:`: ${tr}/${Qn.length} `)},Zn=()=>{var Yn,tr;gn.value=!gn.value,localStorage.setItem("anna_enabled",String(gn.value));const Qn=gn.value?((Yn=sn.i18n)==null?void 0:Yn.annaEnabled)||"":((tr=sn.i18n)==null?void 0:tr.annaDisabled)||"";siyuan.showMessage(Qn),window.dispatchEvent(new CustomEvent("anna-toggle"))};return onMounted(async()=>{await bookSourceManager.loadSources(),Mn(),kn()}),onBeforeUnmount(()=>{pn.value=!0,dn.value=!1}),(Qn,Yn)=>{var tr,Un;return openBlock$1(),createElementBlock("div",{class:"sr-source-mgr",onClick:Yn[10]||(Yn[10]=Xn=>mn.value=!1)},[createBaseVNode("div",_hoisted_1$9,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Yn[0]||(Yn[0]=Xn=>hn.value=Xn),placeholder:"..."},null,512),[[vModelText,hn.value]]),fn.value.size?(openBlock$1(),createElementBlock(Fragment,{key:0},[createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Yn[1]||(Yn[1]=Xn=>On(!0)),"aria-label":""},[...Yn[11]||(Yn[11]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-eye"})],-1)])]),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Yn[2]||(Yn[2]=Xn=>On(!1)),"aria-label":""},[...Yn[12]||(Yn[12]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-eye-off"})],-1)])]),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:zn,"aria-label":""},[...Yn[13]||(Yn[13]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-trash-2"})],-1)])])],64)):createCommentVNode("",!0),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:withModifiers(Zn,["stop"]),onContextmenu:Yn[3]||(Yn[3]=withModifiers(Xn=>mn.value=!mn.value,["prevent","stop"])),"aria-label":gn.value?((tr=an.i18n)==null?void 0:tr.annaEnabled)||"":((Un=an.i18n)==null?void 0:Un.annaDisabled)||""},[(openBlock$1(),createElementBlock("svg",{style:normalizeStyle({color:gn.value?"var(--b3-theme-primary)":""})},[...Yn[14]||(Yn[14]=[createBaseVNode("use",{"xlink:href":"#lucide-library-big"},null,-1)])],4))],40,_hoisted_2$8),mn.value?(openBlock$1(),createElementBlock("div",{key:1,class:"sr-menu",onClick:Yn[6]||(Yn[6]=withModifiers(()=>{},["stop"])),style:{top:"40px",right:"8px",width:"180px",padding:"8px"}},[Yn[15]||(Yn[15]=createBaseVNode("div",{style:{"font-size":"10px",opacity:".6","margin-bottom":"6px"}},"",-1)),createBaseVNode("div",_hoisted_3$8,[(openBlock$1(),createElementBlock(Fragment,null,renderList(["epub","pdf","mobi","azw3"],Xn=>createBaseVNode("span",{key:Xn,onClick:or=>_n(Xn),style:normalizeStyle([{padding:"3px 8px","border-radius":"3px","font-size":"10px",cursor:"pointer",transition:"all .15s"},{background:bn.value.includes(Xn)?"var(--b3-theme-primary)":"var(--b3-theme-background)",color:bn.value.includes(Xn)?"#fff":"var(--b3-theme-on-surface)"}])},toDisplayString(Xn.toUpperCase()),13,_hoisted_4$8)),64))]),withDirectives(createBaseVNode("select",{"onUpdate:modelValue":Yn[4]||(Yn[4]=Xn=>vn.value=Xn),onChange:xn,class:"b3-select",style:{width:"100%","margin-bottom":"6px"}},[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(yn.value,Xn=>(openBlock$1(),createElementBlock("option",{key:Xn,value:Xn},toDisplayString(Xn.replace("https://","").replace("annas-archive.","")),9,_hoisted_5$8))),128))],544),[[vModelSelect,vn.value]]),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Yn[5]||(Yn[5]=Xn=>wn.value=Xn),placeholder:"https://...",onKeyup:withKeys(En,["enter"]),class:"b3-text-field",style:{width:"100%","margin-bottom":"6px"}},null,544),[[vModelText,wn.value]]),createBaseVNode("button",{onClick:En,class:"b3-button b3-button--outline",style:{width:"100%"}},"")])):createCommentVNode("",!0),dn.value?(openBlock$1(),createElementBlock("button",{key:3,class:"b3-tooltips b3-tooltips__s",onClick:Yn[7]||(Yn[7]=Xn=>pn.value=!0),"aria-label":""},[...Yn[17]||(Yn[17]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-hand"})],-1)])])):(openBlock$1(),createElementBlock("button",{key:2,class:"b3-tooltips b3-tooltips__s",onClick:Hn,"aria-label":""},[...Yn[16]||(Yn[16]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-list-restart"})],-1)])])),Bn.value?(openBlock$1(),createElementBlock("button",{key:4,class:"b3-tooltips b3-tooltips__s",onClick:Vn,"aria-label":""},[...Yn[18]||(Yn[18]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-brush-cleaning"})],-1)])])):createCommentVNode("",!0),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Yn[8]||(Yn[8]=Xn=>ln("close")),"aria-label":""},[...Yn[19]||(Yn[19]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-panel-top-close"})],-1)])])]),createBaseVNode("div",_hoisted_6$8,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Tn.value,Xn=>(openBlock$1(),createElementBlock("div",{key:Xn.bookSourceUrl,class:normalizeClass(["sr-card",{off:!Xn.enabled,bad:un.value[Xn.bookSourceUrl]==="invalid",sel:Nn(Xn.bookSourceUrl)}])},[createBaseVNode("input",{type:"checkbox",class:"b3-checkbox",checked:Nn(Xn.bookSourceUrl),onChange:or=>Ln(Xn.bookSourceUrl),onClick:Yn[9]||(Yn[9]=withModifiers(()=>{},["stop"]))},null,40,_hoisted_7$8),un.value[Xn.bookSourceUrl]==="checking"?(openBlock$1(),createElementBlock("svg",_hoisted_8$8,[...Yn[20]||(Yn[20]=[createBaseVNode("use",{"xlink:href":"#lucide-refresh-cw"},null,-1)])])):un.value[Xn.bookSourceUrl]==="valid"?(openBlock$1(),createElementBlock("svg",_hoisted_9$8,[...Yn[21]||(Yn[21]=[createBaseVNode("use",{"xlink:href":"#lucide-check"},null,-1)])])):un.value[Xn.bookSourceUrl]==="invalid"?(openBlock$1(),createElementBlock("svg",_hoisted_10$8,[...Yn[22]||(Yn[22]=[createBaseVNode("use",{"xlink:href":"#lucide-x"},null,-1)])])):createCommentVNode("",!0),createBaseVNode("div",{class:"sr-info",onClick:or=>Pn(Xn)},[createBaseVNode("div",_hoisted_12$8,toDisplayString(Xn.bookSourceName),1),createBaseVNode("div",_hoisted_13$8,toDisplayString(Xn.bookSourceUrl),1)],8,_hoisted_11$8),createBaseVNode("button",{class:"sr-btn-icon b3-tooltips b3-tooltips__w",onClick:withModifiers(or=>Rn(Xn),["stop"]),"aria-label":""},[...Yn[23]||(Yn[23]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-book-search"})],-1)])],8,_hoisted_14$7),createBaseVNode("button",{class:"sr-btn-icon b3-tooltips b3-tooltips__w",onClick:withModifiers(or=>An(Xn),["stop"]),"aria-label":""},[...Yn[24]||(Yn[24]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-eraser"})],-1)])],8,_hoisted_15$7)],2))),128)),Tn.value.length?createCommentVNode("",!0):(openBlock$1(),createElementBlock("div",_hoisted_16$7,toDisplayString(hn.value?"":""),1))])])}}}),_export_sfc=(an,on)=>{const sn=an.__vccOpts||an;for(const[ln,cn]of on)sn[ln]=cn;return sn},SourceMgr=_export_sfc(_sfc_main$9,[["__scopeId","data-v-62a762e2"]]),_hoisted_1$8={class:"sr-toolbar"},_hoisted_2$7=["placeholder","disabled"],_hoisted_3$7={class:"sr-select"},_hoisted_4$7=["aria-label"],_hoisted_5$7=["onClick"],_hoisted_6$7=["aria-label"],_hoisted_7$7={key:0,class:"sr-placeholder"},_hoisted_8$7={key:1,class:"sr-list"},_hoisted_9$7=["enter","onClick"],_hoisted_10$7={class:"sr-cover-wrap"},_hoisted_11$7=["src","onError"],_hoisted_12$7={key:1,class:"sr-text-cover"},_hoisted_13$7={class:"sr-info"},_hoisted_14$6={class:"sr-title"},_hoisted_15$6={class:"sr-author"},_hoisted_16$6={key:0,class:"sr-author"},_hoisted_17$6={key:1,class:"sr-author"},_hoisted_18$6={key:0},_hoisted_19$6={key:1},_hoisted_20$6={key:2},_hoisted_21$5={key:2,class:"sr-intro"},_hoisted_22$5={key:3,class:"sr-chapter"},_hoisted_23$5={class:"sr-source"},_hoisted_24$5=["aria-label","onClick"],_hoisted_25$3=["aria-label","onClick"],_hoisted_26$3=["xlink:href"],_hoisted_27$2={key:2,class:"sr-status"},_hoisted_28$2={key:3,class:"sr-status"},_hoisted_29$2={key:4,class:"sr-status"},_hoisted_30$2={key:0,class:"sr-detail"},_hoisted_31$2={class:"sr-detail-header"},_hoisted_32$2={class:"sr-detail-content"},_hoisted_33$2=["src"],_hoisted_34$2={class:"sr-meta"},_hoisted_35$2={key:0,class:"sr-tags"},_hoisted_36$2={key:0},_hoisted_37$2={key:1},_hoisted_38$1={key:2},_hoisted_39$1={key:3},_hoisted_40$1={key:1,class:"sr-intro-full"},_hoisted_41$1={key:2,class:"sr-actions-full"},_hoisted_42$1={key:3,class:"sr-actions-full"},_hoisted_43$1=["xlink:href"],_hoisted_44$1={key:4,class:"sr-chapters"},_hoisted_45$1={class:"sr-chapters-header"},_hoisted_46$1={key:0,class:"sr-placeholder"},_hoisted_47$1={key:1,class:"sr-placeholder"},_hoisted_48$1={key:2,class:"sr-chapters-list"},_sfc_main$8=defineComponent({__name:"BookSearch",props:{i18n:{}},emits:["read"],setup(an,{emit:on}){const sn=an,ln=on,cn=tr=>bookshelfManager.hasBook(tr.bookUrl),un=tr=>{var Un;return(Un=tr.bookUrl)==null?void 0:Un.includes("annas-archive")},dn=ref(null),hn=ref([]),fn=ref(!1),pn=ref(!1),gn=ref(!1),mn=computed(()=>{var tr,Un;return((Un=(tr=dn.value)==null?void 0:tr.kind)==null?void 0:Un.split(",").filter(Boolean))||[]}),bn=computed(()=>fn.value?[...hn.value].reverse():hn.value),vn=tr=>{const Xn=sn.i18n.name===""?tr.replace("annas-archive.org","zh.annas-archive.org"):tr;window.open(Xn,"_blank")},yn=ref(""),wn=ref(""),kn=ref(!1),_n=ref(!1),xn=ref([]),En=ref(),Tn=ref(!1),Bn=ref(null),Nn=ref(localStorage.getItem("anna_enabled")==="true"),Mn=new Set,Ln=computed(()=>bookSourceManager.getEnabledSources()),On=computed(()=>{if(!wn.value)return sn.i18n.allSources||"";if(wn.value==="anna")return sn.i18n.annaArchive||"";const tr=Ln.value.find(Un=>Un.bookSourceUrl===wn.value);return(tr==null?void 0:tr.bookSourceName)||""}),zn=tr=>tr.coverUrl&&!Mn.has(tr.coverUrl),Pn=tr=>Mn.add(tr.coverUrl),An=async()=>{if(yn.value.trim()){_n.value=!0,xn.value=[],Tn.value=!0;try{const tr=wn.value==="anna",Un=tr||!wn.value&&Nn.value;Bn.value=bookSourceManager.searchBooksStream(yn.value,tr?void 0:wn.value||void 0,1,Un),await Vn()}catch(tr){siyuan.showMessage(": "+tr.message,3e3,"error")}finally{_n.value=!1}}},Vn=async()=>{if(!(!Bn.value||_n.value)){_n.value=!0;try{const{value:tr,done:Un}=await Bn.value.next();Tn.value=!Un,tr&&xn.value.push(...tr)}catch(tr){siyuan.showMessage(": "+tr.message,3e3,"error")}finally{_n.value=!1}}},Sn=()=>{Bn.value=null,Tn.value=!1,_n.value=!1},Rn=tr=>{dn.value=tr,un(tr)||Hn()},Hn=async()=>{if(dn.value){pn.value=!0,hn.value=[];try{const Un=(await bookSourceManager.getBookInfo(dn.value.sourceUrl||dn.value.origin,dn.value.bookUrl)).tocUrl||dn.value.bookUrl;hn.value=await bookSourceManager.getChapters(dn.value.sourceUrl||dn.value.origin,Un)}catch(tr){siyuan.showMessage(`: ${tr.message}`,3e3,"error")}finally{pn.value=!1}}},Zn=async tr=>{try{await bookshelfManager.addBook({bookUrl:tr.bookUrl,tocUrl:tr.tocUrl||tr.bookUrl,origin:tr.sourceUrl||tr.origin,originName:tr.sourceName||tr.originName,name:tr.name,author:tr.author,kind:tr.kind,coverUrl:tr.coverUrl,intro:tr.intro,wordCount:tr.wordCount}),siyuan.showMessage(`${tr.name}`,2e3,"info")}catch(Un){siyuan.showMessage(Un.message,3e3,"error")}},Qn=()=>{if(!En.value||_n.value||!Tn.value)return;const{scrollTop:tr,scrollHeight:Un,clientHeight:Xn}=En.value;tr+Xn>=Un-100&&Vn()},Yn=()=>Nn.value=localStorage.getItem("anna_enabled")==="true";return onMounted(()=>window.addEventListener("anna-toggle",Yn)),onUnmounted(()=>window.removeEventListener("anna-toggle",Yn)),(tr,Un)=>{const Xn=resolveDirective("motion");return openBlock$1(),createElementBlock("div",{class:"sr-search",onClick:Un[14]||(Un[14]=or=>kn.value=!1)},[createBaseVNode("div",_hoisted_1$8,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Un[0]||(Un[0]=or=>yn.value=or),placeholder:an.i18n.searchPlaceholder||"",onKeyup:withKeys(An,["enter"]),disabled:_n.value},null,40,_hoisted_2$7),[[vModelText,yn.value]]),createBaseVNode("div",_hoisted_3$7,[createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Un[1]||(Un[1]=withModifiers(or=>kn.value=!kn.value,["stop"])),"aria-label":On.value},[...Un[15]||(Un[15]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-sliders-horizontal"})],-1)])],8,_hoisted_4$7),kn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-menu",onClick:Un[4]||(Un[4]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",{class:normalizeClass(["sr-menu-item",{active:!wn.value}]),onClick:Un[2]||(Un[2]=or=>{wn.value="",kn.value=!1})},toDisplayString(an.i18n.allSources||""),3),Nn.value?(openBlock$1(),createElementBlock("div",{key:0,class:normalizeClass(["sr-menu-item",{active:wn.value==="anna"}]),onClick:Un[3]||(Un[3]=or=>{wn.value="anna",kn.value=!1})},toDisplayString(an.i18n.annaArchive||""),3)):createCommentVNode("",!0),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Ln.value,or=>(openBlock$1(),createElementBlock("div",{key:or.bookSourceUrl,class:normalizeClass(["sr-menu-item",{active:wn.value===or.bookSourceUrl}]),onClick:kr=>{wn.value=or.bookSourceUrl,kn.value=!1}},toDisplayString(or.bookSourceName),11,_hoisted_5$7))),128))])):createCommentVNode("",!0)]),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Un[5]||(Un[5]=or=>gn.value=!gn.value),"aria-label":an.i18n.bookSourceManage||""},[...Un[16]||(Un[16]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-settings-2"})],-1)])],8,_hoisted_6$7)]),createVNode(Transition,{name:"slide"},{default:withCtx(()=>[gn.value?(openBlock$1(),createBlock(SourceMgr,{key:0,onClose:Un[6]||(Un[6]=or=>gn.value=!1)})):createCommentVNode("",!0)]),_:1}),withDirectives(createBaseVNode("div",{class:"sr-results",ref_key:"resultsContainer",ref:En,onScroll:Qn},[!_n.value&&!xn.value.length&&yn.value?(openBlock$1(),createElementBlock("div",_hoisted_7$7,toDisplayString(an.i18n.noResults||""),1)):(openBlock$1(),createElementBlock("div",_hoisted_8$7,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(xn.value,or=>withDirectives((openBlock$1(),createElementBlock("div",{key:or.bookUrl,initial:{opacity:0,y:15},enter:{opacity:1,y:0,transition:{delay:xn.value.indexOf(or)*20}},class:"sr-card",onClick:kr=>Rn(or)},[createBaseVNode("div",_hoisted_10$7,[zn(or)?(openBlock$1(),createElementBlock("img",{key:0,src:or.coverUrl,onError:kr=>Pn(or),class:"sr-cover"},null,40,_hoisted_11$7)):(openBlock$1(),createElementBlock("div",_hoisted_12$7,toDisplayString(or.name),1))]),createBaseVNode("div",_hoisted_13$7,[createBaseVNode("div",_hoisted_14$6,toDisplayString(or.name),1),createBaseVNode("div",_hoisted_15$6,toDisplayString(or.author),1),or.kind?(openBlock$1(),createElementBlock("div",_hoisted_16$6,toDisplayString(or.kind),1)):createCommentVNode("",!0),or.extension||or.fileSize?(openBlock$1(),createElementBlock("div",_hoisted_17$6,[or.extension?(openBlock$1(),createElementBlock("span",_hoisted_18$6,toDisplayString(or.extension),1)):createCommentVNode("",!0),or.extension&&or.fileSize?(openBlock$1(),createElementBlock("span",_hoisted_19$6,"  ")):createCommentVNode("",!0),or.fileSize?(openBlock$1(),createElementBlock("span",_hoisted_20$6,toDisplayString(or.fileSize),1)):createCommentVNode("",!0)])):createCommentVNode("",!0),or.intro?(openBlock$1(),createElementBlock("div",_hoisted_21$5,toDisplayString(or.intro),1)):createCommentVNode("",!0),or.lastChapter?(openBlock$1(),createElementBlock("div",_hoisted_22$5,toDisplayString(or.lastChapter),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_23$5,toDisplayString(or.sourceName),1)]),un(or)?(openBlock$1(),createElementBlock("button",{key:0,class:"sr-btn sr-btn-icon b3-tooltips b3-tooltips__w","aria-label":an.i18n.openLink||"",onClick:withModifiers(kr=>vn(or.bookUrl),["stop"])},[...Un[17]||(Un[17]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconLink"})],-1)])],8,_hoisted_24$5)):(openBlock$1(),createElementBlock("button",{key:1,class:normalizeClass(["sr-btn sr-btn-icon b3-tooltips b3-tooltips__w",{active:cn(or)}]),"aria-label":cn(or)?"":"",onClick:withModifiers(kr=>Zn(or),["stop"])},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":cn(or)?"#iconCheck":"#iconAdd"},null,8,_hoisted_26$3)]))],10,_hoisted_25$3))],8,_hoisted_9$7)),[[Xn]])),128))])),_n.value?(openBlock$1(),createElementBlock("div",_hoisted_27$2,[createBaseVNode("span",null,"... ("+toDisplayString(xn.value.length)+")",1),createBaseVNode("button",{class:"sr-btn sr-btn-text",onClick:Sn},"")])):createCommentVNode("",!0),!_n.value&&Tn.value?(openBlock$1(),createElementBlock("div",_hoisted_28$2,[createBaseVNode("button",{class:"sr-btn sr-btn-primary",onClick:Vn},"")])):createCommentVNode("",!0),!_n.value&&!Tn.value&&xn.value.length?(openBlock$1(),createElementBlock("div",_hoisted_29$2,"")):createCommentVNode("",!0)],544),[[vShow,!gn.value]]),createVNode(Transition,{name:"slide"},{default:withCtx(()=>[dn.value?(openBlock$1(),createElementBlock("div",_hoisted_30$2,[createBaseVNode("div",_hoisted_31$2,[Un[19]||(Un[19]=createBaseVNode("span",null,"",-1)),createBaseVNode("button",{class:"sr-btn sr-btn-icon",onClick:Un[7]||(Un[7]=or=>dn.value=null)},[...Un[18]||(Un[18]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconClose"})],-1)])])]),createBaseVNode("div",_hoisted_32$2,[createBaseVNode("img",{class:"sr-cover-large",src:dn.value.coverUrl||"/icons/book-placeholder.svg",onError:Un[8]||(Un[8]=or=>or.target.src="/icons/book-placeholder.svg")},null,40,_hoisted_33$2),createBaseVNode("h2",null,toDisplayString(dn.value.name),1),createBaseVNode("p",_hoisted_34$2,toDisplayString(dn.value.author),1),mn.value.length||dn.value.extension||dn.value.fileSize||dn.value.language||dn.value.year?(openBlock$1(),createElementBlock("div",_hoisted_35$2,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(mn.value,or=>(openBlock$1(),createElementBlock("span",{key:or},toDisplayString(or),1))),128)),dn.value.extension?(openBlock$1(),createElementBlock("span",_hoisted_36$2,toDisplayString(dn.value.extension),1)):createCommentVNode("",!0),dn.value.fileSize?(openBlock$1(),createElementBlock("span",_hoisted_37$2,toDisplayString(dn.value.fileSize),1)):createCommentVNode("",!0),dn.value.language?(openBlock$1(),createElementBlock("span",_hoisted_38$1,toDisplayString(dn.value.language),1)):createCommentVNode("",!0),dn.value.year?(openBlock$1(),createElementBlock("span",_hoisted_39$1,toDisplayString(dn.value.year),1)):createCommentVNode("",!0)])):createCommentVNode("",!0),dn.value.intro?(openBlock$1(),createElementBlock("p",_hoisted_40$1,toDisplayString(dn.value.intro),1)):createCommentVNode("",!0),un(dn.value)?(openBlock$1(),createElementBlock("div",_hoisted_41$1,[createBaseVNode("button",{class:"sr-btn sr-btn-primary",onClick:Un[9]||(Un[9]=or=>vn(dn.value.bookUrl))},[Un[20]||(Un[20]=createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconLink"})],-1)),createTextVNode(toDisplayString(an.i18n.openLink||""),1)])])):(openBlock$1(),createElementBlock("div",_hoisted_42$1,[createBaseVNode("button",{class:normalizeClass(["sr-btn sr-btn-primary",{active:cn(dn.value)}]),onClick:Un[10]||(Un[10]=or=>cn(dn.value)||Zn(dn.value))},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":cn(dn.value)?"#iconCheck":"#iconAdd"},null,8,_hoisted_43$1)])),createTextVNode(" "+toDisplayString(cn(dn.value)?"":""),1)],2),createBaseVNode("button",{class:"sr-btn sr-btn-primary",onClick:Un[11]||(Un[11]=or=>ln("read",dn.value))},[...Un[21]||(Un[21]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconRead"})],-1),createTextVNode(" ",-1)])])])),un(dn.value)?createCommentVNode("",!0):(openBlock$1(),createElementBlock("div",_hoisted_44$1,[createBaseVNode("div",_hoisted_45$1,[createBaseVNode("span",null," "+toDisplayString(hn.value.length),1),createBaseVNode("button",{class:"sr-btn sr-btn-icon",onClick:Un[12]||(Un[12]=or=>fn.value=!fn.value)},[...Un[22]||(Un[22]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconSort"})],-1)])])]),pn.value?(openBlock$1(),createElementBlock("div",_hoisted_46$1,"...")):hn.value.length?(openBlock$1(),createElementBlock("div",_hoisted_48$1,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(bn.value,(or,kr)=>(openBlock$1(),createElementBlock("div",{key:kr,class:"sr-chapter-item",onClick:Un[13]||(Un[13]=wr=>ln("read",dn.value))},toDisplayString(or.name||or.title||`${kr+1}`),1))),128))])):(openBlock$1(),createElementBlock("div",_hoisted_47$1,""))]))])])):createCommentVNode("",!0)]),_:1})])}}}),BookSearch=_export_sfc(_sfc_main$8,[["__scopeId","data-v-39664fc3"]]),isMobile=()=>siyuan.getFrontend().endsWith("mobile");let plugin$2=null;const initMobile=an=>{plugin$2=an,isMobile()&&window.addEventListener("popstate",()=>{window.dispatchEvent(new CustomEvent("reader:close"))})},saveMobilePosition=async(an,on)=>{if(!plugin$2||!isMobile())return;const sn=await plugin$2.loadData("positions")||{};sn[an]=on,await plugin$2.saveData("positions",sn)},getMobilePosition=async an=>!plugin$2||!isMobile()?null:(await plugin$2.loadData("positions")||{})[an],_hoisted_1$7={class:"sr-toolbar"},_hoisted_2$6=["placeholder"],_hoisted_3$6={key:0,class:"sr-select"},_hoisted_4$6=["aria-label"],_hoisted_5$6=["onClick"],_hoisted_6$6={class:"sr-select"},_hoisted_7$6=["aria-label"],_hoisted_8$6=["onClick"],_hoisted_9$6=["aria-label"],_hoisted_10$6=["aria-label"],_hoisted_11$6=["aria-label"],_hoisted_12$6={key:"empty",class:"sr-empty"},_hoisted_13$6=["enter"],_hoisted_14$5=["onClick"],_hoisted_15$5=["src","alt"],_hoisted_16$5={key:1,class:"sr-text-cover"},_hoisted_17$5={class:"sr-format-tag"},_hoisted_18$5={key:2,class:"sr-badge"},_hoisted_19$5=["onClick"],_hoisted_20$5=["title"],_hoisted_21$4={class:"sr-meta"},_hoisted_22$4={class:"sr-progress-info"},_hoisted_23$4={class:"sr-percent"},_hoisted_24$4={class:"sr-chapter"},_hoisted_25$2=["onClick"],_hoisted_26$2=["onClick","aria-label"],_sfc_main$7=defineComponent({__name:"Bookshelf",props:{i18n:{}},emits:["read"],setup(an,{emit:on}){const sn=on,ln=[{value:"time",label:""},{value:"added",label:""},{value:"progress",label:""},{value:"name",label:""},{value:"author",label:""},{value:"update",label:""}],cn={epub:"EPUB",pdf:"PDF",mobi:"MOBI",azw3:"AZW3",fb2:"FB2",cbz:"CBZ",txt:"TXT",online:""},un=["txt","pdf","mobi","azw3"],dn=ref([]),hn=ref(""),fn=ref(localStorage.getItem("sr-active-tag")||""),pn=ref(localStorage.getItem("sr-sort-type")||"time"),gn=ref(!1),mn=ref(!1),bn=ref(localStorage.getItem("sr-view-mode")||"grid"),vn=ref(null),yn=ref(),wn=new Map;watch(bn,Vn=>localStorage.setItem("sr-view-mode",Vn)),watch(fn,Vn=>localStorage.setItem("sr-active-tag",Vn)),watch(pn,Vn=>localStorage.setItem("sr-sort-type",Vn));const kn=computed(()=>["",...new Set(dn.value.map(Vn=>cn[Vn.format]||Vn.format.toUpperCase()))]),_n=computed(()=>{var Vn;return((Vn=ln.find(Sn=>Sn.value===pn.value))==null?void 0:Vn.label)??""}),xn=computed(()=>dn.value.filter(Vn=>fn.value===""||cn[Vn.format]===fn.value).filter(Vn=>!hn.value||[Vn.name,Vn.author].some(Sn=>Sn.toLowerCase().includes(hn.value.toLowerCase())))),En=Vn=>Vn.epubProgress??(Vn.totalChapterNum>0?Math.round((Vn.durChapterIndex+1)/Vn.totalChapterNum*100):0),Tn=Vn=>un.includes(Vn.format)||!Vn.coverUrl?"":Vn.coverUrl.startsWith("/data/")?(wn.has(Vn.coverUrl)||Bn(Vn.coverUrl),wn.get(Vn.coverUrl)||""):Vn.coverUrl,Bn=async Vn=>{try{const Sn=await fetch("/api/file/getFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:Vn})});if(!Sn.ok)throw new Error;wn.set(Vn,URL.createObjectURL(await Sn.blob())),dn.value=[...dn.value]}catch{wn.set(Vn,null)}},Nn=async Vn=>{var Hn;const Sn=await bookshelfManager.getBook(Vn.bookUrl);if(!Sn)return siyuan.showMessage("",3e3,"error");const Rn=Array.from(document.querySelectorAll(".layout-tab-bar .item")).find(Zn=>{var Qn;return(Zn.getAttribute("data-title")||((Qn=Zn.querySelector(".item__text"))==null?void 0:Qn.textContent))===Sn.name});if(Rn)return Rn.click();if(Sn.format==="online"&&Sn.origin&&!((Hn=Sn.chapters)!=null&&Hn.length))try{const Zn=await bookSourceManager.getBookInfo(Sn.origin,Sn.bookUrl),Qn=await bookSourceManager.getChapters(Sn.origin,Zn.tocUrl||Sn.bookUrl);Sn.chapters=Qn.map((Yn,tr)=>({index:tr,title:Yn.name,url:Yn.url})),await bookshelfManager.updateBook(Sn.bookUrl,{chapters:Sn.chapters,totalChapterNum:Qn.length})}catch(Zn){return console.error("[]",Zn),siyuan.showMessage("",3e3,"error")}isMobile()?window.dispatchEvent(new CustomEvent("reader:open",{detail:{book:Sn}})):sn("read",Sn)},Mn=async()=>{const Vn=await bookshelfManager.checkAllUpdates();On();const Sn=Vn.filter(Rn=>Rn.hasUpdate).length;siyuan.showMessage(Sn?`${Sn} `:"",2e3,"info")},Ln=async Vn=>{vn.value=null;try{await bookshelfManager.removeBook(Vn.bookUrl),await new Promise(Sn=>setTimeout(Sn,200)),On()}catch(Sn){siyuan.showMessage(Sn.message,3e3,"error")}},On=()=>dn.value=bookshelfManager.getBooks(),zn=async Vn=>{pn.value=Vn,Vn==="added"?dn.value.sort((Sn,Rn)=>Rn.addTime-Sn.addTime):Vn==="progress"?dn.value.sort((Sn,Rn)=>En(Rn)-En(Sn)):(await bookshelfManager.sortBooks(Vn),On())},Pn=()=>bn.value=["grid","list","compact"][(["grid","list","compact"].indexOf(bn.value)+1)%3],An=async Vn=>{const Sn=Array.from(Vn.target.files||[]);if(!Sn.length)return;const Rn=await Promise.allSettled(Sn.map(Qn=>bookshelfManager.addLocalBook(Qn))),[Hn,Zn]=[Rn.filter(Qn=>Qn.status==="fulfilled").length,Rn.filter(Qn=>Qn.status==="rejected").length];await bookshelfManager.init(!0),On(),siyuan.showMessage(Zn===0?` ${Hn} `:Hn===0?"":` ${Hn}  ${Zn} `,Zn?3e3:2e3,Zn&&!Hn?"error":"info"),yn.value&&(yn.value.value="")};return onMounted(async()=>{await bookshelfManager.init(),On(),window.addEventListener("sireader:bookshelf-updated",On)}),onUnmounted(()=>window.removeEventListener("sireader:bookshelf-updated",On)),(Vn,Sn)=>{const Rn=resolveDirective("motion");return openBlock$1(),createElementBlock("div",{class:"sr-bookshelf fn__flex-1 fn__flex-column b3-scroll",onClick:Sn[8]||(Sn[8]=Hn=>gn.value=mn.value=!1)},[createBaseVNode("div",_hoisted_1$7,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Sn[0]||(Sn[0]=Hn=>hn.value=Hn),placeholder:an.i18n.searchPlaceholder||"..."},null,8,_hoisted_2$6),[[vModelText,hn.value]]),kn.value.length>1?(openBlock$1(),createElementBlock("div",_hoisted_3$6,[createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Sn[1]||(Sn[1]=withModifiers(Hn=>gn.value=!gn.value,["stop"])),"aria-label":fn.value},[...Sn[9]||(Sn[9]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-sliders-horizontal"})],-1)])],8,_hoisted_4$6),gn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-menu",onClick:Sn[2]||(Sn[2]=withModifiers(()=>{},["stop"]))},[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(kn.value,Hn=>(openBlock$1(),createElementBlock("div",{key:Hn,class:normalizeClass(["sr-menu-item",{active:fn.value===Hn}]),onClick:Zn=>{fn.value=Hn,gn.value=!1}},toDisplayString(Hn),11,_hoisted_5$6))),128))])):createCommentVNode("",!0)])):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6$6,[createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Sn[3]||(Sn[3]=withModifiers(Hn=>mn.value=!mn.value,["stop"])),"aria-label":_n.value},[...Sn[10]||(Sn[10]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-clock-plus"})],-1)])],8,_hoisted_7$6),mn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-menu",onClick:Sn[4]||(Sn[4]=withModifiers(()=>{},["stop"]))},[(openBlock$1(),createElementBlock(Fragment,null,renderList(ln,Hn=>createBaseVNode("div",{key:Hn.value,class:normalizeClass(["sr-menu-item",{active:pn.value===Hn.value}]),onClick:Zn=>{zn(Hn.value),mn.value=!1}},toDisplayString(Hn.label),11,_hoisted_8$6)),64))])):createCommentVNode("",!0)]),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Pn,"aria-label":bn.value==="grid"?"":bn.value==="list"?"":""},[...Sn[11]||(Sn[11]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-panels-top-left"})],-1)])],8,_hoisted_9$6),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Mn,"aria-label":an.i18n.checkUpdate||""},[...Sn[12]||(Sn[12]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-list-restart"})],-1)])],8,_hoisted_10$6),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__s",onClick:Sn[5]||(Sn[5]=Hn=>{var Zn;return(Zn=yn.value)==null?void 0:Zn.click()}),"aria-label":an.i18n.addBook||""},[...Sn[13]||(Sn[13]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-book-plus"})],-1)])],8,_hoisted_11$6)]),createBaseVNode("input",{ref_key:"fileInput",ref:yn,type:"file",accept:".epub,.pdf,.mobi,.azw3,.azw,.fb2,.cbz,.txt",multiple:"",style:{display:"none"},onChange:An},null,544),createBaseVNode("div",{class:normalizeClass(["sr-books",bn.value])},[createVNode(Transition,{name:"fade",mode:"out-in"},{default:withCtx(()=>[xn.value.length?(openBlock$1(),createElementBlock("div",{key:"books",class:normalizeClass(`sr-${bn.value}`)},[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(xn.value,Hn=>withDirectives((openBlock$1(),createElementBlock("div",{key:Hn.bookUrl,initial:{opacity:0,y:20},enter:{opacity:1,y:0,transition:{delay:xn.value.indexOf(Hn)*20}},leave:{opacity:0,scale:.8,transition:{duration:200}},class:"sr-card"},[bn.value!=="compact"?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-cover-wrap",onClick:Zn=>Nn(Hn)},[Tn(Hn)?(openBlock$1(),createElementBlock("img",{key:0,src:Tn(Hn),class:"sr-cover",alt:Hn.name},null,8,_hoisted_15$5)):(openBlock$1(),createElementBlock("div",_hoisted_16$5,toDisplayString(Hn.name),1)),createBaseVNode("div",_hoisted_17$5,toDisplayString(Hn.format.toUpperCase()),1),Hn.lastCheckCount>0?(openBlock$1(),createElementBlock("div",_hoisted_18$5,toDisplayString(Hn.lastCheckCount),1)):createCommentVNode("",!0),createBaseVNode("div",{class:"sr-progress",style:normalizeStyle({width:En(Hn)+"%"})},null,4)],8,_hoisted_14$5)):createCommentVNode("",!0),createBaseVNode("div",{class:"sr-info",onClick:Zn=>Nn(Hn)},[createBaseVNode("div",{class:"sr-title",title:Hn.name},toDisplayString(Hn.name),9,_hoisted_20$5),createBaseVNode("div",_hoisted_21$4,toDisplayString(Hn.author),1),createBaseVNode("div",_hoisted_22$4,[createBaseVNode("span",_hoisted_23$4,toDisplayString(En(Hn))+"%",1),createBaseVNode("span",_hoisted_24$4,toDisplayString(Hn.durChapterIndex+1)+"/"+toDisplayString(Hn.totalChapterNum),1)])],8,_hoisted_19$5),createVNode(Transition,{name:"confirm"},{default:withCtx(()=>[vn.value===Hn.bookUrl?withDirectives((openBlock$1(),createElementBlock("div",{key:0,initial:{opacity:0,scale:.9},enter:{opacity:1,scale:1},class:"sr-remove-confirm",onClick:Sn[7]||(Sn[7]=withModifiers(()=>{},["stop"]))},[createBaseVNode("button",{class:"sr-btn-cancel",onClick:Sn[6]||(Sn[6]=Zn=>vn.value=null)},""),createBaseVNode("button",{class:"sr-btn-confirm",onClick:Zn=>Ln(Hn)},"",8,_hoisted_25$2)])),[[Rn]]):createCommentVNode("",!0)]),_:2},1024),vn.value!==Hn.bookUrl?(openBlock$1(),createElementBlock("button",{key:1,class:"sr-btn-remove",onClick:withModifiers(Zn=>vn.value=Hn.bookUrl,["stop"]),"aria-label":an.i18n.remove||""},[...Sn[14]||(Sn[14]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_26$2)):createCommentVNode("",!0)],8,_hoisted_13$6)),[[Rn]])),128))],2)):(openBlock$1(),createElementBlock("div",_hoisted_12$6,toDisplayString(hn.value?an.i18n.noResults||"":an.i18n.emptyShelf||""),1))]),_:1})],2)])}}}),Bookshelf=_export_sfc(_sfc_main$7,[["__scopeId","data-v-6ad8dd55"]]),createSVGElement$1=an=>document.createElementNS("http://www.w3.org/2000/svg",an);var Oo,Fo,Pi,Ss,Da,Ra;class Overlayer{constructor(on){pr(this,Ss);pr(this,Oo,createSVGElement$1("svg"));pr(this,Fo,new Map);pr(this,Pi,null);yr(this,Pi,on),Object.assign($n(this,Oo).style,{position:"absolute",top:"0",left:"0",width:"100%",height:"100%",pointerEvents:"none"})}get element(){return $n(this,Oo)}add(on,sn,ln,cn){$n(this,Fo).has(on)&&this.remove(on),typeof sn=="function"&&(sn=sn($n(this,Oo).getRootNode()));const un=$n(this,Ss,Da);let dn=[];dr(this,Ss,Ra).call(this,sn).forEach(fn=>{const pn=Array.from(fn.getClientRects()).map(gn=>({left:gn.left*un,top:gn.top*un,right:gn.right*un,bottom:gn.bottom*un,width:gn.width*un,height:gn.height*un}));dn=dn.concat(pn)});const hn=ln(dn,cn);$n(this,Oo).append(hn),$n(this,Fo).set(on,{range:sn,draw:ln,options:cn,element:hn,rects:dn})}remove(on){$n(this,Fo).has(on)&&($n(this,Oo).removeChild($n(this,Fo).get(on).element),$n(this,Fo).delete(on))}redraw(){for(const on of $n(this,Fo).values()){const{range:sn,draw:ln,options:cn,element:un}=on;$n(this,Oo).removeChild(un);const dn=$n(this,Ss,Da);let hn=[];dr(this,Ss,Ra).call(this,sn).forEach(pn=>{const gn=Array.from(pn.getClientRects()).map(mn=>({left:mn.left*dn,top:mn.top*dn,right:mn.right*dn,bottom:mn.bottom*dn,width:mn.width*dn,height:mn.height*dn}));hn=hn.concat(gn)});const fn=ln(hn,cn);$n(this,Oo).append(fn),on.element=fn,on.rects=hn}}hitTest({x:on,y:sn}){const ln=Array.from($n(this,Fo).entries());for(let cn=ln.length-1;cn>=0;cn--){const[un,dn]=ln[cn];for(const{left:hn,top:fn,right:pn,bottom:gn}of dn.rects)if(fn<=sn&&hn<=on&&gn>sn&&pn>on)return[un,dn.range]}return[]}static underline(on,sn={}){const{color:ln="red",width:cn=2,padding:un=0,writingMode:dn}=sn,hn=createSVGElement$1("g");if(hn.setAttribute("fill",ln),dn==="vertical-rl"||dn==="vertical-lr")for(const{right:fn,top:pn,height:gn}of on){const mn=createSVGElement$1("rect");mn.setAttribute("x",fn-cn/2+un),mn.setAttribute("y",pn),mn.setAttribute("height",gn),mn.setAttribute("width",cn),hn.append(mn)}else for(const{left:fn,bottom:pn,width:gn}of on){const mn=createSVGElement$1("rect");mn.setAttribute("x",fn),mn.setAttribute("y",pn-cn/2+un),mn.setAttribute("height",cn),mn.setAttribute("width",gn),hn.append(mn)}return hn}static strikethrough(on,sn={}){const{color:ln="red",width:cn=2,writingMode:un}=sn,dn=createSVGElement$1("g");if(dn.setAttribute("fill",ln),un==="vertical-rl"||un==="vertical-lr")for(const{right:hn,left:fn,top:pn,height:gn}of on){const mn=createSVGElement$1("rect");mn.setAttribute("x",(hn+fn)/2),mn.setAttribute("y",pn),mn.setAttribute("height",gn),mn.setAttribute("width",cn),dn.append(mn)}else for(const{left:hn,top:fn,bottom:pn,width:gn}of on){const mn=createSVGElement$1("rect");mn.setAttribute("x",hn),mn.setAttribute("y",(fn+pn)/2),mn.setAttribute("height",cn),mn.setAttribute("width",gn),dn.append(mn)}return dn}static squiggly(on,sn={}){const{color:ln="red",width:cn=2,padding:un=0,writingMode:dn}=sn,hn=createSVGElement$1("g");hn.setAttribute("fill","none"),hn.setAttribute("stroke",ln),hn.setAttribute("stroke-width",cn);const fn=cn*1.5;if(dn==="vertical-rl"||dn==="vertical-lr")for(const{right:pn,top:gn,height:mn}of on){const bn=createSVGElement$1("path"),vn=Math.round(mn/fn/1.5),yn=mn/vn,wn=Array.from({length:vn},(kn,_n)=>`l${_n%2?-fn:fn} ${yn}`).join("");bn.setAttribute("d",`M${pn-cn/2+un} ${gn}${wn}`),hn.append(bn)}else for(const{left:pn,bottom:gn,width:mn}of on){const bn=createSVGElement$1("path"),vn=Math.round(mn/fn/1.5),yn=mn/vn,wn=Array.from({length:vn},(kn,_n)=>`l${yn} ${_n%2?fn:-fn}`).join("");bn.setAttribute("d",`M${pn} ${gn+cn/2+un}${wn}`),hn.append(bn)}return hn}static highlight(on,sn={}){const{color:ln="red",padding:cn=0}=sn,un=createSVGElement$1("g");un.setAttribute("fill",ln),un.style.opacity="var(--overlayer-highlight-opacity, .3)",un.style.mixBlendMode="var(--overlayer-highlight-blend-mode, normal)";for(const{left:dn,top:hn,height:fn,width:pn}of on){const gn=createSVGElement$1("rect");gn.setAttribute("x",dn-cn),gn.setAttribute("y",hn-cn),gn.setAttribute("height",fn+cn*2),gn.setAttribute("width",pn+cn*2),un.append(gn)}return un}static outline(on,sn={}){const{color:ln="red",width:cn=3,padding:un=0,radius:dn=3}=sn,hn=createSVGElement$1("g");hn.setAttribute("fill","none"),hn.setAttribute("stroke",ln),hn.setAttribute("stroke-width",cn);for(const{left:fn,top:pn,height:gn,width:mn}of on){const bn=createSVGElement$1("rect");bn.setAttribute("x",fn-un),bn.setAttribute("y",pn-un),bn.setAttribute("height",gn+un*2),bn.setAttribute("width",mn+un*2),bn.setAttribute("rx",dn),hn.append(bn)}return hn}static copyImage([on],sn={}){const{src:ln}=sn,cn=createSVGElement$1("image"),{left:un,top:dn,height:hn,width:fn}=on;return cn.setAttribute("href",ln),cn.setAttribute("x",un),cn.setAttribute("y",dn),cn.setAttribute("height",hn),cn.setAttribute("width",fn),cn}}Oo=new WeakMap,Fo=new WeakMap,Pi=new WeakMap,Ss=new WeakSet,Da=function(){return/^((?!chrome|android).)*AppleWebKit/i.test(navigator.userAgent)&&!window.chrome&&window.getComputedStyle($n(this,Pi).body).zoom||1},Ra=function(on){var un;const sn=on.commonAncestorContainer,ln=Array.from(((un=sn.querySelectorAll)==null?void 0:un.call(sn,"p"))||[]);if(ln.length===0)return[on];const cn=[];return ln.forEach(dn=>{const hn=document.createRange();on.intersectsNode(dn)&&(hn.selectNodeContents(dn),hn.compareBoundaryPoints(Range.START_TO_START,on)<0&&hn.setStart(on.startContainer,on.startOffset),hn.compareBoundaryPoints(Range.END_TO_END,on)>0&&hn.setEnd(on.endContainer,on.endOffset),cn.push(hn))}),cn};const COLORS=[{name:"",color:"yellow",bg:"#ffeb3b"},{name:"",color:"red",bg:"#ef5350"},{name:"",color:"green",bg:"#66bb6a"},{name:"",color:"blue",bg:"#42a5f5"},{name:"",color:"purple",bg:"#ab47bc"},{name:"",color:"orange",bg:"#ff9800"},{name:"",color:"pink",bg:"#ec407a"}],STYLES=[{type:"highlight",name:"",text:"A"},{type:"underline",name:"",text:"A"},{type:"outline",name:"",text:"A"},{type:"dotted",name:"",text:"A",pdfOnly:!0},{type:"dashed",name:"",text:"A",pdfOnly:!0},{type:"double",name:"",text:"A",pdfOnly:!0},{type:"squiggly",name:"",text:"A",epubOnly:!0}],getColorMap=()=>Object.fromEntries(COLORS.map(an=>[an.color,an.bg])),formatTime=an=>{const on=new Date(an);return`${on.getFullYear()}-${(on.getMonth()+1).toString().padStart(2,"0")}-${on.getDate().toString().padStart(2,"0")}`},getNoteIcon=an=>an==="purple"?"":"",getNoteColor=an=>an==="purple"?"#ab47bc":"#2196f3",getColorBg=an=>{var on;return((on=COLORS.find(sn=>sn.color===an))==null?void 0:on.bg)||"#ffeb3b"},cleanTooltips=an=>document.querySelectorAll(`[data-note-tooltip][data-mark-id="${an}"]`).forEach(on=>on.remove()),createTooltip=an=>{const{icon:on,iconColor:sn,title:ln,content:cn,id:un}=an;return`<div style="display:flex;align-items:center;gap:8px;padding:12px 14px;border-left:4px solid ${sn};background:linear-gradient(135deg,var(--b3-theme-surface) 0%,var(--b3-theme-background-light) 100%)"><svg style="width:16px;height:16px;color:${sn};flex-shrink:0;filter:drop-shadow(0 1px 2px ${sn}4d)"><use xlink:href="${on}"/></svg><span style="font-size:13px;font-weight:600;color:var(--b3-theme-on-surface);text-shadow:0 1px 2px rgba(0,0,0,.05)">${ln}</span>${un?`<span style="font-size:10px;color:var(--b3-theme-on-surface-variant);margin-left:auto;opacity:0.6;font-weight:400">${un}</span>`:""}</div>`+cn},showTooltip=(an,on,sn)=>{Object.assign(an.style,{opacity:"0",transform:"translateY(-8px)",display:"block",left:on+"px",top:sn+"px"}),requestAnimationFrame(()=>{const{width:ln,height:cn}=an.getBoundingClientRect();Object.assign(an.style,{left:Math.max(10,Math.min(window.innerWidth-ln-10,on))+"px",top:Math.max(10,Math.min(window.innerHeight-cn-10,sn))+"px",opacity:"1",transform:"translateY(0)"})})},hideTooltip=(an,on=200)=>{an.style.opacity="0",an.style.transform="translateY(-8px)",setTimeout(()=>an.style.display="none",on)},formatAuthor=an=>Array.isArray(an)?an.map(on=>typeof on=="string"?on:on==null?void 0:on.name).filter(Boolean).join(", "):typeof an=="string"?an:(an==null?void 0:an.name)||"",getChapterName=an=>{var dn,hn;const{cfi:on,page:sn,isPdf:ln,toc:cn,location:un}=an;if(on&&((dn=un==null?void 0:un.tocItem)!=null&&dn.label||(hn=un==null?void 0:un.tocItem)!=null&&hn.title))return un.tocItem.label||un.tocItem.title;if(ln&&sn&&cn){for(let fn=cn.length-1;fn>=0;fn--)if(cn[fn].pageNumber&&cn[fn].pageNumber<=sn)return cn[fn].label}return""};class MarkManager{constructor(on){ir(this,"format");ir(this,"view");ir(this,"bookUrl");ir(this,"marks",[]);ir(this,"marksMap",new Map);ir(this,"saveTimer");ir(this,"autoSaveTimer");ir(this,"currentPage",1);ir(this,"currentProgress",0);ir(this,"onAnnotationClick");ir(this,"pdfViewer");ir(this,"reader");ir(this,"initialized",!1);ir(this,"getBookmarks",()=>this.marks.filter(on=>on.type==="bookmark").sort((on,sn)=>(on.progress||0)-(sn.progress||0)));ir(this,"getAnnotations",on=>{const sn=this.marks.filter(ln=>ln.type==="highlight"||ln.type==="note");return on?sn.filter(ln=>ln.color===on):sn});ir(this,"getNotes",()=>this.marks.filter(on=>on.type==="note"));ir(this,"getAll",()=>[...this.marks]);ir(this,"getInkAnnotations",()=>{var on,sn;return((sn=(on=this.getManager("ink"))==null?void 0:on.toJSON)==null?void 0:sn.call(on))||[]});ir(this,"getShapeAnnotations",()=>{var on,sn;return((sn=(on=this.getManager("shape"))==null?void 0:on.toJSON)==null?void 0:sn.call(on))||[]});ir(this,"setCurrentPage",on=>{this.currentPage=on,this.save()});this.format=on.format,this.view=on.view,this.bookUrl=on.bookUrl,this.onAnnotationClick=on.onAnnotationClick,this.pdfViewer=on.pdfViewer,this.reader=on.reader,this.view&&this.setupListeners(),this.startAutoSave()}async init(){await this.load(),this.initialized=!0,this.format!=="pdf"&&await this.loadCalibre(),await this.loadDeck(),window.addEventListener("sireader:deck-updated",()=>this.loadDeck()),document.addEventListener("visibilitychange",()=>{document.hidden&&this.updateProgress()})}async restoreProgress(on){var sn,ln;if(on)if(this.format==="pdf"&&this.pdfViewer){const cn=on.durChapterIndex||0,un=this.pdfViewer.getPageCount();if(cn>=1&&cn<=un)this.pdfViewer.goToPage(cn);else if((sn=on.epubCfi)!=null&&sn.startsWith("#page-")){const dn=parseInt(on.epubCfi.replace("#page-",""));dn>=1&&dn<=un&&this.pdfViewer.goToPage(dn)}}else this.reader?on.epubCfi?await this.reader.goTo(on.epubCfi):on.durChapterIndex!==void 0&&await this.reader.goTo(on.durChapterIndex):(ln=this.view)!=null&&ln.goTo&&on.durChapterIndex!==void 0&&await this.view.goTo(on.durChapterIndex)}async load(){try{const on=await loadBookData(this.bookUrl);if(!on||!Object.keys(on).length)return;this.marks=[];const sn=(ln,cn)=>{for(const un of ln||[])this.marks.some(dn=>dn.type==="bookmark"&&dn.cfi===un.cfi&&dn.page===un.page&&dn.section===un.section)||this.add({type:"bookmark",format:cn,cfi:un.cfi,section:un.section,page:un.page,title:un.title,timestamp:un.time||Date.now(),progress:un.progress})};sn(on.epubBookmarks,"epub"),sn(on.txtBookmarks,"txt"),this.format==="pdf"&&on.annotations?on.annotations.forEach(ln=>this.add({id:ln.id,type:ln.note?"note":"highlight",format:"pdf",page:ln.page,rects:ln.rects,text:ln.text,color:ln.color,style:ln.style,note:ln.note,timestamp:ln.timestamp||Date.now(),blockId:ln.blockId,chapter:ln.chapter})):on.annotations&&on.annotations.forEach(ln=>this.add({id:ln.id,type:ln.note?"note":"highlight",format:this.format,cfi:ln.cfi||ln.value,section:ln.section,text:ln.text,color:ln.color,style:ln.style,note:ln.note,timestamp:ln.timestamp||Date.now(),blockId:ln.blockId,chapter:ln.chapter})),on.durChapterIndex&&(this.currentPage=on.durChapterIndex)}catch(on){console.error("[Mark]",on)}}save(){clearTimeout(this.saveTimer),this.saveTimer=setTimeout(()=>this.saveNow(),300)}startAutoSave(){this.autoSaveTimer=setInterval(()=>{this.updateProgress()},3e4)}async saveNow(){if(this.initialized)try{const on=this.marks.filter(pn=>pn.type==="bookmark"),sn=this.marks.filter(pn=>pn.type==="highlight"||pn.type==="note"||pn.type==="vocab"),ln=this.getInkAnnotations(),cn=this.getShapeAnnotations(),un=sn.length+ln.length+cn.length;console.log(`[Mark] ${un}`);const dn={annotations:this.format==="pdf"?sn.map(pn=>({id:pn.id,page:pn.page,type:pn.type,rects:pn.rects,text:pn.text,color:pn.color,style:pn.style,note:pn.note,timestamp:pn.timestamp,blockId:pn.blockId,chapter:pn.chapter})):sn.map(pn=>({id:pn.id,value:pn.cfi,cfi:pn.cfi,section:pn.section,text:pn.text,color:pn.color,style:pn.style,note:pn.note,timestamp:pn.timestamp,blockId:pn.blockId,chapter:pn.chapter})),durChapterIndex:this.currentPage,epubProgress:this.currentProgress},hn=on.filter(pn=>pn.cfi),fn=on.filter(pn=>pn.section!==void 0);hn.length&&(dn.epubBookmarks=hn.map(pn=>({cfi:pn.cfi,title:pn.title,progress:pn.progress,time:pn.timestamp}))),fn.length&&(dn.txtBookmarks=fn.map(pn=>({section:pn.section,page:pn.page,title:pn.title,progress:pn.progress,time:pn.timestamp}))),await saveBookData(this.bookUrl,dn),window.dispatchEvent(new Event("sireader:marks-updated"))}catch(on){console.error("[Mark]",on)}}add(on){var ln,cn,un,dn,hn,fn;const sn={id:on.id||`${on.type}-${Date.now()}-${Math.random().toString(36).slice(2,9)}`,format:this.format,type:on.type,timestamp:Date.now(),...on};if(!sn.chapter&&sn.type!=="bookmark"){const pn=this.format==="pdf"?null:(ln=this.view)==null?void 0:ln.lastLocation;if(sn.chapter=((cn=pn==null?void 0:pn.tocItem)==null?void 0:cn.label)||((un=pn==null?void 0:pn.tocItem)==null?void 0:un.title)||"",!sn.chapter&&this.format==="pdf"&&sn.page){const gn=(fn=(hn=(dn=this.pdfViewer)==null?void 0:dn.getPDF)==null?void 0:hn.call(dn))==null?void 0:fn.toc;if(gn){for(let mn=gn.length-1;mn>=0;mn--)if(gn[mn].pageNumber<=sn.page){sn.chapter=gn[mn].label||gn[mn].title;break}}sn.chapter||(sn.chapter=`${sn.page}`)}}return this.marks.push(sn),this.marksMap.set(sn.id,sn),sn}del(on){const sn=this.marks.findIndex(ln=>ln.id===on);return sn<0?!1:(this.marks.splice(sn,1),this.marksMap.delete(on),!0)}async loadCalibre(){var on,sn,ln,cn;try{const un=await((ln=(sn=(on=this.view)==null?void 0:on.book)==null?void 0:sn.getCalibreBookmarks)==null?void 0:ln.call(sn));if(!un)return;for(const dn of un){const hn=this.marks.find(fn=>fn.type==="bookmark"&&fn.cfi===dn.start_cfi);if(dn.type==="bookmark"&&dn.start_cfi&&!hn)this.add({type:"bookmark",format:"epub",cfi:dn.start_cfi,title:dn.title||dn.notes||""});else if(dn.type==="highlight"){const{fromCalibreHighlight:fn}=await Promise.resolve().then(()=>epubcfi),pn=fn(dn);this.marks.find(mn=>mn.cfi===pn)||this.add({type:dn.notes?"note":"highlight",format:"epub",cfi:pn,color:((cn=dn.style)==null?void 0:cn.which)||"yellow",note:dn.notes})}}this.save()}catch(un){console.error("[Mark]",un)}}async loadDeck(){var on,sn,ln;try{const{loadDeckCards:cn}=await Promise.resolve().then(()=>dictionary),un=(await cn()).filter(dn=>dn.bookUrl===this.bookUrl);this.marks.filter(dn=>dn.type==="vocab").forEach(dn=>this.del(String(dn.cfi||dn.page||`s${dn.section}`)));for(const dn of un){const hn=`${dn.word}
${dn.data.phonetic?`/${dn.data.phonetic}/`:""}
${((on=dn.data.meanings)==null?void 0:on.map(pn=>`${pn.pos} ${pn.text}`).join(`
`))||""}`,fn=this.add({type:"vocab",format:this.format,cfi:dn.cfi,section:dn.section,page:dn.page,rects:dn.rects,text:dn.word,note:hn.trim(),color:"purple",style:"highlight",timestamp:dn.timestamp});this.format==="pdf"?this.renderPdf(fn.page):this.format==="txt"?this.refreshTxt():fn.cfi&&await((ln=(sn=this.view)==null?void 0:sn.addAnnotation)==null?void 0:ln.call(sn,{value:fn.cfi,color:"purple",note:fn.note}).catch(()=>{}))}this.save(),window.dispatchEvent(new Event("sireader:marks-updated"))}catch(cn){console.error("[Mark]",cn)}}setupListeners(){this.format!=="pdf"&&(this.view.addEventListener("create-overlay",(on=>{const{index:sn}=on.detail;this.marks.forEach(ln=>{if(ln.type!=="bookmark"&&ln.cfi)try{this.view.resolveCFI(ln.cfi).index===sn&&this.view.addAnnotation({value:ln.cfi,color:ln.color,note:ln.note}).catch(()=>{})}catch{}})})),this.view.addEventListener("draw-annotation",(on=>{const{draw:sn,annotation:ln,range:cn}=on.detail,un=this.marks.find(vn=>vn.cfi===ln.value),dn=getColorBg(un==null?void 0:un.color),hn=(un==null?void 0:un.style)||"highlight",pn={dotted:"underline",dashed:"underline",double:"underline"}[hn]||hn,gn={underline:[Overlayer.underline,{color:dn,width:2}],outline:[Overlayer.outline,{color:dn,width:3}],squiggly:[Overlayer.squiggly,{color:dn,width:2}],highlight:[Overlayer.highlight,{color:dn}]},[mn,bn]=gn[pn]||gn.highlight;sn(mn,bn),un!=null&&un.note&&cn&&this.renderNote(cn,un)})))}renderNote(on,sn){var ln,cn;try{const un=on.startContainer.ownerDocument;if(un.querySelector(`[data-note-marker][data-mark-id="${sn.id}"]`))return;const dn=getNoteIcon(sn.color),hn=getNoteColor(sn.color),fn=sn.color==="purple",pn=un.createElement("span");pn.setAttribute("data-note-marker","true"),fn&&pn.setAttribute("data-vocab","true"),pn.setAttribute("data-mark-id",sn.id),pn.textContent=dn,pn.style.cssText="position:relative;top:-0.5em;font-size:1.1em;margin-left:3px;cursor:pointer;user-select:none;opacity:0.85",cleanTooltips(sn.id);const gn=window.document.createElement("div");gn.setAttribute("data-note-tooltip","true"),fn&&gn.setAttribute("data-vocab","true"),gn.setAttribute("data-mark-id",sn.id),gn.style.cssText="position:fixed;display:none;width:340px;background:var(--b3-theme-surface);border:1px solid var(--b3-border-color);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.12),0 4px 8px rgba(0,0,0,.08),0 0 1px rgba(0,0,0,.1);z-index:99999;pointer-events:auto;overflow:hidden;backdrop-filter:blur(10px);transform:translateY(0);transition:transform .2s cubic-bezier(.4,0,.2,1),opacity .2s cubic-bezier(.4,0,.2,1)";const mn=xn=>xn.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/\n/g,"<br>"),bn=sn.text?`<div style="padding:8px 14px;background:var(--b3-theme-background-light);border-bottom:1px solid var(--b3-border-color);font-size:12px;color:var(--b3-theme-on-surface-variant);font-style:italic;line-height:1.5">"${mn(sn.text)}"</div>`:"",vn=`<div style="padding:14px;font-size:13px;line-height:1.7;color:var(--b3-theme-on-surface);max-height:300px;overflow-y:auto;word-wrap:break-word;word-break:break-word;background:var(--b3-theme-surface)">${mn(sn.note||"")}</div>`,yn=new Date(sn.timestamp).toLocaleString("zh-CN",{month:"numeric",day:"numeric",hour:"2-digit",minute:"2-digit"});gn.innerHTML=createTooltip({icon:fn?"#iconLanguage":"#iconEdit",iconColor:hn,title:fn?"":"",content:bn+vn,id:yn}),window.document.body.appendChild(gn);let wn;pn.onmouseenter=()=>{var Bn;clearTimeout(wn),pn.style.opacity="1";const xn=pn.getBoundingClientRect(),En=(Bn=un.defaultView)==null?void 0:Bn.frameElement,Tn=En==null?void 0:En.getBoundingClientRect();showTooltip(gn,((Tn==null?void 0:Tn.left)||0)+xn.left,((Tn==null?void 0:Tn.top)||0)+xn.bottom+8)},pn.onmouseleave=()=>{wn=setTimeout(()=>{pn.style.opacity="0.85",hideTooltip(gn)},100)},gn.onmouseenter=()=>clearTimeout(wn),gn.onmouseleave=()=>{pn.style.opacity="0.85",hideTooltip(gn)};const kn=on.endContainer,_n=on.endOffset;if(kn.nodeType===3){const xn=kn;_n===xn.length?(ln=xn.parentNode)==null||ln.insertBefore(pn,xn.nextSibling):(cn=xn.parentNode)==null||cn.insertBefore(pn,xn.splitText(_n))}else{const xn=kn.childNodes[_n];xn?kn.insertBefore(pn,xn):kn.appendChild(pn)}}catch(un){console.error("[Mark]",un)}}createNoteMarker(on,sn,ln){if(ln.querySelector(`[data-note-marker][data-mark-id="${on.id}"]`))return;const cn=getColorBg(on.color),un=document.createElement("span");un.setAttribute("data-note-marker","true"),un.setAttribute("data-mark-id",on.id),un.textContent=getNoteIcon(on.color),un.style.cssText=`position:absolute;left:${sn.x+sn.w+3}px;top:${sn.y-5}px;font-size:14px;cursor:pointer;user-select:none;opacity:0.85;transition:opacity .2s;pointer-events:auto;z-index:12`,cleanTooltips(on.id);const dn=document.createElement("div");dn.setAttribute("data-note-tooltip","true"),dn.setAttribute("data-mark-id",on.id),dn.style.cssText="position:fixed;display:none;min-width:280px;max-width:420px;background:var(--b3-theme-surface);border:1px solid var(--b3-border-color);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.12),0 4px 16px rgba(0,0,0,.08),0 2px 8px rgba(0,0,0,.04);z-index:99999;overflow:hidden;backdrop-filter:blur(8px);word-wrap:break-word",dn.innerHTML=createTooltip({icon:on.type==="vocab"?"#iconLanguage":"#iconEdit",iconColor:cn,title:on.type==="vocab"?"":"",content:`<div style="padding:14px;font-size:13px;line-height:1.7;color:var(--b3-theme-on-surface);max-height:300px;overflow-y:auto;word-wrap:break-word;word-break:break-word;background:var(--b3-theme-surface)">${on.note.split(`
`).map(fn=>fn.trim()).filter(Boolean).join("<br>")}</div>`}),document.body.appendChild(dn);let hn;un.onmouseenter=()=>{clearTimeout(hn),un.style.opacity="1",showTooltip(dn,un.getBoundingClientRect().left,un.getBoundingClientRect().bottom+8)},un.onmouseleave=()=>{hn=setTimeout(()=>{un.style.opacity="0.85",hideTooltip(dn)},100)},dn.onmouseenter=()=>clearTimeout(hn),dn.onmouseleave=()=>{hn=setTimeout(()=>hideTooltip(dn),100)},un.onclick=()=>{var fn;return(fn=this.onAnnotationClick)==null?void 0:fn.call(this,on)},ln.appendChild(un)}renderPdf(on){if(this.format!=="pdf"||!this.pdfViewer)return;const sn=document.querySelector(`[data-page="${on}"] .pdf-annotation-layer`);if(!sn)return;sn.querySelectorAll("[data-note-marker],.pdf-highlight").forEach(un=>un.remove()),this.marks.filter(un=>un.page===on).forEach(un=>cleanTooltips(un.id));const ln=this.pdfViewer.getPages().get(on);if(!ln)return;const cn=ln.getViewport({scale:this.pdfViewer.getScale(),rotation:this.pdfViewer.getRotation()});this.marks.filter(un=>un.page===on&&(un.type==="highlight"||un.type==="note"||un.type==="vocab")).forEach(un=>{var fn;const dn=getColorBg(un.color),hn=un.style||"highlight";(fn=un.rects)==null||fn.forEach((pn,gn)=>{const mn=cn.convertToViewportRectangle([pn.x,pn.y,pn.x+pn.w,pn.y+pn.h]),bn=Math.abs(mn[0]-mn[2]),vn=Math.abs(mn[1]-mn[3]);if(bn<=0||vn<=0)return;const yn=Math.min(mn[0],mn[2]),wn=Math.min(mn[1],mn[3]),kn=document.createElement("div"),_n=`position:absolute;left:${yn}px;top:${wn}px;width:${bn}px;height:${vn}px;pointer-events:auto;cursor:pointer`;kn.className=`pdf-highlight pdf-${hn}`,kn.dataset.id=un.id;const xn=hn==="double"?"4px":"2px";kn.style.cssText=hn==="highlight"?`${_n};background:${dn};opacity:0.3`:hn==="underline"?`${_n};border-bottom:2px solid ${dn};opacity:0.8`:hn==="outline"?`${_n};border:2px solid ${dn};opacity:0.8`:`${_n};border-bottom:${xn} ${hn} ${dn};opacity:0.8`,kn.onclick=()=>{var En;return(En=this.onAnnotationClick)==null?void 0:En.call(this,un)},sn.appendChild(kn),un.note&&gn===un.rects.length-1&&this.createNoteMarker(un,{x:yn,y:wn,w:bn,h:vn},sn)})})}renderTxt(on,sn,ln){if(!(this.format!=="txt"||!(on!=null&&on.body)))try{(ln?this.marks.filter(cn=>cn.id===ln&&cn.section===sn):this.marks.filter(cn=>cn.section===sn&&cn.type!=="bookmark"&&!on.querySelector(`[data-mark-id="${cn.id}"]`))).forEach(cn=>{var dn;const un=on.createTreeWalker(on.body,NodeFilter.SHOW_TEXT,{acceptNode:hn=>{var fn;return(fn=hn.parentElement)!=null&&fn.hasAttribute("data-txt-mark")?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_ACCEPT}});for(let hn;hn=un.nextNode();){const fn=(hn.textContent||"").indexOf(cn.text||"");if(fn>-1&&hn.textContent.length>10){const pn=on.createRange(),gn=on.createElement("span"),mn=getColorBg(cn.color),bn=cn.style||"highlight";pn.setStart(hn,fn),pn.setEnd(hn,fn+(((dn=cn.text)==null?void 0:dn.length)||0)),gn.setAttribute("data-txt-mark",""),gn.setAttribute("data-mark-id",cn.id),Object.assign(gn.style,bn==="highlight"?{backgroundColor:mn}:bn==="underline"?{borderBottom:`2px solid ${mn}`,paddingBottom:"2px"}:bn==="outline"?{border:`2px solid ${mn}`,padding:"0 2px",borderRadius:"2px"}:{textDecoration:"underline wavy",textDecorationColor:mn},{cursor:"pointer"}),gn.onclick=vn=>{var kn,_n;vn.stopPropagation();const yn=gn.getBoundingClientRect(),wn=(_n=(kn=on.defaultView)==null?void 0:kn.frameElement)==null?void 0:_n.getBoundingClientRect();window.dispatchEvent(new CustomEvent("txt-annotation-click",{detail:{mark:cn,x:((wn==null?void 0:wn.left)||0)+yn.left+yn.width/2,y:((wn==null?void 0:wn.top)||0)+yn.top+yn.height}}))},pn.surroundContents(gn);break}}})}catch(cn){console.error("[Mark] renderTxt:",cn)}}bindTxtDocEvents(on,sn){if(!(!(on!=null&&on.body)||on.__txtEventsBound))try{on.addEventListener("mouseup",ln=>window.dispatchEvent(new CustomEvent("txt-selection",{detail:{doc:on,event:ln}}))),this.renderTxt(on,sn),on.__txtEventsBound=!0}catch(ln){console.error("[Mark] bindTxtDocEvents:",ln)}}txtOp(on,sn){var cn,un,dn,hn,fn;const ln=(dn=(un=(cn=this.view)==null?void 0:cn.renderer)==null?void 0:un.getContents)==null?void 0:dn.call(un);ln&&on.section===((fn=(hn=this.view)==null?void 0:hn.lastLocation)==null?void 0:fn.section)&&ln.forEach(({doc:pn})=>pn&&(sn!=="add"&&pn.querySelectorAll(`[data-mark-id="${on.id}"]`).forEach(gn=>{var mn;for(;gn.firstChild;)(mn=gn.parentNode)==null||mn.insertBefore(gn.firstChild,gn);gn.remove()}),sn!=="delete"&&this.renderTxt(pn,on.section,on.id)))}refreshTxt(){var on,sn,ln,cn;(cn=(ln=(sn=(on=this.view)==null?void 0:on.renderer)==null?void 0:sn.getContents)==null?void 0:ln.call(sn))==null||cn.forEach(({doc:un})=>{var dn,hn;return un&&this.renderTxt(un,((hn=(dn=this.view)==null?void 0:dn.lastLocation)==null?void 0:hn.section)||0)})}async addHighlight(on,sn,ln,cn="highlight",un,dn){var fn,pn;const hn=this.add({type:"highlight",[typeof on=="string"?"cfi":this.format==="pdf"?"page":"section"]:on,text:sn.substring(0,200),color:ln,style:cn,rects:un,textOffset:dn});return this.format==="pdf"?this.renderPdf(hn.page):this.format==="txt"?this.txtOp(hn,"add"):hn.cfi&&await((pn=(fn=this.view)==null?void 0:fn.addAnnotation)==null?void 0:pn.call(fn,{value:hn.cfi,color:hn.color,note:hn.note}).catch(()=>{})),this.save(),window.dispatchEvent(new Event("sireader:marks-updated")),this.tryAutoSync(hn),hn}async addNote(on,sn,ln,cn="blue",un="outline",dn,hn){var pn,gn;const fn=this.add({type:"note",[typeof on=="string"?"cfi":this.format==="pdf"?"page":"section"]:on,text:ln.substring(0,200),note:sn,color:cn,style:un,rects:dn,textOffset:hn});return this.format==="pdf"?this.renderPdf(fn.page):this.format==="txt"?this.txtOp(fn,"add"):fn.cfi&&await((gn=(pn=this.view)==null?void 0:pn.addAnnotation)==null?void 0:gn.call(pn,{value:fn.cfi,color:fn.color,note:fn.note}).catch(()=>{})),this.save(),window.dispatchEvent(new Event("sireader:marks-updated")),this.tryAutoSync(fn),fn}async tryAutoSync(on){if(on.type!=="bookmark")try{const{autoSyncMark:sn}=await Promise.resolve().then(()=>copy);await sn(on,{bookUrl:this.bookUrl,isPdf:this.format==="pdf",reader:this.reader,pdfViewer:this.pdfViewer,marks:this})}catch(sn){console.error("[AutoSync]",sn)}}async updateMark(on,sn){var cn,un,dn,hn,fn,pn;if(typeof on=="object"&&(on!=null&&on.type)){const{type:gn,id:mn}=on;if(gn==="shape"){const bn=await((un=(cn=this.getManager("shape"))==null?void 0:cn.updateShape)==null?void 0:un.call(cn,mn,sn));return bn&&window.dispatchEvent(new Event("sireader:marks-updated")),bn||!1}if(gn==="ink")return!1;on=mn}const ln=this.marksMap.get(on);return ln?(Object.assign(ln,sn),this.format==="pdf"?this.renderPdf(ln.page):this.format==="txt"?this.txtOp(ln,"update"):ln.cfi&&(await((hn=(dn=this.view)==null?void 0:dn.deleteAnnotation)==null?void 0:hn.call(dn,{value:ln.cfi}).catch(()=>{})),await((pn=(fn=this.view)==null?void 0:fn.addAnnotation)==null?void 0:pn.call(fn,{value:ln.cfi,color:ln.color,note:ln.note}).catch(()=>{}))),this.save(),window.dispatchEvent(new Event("sireader:marks-updated")),!0):!1}getManager(on){return this[`${on}Manager`]}async callManager(on,sn,ln){var dn,hn;const cn=this.getManager(on);if(!((dn=cn==null?void 0:cn.toJSON)!=null&&dn.call(cn).some(fn=>fn.id===ln)))return!1;const un=await((hn=cn[sn])==null?void 0:hn.call(cn,ln));return un&&window.dispatchEvent(new Event("sireader:marks-updated")),un}async deleteMark(on){var ln,cn,un,dn,hn,fn;if(typeof on=="object"&&(on!=null&&on.type)){const{type:pn,id:gn}=on;if(pn==="shape"||pn==="ink")return this.callManager(pn,"delete"+pn.charAt(0).toUpperCase()+pn.slice(1),gn);on=gn}if(await this.callManager("ink","deleteInk",on)||await this.callManager("shape","deleteShape",on))return!0;const sn=this.marksMap.get(on);if(!sn||!this.del(sn.id))return!1;if(sn.blockId)try{const{bookshelfManager:pn}=await Promise.resolve().then(()=>bookshelf),gn=await pn.getBook(this.bookUrl);if(gn!=null&&gn.syncDelete){const{deleteBlock:mn}=await Promise.resolve().then(()=>api);await mn(sn.blockId)}}catch(pn){console.error("[DeleteBlock]",pn)}if(sn.type==="vocab"&&sn.text)try{const{getDeckCards:pn,removeFromDeck:gn}=await Promise.resolve().then(()=>dictionary),mn=pn().find(bn=>bn.word===sn.text&&bn.cfi===sn.cfi&&bn.section===sn.section);mn&&await gn(mn.id)}catch(pn){console.error("[Mark]",pn)}return this.format==="pdf"?this.renderPdf(sn.page):this.format==="txt"?(cleanTooltips(sn.id),this.txtOp(sn,"delete")):(sn.cfi&&await((cn=(ln=this.view)==null?void 0:ln.deleteAnnotation)==null?void 0:cn.call(ln,{value:sn.cfi}).catch(()=>{})),cleanTooltips(sn.id),(fn=(hn=(dn=(un=this.view)==null?void 0:un.renderer)==null?void 0:dn.getContents)==null?void 0:hn.call(dn))==null||fn.forEach(({doc:pn})=>pn==null?void 0:pn.querySelectorAll(`[data-mark-id="${sn.id}"]`).forEach(gn=>gn.remove()))),this.save(),window.dispatchEvent(new Event("sireader:marks-updated")),!0}addBookmark(on,sn){var hn,fn;const ln=(hn=this.view)==null?void 0:hn.lastLocation,cn=on||(this.format==="pdf"?this.currentPage:(ln==null?void 0:ln.cfi)||(ln==null?void 0:ln.section));if(this.marks.find(pn=>pn.type==="bookmark"&&(pn.cfi===cn||pn.page===cn||pn.section===cn)))throw new Error("");const dn=this.add({type:"bookmark",format:this.format,[typeof cn=="string"?"cfi":this.format==="pdf"?"page":"section"]:cn,title:sn||((fn=ln==null?void 0:ln.tocItem)==null?void 0:fn.label)||`${(cn||0)+1}`,progress:Math.round(((ln==null?void 0:ln.fraction)||0)*100)});return this.save(),window.dispatchEvent(new Event("sireader:marks-updated")),dn}deleteBookmark(on){return this.del(on)?(this.save(),window.dispatchEvent(new Event("sireader:marks-updated")),!0):!1}toggleBookmark(on,sn){var dn;const ln=(dn=this.view)==null?void 0:dn.lastLocation,cn=on||(this.format==="pdf"?this.currentPage:(ln==null?void 0:ln.cfi)||(ln==null?void 0:ln.section)),un=this.marks.find(hn=>hn.type==="bookmark"&&(hn.cfi===cn||hn.page===cn||hn.section===cn));return un?(this.deleteBookmark(un.id),!1):(this.addBookmark(cn,sn),!0)}hasBookmark(on){var cn;const sn=(cn=this.view)==null?void 0:cn.lastLocation,ln=on||(this.format==="pdf"?this.currentPage:(sn==null?void 0:sn.cfi)||(sn==null?void 0:sn.section));return this.marks.some(un=>un.type==="bookmark"&&(un.cfi===ln||un.page===ln||un.section===ln))}async goTo(on){const sn=this.format==="pdf"&&on.page?{cfi:`#page-${on.page}`,id:on.id}:this.format==="txt"&&on.section!==void 0?{section:on.section,textOffset:on.textOffset,text:on.text,id:on.id}:{cfi:on.cfi||`section-${on.section}`,id:on.id};window.dispatchEvent(new CustomEvent("sireader:goto",{detail:sn}))}updateProgress(){var on,sn,ln,cn,un;if(this.format==="pdf"){const dn=((on=this.pdfViewer)==null?void 0:on.getCurrentPage())||1,hn=((sn=this.pdfViewer)==null?void 0:sn.getPageCount())||1;this.currentPage=dn,this.saveProgress({page:dn,total:hn})}else{const dn=this.reader?this.reader.getView().lastLocation:((cn=(ln=this.view)==null?void 0:ln.getLocation)==null?void 0:cn.call(ln))||((un=this.view)==null?void 0:un.lastLocation);this.saveProgress(dn)}}saveProgress(on){var sn;this.format==="pdf"?typeof on=="number"?this.currentPage=on:typeof on=="object"&&on.page&&(this.currentPage=on.page,on.total&&(this.currentProgress=Math.round(on.page/on.total*100))):(((sn=on==null?void 0:on.section)==null?void 0:sn.current)!==void 0?this.currentPage=on.section.current:typeof(on==null?void 0:on.section)=="number"&&(this.currentPage=on.section),(on==null?void 0:on.fraction)!==void 0&&(this.currentProgress=Math.round(on.fraction*100))),this.save(),this.syncToBookshelf()}async destroy(){clearTimeout(this.saveTimer),clearInterval(this.autoSaveTimer),await this.saveNow(),await this.syncToBookshelf(),this.marks=[],this.marksMap.clear()}async syncToBookshelf(){try{const{bookshelfManager:on}=await Promise.resolve().then(()=>bookshelf),sn=await on.getBook(this.bookUrl);sn&&(sn.durChapterIndex=this.currentPage,sn.durChapterTime=Date.now(),sn.epubProgress=this.currentProgress,await on.saveBook(sn),window.dispatchEvent(new Event("sireader:bookshelf-updated")))}catch(on){console.error("[Mark] Sync:",on)}}}const createMarkManager=an=>new MarkManager(an),MarkManager$1=Object.freeze(Object.defineProperty({__proto__:null,COLORS,MarkManager,STYLES,createMarkManager,createTooltip,formatAuthor,formatTime,getChapterName,getColorMap,hideTooltip,showTooltip},Symbol.toStringTag,{value:"Module"}));class EPUBSearch{constructor(on){ir(this,"view");ir(this,"results",[]);ir(this,"current",-1);ir(this,"getResults",()=>this.results);ir(this,"getCurrentIndex",()=>this.current);ir(this,"getCurrent",()=>this.current>=0?this.results[this.current]:null);this.view=on}async*search(on,sn={}){this.clear();const{matchCase:ln=!1,matchWholeWords:cn=!1}=sn;for await(const un of this.view.search({query:on,matchCase:ln,matchWholeWords:cn,matchDiacritics:!1})){if(un==="done")break;if(un.progress===void 0)if(un.subitems)for(const dn of un.subitems)this.results.push({...dn,label:un.label}),yield{...dn,label:un.label};else un.cfi&&(this.results.push(un),yield un)}}async goto(on){try{await(this.view.select?this.view.select(on.cfi):this.view.goTo(on.cfi))}catch{}}next(){return this.results.length?(this.current=(this.current+1)%this.results.length,this.goto(this.results[this.current]),this.results[this.current]):null}prev(){return this.results.length?(this.current=(this.current-1+this.results.length)%this.results.length,this.goto(this.results[this.current]),this.results[this.current]):null}clear(){var on,sn;(sn=(on=this.view).clearSearch)==null||sn.call(on),this.results=[],this.current=-1}}const findIndices=(an,on)=>an.map((sn,ln,cn)=>on(sn,ln,cn)?ln:null).filter(sn=>sn!=null),splitAt=(an,on)=>[-1,...on,an.length].reduce(({xs:sn,a:ln},cn)=>({xs:(sn==null?void 0:sn.concat([an.slice(ln+1,cn)]))??[],a:cn}),{}).xs,concatArrays=(an,on)=>an.slice(0,-1).concat([an[an.length-1].concat(on[0])]).concat(on.slice(1)),isNumber=/\d/,isCFI=/^epubcfi\((.*)\)$/,escapeCFI=an=>an.replace(/[\^[\](),;=]/g,"^$&"),wrap=an=>isCFI.test(an)?an:`epubcfi(${an})`,unwrap=an=>{var on;return((on=an.match(isCFI))==null?void 0:on[1])??an},lift=an=>(...on)=>`epubcfi(${an(...on.map(sn=>{var ln;return((ln=sn.match(isCFI))==null?void 0:ln[1])??sn}))})`,joinIndir=lift((...an)=>an.join("!")),tokenizer=an=>{const on=[];let sn,ln,cn="";const un=hn=>(on.push(hn),sn=null,cn=""),dn=hn=>(cn+=hn,ln=!1);for(const hn of Array.from(an.trim()).concat("")){if(hn==="^"&&!ln){ln=!0;continue}if(sn==="!")un(["!"]);else if(sn===",")un([","]);else if(sn==="/"||sn===":")if(isNumber.test(hn)){dn(hn);continue}else un([sn,parseInt(cn)]);else if(sn==="~")if(isNumber.test(hn)||hn==="."){dn(hn);continue}else un(["~",parseFloat(cn)]);else if(sn==="@"){if(hn===":"){un(["@",parseFloat(cn)]),sn="@";continue}if(isNumber.test(hn)||hn==="."){dn(hn);continue}else un(["@",parseFloat(cn)])}else if(sn==="["){hn===";"&&!ln?(un(["[",cn]),sn=";"):hn===","&&!ln?(un(["[",cn]),sn="["):hn==="]"&&!ln?un(["[",cn]):dn(hn);continue}else if(sn!=null&&sn.startsWith(";")){hn==="="&&!ln?(sn=`;${cn}`,cn=""):hn===";"&&!ln?(un([sn,cn]),sn=";"):hn==="]"&&!ln?un([sn,cn]):dn(hn);continue}(hn==="/"||hn===":"||hn==="~"||hn==="@"||hn==="["||hn==="!"||hn===",")&&(sn=hn)}return on},findTokens=(an,on)=>findIndices(an,([sn])=>sn===on),parser=an=>{const on=[];let sn;for(const[ln,cn]of an){if(ln==="/")on.push({index:cn});else{const un=on[on.length-1];if(ln===":")un.offset=cn;else if(ln==="~")un.temporal=cn;else if(ln==="@")un.spatial=(un.spatial??[]).concat(cn);else if(ln===";s")un.side=cn;else if(ln==="[")if(sn==="/"&&cn)un.id=cn;else{un.text=(un.text??[]).concat(cn);continue}}sn=ln}return on},parserIndir=an=>splitAt(an,findTokens(an,"!")).map(parser),parse=an=>{const on=tokenizer(unwrap(an)),sn=findTokens(on,",");if(!sn.length)return parserIndir(on);const[ln,cn,un]=splitAt(on,sn).map(parserIndir);return{parent:ln,start:cn,end:un}},partToString=({index:an,id:on,offset:sn,temporal:ln,spatial:cn,text:un,side:dn})=>{var fn;const hn=dn?`;s=${dn}`:"";return`/${an}`+(on?`[${escapeCFI(on)}${hn}]`:"")+(sn!=null&&an%2?`:${sn}`:"")+(ln?`~${ln}`:"")+(cn?`@${cn.join(":")}`:"")+(un||!on&&dn?"["+(((fn=un==null?void 0:un.map(escapeCFI))==null?void 0:fn.join(","))??"")+hn+"]":"")},toInnerString=an=>an.parent?[an.parent,an.start,an.end].map(toInnerString).join(","):an.map(on=>on.map(partToString).join("")).join("!"),toString=an=>wrap(toInnerString(an)),collapse=(an,on)=>typeof an=="string"?toString(collapse(parse(an),on)):an.parent?concatArrays(an.parent,an[on?"end":"start"]):an,buildRange=(an,on)=>{typeof an=="string"&&(an=parse(an)),typeof on=="string"&&(on=parse(on)),an=collapse(an),on=collapse(on,!0);const sn=an[an.length-1],ln=on[on.length-1],cn=[],un=[],dn=[];let hn=!0;const fn=Math.max(sn.length,ln.length);for(let gn=0;gn<fn;gn++){const mn=sn[gn],bn=ln[gn];hn&&(hn=(mn==null?void 0:mn.index)===(bn==null?void 0:bn.index)&&!(mn!=null&&mn.offset)&&!(bn!=null&&bn.offset)),hn?cn.push(mn):(mn&&un.push(mn),bn&&dn.push(bn))}const pn=an.slice(0,-1).concat([cn]);return toString({parent:pn,start:[un],end:[dn]})},isTextNode=({nodeType:an})=>an===3||an===4,isElementNode=({nodeType:an})=>an===1,getChildNodes=(an,on)=>{const sn=Array.from(an.childNodes).filter(ln=>isTextNode(ln)||isElementNode(ln));return on?sn.map(ln=>{const cn=on(ln);return cn===NodeFilter.FILTER_REJECT?null:cn===NodeFilter.FILTER_SKIP?getChildNodes(ln,on):ln}).flat().filter(ln=>ln):sn},indexChildNodes=(an,on)=>{const sn=getChildNodes(an,on).reduce((ln,cn)=>{let un=ln[ln.length-1];return un?isTextNode(cn)?Array.isArray(un)?un.push(cn):isTextNode(un)?ln[ln.length-1]=[un,cn]:ln.push(cn):isElementNode(un)?ln.push(null,cn):ln.push(cn):ln.push(cn),ln},[]);return isElementNode(sn[0])&&sn.unshift("first"),isElementNode(sn[sn.length-1])&&sn.push("last"),sn.unshift("before"),sn.push("after"),sn},partsToNode=(an,on,sn)=>{const{id:ln}=on[on.length-1];if(ln){const dn=an.ownerDocument.getElementById(ln);if(dn)return{node:dn,offset:0}}for(const{index:dn}of on){const hn=an?indexChildNodes(an,sn)[dn]:null;if(hn==="first")return{node:an.firstChild??an};if(hn==="last")return{node:an.lastChild??an};if(hn==="before")return{node:an,before:!0};if(hn==="after")return{node:an,after:!0};an=hn}const{offset:cn}=on[on.length-1];if(!Array.isArray(an))return{node:an,offset:cn};let un=0;for(const dn of an){const{length:hn}=dn.nodeValue;if(un+hn>=cn)return{node:dn,offset:cn-un};un+=hn}},nodeToParts=(an,on,sn)=>{const{parentNode:ln,id:cn}=an,un=indexChildNodes(ln,sn),dn=un.findIndex(pn=>Array.isArray(pn)?pn.some(gn=>gn===an):pn===an),hn=un[dn];if(Array.isArray(hn)){let pn=0;for(const gn of hn)if(gn===an){pn+=on;break}else pn+=gn.nodeValue.length;on=pn}const fn={id:cn,index:dn,offset:on};return(ln!==an.ownerDocument.documentElement?nodeToParts(ln,null,sn).concat(fn):[fn]).filter(pn=>pn.index!==-1)},fromRange=(an,on)=>{const{startContainer:sn,startOffset:ln,endContainer:cn,endOffset:un}=an,dn=nodeToParts(sn,ln,on);if(an.collapsed)return toString([dn]);const hn=nodeToParts(cn,un,on);return buildRange([dn],[hn])},toRange=(an,on,sn)=>{const ln=collapse(on),cn=collapse(on,!0),un=an.documentElement,dn=partsToNode(un,ln[0],sn),hn=partsToNode(un,cn[0],sn),fn=an.createRange();return dn.before?fn.setStartBefore(dn.node):dn.after?fn.setStartAfter(dn.node):fn.setStart(dn.node,dn.offset),hn.before?fn.setEndBefore(hn.node):hn.after?fn.setEndAfter(hn.node):fn.setEnd(hn.node,hn.offset),fn},fromElements=an=>{const on=[],{parentNode:sn}=an[0],ln=nodeToParts(sn);for(const[cn,un]of indexChildNodes(sn).entries()){const dn=an[on.length];un===dn&&on.push(toString([ln.concat({id:dn.id,index:cn})]))}return on},toElement=(an,on)=>partsToNode(an.documentElement,collapse(on)).node,fake={fromIndex:an=>wrap(`/6/${(an+1)*2}`),toIndex:an=>(an==null?void 0:an.at(-1).index)/2-1},fromCalibreHighlight=({spine_index:an,start_cfi:on,end_cfi:sn})=>{const ln=fake.fromIndex(an)+"!";return buildRange(ln+on.slice(2),ln+sn.slice(2))},epubcfi=Object.freeze(Object.defineProperty({__proto__:null,collapse,fake,fromCalibreHighlight,fromElements,fromRange,isCFI,joinIndir,parse,toElement,toRange},Symbol.toStringTag,{value:"Module"})),assignIDs=an=>{let on=0;const sn=ln=>{if(ln.id=on++,ln.subitems)for(const cn of ln.subitems)sn(cn)};for(const ln of an)sn(ln);return an},flatten=an=>an.map(on=>{var sn;return(sn=on.subitems)!=null&&sn.length?[on,flatten(on.subitems)].flat():on}).flat();class TOCProgress{async init({toc:on,ids:sn,splitHref:ln,getFragment:cn}){assignIDs(on);const un=flatten(on),dn=new Map;for(const[fn,pn]of un.entries()){const[gn,mn]=await ln(pn==null?void 0:pn.href)??[],bn={fragment:mn,item:pn};dn.has(gn)?dn.get(gn).items.push(bn):dn.set(gn,{prev:un[fn-1],items:[bn]})}const hn=new Map;for(const[fn,pn]of sn.entries())dn.has(pn)?hn.set(pn,dn.get(pn)):hn.set(pn,hn.get(sn[fn-1]));this.ids=sn,this.map=hn,this.getFragment=cn}getProgress(on,sn){var fn;if(!this.ids)return;const ln=this.ids[on],cn=this.map.get(ln);if(!cn)return null;const{prev:un,items:dn}=cn;if(!dn)return un;if(!sn||dn.length===1&&!dn[0].fragment)return dn[0].item;const hn=sn.startContainer.getRootNode();for(const[pn,{fragment:gn}]of dn.entries()){const mn=this.getFragment(hn,gn);if(mn&&sn.comparePoint(mn,0)>0)return((fn=dn[pn-1])==null?void 0:fn.item)??un}return dn[dn.length-1].item}}var Ca,al;class SectionProgress{constructor(on,sn,ln){pr(this,Ca);this.sizes=on.map(cn=>cn.linear!="no"&&cn.size>0?cn.size:0),this.sizePerLoc=sn,this.sizePerTimeUnit=ln,this.sizeTotal=this.sizes.reduce((cn,un)=>cn+un,0),this.sectionFractions=dr(this,Ca,al).call(this)}getProgress(on,sn,ln=0){const{sizes:cn,sizePerLoc:un,sizePerTimeUnit:dn,sizeTotal:hn}=this,fn=cn[on]??0,gn=cn.slice(0,on).reduce((yn,wn)=>yn+wn,0)+sn*fn,mn=gn+ln*fn,bn=hn-gn,vn=(1-sn)*fn;return{fraction:mn/hn,section:{current:on,total:cn.length},location:{current:Math.floor(gn/un),next:Math.floor(mn/un),total:Math.ceil(hn/un)},time:{section:vn/dn,total:bn/dn}}}getSection(on){if(on<=0)return[0,0];if(on>=1)return[this.sizes.length-1,1];on=on+Number.EPSILON;const{sizeTotal:sn}=this;let ln=this.sectionFractions.findIndex(un=>un>on)-1;if(ln<0)return[0,0];for(;!this.sizes[ln];)ln++;const cn=(on-this.sectionFractions[ln])/(this.sizes[ln]/sn);return[ln,cn]}}Ca=new WeakSet,al=function(){const{sizeTotal:on}=this,sn=[0];let ln=0;for(const cn of this.sizes)sn.push((ln+=cn)/on);return sn};const walkRange=(an,on)=>{const sn=[];for(let ln=on.currentNode;ln;ln=on.nextNode()){const cn=an.comparePoint(ln,0);if(cn===0)sn.push(ln);else if(cn>0)break}return sn},walkDocument=(an,on)=>{const sn=[];for(let ln=on.nextNode();ln;ln=on.nextNode())sn.push(ln);return sn},filter$1=NodeFilter.SHOW_ELEMENT|NodeFilter.SHOW_TEXT|NodeFilter.SHOW_CDATA_SECTION,acceptNode=an=>{if(an.nodeType===1){const on=an.tagName.toLowerCase();return on==="script"||on==="style"?NodeFilter.FILTER_REJECT:NodeFilter.FILTER_SKIP}return NodeFilter.FILTER_ACCEPT},textWalker=function*(an,on){const sn=an.commonAncestorContainer??an.body??an,ln=document.createTreeWalker(sn,filter$1,{acceptNode}),un=(an.commonAncestorContainer?walkRange:walkDocument)(an,ln),dn=un.map(fn=>fn.nodeValue??""),hn=(fn,pn,gn,mn)=>{const bn=document.createRange();return bn.setStart(un[fn],pn),bn.setEnd(un[gn],mn),bn};for(const fn of on(dn,hn))yield fn},SEARCH_PREFIX="foliate-search:",isZip=async an=>{const on=new Uint8Array(await an.slice(0,4).arrayBuffer());return on[0]===80&&on[1]===75&&on[2]===3&&on[3]===4},isCBZ=({name:an,type:on})=>on==="application/vnd.comicbook+zip"||an.endsWith(".cbz"),isFB2=({name:an,type:on})=>on==="application/x-fictionbook+xml"||an.endsWith(".fb2"),isFBZ=({name:an,type:on})=>on==="application/x-zip-compressed-fb2"||an.endsWith(".fb2.zip")||an.endsWith(".fbz"),makeZipLoader=async an=>{const{configure:on,ZipReader:sn,BlobReader:ln,TextWriter:cn,BlobWriter:un}=await Promise.resolve().then(()=>zip);on({useWebWorkers:!1});const hn=await new sn(new ln(an)).getEntries(),fn=new Map(hn.map(vn=>[vn.filename,vn])),pn=vn=>(yn,...wn)=>fn.has(yn)?vn(fn.get(yn),...wn):null,gn=pn(vn=>vn.getData(new cn)),mn=pn((vn,yn)=>vn.getData(new un(yn)));return{entries:hn,loadText:gn,loadBlob:mn,getSize:vn=>{var yn;return((yn=fn.get(vn))==null?void 0:yn.uncompressedSize)??0}}},getFileEntries=async an=>an.isFile?an:(await Promise.all(Array.from(await new Promise((on,sn)=>an.createReader().readEntries(ln=>on(ln),ln=>sn(ln))),getFileEntries))).flat(),makeDirectoryLoader=async an=>{const on=await getFileEntries(an),sn=await Promise.all(on.map(gn=>new Promise((mn,bn)=>gn.file(vn=>mn([vn,gn.fullPath]),vn=>bn(vn))))),ln=new Map(sn.map(([gn,mn])=>[mn.replace(an.fullPath+"/",""),gn])),cn=new TextDecoder,un=gn=>gn?cn.decode(gn):null,dn=gn=>{var mn;return((mn=ln.get(gn))==null?void 0:mn.arrayBuffer())??null};return{loadText:async gn=>un(await dn(gn)),loadBlob:gn=>ln.get(gn),getSize:gn=>{var mn;return((mn=ln.get(gn))==null?void 0:mn.size)??0}}};class ResponseError extends Error{}class NotFoundError extends Error{}class UnsupportedTypeError extends Error{}const fetchFile=async an=>{const on=await fetch(an);if(!on.ok)throw new ResponseError(`${on.status} ${on.statusText}`,{cause:on});return new File([await on.blob()],new URL(on.url).pathname)},makeBook=async an=>{typeof an=="string"&&(an=await fetchFile(an));let on;if(an.isDirectory){const sn=await makeDirectoryLoader(an),{EPUB:ln}=await Promise.resolve().then(()=>epub);on=await new ln(sn).init()}else if(an.size)if(await isZip(an)){const sn=await makeZipLoader(an);if(isCBZ(an)){const{makeComicBook:ln}=await Promise.resolve().then(()=>comicBook);on=ln(sn,an)}else if(isFBZ(an)){const{makeFB2:ln}=await Promise.resolve().then(()=>fb2),{entries:cn}=sn,un=cn.find(hn=>hn.filename.endsWith(".fb2")),dn=await sn.loadBlob((un??cn[0]).filename);on=await ln(dn)}else{const{EPUB:ln}=await Promise.resolve().then(()=>epub);on=await new ln(sn).init()}}else{const{isMOBI:sn,MOBI:ln}=await Promise.resolve().then(()=>mobi);if(await sn(an)){const cn=await Promise.resolve().then(()=>fflate);on=await new ln({unzlib:cn.unzlibSync}).open(an)}else if(isFB2(an)){const{makeFB2:cn}=await Promise.resolve().then(()=>fb2);on=await cn(an)}}else throw new NotFoundError("File not found");if(!on)throw new UnsupportedTypeError("File type not supported");return on};var ri,Ns,Oi,vo;const Xa=class Xa{constructor(on,sn,ln={}){pr(this,ri);pr(this,Ns);pr(this,Oi);pr(this,vo);yr(this,Ns,on),yr(this,Oi,sn),yr(this,vo,ln),$n(this,vo).hidden&&this.hide(),$n(this,Ns).addEventListener("mousemove",({screenX:cn,screenY:un})=>{cn===$n(this,vo).x&&un===$n(this,vo).y||($n(this,vo).x=cn,$n(this,vo).y=un,this.show(),$n(this,ri)&&clearTimeout($n(this,ri)),sn()&&yr(this,ri,setTimeout(this.hide.bind(this),1e3)))},!1)}cloneFor(on){return new Xa(on,$n(this,Oi),$n(this,vo))}hide(){$n(this,Ns).style.cursor="none",$n(this,vo).hidden=!0}show(){$n(this,Ns).style.removeProperty("cursor"),$n(this,vo).hidden=!1}};ri=new WeakMap,Ns=new WeakMap,Oi=new WeakMap,vo=new WeakMap;let CursorAutohider=Xa;var wo,lo;class History extends EventTarget{constructor(){super(...arguments);pr(this,wo,[]);pr(this,lo,-1)}pushState(sn){const ln=$n(this,wo)[$n(this,lo)];ln===sn||ln!=null&&ln.fraction&&ln.fraction===sn.fraction||($n(this,wo)[++Ii(this,lo)._]=sn,$n(this,wo).length=$n(this,lo)+1,this.dispatchEvent(new Event("index-change")))}replaceState(sn){const ln=$n(this,lo);$n(this,wo)[ln]=sn}back(){const sn=$n(this,lo);if(sn<=0)return;const ln={state:$n(this,wo)[sn-1]};yr(this,lo,sn-1),this.dispatchEvent(new CustomEvent("popstate",{detail:ln})),this.dispatchEvent(new Event("index-change"))}forward(){const sn=$n(this,lo);if(sn>=$n(this,wo).length-1)return;const ln={state:$n(this,wo)[sn+1]};yr(this,lo,sn+1),this.dispatchEvent(new CustomEvent("popstate",{detail:ln})),this.dispatchEvent(new Event("index-change"))}get canGoBack(){return $n(this,lo)>0}get canGoForward(){return $n(this,lo)<$n(this,wo).length-1}clear(){yr(this,wo,[]),yr(this,lo,-1)}}wo=new WeakMap,lo=new WeakMap;const languageInfo=an=>{var on,sn;if(!an)return{};try{const ln=Intl.getCanonicalLocales(an)[0],cn=new Intl.Locale(ln),un=["zh","ja","kr"].includes(cn.language),dn=(sn=((on=cn.getTextInfo)==null?void 0:on.call(cn))??cn.textInfo)==null?void 0:sn.direction;return{canonical:ln,locale:cn,isCJK:un,direction:dn}}catch(ln){return console.warn(ln),{}}};var Ea,Xo,$o,ls,Yo,Ta,jr,Go,ll,cl,ul,ga,dl,hl,pl,il;let View$1=(il=class extends HTMLElement{constructor(){super();pr(this,jr);pr(this,Ea,this.attachShadow({mode:"closed"}));pr(this,Xo);pr(this,$o);pr(this,ls);pr(this,Yo,new Map);pr(this,Ta,new CursorAutohider(this,()=>this.hasAttribute("autohide-cursor")));ir(this,"isFixedLayout",!1);ir(this,"lastLocation");ir(this,"history",new History);this.history.addEventListener("popstate",({detail:sn})=>{const ln=this.resolveNavigation(sn.state);this.renderer.goTo(ln)})}async open(sn){var ln,cn;if((typeof sn=="string"||typeof sn.arrayBuffer=="function"||sn.isDirectory)&&(sn=await makeBook(sn)),this.book=sn,this.language=languageInfo((ln=sn.metadata)==null?void 0:ln.language),sn.splitTOCHref&&sn.getTOCFragment){const un=sn.sections.map(fn=>fn.id);yr(this,Xo,new SectionProgress(sn.sections,1500,1600));const dn=sn.splitTOCHref.bind(sn),hn=sn.getTOCFragment.bind(sn);yr(this,$o,new TOCProgress),await $n(this,$o).init({toc:sn.toc??[],ids:un,splitHref:dn,getFragment:hn}),yr(this,ls,new TOCProgress),await $n(this,ls).init({toc:sn.pageList??[],ids:un,splitHref:dn,getFragment:hn})}if(this.isFixedLayout=((cn=this.book.rendition)==null?void 0:cn.layout)==="pre-paginated",this.isFixedLayout?(await Promise.resolve().then(()=>fixedLayout),this.renderer=document.createElement("foliate-fxl")):(await Promise.resolve().then(()=>paginator),this.renderer=document.createElement("foliate-paginator")),this.renderer.setAttribute("exportparts","head,foot,filter,container"),this.renderer.addEventListener("load",un=>dr(this,jr,cl).call(this,un.detail)),this.renderer.addEventListener("relocate",un=>dr(this,jr,ll).call(this,un.detail)),this.renderer.addEventListener("create-overlayer",un=>un.detail.attach(dr(this,jr,dl).call(this,un.detail))),this.renderer.open(sn),$n(this,Ea).append(this.renderer),sn.sections.some(un=>un.mediaOverlay)){const un=sn.media.activeClass,dn=sn.media.playbackActiveClass;this.mediaOverlay=sn.getMediaOverlay();let hn;this.mediaOverlay.addEventListener("highlight",fn=>{const pn=this.resolveNavigation(fn.detail.text);this.renderer.goTo(pn).then(()=>{const{doc:gn}=this.renderer.getContents().find(bn=>bn.index=pn.index),mn=pn.anchor(gn);mn.classList.add(un),dn&&mn.ownerDocument.documentElement.classList.add(dn),hn=new WeakRef(mn)})}),this.mediaOverlay.addEventListener("unhighlight",()=>{const fn=hn==null?void 0:hn.deref();fn&&(fn.classList.remove(un),dn&&fn.ownerDocument.documentElement.classList.remove(dn))})}}close(){var sn,ln;(sn=this.renderer)==null||sn.destroy(),(ln=this.renderer)==null||ln.remove(),yr(this,Xo,null),yr(this,$o,null),yr(this,ls,null),yr(this,Yo,new Map),this.lastLocation=null,this.history.clear(),this.tts=null,this.mediaOverlay=null}goToTextStart(){var sn,ln;return this.goTo(((ln=(sn=this.book.landmarks)==null?void 0:sn.find(cn=>cn.type.includes("bodymatter")||cn.type.includes("text")))==null?void 0:ln.href)??this.book.sections.findIndex(cn=>cn.linear!=="no"))}async init({lastLocation:sn,showTextStart:ln}){const cn=sn?this.resolveNavigation(sn):null;cn?(await this.renderer.goTo(cn),this.history.pushState(sn)):ln?await this.goToTextStart():(this.history.pushState(0),await this.next())}async addAnnotation(sn,ln){var pn;const{value:cn}=sn;if(cn.startsWith(SEARCH_PREFIX)){const gn=cn.replace(SEARCH_PREFIX,""),{index:mn,anchor:bn}=await this.resolveNavigation(gn),vn=dr(this,jr,ga).call(this,mn);if(vn){const{overlayer:yn,doc:wn}=vn;if(ln){yn.remove(cn);return}const kn=wn?bn(wn):bn;yn.add(cn,kn,Overlayer.outline)}return}const{index:un,anchor:dn}=await this.resolveNavigation(cn),hn=dr(this,jr,ga).call(this,un);if(hn){const{overlayer:gn,doc:mn}=hn;if(gn.remove(cn),!ln){const bn=mn?dn(mn):dn,vn=(yn,wn)=>gn.add(cn,bn,yn,wn);dr(this,jr,Go).call(this,"draw-annotation",{draw:vn,annotation:sn,doc:mn,range:bn})}}const fn=((pn=$n(this,$o).getProgress(un))==null?void 0:pn.label)??"";return{index:un,label:fn}}deleteAnnotation(sn){return this.addAnnotation(sn,!0)}async showAnnotation(sn){const{value:ln}=sn,cn=await this.goTo(ln);if(cn){const{index:un,anchor:dn}=cn,{doc:hn}=dr(this,jr,ga).call(this,un),fn=dn(hn);dr(this,jr,Go).call(this,"show-annotation",{value:ln,index:un,range:fn})}}getCFI(sn,ln){const cn=this.book.sections[sn].cfi??fake.fromIndex(sn);return ln?joinIndir(cn,fromRange(ln)):cn}resolveCFI(sn){if(this.book.resolveCFI)return this.book.resolveCFI(sn);{const ln=parse(sn);return{index:fake.toIndex((ln.parent??ln).shift()),anchor:dn=>toRange(dn,ln)}}}resolveNavigation(sn){try{if(typeof sn=="number")return{index:sn};if(typeof sn.fraction=="number"){const[ln,cn]=$n(this,Xo).getSection(sn.fraction);return{index:ln,anchor:cn}}return isCFI.test(sn)?this.resolveCFI(sn):this.book.resolveHref(sn)}catch(ln){console.error(ln),console.error(`Could not resolve target ${sn}`)}}async goTo(sn){const ln=this.resolveNavigation(sn);try{return await this.renderer.goTo(ln),this.history.pushState(sn),ln}catch(cn){console.error(cn),console.error(`Could not go to ${sn}`)}}async goToFraction(sn){const[ln,cn]=$n(this,Xo).getSection(sn);await this.renderer.goTo({index:ln,anchor:cn}),this.history.pushState({fraction:sn})}async select(sn){try{const ln=await this.resolveNavigation(sn);await this.renderer.goTo({...ln,select:!0}),this.history.pushState(sn)}catch(ln){console.error(ln),console.error(`Could not go to ${sn}`)}}deselect(){for(const{doc:sn}of this.renderer.getContents())sn.defaultView.getSelection().removeAllRanges()}getSectionFractions(){var sn;return(((sn=$n(this,Xo))==null?void 0:sn.sectionFractions)??[]).map(ln=>ln+Number.EPSILON)}getProgressOf(sn,ln){var dn,hn;const cn=(dn=$n(this,$o))==null?void 0:dn.getProgress(sn,ln),un=(hn=$n(this,ls))==null?void 0:hn.getProgress(sn,ln);return{tocItem:cn,pageItem:un}}async getTOCItemOf(sn){try{const{index:ln,anchor:cn}=await this.resolveNavigation(sn),un=await this.book.sections[ln].createDocument(),dn=cn(un),hn=dn instanceof Range,fn=hn?dn:un.createRange();return hn||fn.selectNodeContents(dn),$n(this,$o).getProgress(ln,fn)}catch(ln){console.error(ln),console.error(`Could not get ${sn}`)}}async prev(sn){await this.renderer.prev(sn)}async next(sn){await this.renderer.next(sn)}goLeft(){return this.book.dir==="rtl"?this.next():this.prev()}goRight(){return this.book.dir==="rtl"?this.prev():this.next()}async*search(sn){var pn;this.clearSearch();const{searchMatcher:ln}=await Promise.resolve().then(()=>search$1),{query:cn,index:un}=sn,dn=ln(textWalker,{defaultLocale:this.language,...sn}),hn=un!=null?dr(this,jr,hl).call(this,dn,cn,un):dr(this,jr,pl).call(this,dn,cn),fn=[];$n(this,Yo).set(un,fn);for await(const gn of hn)if(gn.subitems){const mn=gn.subitems.map(({cfi:bn})=>({value:SEARCH_PREFIX+bn}));$n(this,Yo).set(gn.index,mn);for(const bn of mn)this.addAnnotation(bn);yield{label:((pn=$n(this,$o).getProgress(gn.index))==null?void 0:pn.label)??"",subitems:gn.subitems}}else{if(gn.cfi){const mn={value:SEARCH_PREFIX+gn.cfi};fn.push(mn),this.addAnnotation(mn)}yield gn}yield"done"}clearSearch(){for(const sn of $n(this,Yo).values())for(const ln of sn)this.deleteAnnotation(ln);$n(this,Yo).clear()}async initTTS(sn="word"){const ln=this.renderer.getContents()[0].doc;if(this.tts&&this.tts.doc===ln)return;const{TTS:cn}=await Promise.resolve().then(()=>tts);this.tts=new cn(ln,textWalker,un=>this.renderer.scrollToAnchor(un,!0),sn)}startMediaOverlay(){const{index:sn}=this.renderer.getContents()[0];return this.mediaOverlay.start(sn)}},Ea=new WeakMap,Xo=new WeakMap,$o=new WeakMap,ls=new WeakMap,Yo=new WeakMap,Ta=new WeakMap,jr=new WeakSet,Go=function(sn,ln,cn){return this.dispatchEvent(new CustomEvent(sn,{detail:ln,cancelable:cn}))},ll=function({reason:sn,range:ln,index:cn,fraction:un,size:dn}){var mn,bn,vn;const hn=((mn=$n(this,Xo))==null?void 0:mn.getProgress(cn,un,dn))??{},fn=(bn=$n(this,$o))==null?void 0:bn.getProgress(cn,ln),pn=(vn=$n(this,ls))==null?void 0:vn.getProgress(cn,ln),gn=this.getCFI(cn,ln);this.lastLocation={...hn,tocItem:fn,pageItem:pn,cfi:gn,range:ln},(sn==="snap"||sn==="page"||sn==="scroll")&&this.history.replaceState(gn),dr(this,jr,Go).call(this,"relocate",this.lastLocation)},cl=function({doc:sn,index:ln}){var cn,un;(cn=sn.documentElement).lang||(cn.lang=this.language.canonical??""),this.language.isCJK||(un=sn.documentElement).dir||(un.dir=this.language.direction??""),dr(this,jr,ul).call(this,sn,ln),$n(this,Ta).cloneFor(sn.documentElement),dr(this,jr,Go).call(this,"load",{doc:sn,index:ln})},ul=function(sn,ln){const{book:cn}=this,un=cn.sections[ln];sn.addEventListener("click",dn=>{var gn,mn;const hn=dn.target.closest("a[href]");if(!hn)return;dn.preventDefault();const fn=hn.getAttribute("href"),pn=((gn=un==null?void 0:un.resolveHref)==null?void 0:gn.call(un,fn))??fn;(mn=cn==null?void 0:cn.isExternal)!=null&&mn.call(cn,pn)?Promise.resolve(dr(this,jr,Go).call(this,"external-link",{a:hn,href:pn},!0)).then(bn=>bn?globalThis.open(pn,"_blank"):null).catch(bn=>console.error(bn)):Promise.resolve(dr(this,jr,Go).call(this,"link",{a:hn,href:pn},!0)).then(bn=>bn?this.goTo(pn):null).catch(bn=>console.error(bn))})},ga=function(sn){return this.renderer.getContents().find(ln=>ln.index===sn&&ln.overlayer)},dl=function({doc:sn,index:ln}){const cn=new Overlayer(sn);sn.addEventListener("click",dn=>{const[hn,fn]=cn.hitTest(dn);hn&&!hn.startsWith(SEARCH_PREFIX)&&dr(this,jr,Go).call(this,"show-annotation",{value:hn,index:ln,range:fn})},!1);const un=$n(this,Yo).get(ln);if(un)for(const dn of un)this.addAnnotation(dn);return dr(this,jr,Go).call(this,"create-overlay",{index:ln}),cn},hl=async function*(sn,ln,cn){const un=await this.book.sections[cn].createDocument();for(const{range:dn,excerpt:hn}of sn(un,ln))yield{cfi:this.getCFI(cn,dn),excerpt:hn}},pl=async function*(sn,ln){const{sections:cn}=this.book;for(const[un,{createDocument:dn}]of cn.entries()){if(!dn)continue;const hn=await dn(),fn=Array.from(sn(hn,ln),({range:gn,excerpt:mn})=>({cfi:this.getCFI(un,gn),excerpt:mn}));yield{progress:(un+1)/cn.length},fn.length&&(yield{index:un,subitems:fn})}},il);customElements.define("foliate-view",View$1);function createFoliateView(an){const on=document.createElement("foliate-view");return on.style.cssText="width:100%;height:100%",on.setAttribute("persist","false"),an.appendChild(on),on}function configureView(an,on){const sn=an.renderer;if(!sn)return;const{viewMode:ln="single",pageAnimation:cn="slide",layoutSettings:un,visualSettings:dn,theme:hn,customTheme:fn}=on||{},pn=un||{gap:5,headerFooterMargin:0},gn=hn==="custom"?fn:hn&&PRESET_THEMES[hn]||PRESET_THEMES.default,mn=ln==="scroll",bn=(yn,wn)=>sn.setAttribute(yn,wn),vn=(yn,wn,kn="")=>wn?bn(yn,kn):sn.removeAttribute(yn);bn("flow",mn?"scrolled":"paginated"),bn("max-column-count",ln==="double"?"2":"1"),vn("animated",!mn&&cn==="slide"),bn("gap",`${pn.gap||5}%`),bn("max-inline-size","800px"),vn("margin",(pn.headerFooterMargin||0)>0,`${pn.headerFooterMargin}px`),applyVisualFilter(dn),applyViewTheme(an,gn)}function applyVisualFilter(an={}){var sn;(sn=document.getElementById("sireader-visual-filter"))==null||sn.remove();const on=[an.brightness!==1&&`brightness(${an.brightness})`,an.contrast!==1&&`contrast(${an.contrast})`,an.sepia>0&&`sepia(${an.sepia})`,an.saturate!==1&&`saturate(${an.saturate})`,an.invert&&"invert(1) hue-rotate(180deg)"].filter(Boolean);on.length&&Object.assign(document.head.appendChild(document.createElement("style")),{id:"sireader-visual-filter",textContent:`foliate-view::part(filter){filter:${on.join(" ")}}`})}function applyViewTheme(an,on){const sn=on.bgImg?`url("${on.bgImg}") center/cover no-repeat`:on.bg;Object.assign(an.style,{background:sn,color:on.color})}function applyCustomCSS(an,on){var kn,_n,xn;const{textSettings:sn,paragraphSettings:ln,layoutSettings:cn,theme:un,customTheme:dn}=on||{},hn=sn||{fontFamily:"inherit",fontSize:16,letterSpacing:0,customFont:{fontFamily:"",fontFile:""}},fn=ln||{lineHeight:1.8,textIndent:2,paragraphSpacing:1},pn=cn||{marginHorizontal:40,marginVertical:20},gn=un==="custom"?dn:un&&PRESET_THEMES[un]||PRESET_THEMES.default,mn=hn.fontFamily==="custom"&&((kn=hn.customFont)==null?void 0:kn.fontFamily),bn=mn?`"${hn.customFont.fontFamily}", sans-serif`:hn.fontFamily||"inherit",vn=mn?`@font-face{font-family:"${hn.customFont.fontFamily}";src:url("${window.location.origin}/plugins/custom-fonts/${hn.customFont.fontFile}")}`:"",yn=gn.bgImg?`background:url("${gn.bgImg}") center/cover no-repeat`:`background:${gn.bg}`,wn=`@namespace epub "http://www.idpf.org/2007/ops";${vn}html{color-scheme:light dark}body{${yn}!important;color:${gn.color}!important;font-family:${bn}!important;font-size:${hn.fontSize||16}px!important;letter-spacing:${hn.letterSpacing||0}em!important;padding:${pn.marginVertical}px ${pn.marginHorizontal}px!important}p,li,blockquote,dd{line-height:${fn.lineHeight||1.8}!important;text-align:start;text-indent:${fn.textIndent||2}em!important;margin-bottom:${fn.paragraphSpacing||1}em!important}[align="left"]{text-align:left!important}[align="right"]{text-align:right!important}[align="center"]{text-align:center!important}[align="justify"]{text-align:justify!important}pre{white-space:pre-wrap!important}`;(xn=(_n=an.renderer)==null?void 0:_n.setStyles)==null||xn.call(_n,wn)}function getCurrentLocation(an){var on;if(!an.renderer)return null;try{const sn=an.renderer.location;return sn?{index:sn.index??0,fraction:sn.fraction??0,cfi:(on=an.lastLocation)==null?void 0:on.cfi}:null}catch(sn){return console.error("[FoliateView] Failed to get location:",sn),null}}function destroyView(an){try{an.remove()}catch{}}class FoliateReader{constructor(on){ir(this,"view");ir(this,"container");ir(this,"settings");ir(this,"bookUrl");ir(this,"plugin");ir(this,"marks");ir(this,"searchManager");ir(this,"eventListeners",new Map);ir(this,"check",()=>!!this.view.renderer||(console.warn("[Reader] Renderer not ready"),!1));ir(this,"getLocation",()=>getCurrentLocation(this.view));ir(this,"getProgress",()=>this.view.lastLocation);ir(this,"canGoBack",()=>{var on;return((on=this.view.history)==null?void 0:on.canGoBack)??!1});ir(this,"canGoForward",()=>{var on;return((on=this.view.history)==null?void 0:on.canGoForward)??!1});ir(this,"goBack",()=>{var on;return(on=this.view.history)==null?void 0:on.back()});ir(this,"goForward",()=>{var on;return(on=this.view.history)==null?void 0:on.forward()});ir(this,"clearSearch",()=>this.searchManager.clear());ir(this,"nextSearchResult",()=>this.searchManager.next());ir(this,"prevSearchResult",()=>this.searchManager.prev());ir(this,"getSearchResults",()=>this.searchManager.getResults());ir(this,"getCurrentSearchResult",()=>this.searchManager.getCurrent());ir(this,"deselect",()=>{var on,sn;return(sn=(on=this.view).deselect)==null?void 0:sn.call(on)});ir(this,"off",(on,sn)=>{var ln;return(ln=this.eventListeners.get(on))==null?void 0:ln.delete(sn)});ir(this,"getBook",()=>this.view.book);ir(this,"getView",()=>this.view);this.container=on.container,this.settings=on.settings,this.bookUrl=on.bookUrl,this.plugin=on.plugin,this.view=createFoliateView(this.container),this.searchManager=new EPUBSearch(this.view),this.setupEventListeners(),this.listenToSettingsChanges()}async open(on){await this.view.open(on),this.applySettings(),this.marks&&await this.marks.init(),this.emit("loaded",{book:this.view.book})}applySettings(){configureView(this.view,this.settings),applyCustomCSS(this.view,this.settings)}setupEventListeners(){["relocate","load","external-link"].forEach(on=>{this.view.addEventListener(on,(sn=>this.emit(on,sn.detail)))}),this.view.addEventListener("load",(on=>{const{doc:sn}=on.detail||{};sn&&sn.querySelectorAll("img").forEach(ln=>{ln.onerror=()=>{ln.style.display="none"}})})),this.view.addEventListener("link",(on=>{var fn,pn,gn,mn;const{a:sn,href:ln}=on.detail;if(!sn||!ln){this.emit("link",on.detail);return}const cn=new Set((pn=(fn=sn==null?void 0:sn.getAttributeNS)==null?void 0:fn.call(sn,"http://www.idpf.org/2007/ops","type"))==null?void 0:pn.split(" ")),un=new Set((mn=(gn=sn==null?void 0:sn.getAttribute)==null?void 0:gn.call(sn,"role"))==null?void 0:mn.split(" ")),dn=bn=>{const vn=getComputedStyle(bn);return bn.matches("sup")||vn.verticalAlign==="super"||vn.verticalAlign==="top"||/^\d/.test(vn.verticalAlign)};["doc-noteref","doc-biblioref","doc-glossref"].some(bn=>un.has(bn))||["noteref","biblioref","glossref"].some(bn=>cn.has(bn))||!cn.has("backlink")&&!un.has("doc-backlink")&&(dn(sn)||sn.children.length===1&&dn(sn.children[0])||dn(sn.parentElement))?(on.preventDefault(),this.showFootnote(sn,ln).catch(()=>{})):this.emit("link",on.detail)}))}async showFootnote(on,sn){var ln,cn,un,dn,hn;try{const fn=await this.view.book.resolveHref(sn),pn=this.view.book.sections[fn==null?void 0:fn.index];if(!pn)return;const gn=new DOMParser().parseFromString(await(await fetch(await pn.load())).text(),"text/html"),mn=fn.anchor(gn);if(!mn)return;const bn=new Set((cn=(ln=mn==null?void 0:mn.getAttributeNS)==null?void 0:ln.call(mn,"http://www.idpf.org/2007/ops","type"))==null?void 0:cn.split(" ")),vn=new Set((dn=(un=mn==null?void 0:mn.getAttribute)==null?void 0:un.call(mn,"role"))==null?void 0:dn.split(" ")),yn=vn.has("doc-endnote")||bn.has("endnote")||bn.has("rearnote")?"":vn.has("doc-footnote")||bn.has("footnote")?"":vn.has("doc-biblioentry")||bn.has("biblioentry")?"":vn.has("definition")||bn.has("glossdef")?"":bn.has("note")?"":"",wn=mn.id||mn.getAttribute("id")||"",kn=mn.startContainer?mn:gn.createRange();mn.startContainer||(mn.matches("li, aside")?kn.selectNodeContents(mn):kn.selectNode(mn));const _n=document.createElement("div");_n.appendChild(kn.cloneContents());let xn=document.querySelector("[data-footnote-tooltip]");xn||(xn=document.createElement("div"),xn.setAttribute("data-footnote-tooltip","true"),xn.style.cssText="position:fixed;display:none;width:340px;background:var(--b3-theme-surface);border:1px solid var(--b3-border-color);border-radius:12px;box-shadow:0 8px 24px rgba(0,0,0,.12),0 4px 8px rgba(0,0,0,.08),0 0 1px rgba(0,0,0,.1);z-index:99999;pointer-events:auto;overflow:hidden;backdrop-filter:blur(10px);transform:translateY(0);transition:transform .2s cubic-bezier(.4,0,.2,1),opacity .2s cubic-bezier(.4,0,.2,1)",document.body.appendChild(xn));const En=`<div style="padding:14px;font-size:13px;line-height:1.7;color:var(--b3-theme-on-surface);max-height:300px;overflow-y:auto;word-wrap:break-word;word-break:break-word;background:var(--b3-theme-surface)">${_n.innerHTML}</div>`;xn.innerHTML=createTooltip({icon:"#iconMark",iconColor:"#ef4444",title:yn,content:En,id:wn?`#${wn}`:void 0});const Tn=on.getBoundingClientRect(),Bn=(hn=on.ownerDocument.defaultView)==null?void 0:hn.frameElement,Nn=Bn==null?void 0:Bn.getBoundingClientRect(),Mn=((Nn==null?void 0:Nn.left)||0)+Tn.left,Ln=((Nn==null?void 0:Nn.top)||0)+Tn.bottom+8;let On;showTooltip(xn,Mn,Ln),on.onmouseenter=()=>{clearTimeout(On),showTooltip(xn,Mn,Ln)},on.onmouseleave=()=>{On=setTimeout(()=>hideTooltip(xn),100)},xn.onmouseenter=()=>clearTimeout(On),xn.onmouseleave=()=>hideTooltip(xn)}catch(fn){console.error("[Footnote]",fn)}}listenToSettingsChanges(){window.addEventListener("sireaderSettingsUpdated",(on=>this.updateSettings(on.detail)))}async goTo(on){this.check()&&await this.view.goTo(on)}async goLeft(){this.check()&&await this.view.goLeft()}async goRight(){this.check()&&await this.view.goRight()}async prev(){this.check()&&await this.view.prev()}async next(){this.check()&&await this.view.next()}async goToFraction(on){this.check()&&await this.view.goToFraction(on)}async*search(on,sn){yield*this.searchManager.search(on,sn)}async select(on){this.view.select&&await this.view.select(on)}getSelectedText(){var on,sn,ln;try{const cn=(sn=(on=this.view.renderer)==null?void 0:on.getContents)==null?void 0:sn.call(on);if(!cn)return null;for(const{doc:un}of cn){const dn=(ln=un.defaultView)==null?void 0:ln.getSelection();if(dn&&!dn.isCollapsed)return{text:dn.toString(),range:dn.getRangeAt(0)}}}catch(cn){console.error("[Reader] Selection error:",cn)}return null}on(on,sn){this.eventListeners.has(on)||this.eventListeners.set(on,new Set),this.eventListeners.get(on).add(sn)}emit(on,sn){var ln;(ln=this.eventListeners.get(on))==null||ln.forEach(cn=>{try{cn(sn)}catch(un){console.error(`[Reader] Event error (${on}):`,un)}})}updateSettings(on){this.settings=on,this.applySettings()}async destroy(){var on;await((on=this.marks)==null?void 0:on.destroy()),this.eventListeners.clear(),destroyView(this.view)}}function createReader(an){return new FoliateReader(an)}async function detectAndDecodeText(an){const on=new Uint8Array(an);if(on.length>=3&&on[0]===239&&on[1]===187&&on[2]===191)return new TextDecoder("utf-8").decode(on.slice(3));if(on.length>=2){if(on[0]===255&&on[1]===254)return new TextDecoder("utf-16le").decode(on.slice(2));if(on[0]===254&&on[1]===255)return new TextDecoder("utf-16be").decode(on.slice(2))}try{const sn=new TextDecoder("utf-8",{fatal:!0}).decode(on);if(!sn.includes(""))return sn}catch{}try{return new TextDecoder("gbk").decode(on)}catch{return new TextDecoder("utf-8").decode(on)}}async function loadTxtBook(an,on,sn,ln,cn){let un="";on instanceof ArrayBuffer?un=await detectAndDecodeText(on):un=on;const dn=sn.length?sn:splitTxtContent(un),hn=async gn=>{let mn="";if(gn.url&&ln)try{const bn=await bookSourceManager.getChapterContent(ln.sourceUrl||ln.origin,gn.url);mn=toHtml(gn.title,bn)}catch{mn=toHtml(gn.title,"")}else mn=toHtml(gn.title,gn.content||"");return URL.createObjectURL(new Blob([mn],{type:"text/html"}))},fn={sections:dn.map((gn,mn)=>({load:()=>hn(gn),id:`chapter-${mn}`,linear:"yes"})),toc:dn.map((gn,mn)=>({label:gn.title,href:`#chapter-${mn}`,level:0})),resolveHref:gn=>{const mn=gn.match(/#chapter-(\d+)/);return mn?{index:parseInt(mn[1]),anchor:()=>null}:null},resolveCFI:()=>null};await an.open(fn),cn&&(configureView(an,cn),applyCustomCSS(an,cn));const pn=(gn,mn=0)=>{var wn;const bn=((wn=dn[gn])==null?void 0:wn.title)||"",vn=dn.length,yn=vn>0?(gn+mn)/vn:0;return an.lastLocation={section:gn,fraction:yn,label:bn,tocItem:{label:bn,href:`#chapter-${gn}`},index:gn},an.lastLocation};pn(0,0),an.addEventListener("relocate",(gn=>{const mn=gn.detail||{};let bn=mn.index??mn.section??0;if(!bn&&mn.cfi){const vn=mn.cfi.match(/\/6\/(\d+)/);vn&&(bn=Math.floor((parseInt(vn[1])-2)/2))}pn(bn,mn.fraction||0),setTimeout(()=>{var vn,yn;try{const wn=(yn=(vn=an.renderer)==null?void 0:vn.getContents)==null?void 0:yn.call(vn),kn=an.marks;if(wn&&kn&&typeof kn.bindTxtDocEvents=="function")for(const{doc:_n}of wn)_n&&_n.body&&kn.bindTxtDocEvents(_n,bn)}catch{}},200)})),an.getLocation=()=>{const gn=an.renderer;return(gn==null?void 0:gn.index)!==void 0?pn(gn.index,gn.fraction||0):an.lastLocation||pn(0,0)}}function splitTxtContent(an){const on=an.split(`
`),sn=[];let ln=null,cn=0;const un=/^([\d]+[]|Chapter\s+\d+|\d+\.|.*?)/i;for(const dn of on){const hn=dn.trim();un.test(hn)?(ln&&sn.push({index:cn++,title:ln.title,content:ln.content.join(`
`)}),ln={title:hn||` ${cn+1} `,content:[]}):hn&&(ln||(ln={title:"",content:[]}),ln.content.push(hn))}return ln&&sn.push({index:cn,title:ln.title,content:ln.content.join(`
`)}),sn.length?sn:[{index:0,title:"",content:an}]}function toHtml(an,on){const sn=cn=>{const un=document.createElement("div");return un.textContent=cn,un.innerHTML},ln=sn(on).split(/\n+/).map(cn=>cn.trim()).filter(Boolean).map(cn=>`<p>${cn}</p>`).join("");return`<!DOCTYPE html><html><head><meta charset="utf-8"><style>body{max-width:800px;margin:0 auto;padding:2em;font-size:18px;line-height:1.8}h1{text-align:center;margin-bottom:2em}p{text-indent:2em;margin:1em 0}</style></head><body><h1>${sn(an)}</h1>${ln}</body></html>`}const reader=Object.freeze(Object.defineProperty({__proto__:null,FoliateReader,applyCustomCSS,configureView,createFoliateView,createReader,destroyView,getCurrentLocation,loadTxtBook},Symbol.toStringTag,{value:"Module"})),activeView=ref(null),activeReader=ref(null),setActiveReader=(an,on)=>{activeView.value=an,activeReader.value=on||null,window.__sireader_active_view=an,window.__sireader_active_reader=on||null},clearActiveReader=()=>{activeView.value=null,activeReader.value=null,window.__sireader_active_view=null,window.__sireader_active_reader=null},useReaderState=()=>({activeView:computed(()=>activeView.value),activeReader:computed(()=>activeReader.value),canShowToc:computed(()=>!!activeView.value)}),BASE_URL="https://dictionary.cambridge.org",MXNZP_ID="guuhjloujpkfenn1",MXNZP_SECRET="izYrfPlqfRMxrXHUCf5vEbD4WSxnjSow",DICT_PATH="/data/storage/petal/siyuan-sireader/dictionaries/",DICT_NAMES={ai:"AI","ai-free":"AI()",cambridge:"",youdao:"",haici:"",mxnzp:"",ciyu:"",zdic:"",offline:"",bing:""},getDictName=an=>DICT_NAMES[an]||an,POS_MAP={n:{name:"n.",color:"#2563eb"},noun:{name:"n.",color:"#2563eb"},v:{name:"v.",color:"#059669"},verb:{name:"v.",color:"#059669"},vt:{name:"vt.",color:"#047857"},vi:{name:"vi.",color:"#0d9488"},a:{name:"adj.",color:"#d97706"},adj:{name:"adj.",color:"#d97706"},adjective:{name:"adj.",color:"#d97706"},ad:{name:"adv.",color:"#ea580c"},adv:{name:"adv.",color:"#ea580c"},adverb:{name:"adv.",color:"#ea580c"},prep:{name:"prep.",color:"#7c3aed"},conj:{name:"conj.",color:"#9333ea"},pron:{name:"pron.",color:"#db2777"},int:{name:"int.",color:"#dc2626"},art:{name:"art.",color:"#4f46e5"}},ONLINE_DICTS=[{id:"ai-free",name:"AI()",icon:"#iconSparkles",enabled:!0,desc:"AI"},{id:"ai",name:"AI()",icon:"#iconSparkles",enabled:!0,desc:"AI"},{id:"cambridge",name:"",icon:"#iconLanguage",enabled:!0,desc:""},{id:"youdao",name:"",icon:"https://shared.ydstatic.com/images/favicon.ico",enabled:!0,desc:""},{id:"haici",name:"",icon:"https://dict.cn/favicon.ico",enabled:!0,desc:""},{id:"mxnzp",name:"",icon:"#iconA",enabled:!0,desc:""},{id:"ciyu",name:"",icon:"#iconFont",enabled:!0,desc:""},{id:"zdic",name:"",icon:"https://www.zdic.net/favicon.ico",enabled:!0,desc:""},{id:"bing",name:"",icon:"https://cn.bing.com/favicon.ico",enabled:!0,url:"https://cn.bing.com/dict/search?q={{word}}",desc:""}];let plugin$1=null,onlineDicts=[...ONLINE_DICTS];class OfflineDictManager{constructor(){ir(this,"dicts",[]);ir(this,"loaded",new Map);ir(this,"loading",new Map);ir(this,"initialized",!1);ir(this,"dictDataLoaded",new Set);ir(this,"inflate",async on=>{const{inflate:sn}=await Promise.resolve().then(()=>browser);return new Promise((ln,cn)=>{sn(on,(un,dn)=>un?cn(un):ln(dn))})});ir(this,"getDicts",()=>this.dicts)}async init(on){var sn;if(!this.initialized){plugin$1=on,this.initialized=!0;try{await fetch("/api/file/putFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:DICT_PATH,isDir:!0,file:""})}).catch(()=>{});const ln=await plugin$1.loadData("dictionaries/config.json");(sn=ln==null?void 0:ln.dicts)!=null&&sn.length&&(this.dicts=ln.dicts.map(cn=>({id:cn.id,name:cn.name,type:cn.type,enabled:cn.enabled,files:cn.files})),this.preloadIndexes())}catch(ln){console.error("[Dict] Init:",ln)}}}async preloadIndexes(){const on=await Promise.resolve().then(()=>dict);await Promise.all(this.dicts.filter(sn=>sn.enabled).map(async sn=>{try{const ln=sn.type==="stardict"?new on.StarDict:new on.DictdDict,cn=sn.type==="stardict"?[sn.files.ifo,sn.files.idx,sn.files.syn]:[sn.files.index],un={ifo:"loadIfo",idx:"loadIdx",syn:"loadSyn",index:"loadIndex"};await Promise.all(cn.filter(Boolean).map(async dn=>{const hn=Object.keys(sn.files).find(fn=>sn.files[fn]===dn);hn&&un[hn]&&await ln[un[hn]](await this.loadFile(dn))})),this.loaded.set(sn.id,ln)}catch(ln){console.error("[Dict] Preload:",sn.name,ln)}}))}async loadDict(on){if(this.loading.has(on.id))return this.loading.get(on.id);const sn=(async()=>{try{let ln=this.loaded.get(on.id);if(!ln){const cn=await Promise.resolve().then(()=>dict);ln=on.type==="stardict"?new cn.StarDict:new cn.DictdDict;const un=[["ifo","loadIfo"],["idx","loadIdx"],["syn","loadSyn"],["index","loadIndex"]];await Promise.all(un.map(async([dn,hn])=>on.files[dn]&&ln[hn](await this.loadFile(on.files[dn])))),this.loaded.set(on.id,ln)}on.files.dz&&!this.dictDataLoaded.has(on.id)&&(await ln.loadDict(await this.loadFile(on.files.dz),this.inflate),this.dictDataLoaded.add(on.id))}finally{this.loading.delete(on.id)}})();return this.loading.set(on.id,sn),sn}async loadFile(on){const sn=await fetch("/api/file/getFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:on})});if(!sn.ok)throw new Error("File not found");const ln=await sn.blob();return new File([ln],on.split("/").pop()||"file")}async lookup(on){for(const sn of this.dicts.filter(ln=>ln.enabled))try{await this.loadDict(sn);const ln=this.loaded.get(sn.id);if(!ln)continue;const cn=await ln.lookup(on);if(!(cn!=null&&cn.length))continue;for(const un of cn)if(Array.isArray(un.data))for(const dn of un.data)dn[1]instanceof Promise&&(dn[1]=await dn[1]);return cn}catch(ln){console.error("[Dict] Lookup:",sn.name,ln)}return null}async sortDicts(on){const sn=new Map(this.dicts.map(ln=>[ln.id,ln]));this.dicts=on.map(ln=>sn.get(ln)).filter(Boolean),await this.saveConfig()}async addDict(on){if(!plugin$1||!on.length)return;const sn=new Map,ln={ifo:"ifo","dict.dz":"dz",dz:"dz",idx:"idx",index:"index",syn:"syn"};Array.from(on).forEach(cn=>{var hn;const un=cn.name.replace(/\.(ifo|dict\.dz|dz|idx|index|syn)$/i,""),dn=(hn=cn.name.match(/\.(ifo|dict\.dz|dz|idx|index|syn)$/i))==null?void 0:hn[1].toLowerCase();dn&&ln[dn]&&(sn.has(un)||sn.set(un,{}),sn.get(un)[ln[dn]]=cn)});for(const[cn,un]of sn)try{const dn=`dict_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,hn=`${DICT_PATH}${dn}/`,fn={};await fetch("/api/file/putFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:hn,isDir:!0,file:""})});for(const[pn,gn]of Object.entries(un))if(gn){const mn=`${hn}${gn.name}`,bn=new FormData;bn.append("path",mn),bn.append("file",gn),bn.append("isDir","false"),await fetch("/api/file/putFile",{method:"POST",body:bn}),fn[pn]=mn}this.dicts.push({id:dn,name:cn,type:un.ifo||un.idx?"stardict":"dictd",enabled:!0,files:fn}),await this.saveConfig()}catch(dn){throw console.error("[Dict] Add:",cn,dn),dn}}async removeDict(on){const sn=this.dicts.findIndex(ln=>ln.id===on);sn>=0&&(await fetch("/api/file/removeFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:`${DICT_PATH}${on}/`})}).catch(()=>{}),this.dicts.splice(sn,1),this.loaded.delete(on),await this.saveConfig())}async toggleDict(on){const sn=this.dicts.find(ln=>ln.id===on);sn&&(sn.enabled=!sn.enabled,await this.saveConfig())}async saveConfig(){plugin$1&&await plugin$1.saveData("dictionaries/config.json",{dicts:this.dicts.map(({id:on,name:sn,type:ln,enabled:cn,files:un})=>({id:on,name:sn,type:ln,enabled:cn,files:un}))})}}const offlineDictManager=new OfflineDictManager;class OnlineDictManager{constructor(){ir(this,"getDicts",()=>onlineDicts)}async init(on){var ln;plugin$1=on;const sn=await plugin$1.loadData("dictionaries/config.json");(ln=sn==null?void 0:sn.online)==null||ln.forEach(cn=>{const un=onlineDicts.find(dn=>dn.id===cn.id);un&&(un.enabled=cn.enabled)})}async sortDicts(on){const sn=new Map(onlineDicts.map(ln=>[ln.id,ln]));onlineDicts=on.map(ln=>sn.get(ln)).filter(Boolean),await this.saveConfig()}async toggleDict(on){const sn=onlineDicts.find(ln=>ln.id===on);sn&&(sn.enabled=!sn.enabled,await this.saveConfig())}async saveConfig(){if(!plugin$1)return;const on=await plugin$1.loadData("dictionaries/config.json")||{dicts:[]};on.online=onlineDicts.map(sn=>({id:sn.id,enabled:sn.enabled})),await plugin$1.saveData("dictionaries/config.json",on)}}const onlineDictManager=new OnlineDictManager;function initDictModule(an){plugin$1=an,Promise.all([offlineDictManager.init(an),onlineDictManager.init(an)]).catch(on=>console.error("[Dict] Init error:",on))}const deckCards=[];let deckLoaded=!1;const loadDeck=async()=>{if(!(deckLoaded||!plugin$1))try{const an=await plugin$1.loadData("dictionaries/deck.json");an!=null&&an.cards&&deckCards.push(...an.cards),deckLoaded=!0}catch(an){console.error("[Deck] Load:",an)}},saveDeck=async()=>plugin$1&&plugin$1.saveData("dictionaries/deck.json",{cards:deckCards}).catch(an=>console.error("[Deck] Save:",an)),notifyDeckUpdate=()=>window.dispatchEvent(new Event("sireader:deck-updated")),addToDeck=async(an,on,sn,ln,cn,un,dn,hn)=>(await loadDeck(),deckCards.some(fn=>fn.word===an&&fn.dictId===on)?!1:(deckCards.push({id:`${on}-${an}-${Date.now()}`,word:an,dictId:on,data:sn,timestamp:Date.now(),cfi:ln,section:cn,bookUrl:un,page:dn,rects:hn}),await saveDeck(),notifyDeckUpdate(),!0)),loadDeckCards=async()=>(await loadDeck(),deckCards),getDeckCards=()=>deckCards,removeFromDeck=async an=>{const on=deckCards.findIndex(sn=>sn.id===an);return on>=0?(deckCards.splice(on,1),await saveDeck(),notifyDeckUpdate(),!0):!1},fetchHTML=async an=>new DOMParser().parseFromString(await(await fetch(an)).text(),"text/html"),getTexts=(an,on)=>Array.from(an.querySelectorAll(on)).map(sn=>{var ln;return(ln=sn.textContent)==null?void 0:ln.trim()}).filter(Boolean),parseText=an=>{const on=[],sn=[/([^]+)/g,/\[([^\]]+)\]/g,/([^]+)/g,/<([^>]+)>/g];let ln=an;sn.forEach(dn=>Array.from(an.matchAll(dn)).forEach(hn=>{const fn=hn[1].trim();if(fn&&fn.length<=20){const pn=/^(||||||||)$/.test(fn)?"":/^(|||||||||||||||||)$/.test(fn)||fn.includes("")?"":"";on.push({label:pn,text:fn}),ln=ln.replace(hn[0],"")}}));const cn=ln.match(/^([^:]+)[:]\s*(.+)/);cn&&cn[1].trim().length<=10&&(on.push({label:"",text:`${cn[1].trim()}${cn[2]}`}),ln=cn[2]),ln=ln.trim();const un=ln.match(/^([a-z]{1,4})\.\s*(.+)/i);return un?{pos:un[1],text:un[2].trim(),extras:on}:{pos:"",text:ln,extras:on}},mergeExtras=an=>{const on=new Map;return an.forEach(sn=>sn.forEach(({label:ln,text:cn})=>(on.has(ln)||on.set(ln,new Set),on.get(ln).add(cn)))),Array.from(on).map(([sn,ln])=>({label:sn,text:Array.from(ln).join("")}))},AI_PROMPT='{{to}}{{to}}1.{{to}}{{to}}{{to}}{{to}}2.{{to}}{{to}}3.4.HTML5.1."""xxx)"2.JSON3.4.5.{{text}}',queryAICommon=async(an,on,sn,ln,cn)=>{try{const un=/[\u4e00-\u9fa5]/.test(an),dn=un?"us-en":"zh-cn",hn=on?AI_PROMPT.replace(/\{\{to\}\}/g,dn).replace("{{text}}",an):un?`${an}`:`${an}`,fn=new AbortController,pn=setTimeout(()=>fn.abort(),6e4),gn=await fetch(sn,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(ln(hn)),signal:fn.signal}).finally(()=>clearTimeout(pn));if(!gn.ok)return cn.config?{word:an,defs:[cn.config]}:null;const mn=await gn.json();if(mn.code!==0||!mn.data)return{word:an,defs:[cn.fail]};const bn=(mn.data||await gn.text()).trim().replace(/\*\*(.+?)\*\*/g,"<strong>$1</strong>");return{word:an,defs:bn.split(`
`).filter(vn=>vn.trim())}}catch(un){return un.name==="AbortError"?{word:an,defs:[cn.timeout]}:{word:an,defs:[cn.unavailable]}}};async function queryAIFree(an,on=!1){const sn=/[\u4e00-\u9fa5]/.test(an);return queryAICommon(an,on,"https://ai.bingal.com/api/v1/translate",ln=>({text:ln,lang:sn?"us-en":"zh-cn"}),{config:"",fail:"",timeout:"",unavailable:""}).catch(()=>null)}async function queryAI(an,on=!1){const sn=()=>{const ln=document.querySelector("#progress:has(.b3-dialog__loading)");ln?ln.remove():requestAnimationFrame(sn)};return sn(),queryAICommon(an,on,"/api/ai/chatGPT",ln=>({msg:ln}),{config:`AI 
   AI  OpenAI API  AI 

 "AI()"`,fail:`AI  AI 

 "AI()"`,timeout:`AI 


 "AI()"`,unavailable:`AI 

  AI 
 API 
 

 "AI()"`})}const queryWithParse=async(an,on,sn)=>{try{const ln=await on();if(!ln)return null;const cn=ln.rawDefs.map(hn=>parseText(hn).extras),un=ln.rawDefs.map(hn=>{const fn=parseText(hn);return{pos:fn.pos,text:fn.text}}),dn=ln.audio&&ln.phonetic?[{text:ln.phonetic,audio:ln.audio}]:void 0;return{word:ln.entry,phonetic:ln.phonetic||"",phonetics:dn,meanings:un,extras:[...mergeExtras(cn),{label:"",text:sn}]}}catch{return null}};async function queryYoudao(an){const{data:on}=await(await fetch(`https://dict.youdao.com/suggest?q=${encodeURIComponent(an)}&le=en&num=5&doctype=json`)).json().catch(()=>({data:null})),sn=(on==null?void 0:on.entries)||[];if(!sn.length)return null;const ln=[],cn=sn.slice(0,5).flatMap(un=>un.explain.split(/;\s*/).map(dn=>{const hn=parseText(dn);return ln.push(hn.extras),{pos:hn.pos,text:un.entry===an?hn.text:`${un.entry} - ${hn.text}`}}));return{word:sn[0].entry,meanings:cn,extras:[...mergeExtras(ln),{label:"",text:""}]}}const queryHaici=an=>queryWithParse(an,async()=>{var dn,hn,fn,pn,gn,mn;const on=await fetchHTML(`https://dict.cn/${encodeURIComponent(an)}`),sn=(hn=(dn=on.querySelector(".keyword"))==null?void 0:dn.textContent)==null?void 0:hn.trim(),ln=(gn=(pn=(fn=on.querySelector(".phonetic"))==null?void 0:fn.textContent)==null?void 0:pn.trim())==null?void 0:gn.replace(/\s+/g," "),cn=(mn=on.querySelector(".audio-btn"))==null?void 0:mn.getAttribute("data-src"),un=getTexts(on,".layout.basic li, .layout li, .dict-basic-ul li").filter(bn=>bn.length<200).slice(0,10);return sn&&un.length?{entry:sn,phonetic:ln,audio:cn,rawDefs:un}:null},"");async function queryMxnzp(an){var on;try{const sn=await(await fetch(`https://www.mxnzp.com/api/convert/dictionary?content=${encodeURIComponent(an)}&app_id=${MXNZP_ID}&app_secret=${MXNZP_SECRET}`)).json();if(sn.code!==1||!((on=sn.data)!=null&&on.length))return null;const ln=sn.data[0],cn=ln.explanation?ln.explanation.split(`
`).filter(un=>un.trim()).slice(0,10).map(un=>({pos:"",text:un})):[];return{word:ln.word+(ln.traditional!==ln.word?`${ln.traditional}`:""),phonetic:ln.pinyin||"",badges:[ln.radicals?{text:`: ${ln.radicals}`,gradient:!1}:null,ln.strokes?{text:`: ${ln.strokes}`,gradient:!1}:null].filter(Boolean),meanings:cn,extras:[{label:"",text:""}]}}catch{return null}}const buildExtras=(an,on=[],sn=[],ln="")=>[{label:"",text:ln},...an?[{label:"",text:an}]:[],...on.length?[{label:"",text:on.join("")}]:[],...sn.length?[{label:"",text:sn.join("")}]:[]];async function queryCiyu(an){var on,sn,ln,cn,un,dn,hn,fn,pn,gn,mn,bn;try{const vn=await fetchHTML(`https://hanyu.dict.cn/${encodeURIComponent(an)}`),yn=((sn=(on=vn.querySelector(".keyword"))==null?void 0:on.textContent)==null?void 0:sn.trim())||an,wn=(un=(cn=(ln=vn.querySelector(".phonetic"))==null?void 0:ln.textContent)==null?void 0:cn.trim())==null?void 0:un.replace(/\s+/g," "),kn=getTexts(vn,".basic-info .info-list li").filter(Ln=>!Ln.startsWith("")).slice(0,8),_n=getTexts(vn,".detail-info .info-mod p, .content-info p").slice(0,6),xn=getTexts(vn,".example-list li, .sent-item").slice(0,4),En=(hn=(dn=vn.querySelector(".origin-info, .source-info"))==null?void 0:dn.textContent)==null?void 0:hn.trim(),Tn=getTexts(vn,".synonym-list a, .near-word a").slice(0,8),Bn=getTexts(vn,".antonym-list a, .anti-word a").slice(0,8);let Nn=[...kn,..._n].map(Ln=>({pos:"",text:Ln})),Mn=xn.map(Ln=>({en:Ln,zh:""}));if(!Nn.length){const Ln=await fetchHTML(`https://dict.cn/${encodeURIComponent(an)}`),On=getTexts(Ln,".layout.cn ul li a").slice(0,5),zn=getTexts(Ln,".layout.ref dd ul li div").slice(0,4),Pn=Array.from(Ln.querySelectorAll(".layout.sort ol li")).slice(0,3).map(Sn=>{const Rn=Sn.innerHTML.split("<br>");return Rn.length===2?{en:Rn[0].trim(),zh:Rn[1].trim()}:null}).filter(Boolean),An=getTexts(Ln,".layout.nfo ul li a"),Vn=Math.floor(An.length/2);return Nn=[...On.map(Sn=>({pos:"",text:`: ${Sn}`})),...zn.map(Sn=>({pos:"",text:Sn}))],{word:((pn=(fn=Ln.querySelector(".keyword"))==null?void 0:fn.textContent)==null?void 0:pn.trim())||an,phonetic:((bn=(mn=(gn=Ln.querySelector(".phonetic"))==null?void 0:gn.textContent)==null?void 0:mn.trim())==null?void 0:bn.replace(/\s+/g," "))||wn||"",meanings:Nn,examples:Pn,extras:buildExtras(void 0,An.slice(0,Vn),An.slice(Vn))}}return{word:yn,phonetic:wn||"",meanings:Nn,examples:Mn,extras:buildExtras(En,Tn,Bn)}}catch{return null}}async function queryZdic(an){var on,sn,ln,cn,un,dn,hn,fn,pn,gn,mn,bn;try{const vn=await fetchHTML(`https://www.zdic.net/hans/${encodeURIComponent(an)}`),yn=((sn=(on=vn.querySelector(".z_title h1"))==null?void 0:on.textContent)==null?void 0:sn.trim())||an,wn=getTexts(vn,".jnr p").slice(0,8);if(!yn||!wn.length)return null;const kn=((un=(cn=(ln=vn.querySelector(".z_title .z_pyth"))==null?void 0:ln.textContent)==null?void 0:cn.trim())==null?void 0:un.replace(/\s+/g," "))||((fn=(hn=(dn=wn[0])==null?void 0:dn.match(/[a-z-\s]+/i))==null?void 0:hn[0])==null?void 0:fn.trim())||"",_n=(gn=(pn=vn.querySelector(".z_info span:nth-child(2)"))==null?void 0:pn.textContent)==null?void 0:gn.trim(),xn=(bn=(mn=vn.querySelector(".z_info span:nth-child(4)"))==null?void 0:mn.textContent)==null?void 0:bn.trim();return{word:yn,phonetic:kn,badges:[_n?{text:_n,gradient:!1}:null,xn?{text:xn,gradient:!1}:null].filter(Boolean),meanings:wn.map(En=>({pos:"",text:En})),extras:[{label:"",text:""}]}}catch{return null}}async function queryCambridge(an){try{const on=ln=>{var gn,mn;const cn=new DOMParser().parseFromString(ln,"text/html"),un=(mn=(gn=cn.querySelector(".headword"))==null?void 0:gn.textContent)==null?void 0:mn.trim();if(!un)return null;const dn=(bn,vn)=>{var yn,wn,kn;return{ipa:((wn=(yn=bn==null?void 0:bn.querySelector(".pron .ipa"))==null?void 0:yn.textContent)==null?void 0:wn.trim())||"",audio:((kn=bn==null?void 0:bn.querySelector('[type="audio/mpeg"]'))==null?void 0:kn.getAttribute("src"))||"",region:vn}},hn=[dn(cn.querySelector(".us"),"us"),dn(cn.querySelector(".uk"),"uk")].filter(bn=>bn.ipa),fn=new Map,pn=[];return cn.querySelectorAll(".entry-body__el").forEach(bn=>{var yn,wn;const vn=((wn=(yn=bn.querySelector(".posgram"))==null?void 0:yn.textContent)==null?void 0:wn.trim())||"unknown";bn.querySelectorAll(".dsense").forEach(kn=>kn.querySelectorAll(".def-block").forEach(_n=>{var En,Tn,Bn,Nn,Mn,Ln,On,zn;const xn=(Bn=(Tn=(En=_n.querySelector(".ddef_b"))==null?void 0:En.firstElementChild)==null?void 0:Tn.textContent)==null?void 0:Bn.trim();if(xn&&(fn.has(vn)?fn.get(vn).push(xn):fn.set(vn,[xn])),pn.length<3){const Pn=((Mn=(Nn=_n.querySelector(".examp .eg"))==null?void 0:Nn.textContent)==null?void 0:Mn.trim())||"",An=((zn=(On=(Ln=_n.querySelector(".examp .eg"))==null?void 0:Ln.nextElementSibling)==null?void 0:On.textContent)==null?void 0:zn.trim())||"";Pn&&pn.push({en:Pn,zh:An})}}))}),{word:un,phonetics:hn,parts:Array.from(fn).map(([bn,vn])=>({part:bn,means:vn})),examples:pn}},sn=async ln=>{try{const cn=await fetch(`${BASE_URL}/${ln}/${an.split(" ").join("-")}`);return cn.ok?on(await cn.text()):null}catch{return null}};return await sn("dictionary/english-chinese-simplified")||await sn("dictionary/english")}catch{return null}}function renderDictCard(an){const{word:on,phonetic:sn,phonetics:ln,badges:cn,meanings:un,defs:dn,examples:hn,extras:fn,meta:pn}=an,gn=sn?`<span class="dict-phonetic">/${sn}/</span>`:(ln==null?void 0:ln.map(yn=>`<span class="dict-phonetic">${yn.text}</span>${yn.audio?`<button class="b3-button b3-button--text dict-audio" onclick="new Audio('${yn.audio}').play()"></button>`:""}`).join(""))||"",mn=(yn,wn,kn)=>yn!=null&&yn.length?`<div class="${wn}">${yn.map(kn).join("")}</div>`:"",bn=hn!=null&&hn.length?`<div class="dict-extras"><div class="dict-extra"><span class="dict-extra-label"></span><span class="dict-extra-text">${hn.map(yn=>`<div style="margin-bottom:8px"><div style="font-style:italic;color:var(--b3-theme-on-surface)">${yn.en}</div>${yn.zh?`<div style="color:var(--b3-theme-on-surface-light);font-size:13px;opacity:.8;margin-top:4px">${yn.zh}</div>`:""}</div>`).join("")}</span></div></div>`:"",vn=cn!=null&&cn.length?`<div class="dict-badges">${cn.map(yn=>`<span class="dict-badge ${yn.gradient?"gradient":""}">${yn.text}</span>`).join("")}</div>`:"";return`<div class="dict-card"><div class="dict-card-header"><h2 class="dict-word">${on}</h2>${gn}</div>${vn}${pn?`<div class="dict-badges"><span class="dict-badge">${pn}</span></div>`:""}${mn(un,"dict-meanings",yn=>{const wn=POS_MAP[yn.pos.toLowerCase()]||{name:yn.pos||"",color:"var(--b3-theme-primary)"};return`<div class="dict-meaning">${yn.pos?`<span class="dict-pos" style="background:${wn.color}">${wn.name}</span>`:""}<span class="dict-text">${yn.text}</span></div>`})}${mn(dn,"dict-defs",yn=>`<div class="dict-def">${yn}</div>`)}${bn}${mn(fn,"dict-extras",yn=>`<div class="dict-extra"><span class="dict-extra-label">${yn.label}</span><span class="dict-extra-text">${yn.text}</span></div>`)}</div>`}function parseOfflineDict(an){const on=an[0],sn=Array.isArray(on.data)?on.data:[[on.data[0],on.data[1]]];let ln="",cn="",un="",dn="";const hn=[],fn=[],pn=[];return sn.forEach(([gn,mn])=>{gn==="m"?new TextDecoder().decode(mn).trim().split(`
`).map(bn=>bn.trim()).filter(Boolean).forEach(bn=>{var vn,yn;if(bn.startsWith("*["))ln=((vn=bn.match(/^\*\[([^\]]+)\]/))==null?void 0:vn[1])||"";else if(bn.match(/^\([\d-]+\/\d+\)$/)){const wn=bn.match(/\((\d+)\/(\d+)\)/);wn?(cn=wn[1],un=wn[2]):un=((yn=bn.match(/\d+/))==null?void 0:yn[0])||""}else if(bn.startsWith("[]")||bn.startsWith("[]"))dn=bn.replace(/^\[[^\]]+\]\s*/,"");else if(bn.match(/^[a-z]{1,3}\.\s/)){const wn=bn.match(/^([a-z]{1,3})\.\s+(.+)/);wn&&hn.push({pos:wn[1],text:wn[2]})}else if(bn.startsWith("[")&&bn.includes("]")){const wn=bn.match(/^\[([^\]]+)\]\s*(.+)/);wn&&fn.push({label:wn[1],text:wn[2]})}}):pn.push(`<div class="dict-${gn==="h"||gn==="x"?"html":"plain"}">${new TextDecoder().decode(mn)}</div>`)}),{word:on.word,phonetic:ln,badges:[cn&&cn!=="-"?{text:` ${cn}`,gradient:!0}:null,un?{text:` ${un}`,gradient:!1}:null].filter(Boolean),meanings:hn,extras:[dn?{label:"",text:dn}:null,...fn].filter(Boolean),defs:pn}}let dialog=null,state={word:"",dictId:""},selectionInfo=null;async function openDict(an,on,sn,ln){var pn,gn;state={word:an,dictId:"",data:void 0},selectionInfo=ln||null,dialog==null||dialog.destroy();const cn=offlineDictManager.getDicts().filter(mn=>mn.enabled),un=[...cn.length?[{id:"offline",name:`(${cn.length})`,icon:"#iconDatabase"}]:[],...onlineDicts.filter(mn=>mn.enabled)],dn=mn=>mn.startsWith("#")?`<svg style="width:14px;height:14px"><use xlink:href="${mn}"/></svg>`:`<img src="${mn}" style="width:14px;height:14px">`,hn=un.map(mn=>`<button class="b3-button b3-button--outline" data-id="${mn.id}" style="padding:4px 8px;font-size:12px">${dn(mn.icon)} ${mn.name}</button>`).join(""),fn=selectionInfo?'<button class="b3-button b3-button--outline" id="dict-deck-btn" style="padding:4px 12px;font-size:12px;margin-left:auto"><svg style="width:14px;height:14px"><use xlink:href="#iconAdd"/></svg> </button>':"";dialog=new siyuan.Dialog({title:" ",content:`<div class="b3-dialog__content" style="display:flex;flex-direction:column;gap:8px;height:100%"><div style="display:flex;gap:4px;flex-wrap:wrap;align-items:center">${hn}${fn}</div><div class="dict-body fn__flex-1" style="overflow-y:auto;padding:8px"></div></div>`,width:"540px",height:"600px"}),dialog.element.querySelectorAll("[data-id]").forEach(mn=>mn.addEventListener("click",()=>switchDict(mn.dataset.id))),(pn=dialog.element.querySelector("#dict-deck-btn"))==null||pn.addEventListener("click",async()=>{if(state.data&&selectionInfo&&await addToDeck(state.word,state.dictId,state.data,selectionInfo.cfi,selectionInfo.section,window.__currentBookUrl||"",selectionInfo.page,selectionInfo.rects)){const mn=dialog==null?void 0:dialog.element.querySelector("#dict-deck-btn");mn&&(mn.innerHTML='<svg style="width:14px;height:14px"><use xlink:href="#iconCheck"/></svg> ',mn.disabled=!0,mn.style.opacity="0.6"),siyuan.showMessage("",1500,"info")}}),switchDict(((gn=un[0])==null?void 0:gn.id)||"ai")}function switchDict(an){var dn;if(!dialog)return;state.dictId=an;const on="padding:4px 8px;font-size:12px";dialog.element.querySelectorAll("[data-id]").forEach(hn=>{const fn=hn,pn=fn.dataset.id===an;hn.classList.toggle("b3-button--cancel",pn),fn.style.cssText=pn?`${on};background:var(--b3-theme-primary);color:var(--b3-theme-on-primary);box-shadow:0 2px 4px rgba(0,0,0,0.2)`:on});const sn=onlineDicts.find(hn=>hn.id===an);if(sn!=null&&sn.url)return setBody(`<iframe src="${sn.url.replace("{{word}}",state.word)}" style="width:100%;height:100%;border:none"/>`);an!=="ai"&&an!=="ai-free"&&setBody('<div style="text-align:center;padding:20px;color:var(--b3-theme-on-surface-light)">...</div>');const ln=state.word.length>50||state.word.split(/[.!?]/).length>2,cn=hn=>`<div class="dict-loading"><div class="dict-loading-spinner"></div><div class="dict-loading-text">${hn} ${ln?"":""}...</div></div>`,un={offline:async()=>{const hn=await offlineDictManager.lookup(state.word);return hn?parseOfflineDict(hn):null},"ai-free":async()=>{setBody(cn("AI"));const hn=await queryAIFree(state.word,ln);return hn?{word:ln?"":hn.word,defs:hn.defs}:null},ai:async()=>{setBody(cn("AI"));const hn=await queryAI(state.word,ln);return hn?{word:ln?"":hn.word,defs:hn.defs}:null},cambridge:async()=>{const hn=await queryCambridge(state.word);return hn?{word:hn.word,phonetics:hn.phonetics.map(fn=>({text:`${fn.region==="us"?"":""} /${fn.ipa}/`,audio:"https://dictionary.cambridge.org"+fn.audio})),meanings:hn.parts.flatMap(fn=>fn.means.map(pn=>({pos:fn.part,text:pn}))),examples:hn.examples,extras:[{label:"",text:""}]}:null},youdao:()=>queryYoudao(state.word),haici:()=>queryHaici(state.word),mxnzp:()=>queryMxnzp(state.word),ciyu:()=>queryCiyu(state.word),zdic:()=>queryZdic(state.word)};(dn=un[an])==null||dn.call(un).then(hn=>{var fn;hn?(state.data=hn,setBody(renderDictCard(hn)),an==="cambridge"&&((fn=dialog==null?void 0:dialog.element.querySelector('.dict-body button[onclick*="Audio"]'))==null||fn.click())):setBody('<div style="text-align:center;padding:20px;color:var(--b3-theme-error)"></div>')}).catch(()=>setBody('<div style="text-align:center;padding:20px;color:var(--b3-theme-error)"></div>'))}const setBody=an=>dialog&&(dialog.element.querySelector(".dict-body").innerHTML=an),dictionary=Object.freeze(Object.defineProperty({__proto__:null,ONLINE_DICTS,POS_MAP,addToDeck,getDeckCards,getDictName,initDictModule,loadDeckCards,offlineDictManager,onlineDictManager,openDict,queryAI,queryCambridge,queryCiyu,queryHaici,queryMxnzp,queryYoudao,queryZdic,removeFromDeck,renderDictCard},Symbol.toStringTag,{value:"Module"})),getJumpContext=(an,on,sn)=>({isPdf:an==null?void 0:an.isPdf,pdfViewer:an==null?void 0:an.viewer,reader:on,markManager:sn,shapeManager:sn==null?void 0:sn.shapeManager,view:an}),flashElement=(an,on,sn=1200)=>{an.classList.add(on),setTimeout(()=>an.classList.remove(on),sn)},scrollAndFlash=(an,on,sn)=>{const ln=document.querySelector(".viewer-container");if(ln){const cn=an.getBoundingClientRect(),un=ln.getBoundingClientRect();ln.scrollTop+=cn.top-un.top-(un.height-cn.height)/2}flashElement(an,on)},flashSVG=an=>{const on=an.style.opacity||"1";an.style.opacity="1",setTimeout(()=>{an.style.opacity="0.3",setTimeout(()=>an.style.opacity=on,300)},300)},ensureStyle=(an,on,sn)=>{if(!an.querySelector(`#${on}`)){const ln=an.createElement("style");ln.id=on,ln.textContent=sn,an.head.appendChild(ln)}},gotoPDF=(an,on,sn,ln,cn)=>{sn&&(sn.goToPage(an),setTimeout(()=>{var dn,hn,fn,pn;if(ln==null||ln.renderPdf(an),cn==null||cn.render(an),on){const gn=document.querySelector(`[data-page="${an}"] [data-id="${on}"]`);if(gn)return scrollAndFlash(gn,"pdf-highlight--flash");const mn=(fn=(hn=(dn=cn==null?void 0:cn.controller)==null?void 0:dn.getManager(an))==null?void 0:hn.getAll())==null?void 0:fn.find(bn=>bn.id===on);if(mn){const bn=document.querySelector(`[data-page="${an}"] .pdf-shape-layer`),vn=(pn=sn.getPages().get(an))==null?void 0:pn.getViewport({scale:sn.getScale(),rotation:sn.getRotation()});if(bn&&vn){const[yn,wn,kn,_n]=mn.rect,[,xn]=vn.convertToViewportRectangle([yn,wn,yn,wn]),[,En]=vn.convertToViewportRectangle([kn,_n,kn,_n]),Tn=document.querySelector(".viewer-container");if(Tn){const Bn=bn.getBoundingClientRect(),Nn=Tn.getBoundingClientRect();Tn.scrollTop+=Bn.top+(xn+En)/2-Nn.top-Nn.height/2}flashElement(bn,"pdf-shape--flash")}return}}const un=document.querySelector(`[data-page="${an}"] .pdf-highlight`);un&&scrollAndFlash(un,"pdf-highlight--flash")},100))},gotoEPUB=(an,on,sn,ln)=>{sn==null||sn.goTo(an);const cn=()=>{var dn,hn,fn,pn,gn;let un=an;if(on){const mn=(dn=ln==null?void 0:ln.getAll())==null?void 0:dn.find(bn=>bn.id===on);mn!=null&&mn.cfi&&(un=mn.cfi)}(gn=(pn=(fn=(hn=sn==null?void 0:sn.getView())==null?void 0:hn.renderer)==null?void 0:fn.getContents)==null?void 0:pn.call(fn))==null||gn.forEach(({doc:mn,overlayer:bn})=>{var xn,En;if(!bn)return;const vn=(xn=mn.defaultView)==null?void 0:xn.frameElement,yn=(En=vn==null?void 0:vn.parentElement)==null?void 0:En.querySelector("svg");if(!yn)return;const wn=Array.from(yn.querySelectorAll('g[fill]:not([fill="none"])'));if(!wn.length)return;let kn=null;if(un)try{const Tn=sn.getView().resolveCFI(un);if(Tn!=null&&Tn.anchor){const Bn=Tn.anchor(mn);if(Bn){const Nn=Bn.getClientRects();if(Nn.length>0){const Mn=Nn[0],Ln=vn.getBoundingClientRect(),On=Mn.left+Ln.left,zn=Mn.top+Ln.top,[Pn]=bn.hitTest({x:Mn.left+Mn.width/2,y:Mn.top+Mn.height/2});Pn===un&&(kn=wn.find(An=>{const Vn=An.getBoundingClientRect();return Math.abs(Vn.left-On)<20&&Math.abs(Vn.top-zn)<20}))}}}}catch{}(kn?[kn]:wn).forEach(Tn=>flashSVG(Tn));const _n=mn.querySelectorAll("[data-note-marker]")[0];_n&&(ensureStyle(mn,"epub-flash-style","@keyframes epub-flash{0%,100%{opacity:1}50%{opacity:.3}}.epub-flash{animation:epub-flash 1.2s ease-in-out 1!important}"),flashElement(_n,"epub-flash"))})};setTimeout(cn,300),setTimeout(cn,800)},gotoTXT=(an,on,sn,ln,cn)=>{cn==null||cn.goTo(an),setTimeout(()=>{var un,dn,hn;return(hn=(dn=(un=cn==null?void 0:cn.renderer)==null?void 0:un.getContents)==null?void 0:dn.call(un))==null?void 0:hn.forEach(({doc:fn})=>{const pn=ln?fn==null?void 0:fn.querySelector(`[data-mark-id="${ln}"]`):on!==void 0&&sn?(()=>{var vn;let gn=0,mn=null;const bn=fn.createTreeWalker(fn.body,NodeFilter.SHOW_TEXT);for(let yn;yn=bn.nextNode();)if(gn+=(yn.textContent||"").length,gn>on&&(yn.textContent||"").includes(sn)){mn=(vn=yn.parentElement)==null?void 0:vn.closest("[data-txt-mark]");break}return mn})():null;pn&&(pn.scrollIntoView({block:"center"}),flashElement(pn,"epub-highlight--flash"))})},300)},jump=(an,on,sn,ln)=>{const cn=getJumpContext(on,sn,ln);cn.isPdf&&an.page?gotoPDF(an.page,an.id,cn.pdfViewer,cn.markManager,cn.shapeManager):an.cfi?gotoEPUB(an.cfi,an.id,cn.reader,cn.markManager):an.section!==void 0?gotoTXT(an.section,an.textOffset,an.text,an.id,cn.view):typeof an=="number"&&cn.isPdf&&gotoPDF(an,void 0,cn.pdfViewer,cn.markManager,cn.shapeManager)},restorePosition=async(an,on,sn,ln)=>{if(!an)return;const cn=await ln(an);cn!=null&&cn.cfi&&on?on.goTo(cn.cfi):cn!=null&&cn.page&&sn&&sn.goToPage(cn.page)},initJump=(an,on)=>{if(!an)return;const sn=an.match(/#txt-(\d+)-(\d+)/);setTimeout(()=>window.dispatchEvent(new CustomEvent("sireader:goto",{detail:sn?{section:parseInt(sn[1]),textOffset:parseInt(sn[2])}:{cfi:an}})),500)},jump$1=Object.freeze(Object.defineProperty({__proto__:null,gotoEPUB,gotoPDF,gotoTXT,initJump,jump,restorePosition},Symbol.toStringTag,{value:"Module"})),copyMark=async(an,on)=>{var En,Tn,Bn,Nn;const{bookUrl:sn,bookInfo:ln,settings:cn,isPdf:un,reader:dn,pdfViewer:hn,shapeCache:fn,showMsg:pn}=on,gn=(Mn,Ln="")=>navigator.clipboard.writeText(Mn).then(()=>pn(Ln));if(!sn||sn.startsWith("file://"))return gn(an.text||an.note||"","");const mn=an.page||(un?hn==null?void 0:hn.getCurrentPage():null),bn=an.cfi||(un&&mn?`#page-${mn}`:an.section!==void 0?`#txt-${an.section}-${an.textOffset||0}`:"");if(!bn)return gn(an.text||an.note||"","");const{formatBookLink:vn}=await Promise.resolve().then(()=>useSetting$1),{formatAuthor:yn}=await Promise.resolve().then(()=>MarkManager$1),wn=(En=dn==null?void 0:dn.getBook)==null?void 0:En.call(dn),kn=((Tn=wn==null?void 0:wn.metadata)==null?void 0:Tn.title)||(ln==null?void 0:ln.name)||"",_n=yn(((Bn=wn==null?void 0:wn.metadata)==null?void 0:Bn.author)||(ln==null?void 0:ln.author)||"");let xn="";if(an.shapeType&&un&&hn){const Mn=`${an.id}_${an.shapeType}_hd`;if(fn!=null&&fn.has(Mn)){const Ln=await fetch(fn.get(Mn)).then(An=>An.blob()),On=new File([Ln],`shape_${an.id}.png`,{type:"image/png"}),{upload:zn}=await Promise.resolve().then(()=>api),Pn=await zn("/assets/",[On]);xn=(Nn=Pn.succMap)!=null&&Nn[On.name]?`![](${Pn.succMap[On.name]})`:""}else xn=await generateShapeScreenshot(an,mn,hn)}gn(vn(sn,kn,_n,an.chapter||"",bn,an.text||"",(cn==null?void 0:cn.linkFormat)||`> [!NOTE]  
> []() 
> 
> `,an.note||"",xn,an.id||""))},importMark=async(an,on)=>{var sn,ln,cn,un,dn,hn,fn,pn,gn,mn,bn;try{const{bookshelfManager:vn}=await Promise.resolve().then(()=>bookshelf),{appendBlock:yn}=await Promise.resolve().then(()=>api),wn=await vn.getBook(on.bookUrl);if(!(wn!=null&&wn.bindDocId))return(ln=on.showMsg)==null?void 0:ln.call(on,((sn=on.i18n)==null?void 0:sn.noBindDoc)||"","error");let kn="",_n=navigator.clipboard.writeText;if(navigator.clipboard.writeText=async Tn=>(kn=Tn,Promise.resolve()),await copyMark(an,{...on,showMsg:()=>{}}),navigator.clipboard.writeText=_n,!kn)return(cn=on.showMsg)==null?void 0:cn.call(on,"","error");const xn=await yn("markdown",kn,wn.bindDocId),En=(hn=(dn=(un=xn==null?void 0:xn[0])==null?void 0:un.doOperations)==null?void 0:dn[0])==null?void 0:hn.id;En&&on.marks?(await on.marks.updateMark(an,{blockId:En}),(pn=on.showMsg)==null||pn.call(on,((fn=on.i18n)==null?void 0:fn.imported)||"")):(gn=on.showMsg)==null||gn.call(on,En?"":"","error")}catch(vn){console.error(vn),(bn=on.showMsg)==null||bn.call(on,((mn=on.i18n)==null?void 0:mn.importFailed)||"","error")}},_cache=new Map,isMarkImported=async(an,on)=>{var sn;if(an.blockId)return!0;try{if(!_cache.has(on)){const{getChildBlocks:ln}=await Promise.resolve().then(()=>api),cn=await ln(on),un=new Set;cn.forEach(dn=>{var hn,fn;return(fn=(hn=dn.content)==null?void 0:hn.match(/data-mark-id="([^"]+)"/g))==null?void 0:fn.forEach(pn=>{var mn;const gn=(mn=pn.match(/"([^"]+)"/))==null?void 0:mn[1];gn&&un.add(gn)})}),_cache.set(on,un),setTimeout(()=>_cache.delete(on),3e4)}return((sn=_cache.get(on))==null?void 0:sn.has(an.id))||!1}catch{return!1}},autoSyncMark=async(an,on)=>{try{const{bookshelfManager:sn}=await Promise.resolve().then(()=>bookshelf),ln=await sn.getBook(on.bookUrl);if(!(ln!=null&&ln.bindDocId)||!(ln!=null&&ln.autoSync)||await isMarkImported(an,ln.bindDocId))return;await importMark(an,{...on,showMsg:()=>{}})}catch(sn){console.error("[AutoSync]",sn)}};let _plugin,_floatTimer=0;const setPlugin=an=>_plugin=an,openBlock=an=>{hideFloat(),window.open(`siyuan://blocks/${an}`)},showFloat=(an,on)=>{hideFloat(),_floatTimer=window.setTimeout(()=>{var sn;return(sn=_plugin==null?void 0:_plugin.addFloatLayer)==null?void 0:sn.call(_plugin,{refDefs:[{refID:an}],targetElement:on,isBacklink:!1})},620)},hideFloat=()=>{_floatTimer&&clearTimeout(_floatTimer),_floatTimer=0},generateShapeScreenshot=async(an,on,sn)=>{var Mn,Ln;const ln=document.querySelector(`[data-page="${on}"]`),cn=ln&&(Array.from(ln.querySelectorAll("canvas")).find(On=>!On.className)||ln.querySelector("canvas"));if(!cn)return"";const un=(Mn=sn.getPages().get(on))==null?void 0:Mn.getViewport({scale:sn.getScale(),rotation:sn.getRotation()});if(!un)return"";const[dn,hn,fn,pn]=an.rect,[gn,mn]=un.convertToViewportRectangle([dn,hn,dn,hn]),[bn,vn]=un.convertToViewportRectangle([fn,pn,fn,pn]),yn=Math.abs(bn-gn),wn=Math.abs(vn-mn);if(yn<10||wn<10)return"";const kn=document.createElement("canvas");kn.width=1200,kn.height=wn*1200/yn;const _n=kn.getContext("2d"),xn=cn.width/(parseFloat(cn.style.width)||cn.width);_n.drawImage(cn,Math.min(gn,bn)*xn,Math.min(mn,vn)*xn,yn*xn,wn*xn,0,0,kn.width,kn.height),_n.globalAlpha=an.opacity||.8,an.filled?(_n.fillStyle=an.color||"#ff0000",_n.beginPath(),an.shapeType==="circle"?_n.arc(kn.width/2,kn.height/2,Math.min(kn.width,kn.height)/2,0,Math.PI*2):an.shapeType==="triangle"?(_n.moveTo(kn.width/2,0),_n.lineTo(kn.width,kn.height),_n.lineTo(0,kn.height),_n.closePath()):_n.rect(0,0,kn.width,kn.height),_n.fill()):(_n.strokeStyle=an.color||"#ff0000",_n.lineWidth=4,_n.beginPath(),an.shapeType==="circle"?_n.arc(kn.width/2,kn.height/2,Math.min(kn.width,kn.height)/2,0,Math.PI*2):an.shapeType==="triangle"?(_n.moveTo(kn.width/2,0),_n.lineTo(kn.width,kn.height),_n.lineTo(0,kn.height),_n.closePath()):_n.rect(0,0,kn.width,kn.height),_n.stroke());const En=await fetch(kn.toDataURL("image/png")).then(On=>On.blob()),Tn=new File([En],`shape_${an.id}.png`,{type:"image/png"}),{upload:Bn}=await Promise.resolve().then(()=>api),Nn=await Bn("/assets/",[Tn]);return(Ln=Nn.succMap)!=null&&Ln[Tn.name]?`![](${Nn.succMap[Tn.name]})`:""},copy=Object.freeze(Object.defineProperty({__proto__:null,autoSyncMark,copyMark,generateShapeScreenshot,hideFloat,importMark,isMarkImported,openBlock,setPlugin,showFloat},Symbol.toStringTag,{value:"Module"})),getCoord$1=(an,on)=>({x:(an instanceof MouseEvent?an.clientX:an.touches[0].clientX)-on.left,y:(an instanceof MouseEvent?an.clientY:an.touches[0].clientY)-on.top}),drawInk=(an,on,sn)=>{const ln=an.getContext("2d");if(!ln)return;ln.clearRect(0,0,an.width,an.height);const[cn,un,dn,hn]=sn,fn=dn-cn,pn=hn-un,gn=Math.min(an.width/(fn+10),an.height/(pn+10)),mn=(an.width-fn*gn)/2-cn*gn,bn=(an.height-pn*gn)/2-un*gn;ln.lineCap=ln.lineJoin="round",on.forEach(vn=>{vn.points.length<2||(ln.strokeStyle=vn.color,ln.globalAlpha=vn.opacity,ln.lineWidth=vn.width*gn,ln.beginPath(),ln.moveTo(vn.points[0].x*gn+mn,vn.points[0].y*gn+bn),vn.points.forEach(yn=>ln.lineTo(yn.x*gn+mn,yn.y*gn+bn)),ln.stroke())})},renderInkCanvas=(an,on)=>{document.querySelectorAll("[data-page].sr-group-preview").forEach(sn=>{const ln=sn,cn=+(ln.dataset.page||0),un=`g${cn}`;if(on.has(un))return;const dn=an.find(bn=>bn.type==="ink-group"&&bn.page===cn);if(!(dn!=null&&dn.inks))return;let hn=1/0,fn=1/0,pn=-1/0,gn=-1/0,mn=[];dn.inks.forEach(bn=>{const[vn,yn,wn,kn]=bn.rect||[0,0,0,0];hn=Math.min(hn,vn),fn=Math.min(fn,yn),pn=Math.max(pn,wn),gn=Math.max(gn,kn),mn.push(...bn.paths)}),drawInk(ln,mn,[hn,fn,pn,gn]),on.set(un,1)}),document.querySelectorAll("[data-ink-id]").forEach(sn=>{var hn;const ln=sn,cn=ln.dataset.inkId;if(!cn||on.has(cn))return;const un=an.find(fn=>{var pn;return fn.type==="ink-group"&&((pn=fn.inks)==null?void 0:pn.some(gn=>gn.id===cn))}),dn=(hn=un==null?void 0:un.inks)==null?void 0:hn.find(fn=>fn.id===cn);dn&&(drawInk(ln,dn.paths,dn.rect),on.set(cn,1))})};class InkDrawer{constructor(on,sn){ir(this,"ctx");ir(this,"isDrawing",!1);ir(this,"currentPath",[]);ir(this,"config");this.canvas=on,this.ctx=on.getContext("2d"),this.config=sn,this.ctx.lineCap=this.ctx.lineJoin="round"}setConfig(on){this.config={...this.config,...on}}startDrawing(on,sn,ln=1){this.isDrawing=!0,this.currentPath=[{x:on,y:sn,pressure:ln}],this.ctx.beginPath(),this.ctx.moveTo(on,sn)}draw(on,sn,ln=1){if(!this.isDrawing)return;const cn=Math.round(on),un=Math.round(sn),dn=this.currentPath.length;if(dn>0){const hn=this.currentPath[dn-1];if(hn.x===cn&&hn.y===un||Math.hypot(cn-hn.x,un-hn.y)<3)return}if(this.currentPath.push({x:cn,y:un,pressure:ln}),this.ctx.strokeStyle=this.config.color,this.ctx.globalAlpha=this.config.opacity,this.ctx.lineWidth=this.config.width*ln,this.config.smoothing&&dn>1){const hn=this.currentPath[dn-1],fn={x:cn,y:un};this.ctx.quadraticCurveTo(hn.x,hn.y,(hn.x+fn.x)/2,(hn.y+fn.y)/2)}else this.ctx.lineTo(cn,un);this.ctx.stroke()}endDrawing(){if(!this.isDrawing||this.currentPath.length<2)return this.isDrawing=!1,null;this.isDrawing=!1;const on={points:[...this.currentPath],color:this.config.color,width:this.config.width,opacity:this.config.opacity};return this.currentPath=[],on}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}renderAnnotation(on){on.paths.forEach(sn=>this.renderPath(sn))}renderPath(on){if(!(on.points.length<2)){if(this.ctx.strokeStyle=on.color,this.ctx.globalAlpha=on.opacity,this.ctx.lineWidth=on.width,this.ctx.beginPath(),this.ctx.moveTo(on.points[0].x,on.points[0].y),this.config.smoothing&&on.points.length>2)for(let sn=1;sn<on.points.length-1;sn++){const ln=on.points[sn],cn=on.points[sn+1];this.ctx.quadraticCurveTo(ln.x,ln.y,(ln.x+cn.x)/2,(ln.y+cn.y)/2)}else on.points.forEach(sn=>this.ctx.lineTo(sn.x,sn.y));this.ctx.stroke()}}static calculateRect(on){let sn=1/0,ln=1/0,cn=-1/0,un=-1/0;return on.forEach(dn=>dn.points.forEach(hn=>{sn=Math.min(sn,hn.x),ln=Math.min(ln,hn.y),cn=Math.max(cn,hn.x),un=Math.max(un,hn.y)})),[sn,ln,cn,un]}}class InkManager{constructor(on){ir(this,"annotations",new Map);ir(this,"history",[]);ir(this,"currentAnnotation",null);this.page=on}startAnnotation(){this.currentAnnotation={id:`ink_${Date.now()}_${Math.random().toString(36).slice(2,11)}`,type:"ink",page:this.page,paths:[],timestamp:Date.now()}}addPath(on){var sn;(sn=this.currentAnnotation)==null||sn.paths.push(on)}endAnnotation(){if(!this.currentAnnotation||!this.currentAnnotation.paths.length)return this.currentAnnotation=null,null;this.currentAnnotation.rect=InkDrawer.calculateRect(this.currentAnnotation.paths),this.annotations.set(this.currentAnnotation.id,this.currentAnnotation),this.history.push(this.currentAnnotation.id);const on=this.currentAnnotation;return this.currentAnnotation=null,on}undo(){const on=this.history.pop();return on?(this.annotations.delete(on),!0):!1}getAnnotations(){return Array.from(this.annotations.values())}deleteAnnotation(on){return this.annotations.delete(on)}clear(){this.annotations.clear(),this.history=[]}toJSON(){return this.getAnnotations()}fromJSON(on){on.forEach(sn=>{sn.page===this.page&&this.annotations.set(sn.id,sn)})}}class InkController{constructor(on){ir(this,"managers",new Map);ir(this,"drawers",new Map);ir(this,"config",{color:"#ff0000",width:2,opacity:1,smoothing:!0});ir(this,"currentPage",0);ir(this,"container");ir(this,"listeners",[]);this.onSave=on}init(on){this.container=on}setConfig(on){this.config={...this.config,...on},this.drawers.forEach(sn=>sn.setConfig(this.config))}getDrawer(on,sn){let ln=this.drawers.get(on);return ln?ln.setConfig(this.config):(ln=new InkDrawer(sn,this.config),this.drawers.set(on,ln)),ln}getManager(on){let sn=this.managers.get(on);return sn||(sn=new InkManager(on),this.managers.set(on,sn)),sn}async startDrawing(on,sn,ln){this.currentPage=ln;const{x:cn,y:un}=getCoord$1(on,sn.getBoundingClientRect());this.getDrawer(ln,sn).startDrawing(cn,un)}draw(on){if(!this.currentPage)return;const sn=this.drawers.get(this.currentPage),ln=document.querySelector(`.pdf-ink-layer[data-page="${this.currentPage}"]`);if(!sn||!ln)return;const{x:cn,y:un}=getCoord$1(on,ln.getBoundingClientRect());sn.draw(cn,un)}async endDrawing(){var sn,ln;if(!this.currentPage)return;const on=(sn=this.drawers.get(this.currentPage))==null?void 0:sn.endDrawing();if(on){const cn=this.getManager(this.currentPage);cn.currentAnnotation||cn.startAnnotation(),cn.addPath(on),cn.endAnnotation(),await((ln=this.onSave)==null?void 0:ln.call(this))}this.currentPage=0}render(on,sn){const ln=this.managers.get(on);if(!ln)return;const cn=this.getDrawer(on,sn);cn.clear(),ln.getAnnotations().forEach(un=>cn.renderAnnotation(un))}undo(on){const sn=this.managers.get(on);if(!sn)return!1;const ln=sn.undo();if(ln){const cn=document.querySelector(`.pdf-ink-layer[data-page="${on}"]`);cn&&this.render(on,cn)}return ln}clear(on){var sn,ln;(sn=this.managers.get(on))==null||sn.clear(),(ln=this.drawers.get(on))==null||ln.clear()}toJSON(){const on=[];return this.managers.forEach(sn=>on.push(...sn.toJSON())),on}fromJSON(on){on.forEach(sn=>this.getManager(sn.page).fromJSON([sn]))}async toggle(on){this.container&&(this.container.style.userSelect=on?"none":"text",this.container.style.cursor=on?"crosshair":"default",document.querySelectorAll(".pdf-ink-layer").forEach(sn=>{const ln=sn;ln.style.pointerEvents=on?"auto":"none",ln.style.cursor=on?"crosshair":"default"}),on?this.bindEvents():this.unbindEvents())}bindEvents(){if(!this.container)return;const on=async un=>{const dn=un.target;if(!dn.classList.contains("pdf-ink-layer"))return;const hn=dn,fn=+(hn.dataset.page||0);fn&&(await this.startDrawing(un,hn,fn),un.preventDefault())},sn=un=>{this.draw(un),un.preventDefault()},ln=async()=>await this.endDrawing(),cn=this.container;cn.addEventListener("mousedown",on),cn.addEventListener("mousemove",sn),cn.addEventListener("mouseup",ln),cn.addEventListener("touchstart",on),cn.addEventListener("touchmove",sn),cn.addEventListener("touchend",ln),this.listeners=[{el:cn,type:"mousedown",handler:on},{el:cn,type:"mousemove",handler:sn},{el:cn,type:"mouseup",handler:ln},{el:cn,type:"touchstart",handler:on},{el:cn,type:"touchmove",handler:sn},{el:cn,type:"touchend",handler:ln}]}unbindEvents(){this.listeners.forEach(({el:on,type:sn,handler:ln})=>on.removeEventListener(sn,ln)),this.listeners=[]}destroy(){this.unbindEvents(),this.managers.clear(),this.drawers.clear()}}class InkToolManager{constructor(on,sn,ln,cn,un){ir(this,"controller");ir(this,"plugin");ir(this,"bookUrl");ir(this,"bookName");ir(this,"initialized",!1);this.container=on,this.viewer=un,this.plugin=sn,this.bookUrl=ln,this.bookName=cn||"book"}async loadData(){const on=await loadBookData(this.bookUrl,this.bookName);return(on==null?void 0:on.inkAnnotations)||[]}async saveData(on){this.initialized&&await saveBookData(this.bookUrl,{inkAnnotations:on})}async init(){if(this.controller)return this.controller;this.controller=new InkController(async()=>await this.saveData(this.controller.toJSON())),this.controller.init(this.container);const on=await this.loadData();return on.length&&this.controller.fromJSON(on),this.initialized=!0,this.controller}render(on){const sn=document.querySelector(`.pdf-ink-layer[data-page="${on}"]`);sn&&this.controller&&this.controller.render(on,sn)}async toggle(on){await(await this.init()).toggle(on)}async setConfig(on){(await this.init()).setConfig(on)}async save(){this.controller&&await this.saveData(this.controller.toJSON())}toJSON(){var on;return((on=this.controller)==null?void 0:on.toJSON())||[]}async deleteInk(on){if(!this.controller)return!1;const sn=await this.loadData(),ln=sn.find(cn=>cn.id===on);return ln?(sn.splice(sn.indexOf(ln),1),await this.saveData(sn),this.controller.getManager(ln.page).deleteAnnotation(on),this.render(ln.page),!0):!1}async undo(){var ln;if(!this.controller)return!1;const on=(ln=this.viewer)==null?void 0:ln.getCurrentPage();if(!on)return!1;const sn=this.controller.undo(on);return sn&&await this.saveData(this.controller.toJSON()),sn}async clear(){var sn;if(!this.controller)return;const on=(sn=this.viewer)==null?void 0:sn.getCurrentPage();on&&(this.controller.clear(on),await this.saveData(this.controller.toJSON()))}destroy(){var on;(on=this.controller)==null||on.destroy()}}const createInkToolManager=(an,on,sn,ln,cn)=>new InkToolManager(an,on,sn,ln,cn),getCoord=(an,on)=>({x:(an instanceof MouseEvent?an.clientX:an.touches[0].clientX)-on.left,y:(an instanceof MouseEvent?an.clientY:an.touches[0].clientY)-on.top}),drawShape=(an,on,sn,ln,cn,un=0,dn=!1)=>{var Ln,On;if(!on)return;const hn=an.getContext("2d"),fn=`${on.id}_${on.shapeType}${dn?"_hd":""}`;if(ln.has(fn)){const zn=new Image;zn.onload=()=>hn.drawImage(zn,0,0,an.width,an.height),zn.src=ln.get(fn);return}const pn=document.querySelector(`[data-page="${on.page}"]`),gn=pn&&(Array.from(pn.querySelectorAll("canvas")).find(zn=>!zn.className)||pn.querySelector("canvas"));if(!gn){un<3&&(cn(on.page),setTimeout(()=>drawShape(an,on,sn,ln,cn,un+1,dn),200));return}const mn=(On=(Ln=sn==null?void 0:sn.viewer)==null?void 0:Ln.getPages().get(on.page))==null?void 0:On.getViewport({scale:sn.viewer.getScale(),rotation:sn.viewer.getRotation()});if(!mn)return;const[bn,vn,yn,wn]=on.rect,[kn,_n]=mn.convertToViewportRectangle([bn,vn,bn,vn]),[xn,En]=mn.convertToViewportRectangle([yn,wn,yn,wn]),Tn=Math.abs(xn-kn),Bn=Math.abs(En-_n);if(Tn<10||Bn<10)return;const Nn=dn?1200:240;an.width=Nn,an.height=Bn*Nn/Tn;const Mn=gn.width/(parseFloat(gn.style.width)||gn.width);hn.drawImage(gn,Math.min(kn,xn)*Mn,Math.min(_n,En)*Mn,Tn*Mn,Bn*Mn,0,0,an.width,an.height),hn.globalAlpha=on.opacity||.8,hn.beginPath(),on.shapeType==="circle"?hn.arc(an.width/2,an.height/2,Math.min(an.width,an.height)/2,0,Math.PI*2):on.shapeType==="triangle"?(hn.moveTo(an.width/2,0),hn.lineTo(an.width,an.height),hn.lineTo(0,an.height),hn.closePath()):hn.rect(0,0,an.width,an.height),on.filled?(hn.fillStyle=on.color||"#ff0000",hn.fill()):(hn.strokeStyle=on.color||"#ff0000",hn.lineWidth=Math.max(dn?4:2,on.width||2),hn.stroke()),ln.set(fn,an.toDataURL("image/png"))},renderShapeCanvas=(an,on,sn,ln)=>{document.querySelectorAll("[data-shape-id]").forEach(cn=>{var pn;const un=cn,dn=un.dataset.shapeId,hn=an.find(gn=>{var mn;return gn.type==="shape-group"&&((mn=gn.shapes)==null?void 0:mn.some(bn=>bn.id===dn))}),fn=(pn=hn==null?void 0:hn.shapes)==null?void 0:pn.find(gn=>gn.id===dn);fn&&drawShape(un,fn,on,sn,ln)})};class ShapeDrawer{constructor(on,sn){ir(this,"ctx");ir(this,"config");ir(this,"canvas");this.canvas=on,this.ctx=on.getContext("2d"),this.config=sn}setConfig(on){this.config={...this.config,...on}}drawShape(on,sn=!1){const[ln,cn,un,dn]=on.rect,hn=un-ln,fn=dn-cn;switch(this.ctx.globalAlpha=on.opacity,this.ctx.setLineDash(sn?[5,5]:[]),this.ctx.beginPath(),on.shapeType){case"rect":this.ctx.rect(ln,cn,hn,fn);break;case"circle":const pn=ln+hn/2,gn=cn+fn/2,mn=Math.min(Math.abs(hn),Math.abs(fn))/2;this.ctx.arc(pn,gn,mn,0,Math.PI*2);break;case"triangle":this.ctx.moveTo(ln+hn/2,cn),this.ctx.lineTo(un,dn),this.ctx.lineTo(ln,dn),this.ctx.closePath();break}on.filled?(this.ctx.fillStyle=on.color,this.ctx.fill()):(this.ctx.strokeStyle=on.color,this.ctx.lineWidth=on.width,this.ctx.stroke()),this.ctx.setLineDash([]),!sn&&!on.filled&&(this.ctx.fillStyle="rgba(0,0,0,0.01)",this.ctx.fill())}clear(){this.ctx.clearRect(0,0,this.canvas.width,this.canvas.height)}}class ShapeManager{constructor(on){ir(this,"shapes",new Map);ir(this,"history",[]);this.page=on}add(on){this.shapes.set(on.id,on),this.history.push(on.id)}get(on){return this.shapes.get(on)}delete(on){return this.shapes.delete(on)}undo(){const on=this.history.pop();return on?(this.shapes.delete(on),!0):!1}getAll(){return Array.from(this.shapes.values())}clear(){this.shapes.clear(),this.history=[]}toJSON(){return this.getAll()}fromJSON(on){on.forEach(sn=>{sn.page===this.page&&this.shapes.set(sn.id,sn)})}}class ShapeController{constructor(on,sn){ir(this,"managers",new Map);ir(this,"drawers",new Map);ir(this,"config",{shapeType:"rect",color:"#ff0000",width:2,opacity:.8,filled:!1});ir(this,"startPos",null);ir(this,"currentPage",0);ir(this,"previewShape",null);ir(this,"pdfViewer",null);ir(this,"listeners",[]);ir(this,"containerClickHandler",null);this.onSave=on,this.onShapeClick=sn}setPdfViewer(on){this.pdfViewer=on}setConfig(on){this.config={...this.config,...on},this.drawers.forEach(sn=>sn.setConfig(this.config))}getDrawer(on,sn){let ln=this.drawers.get(on);return(!ln||ln.canvas!==sn)&&(ln=new ShapeDrawer(sn,this.config),this.drawers.set(on,ln)),ln}getManager(on){let sn=this.managers.get(on);return sn||(sn=new ShapeManager(on),this.managers.set(on,sn)),sn}startDrawing(on,sn,ln){this.currentPage=ln;const{x:cn,y:un}=getCoord(on,sn.getBoundingClientRect());this.startPos={x:cn,y:un}}toScreenRect(on,sn){const[ln,cn,un,dn]=on,hn=sn.convertToViewportRectangle([ln,cn,ln,cn]),fn=sn.convertToViewportRectangle([un,dn,un,dn]);return[hn[0],hn[1],fn[0],fn[1]]}draw(on){var hn,fn;if(!this.currentPage||!this.startPos)return;const sn=document.querySelector(`.pdf-shape-layer[data-page="${this.currentPage}"]`);if(!sn)return;const{x:ln,y:cn}=getCoord(on,sn.getBoundingClientRect()),un=this.getDrawer(this.currentPage,sn);un.clear();const dn=(fn=(hn=this.pdfViewer)==null?void 0:hn.getPages().get(this.currentPage))==null?void 0:fn.getViewport({scale:this.pdfViewer.getScale(),rotation:this.pdfViewer.getRotation()});this.getManager(this.currentPage).getAll().forEach(pn=>un.drawShape({...pn,rect:dn?this.toScreenRect(pn.rect,dn):pn.rect})),this.previewShape={id:"preview",type:"shape",shapeType:this.config.shapeType,page:this.currentPage,rect:[this.startPos.x,this.startPos.y,ln,cn],color:this.config.color,width:this.config.width,opacity:this.config.opacity,timestamp:Date.now()},un.drawShape(this.previewShape,!0)}async endDrawing(on){var gn;if(!this.currentPage||!this.startPos||!this.previewShape)return;const[sn,ln,cn,un]=this.previewShape.rect;if(Math.abs(cn-sn)<10||Math.abs(un-ln)<10){this.startPos=this.previewShape=null,this.currentPage=0;return}let dn=[sn,ln,cn,un];const hn=(gn=on==null?void 0:on.getPages().get(this.currentPage))==null?void 0:gn.getViewport({scale:on.getScale(),rotation:on.getRotation()});if(hn){const[mn,bn]=hn.convertToPdfPoint(sn,ln),[vn,yn]=hn.convertToPdfPoint(cn,un);dn=[mn,bn,vn,yn]}const fn={...this.previewShape,id:`shape_${Date.now()}_${Math.random().toString(36).slice(2,9)}`,rect:dn,filled:this.config.filled};this.getManager(this.currentPage).add(fn),await this.onSave();const pn=document.querySelector(`.pdf-shape-layer[data-page="${this.currentPage}"]`);if(pn&&this.render(this.currentPage,pn,on),this.onShapeClick&&pn){const mn=pn.getBoundingClientRect(),bn=mn.left+(sn+cn)/2,vn=mn.top+Math.max(ln,un)+10;setTimeout(()=>{const yn=new CustomEvent("shape-created",{detail:{shape:fn,x:bn,y:vn,edit:!0}});window.dispatchEvent(yn)},50)}this.startPos=this.previewShape=null,this.currentPage=0}render(on,sn,ln){var hn,fn,pn;const cn=(hn=this.managers.get(on))==null?void 0:hn.getAll();if(!(cn!=null&&cn.length))return;const un=this.getDrawer(on,sn);un.clear(),(fn=sn.parentElement)==null||fn.querySelectorAll("[data-shape-note-marker],[data-shape-note-tooltip]").forEach(gn=>gn.remove());const dn=(pn=ln==null?void 0:ln.getPages().get(on))==null?void 0:pn.getViewport({scale:ln.getScale(),rotation:ln.getRotation()});cn.forEach(gn=>{const mn=dn?this.toScreenRect(gn.rect,dn):gn.rect;un.drawShape({...gn,rect:mn}),gn.note&&this.renderNoteMarker({...gn,rect:mn},sn)})}handleClick(on,sn,ln,cn){var fn,pn;const{x:un,y:dn}=getCoord(on,sn.getBoundingClientRect()),hn=(fn=cn==null?void 0:cn.getPages().get(ln))==null?void 0:fn.getViewport({scale:cn.getScale(),rotation:cn.getRotation()});for(const gn of this.getManager(ln).getAll()){const mn=hn?this.toScreenRect(gn.rect,hn):gn.rect;if(this.isPointInShape(un,dn,{...gn,rect:mn}))return(pn=this.onShapeClick)==null||pn.call(this,gn),!0}return!1}renderNoteMarker(on,sn){var vn;const[ln,cn,un,dn]=on.rect,hn="",fn=document.createElement("span");fn.setAttribute("data-shape-note-marker","true"),fn.textContent=hn;const pn=Math.max(ln,un)+5,gn=Math.min(cn,dn)-5;fn.style.cssText=`position:absolute;left:${pn}px;top:${gn}px;font-size:14px;cursor:pointer;user-select:none;opacity:0.85;transition:opacity .2s;pointer-events:auto;z-index:12`;const mn=document.createElement("div");mn.setAttribute("data-shape-note-tooltip","true");const bn=on.note.split(`
`).map(yn=>yn.trim()).filter(Boolean).join(`
`);mn.innerHTML=`<div style="display:flex;align-items:center;gap:8px;margin-bottom:12px;padding-bottom:8px;border-bottom:1px solid rgba(0,0,0,.1)"><span style="font-size:18px">${hn}</span><span style="font-size:12px;font-weight:600;color:#ff9800;text-transform:uppercase;letter-spacing:.5px"></span></div><div style="font-size:14px;line-height:1.8;color:#333;white-space:pre-wrap;max-height:300px;overflow-y:auto">${bn}</div>`,mn.style.cssText="position:fixed;display:none;min-width:280px;max-width:420px;padding:16px;background:#fff;border:1px solid rgba(0,0,0,.1);border-radius:12px;box-shadow:0 8px 32px rgba(0,0,0,.12);z-index:99999;pointer-events:none;word-wrap:break-word",document.body.appendChild(mn),fn.onmouseenter=()=>{fn.style.opacity="1";const yn=fn.getBoundingClientRect();mn.style.display="block",mn.style.left=yn.left+"px",mn.style.top=yn.bottom+5+"px",requestAnimationFrame(()=>{const wn=mn.getBoundingClientRect();wn.right>window.innerWidth&&(mn.style.left=window.innerWidth-wn.width-10+"px"),wn.bottom>window.innerHeight&&(mn.style.top=yn.top-wn.height-5+"px")})},fn.onmouseleave=()=>{fn.style.opacity="0.85",mn.style.display="none"},fn.onclick=yn=>{var wn;yn.stopPropagation(),(wn=this.onShapeClick)==null||wn.call(this,on)},(vn=sn.parentElement)==null||vn.appendChild(fn)}undo(on){const sn=this.managers.get(on);if(!sn||!sn.undo())return!1;const ln=document.querySelector(`.pdf-shape-layer[data-page="${on}"]`);return ln&&this.render(on,ln,this.pdfViewer),!0}clear(on){var sn,ln;(sn=this.managers.get(on))==null||sn.clear(),(ln=this.drawers.get(on))==null||ln.clear()}async toggle(on,sn){sn.style.userSelect=on?"none":"text",sn.style.cursor=on?"crosshair":"default",document.querySelectorAll(".pdf-shape-layer").forEach(ln=>{const cn=ln;cn.style.pointerEvents=on?"auto":"none",cn.style.cursor=on?"crosshair":"default"}),on?(this.bindEvents(sn),this.unbindContainerClick()):(this.unbindEvents(),this.bindContainerClick(sn))}bindEvents(on){const sn=un=>{const dn=un.target;if(!dn.classList.contains("pdf-shape-layer"))return;const hn=dn,fn=+(hn.dataset.page||0);fn&&(this.startDrawing(un,hn,fn),un.preventDefault())},ln=un=>{this.draw(un),un.preventDefault()},cn=async()=>await this.endDrawing(this.pdfViewer);on.addEventListener("mousedown",sn),on.addEventListener("mousemove",ln),on.addEventListener("mouseup",cn),on.addEventListener("touchstart",sn),on.addEventListener("touchmove",ln),on.addEventListener("touchend",cn),this.listeners=[{el:on,type:"mousedown",handler:sn},{el:on,type:"mousemove",handler:ln},{el:on,type:"mouseup",handler:cn},{el:on,type:"touchstart",handler:sn},{el:on,type:"touchmove",handler:ln},{el:on,type:"touchend",handler:cn}]}isPointInShape(on,sn,ln){const[cn,un,dn,hn]=ln.rect,fn=Math.min(cn,dn),pn=Math.max(cn,dn),gn=Math.min(un,hn),mn=Math.max(un,hn);if(on<fn||on>pn||sn<gn||sn>mn)return!1;switch(ln.shapeType){case"rect":return!0;case"circle":const bn=(cn+dn)/2,vn=(un+hn)/2,yn=Math.min(Math.abs(dn-cn),Math.abs(hn-un))/2;return Math.hypot(on-bn,sn-vn)<=yn;case"triangle":const wn=(En,Tn,Bn,Nn,Mn,Ln)=>(En-Mn)*(Nn-Ln)-(Bn-Mn)*(Tn-Ln),kn=wn(on,sn,cn+(dn-cn)/2,un,dn,hn),_n=wn(on,sn,dn,hn,cn,hn),xn=wn(on,sn,cn,hn,cn+(dn-cn)/2,un);return!((kn<0||_n<0||xn<0)&&(kn>0||_n>0||xn>0));default:return!1}}unbindEvents(){this.listeners.forEach(({el:on,type:sn,handler:ln})=>on.removeEventListener(sn,ln)),this.listeners=[]}bindContainerClick(on){this.unbindContainerClick(),this.containerClickHandler=sn=>{const ln=sn.target;if(ln.closest("[data-shape-note-marker]"))return;const cn=ln.closest("[data-page]");if(!cn)return;const un=+(cn.dataset.page||0);if(!un)return;const dn=cn.querySelector(".pdf-shape-layer");dn&&this.handleClick(sn,dn,un,this.pdfViewer)&&(sn.stopPropagation(),sn.preventDefault())},on.addEventListener("click",this.containerClickHandler),document.querySelectorAll(".pdf-shape-layer").forEach(sn=>sn.style.pointerEvents="none")}unbindContainerClick(){this.containerClickHandler&&(document.querySelectorAll(".viewer-container").forEach(on=>on.removeEventListener("click",this.containerClickHandler)),this.containerClickHandler=null)}ensureClickEvents(on){this.bindContainerClick(on)}toJSON(){const on=[];return this.managers.forEach(sn=>on.push(...sn.toJSON())),on}fromJSON(on){on.forEach(sn=>this.getManager(sn.page).fromJSON([sn]))}destroy(){this.unbindEvents(),this.unbindContainerClick(),this.managers.clear(),this.drawers.clear()}}class ShapeToolManager{constructor(on,sn,ln,cn,un,dn){ir(this,"controller");ir(this,"bookUrl");ir(this,"bookName");ir(this,"initialized",!1);ir(this,"pdfViewer");this.container=on,this.onShapeClick=un,this.bookUrl=ln,this.bookName=cn||"book",this.pdfViewer=dn}setPdfViewer(on){this.pdfViewer=on,this.controller&&this.controller.setPdfViewer(on)}async loadData(){const on=await loadBookData(this.bookUrl,this.bookName);return(on==null?void 0:on.shapeAnnotations)||[]}async saveData(on){this.initialized&&await saveBookData(this.bookUrl,{shapeAnnotations:on})}async init(){if(this.controller)return this.controller;this.controller=new ShapeController(async()=>await this.saveData(this.controller.toJSON()),this.onShapeClick),this.pdfViewer&&this.controller.setPdfViewer(this.pdfViewer);const on=await this.loadData();return on.length&&this.controller.fromJSON(on),this.controller.ensureClickEvents(this.container),this.initialized=!0,this.controller}async updateShape(on,sn){if(!this.controller)return!1;const ln=await this.loadData(),cn=ln.find(un=>un.id===on);return cn?(Object.assign(cn,sn),await this.saveData(ln),this.controller.getManager(cn.page).delete(on),this.controller.getManager(cn.page).add(cn),this.render(cn.page),!0):!1}async deleteShape(on){if(!this.controller)return!1;const sn=await this.loadData(),ln=sn.find(cn=>cn.id===on);return ln?(sn.splice(sn.indexOf(ln),1),await this.saveData(sn),this.controller.getManager(ln.page).delete(on),this.render(ln.page),!0):!1}render(on){if(!this.controller)return;const sn=document.querySelector(`.pdf-shape-layer[data-page="${on}"]`);sn&&this.controller.render(on,sn,this.pdfViewer)}async toggle(on){await(await this.init()).toggle(on,this.container)}async setConfig(on){(await this.init()).setConfig(on)}async save(){this.controller&&await this.saveData(this.controller.toJSON())}toJSON(){var on;return((on=this.controller)==null?void 0:on.toJSON())||[]}async undo(on){if(!this.controller)return!1;const sn=this.controller.undo(on);return sn&&await this.save(),sn}async clear(on){this.controller&&(this.controller.clear(on),await this.save())}destroy(){var on;(on=this.controller)==null||on.destroy()}}const createShapeToolManager=(an,on,sn,ln,cn,un)=>new ShapeToolManager(an,on,sn,ln,cn,un),_hoisted_1$6={class:"sr-toolbar"},_hoisted_2$5=["placeholder"],_hoisted_3$5={key:0,class:"sr-select"},_hoisted_4$5=["aria-label"],_hoisted_5$5={class:"sr-menu-section"},_hoisted_6$5=["onClick"],_hoisted_7$5={class:"sr-menu-section"},_hoisted_8$5=["onClick"],_hoisted_9$5=["aria-label"],_hoisted_10$5=["xlink:href"],_hoisted_11$5=["aria-label"],_hoisted_12$5=["xlink:href"],_hoisted_13$5=["aria-label"],_hoisted_14$4=["xlink:href"],_hoisted_15$4={key:2,class:"sr-select"},_hoisted_16$4=["aria-label"],_hoisted_17$4={class:"sr-menu-item active"},_hoisted_18$4={class:"sr-bind-info"},_hoisted_19$4={class:"sr-bind-id"},_hoisted_20$4={class:"sr-menu-item sr-checkbox"},_hoisted_21$3={class:"sr-menu-item sr-checkbox"},_hoisted_22$3=["onClick"],_hoisted_23$3={key:1,class:"sr-empty-small"},_hoisted_24$3={key:0,class:"sr-empty"},_hoisted_25$1=["data-page","onClick"],_hoisted_26$1=["src","alt"],_hoisted_27$1={key:1,class:"sr-thumb-placeholder"},_hoisted_28$1={class:"sr-thumb-label"},_hoisted_29$1={key:"bookmark",class:"sr-list"},_hoisted_30$1={key:0,class:"sr-empty"},_hoisted_31$1=["onClick"],_hoisted_32$1=["onClick"],_hoisted_33$1={key:0,class:"sr-empty"},_hoisted_34$1=["onClick"],_hoisted_35$1={class:"sr-group-content"},_hoisted_36$1={class:"sr-group-title"},_hoisted_37$1={class:"sr-group-count"},_hoisted_38=["onClick"],_hoisted_39={class:"sr-head"},_hoisted_40={key:0,class:"sr-chapter"},_hoisted_41={key:1,class:"sr-time"},_hoisted_42=["onClick","aria-label"],_hoisted_43=["xlink:href"],_hoisted_44=["innerHTML"],_hoisted_45={key:1,class:"sr-title"},_hoisted_46={key:0,class:"sr-meta"},_hoisted_47={key:3,class:"sr-note"},_hoisted_48=["data-page"],_hoisted_49={class:"sr-options"},_hoisted_50={class:"sr-colors"},_hoisted_51=["onClick"],_hoisted_52={key:0,class:"sr-styles"},_hoisted_53=["onClick","title"],_hoisted_54={style:{width:"16px",height:"16px"}},_hoisted_55=["xlink:href"],_hoisted_56={key:1,class:"sr-styles"},_hoisted_57=["onClick"],_hoisted_58=["data-type"],_hoisted_59={class:"sr-actions"},_hoisted_60=["onClick"],_hoisted_61={key:0,class:"sr-sub-list"},_hoisted_62=["onClick"],_hoisted_63=["data-ink-id"],_hoisted_64=["data-shape-id"],_hoisted_65={key:3,class:"sr-note"},_hoisted_66={class:"sr-options"},_hoisted_67={class:"sr-colors"},_hoisted_68=["onClick"],_hoisted_69={key:0,class:"sr-styles"},_hoisted_70=["onClick","title"],_hoisted_71={style:{width:"16px",height:"16px"}},_hoisted_72=["xlink:href"],_hoisted_73={class:"sr-actions"},_hoisted_74=["onClick"],_hoisted_75={key:5,class:"sr-btns"},_hoisted_76=["onClick","aria-label"],_hoisted_77=["onClick","aria-label"],_hoisted_78=["onClick","onMouseenter"],_hoisted_79=["onClick","aria-label"],_hoisted_80=["onClick","aria-label"],_hoisted_81={key:6,class:"sr-btns"},_hoisted_82=["onClick","aria-label"],_hoisted_83=["onClick","aria-label"],_hoisted_84=["onClick","onMouseenter"],_hoisted_85=["onClick","aria-label"],_hoisted_86=["onClick","aria-label"],_hoisted_87={key:"deck",class:"sr-list"},_hoisted_88={key:0,class:"sr-empty"},_hoisted_89=["onClick"],_hoisted_90={class:"sr-deck-head"},_hoisted_91={class:"sr-word"},_hoisted_92={class:"sr-deck-btns"},_hoisted_93=["onClick","aria-label"],_hoisted_94=["onClick","aria-label"],_hoisted_95={class:"sr-deck-meta"},_hoisted_96={class:"sr-deck-dict"},_hoisted_97={class:"sr-deck-time"},_hoisted_98=["innerHTML"],_sfc_main$6=defineComponent({__name:"ReaderToc",props:{mode:{},i18n:{default:()=>({})}},emits:["update:mode"],setup(an,{emit:on}){const sn=an,{activeView:ln,activeReader:cn}=useReaderState(),un=async ur=>{var lr;return(lr=ln.value)==null?void 0:lr.goTo(ur)},dn=ref(),hn=ref(),fn=ref(),pn=ref(),gn=ref(""),mn=ref(!1),bn=ref(!1),vn=ref(!1),yn=ref(!0),wn=ref(0),kn=ref({color:"",sort:"time"}),_n=ref(new Set),xn=ref([]),En=ref(null),Tn=ref(null),Bn=ref(null),Nn=ref(""),Mn=ref(""),Ln=ref("yellow"),On=ref("highlight"),zn=ref("rect"),Pn=[{type:"rect",label:"",icon:"#iconSquareDashed"},{type:"circle",label:"",icon:"#iconCircleDashed"},{type:"triangle",label:"",icon:"#iconTriangleDashed"}],An=ref({}),Vn=new Map,Sn=ref(!1),Rn=ref(""),Hn=ref([]),Zn=ref(""),Qn=ref(""),Yn=getColorMap(),tr={toc:"...",bookmark:"...",mark:"...",note:"...",deck:"..."},Un=computed(()=>{var ur,lr,br,Mr;return{colors:[{label:((ur=sn.i18n)==null?void 0:ur.all)||"",value:""},...COLORS.map(jn=>({label:jn.name,value:jn.color,bg:jn.bg}))],sorts:[{label:((lr=sn.i18n)==null?void 0:lr.sortTime)||"",value:"time"},{label:((br=sn.i18n)==null?void 0:br.sortDate)||"",value:"date"},{label:((Mr=sn.i18n)==null?void 0:Mr.sortChapter)||"",value:"chapter"}]}}),Xn=computed(()=>{var lr,br,Mr;const ur=[];return kn.value.color&&ur.push((lr=COLORS.find(jn=>jn.color===kn.value.color))==null?void 0:lr.name),kn.value.sort!=="time"&&ur.push((br=Un.value.sorts.find(jn=>jn.value===kn.value.sort))==null?void 0:br.label),ur.length?ur.join("  "):((Mr=sn.i18n)==null?void 0:Mr.filter)||""}),or=computed(()=>{var ur,lr;return((ur=cn.value)==null?void 0:ur.marks)||((lr=ln.value)==null?void 0:lr.marks)}),kr=computed(()=>{var ur;return((ur=ln.value)==null?void 0:ur.isPdf)||!1}),wr=computed(()=>{var ur;return((ur=ln.value)==null?void 0:ur.pageCount)||0}),Nr=computed(()=>{var _r,Cr,Ar,Rr;if(wn.value,!or.value)return{bookmarks:[],marks:[],notes:[],deck:xn.value};const lr=(((Cr=(_r=or.value).getInkAnnotations)==null?void 0:Cr.call(_r))||[]).reduce((vr,Tr)=>(vr[Tr.page]||(vr[Tr.page]={page:Tr.page,type:"ink-group",inks:[],timestamp:Tr.timestamp,text:` - ${Tr.page}`}),vr[Tr.page].inks.push(Tr),vr[Tr.page].timestamp=Math.max(vr[Tr.page].timestamp,Tr.timestamp),vr),{}),br=Object.values(lr).map(vr=>({...vr,groupId:`ink-${vr.page}`})),jn=(((Rr=(Ar=or.value).getShapeAnnotations)==null?void 0:Rr.call(Ar))||[]).reduce((vr,Tr)=>(vr[Tr.page]||(vr[Tr.page]={page:Tr.page,type:"shape-group",shapes:[],timestamp:Tr.timestamp,text:` - ${Tr.page}`}),vr[Tr.page].shapes.push({...Tr}),vr[Tr.page].timestamp=Math.max(vr[Tr.page].timestamp,Tr.timestamp),vr),{}),sr=Object.values(jn).map(vr=>({...vr,groupId:`shape-${vr.page}`,shapes:[...vr.shapes]}));return{bookmarks:or.value.getBookmarks(),marks:[...or.value.getAnnotations(kn.value.color),...br,...sr],notes:or.value.getNotes(),deck:xn.value}}),$r=computed(()=>{const ur=gn.value.toLowerCase(),lr={bookmark:"bookmarks",mark:"marks",note:"notes",deck:"deck"}[sn.mode];let br=(Nr.value[lr]||[]).filter(Mr=>!ur||(Mr.title||Mr.text||Mr.note||Mr.word||"").toLowerCase().includes(ur));if((sn.mode==="mark"||sn.mode==="note")&&kn.value.sort!=="time"){const Mr=kn.value.sort==="chapter"?"chapter":"date";br.sort((sr,_r)=>{const Cr=Mr==="chapter"?sr.chapter||"":formatTime(sr.timestamp||0),Ar=Mr==="chapter"?_r.chapter||"":formatTime(_r.timestamp||0);return Cr===Ar?_r.timestamp-sr.timestamp:Cr.localeCompare(Ar)});const jn=[];return br.forEach(sr=>{const _r=Mr==="chapter"?sr.chapter||"":formatTime(sr.timestamp||0);let Cr=jn.find(Ar=>Ar.key===_r);Cr||(Cr={key:_r,items:[],isGroup:!0},jn.push(Cr)),Cr.items.push(sr)}),vn.value?[...jn].reverse():jn}return vn.value?[...br].reverse():br}),cr=computed(()=>{var ur,lr;return gn.value?`${((ur=sn.i18n)==null?void 0:ur.notFound)||""}${tr[sn.mode].replace(/|\.\.\./g,"")}`:`${((lr=sn.i18n)==null?void 0:lr.empty)||""}${tr[sn.mode].replace(/|\.\.\./g,"")}`});let hr=null,gr=null;const Jn=async()=>{var lr;if(sn.mode!=="toc"||!dn.value)return;Fn();const ur=ln.value;if(!((lr=ur==null?void 0:ur.book)!=null&&lr.toc)||ur.book.toc.length===0){kr.value&&(bn.value=!0);return}try{const{createTOCView:br}=await Promise.resolve().then(()=>tree);hr=br(ur.book.toc,un),dn.value.innerHTML="",dn.value.appendChild(hr.element),ur&&typeof ur.addEventListener=="function"&&(gr=Mr=>{var jn,sr,_r;return(_r=hr==null?void 0:hr.setCurrentHref)==null?void 0:_r.call(hr,(sr=(jn=Mr.detail)==null?void 0:jn.tocItem)==null?void 0:sr.href)},ur.addEventListener("relocate",gr)),requestAnimationFrame(()=>{var Mr,jn,sr;(sr=hr==null?void 0:hr.setCurrentHref)==null||sr.call(hr,(jn=(Mr=ur==null?void 0:ur.lastLocation)==null?void 0:Mr.tocItem)==null?void 0:jn.href),Kn()})}catch(br){console.error("[TOC]",br)}},Fn=()=>{const ur=ln.value;gr&&ur&&typeof ur.removeEventListener=="function"&&ur.removeEventListener("relocate",gr),gr=null,dn.value&&(dn.value.innerHTML=""),hr=null},Kn=()=>{if(!dn.value||!or.value)return;const ur=Nr.value.bookmarks;dn.value.querySelectorAll("a[href]").forEach(lr=>{var Cr;const br=lr.parentElement;if(!br||br.querySelector(".toc-bookmark-btn"))return;const Mr=lr.getAttribute("href");if(!Mr)return;const jn=((Cr=lr.textContent)==null?void 0:Cr.trim())||"",sr=ur.some(Ar=>Ar.title===jn),_r=document.createElement("button");_r.className="toc-bookmark-btn b3-tooltips b3-tooltips__w",_r.setAttribute("aria-label",sr?"":""),_r.innerHTML='<svg style="width:14px;height:14px"><use xlink:href="#iconBookmark"/></svg>',sr&&(_r.style.opacity="1",_r.classList.add("has-bookmark")),_r.onclick=Ar=>{Ar.stopPropagation(),Ar.preventDefault(),Cn(_r,Mr,jn)},br.appendChild(_r)})},Cn=async(ur,lr,br)=>{const Mr=ln.value;if(!or.value||!Mr)return siyuan.showMessage("",2e3,"error");try{ur.style.transform="translateY(-50%) scale(1.3)",await Mr.goTo(lr),await new Promise(sr=>setTimeout(sr,200));const jn=or.value.toggleBookmark(void 0,void 0,br);ur.classList.toggle("has-bookmark",jn),ur.style.opacity=jn?"1":"0",ur.setAttribute("aria-label",jn?"":""),ur.style.transform=`translateY(-50%) scale(${jn?1.2:.8})`,setTimeout(()=>ur.style.transform="translateY(-50%) scale(1)",150),siyuan.showMessage(jn?"":"",1500,"info")}catch(jn){ur.style.transform="translateY(-50%) scale(1)",siyuan.showMessage(jn.message||"",2e3,"error")}},qn=ur=>ur.id||ur.cfi||(ur.page?`${ur.page}`:`section-${ur.section}`),Gn=ur=>Bn.value===qn(ur),Dn=ur=>ur.type==="shape"||ur.type==="highlight"||ur.type==="note"||!ur.type,In=(ur,lr="info")=>siyuan.showMessage(ur,lr==="error"?3e3:1500,lr),Wn=ur=>{var lr,br;(br=(lr=or.value)==null?void 0:lr.deleteBookmark)==null||br.call(lr,qn(ur)),In(""),wn.value++},rr=ur=>{Bn.value=qn(ur),Nn.value=ur.text||"",Mn.value=ur.note||"",Ln.value=ur.color||"yellow",On.value=ur.style||"highlight",zn.value=ur.shapeType||"rect",nextTick(()=>{var lr,br;return(br=(lr=fn.value)==null?void 0:lr.focus)==null?void 0:br.call(lr)})},nr=()=>Bn.value=null,er=async ur=>{if(!or.value)return In("","error");if(ur.type==="shape-group"||ur.type==="ink-group")return In("","error");try{const lr={color:Ln.value,note:Mn.value.trim()||void 0};ur.type==="shape"?lr.shapeType=zn.value:(lr.text=Nn.value.trim(),lr.style=On.value),await or.value.updateMark(ur,lr),In(""),Bn.value=null,wn.value++}catch(lr){console.error(lr),In("","error")}},ar=async ur=>{var Mr,jn;const{importMark:lr}=await Promise.resolve().then(()=>copy),br=Ur();await lr(ur,{bookUrl:br||"",bookInfo:br?await bookshelfManager.getBook(br):null,isPdf:((Mr=ln.value)==null?void 0:Mr.isPdf)||!1,reader:cn.value,pdfViewer:(jn=ln.value)==null?void 0:jn.viewer,shapeCache:Cs,showMsg:In,i18n:sn.i18n,marks:or.value}),wn.value++},mr=(ur,lr)=>showFloat(lr,ur.target),fr=async ur=>{if(!or.value)return In("","error");try{if(ur.type==="shape-group"){for(const lr of ur.shapes||[])await or.value.deleteMark(lr);In(""),wn.value++;return}if(ur.type==="ink-group"){for(const lr of ur.inks||[])await or.value.deleteMark(lr);In(""),wn.value++;return}await or.value.deleteMark(ur)&&(In(""),wn.value++)}catch{In("","error")}},xr=ur=>jump(ur,ln.value,cn.value,or.value),Br=ur=>jump(ur,ln.value,cn.value,or.value),Er=ur=>ur.page||ur.cfi||ur.section!==void 0?xr(ur):In(""),Or=ur=>{var br;const lr=(br=ln.value)==null?void 0:br.viewer;lr!=null&&lr.renderPage&&lr.renderPage(ur)},Wr=ur=>{const lr=ur.groupId;Tn.value=Tn.value===lr?null:lr,Tn.value&&(Or(ur.page),setTimeout(()=>{Bi(),Ai()},100))},Lr=ur=>Tn.value===ur.groupId,Jr=async ur=>{await removeFromDeck(ur),In("")},Fr=()=>{var ur;return(ur=hn.value)==null?void 0:ur.scrollTo({top:hn.value.scrollTop<50?hn.value.scrollHeight:0,behavior:"smooth"})},Co=ur=>yn.value=ur.target.scrollTop<50,Ur=()=>window.__currentBookUrl,Hr=ur=>{var lr,br;return((br=(lr=ur.path)==null?void 0:lr.split("/").pop())==null?void 0:br.replace(".sy",""))||ur.id},ro=ref(!1),oo=ref(!1),Ci=async()=>{Hn.value=Rn.value.trim()?await searchDocs(Rn.value.trim()):[]},ss=async ur=>{const lr=Ur();if(!lr)return;const br=await bookshelfManager.getBook(lr);br&&(Object.assign(br,ur),await bookshelfManager.saveBook(br))},Ks=async ur=>{const lr=Ur(),br=Hr(ur);if(!lr||!br)return In(lr?"ID":"","error");const Mr=await bookshelfManager.getBook(lr);if(!Mr)return In("","error");const jn=ur.hPath||ur.content||"";await ss({bindDocId:br,bindDocName:jn}),Zn.value=br,Qn.value=jn,ro.value=Mr.autoSync||!1,oo.value=Mr.syncDelete||!1,In(""),Sn.value=Rn.value="",Hn.value=[]},Ho=async()=>{await ss({bindDocId:"",bindDocName:"",autoSync:!1,syncDelete:!1}),Zn.value=Qn.value="",ro.value=oo.value=!1,In("")},is=async()=>{await ss({autoSync:ro.value}),In(ro.value?"":"")},ua=async()=>{await ss({syncDelete:oo.value}),In(oo.value?"":"")},Ei=async()=>{const ur=Ur();if(!ur)return;const lr=await bookshelfManager.getBook(ur);lr&&(Zn.value=lr.bindDocId||"",Qn.value=lr.bindDocName||"",ro.value=lr.autoSync||!1,oo.value=lr.syncDelete||!1)},Ti=new Map,Cs=Vn,$i=ur=>{var lr,br,Mr;return copyMark(ur,{bookUrl:window.__currentBookUrl||"",isPdf:((lr=ln.value)==null?void 0:lr.isPdf)||!1,reader:cn.value,pdfViewer:(br=ln.value)==null?void 0:br.viewer,settings:(Mr=ln.value)==null?void 0:Mr.settings,shapeCache:Cs,showMsg:In})},Bi=()=>nextTick(()=>renderInkCanvas($r.value,Ti)),Ai=()=>nextTick(()=>renderShapeCanvas($r.value,ln.value,Cs,Or));watch([$r,Tn],()=>{Ti.clear(),Bi(),Ai()},{immediate:!0});let Eo;watch(bn,ur=>ur&&nextTick(()=>{var lr;Eo==null||Eo.disconnect(),Eo=new IntersectionObserver(br=>br.forEach(async Mr=>{var jn;if(Mr.isIntersecting){const sr=+Mr.target.dataset.page,_r=(jn=ln.value)==null?void 0:jn.getThumbnail;_r&&!An.value[sr]&&(An.value[sr]=await _r(sr))}}),{root:hn.value,rootMargin:"200px"}),(lr=pn.value)==null||lr.querySelectorAll(".sr-thumb").forEach(br=>Eo.observe(br))}));const Gs=()=>{wn.value++,sn.mode==="deck"&&loadDeckCards().then(ur=>xn.value=ur)},da=()=>sn.mode==="toc"?requestAnimationFrame(Kn):Gs(),Mi=()=>{sn.mode==="toc"?requestAnimationFrame(Jn):Gs(),Ei()};return watch(()=>{var ur;return(ur=ln.value)==null?void 0:ur.book},ur=>ur!=null&&ur.toc&&sn.mode==="toc"?requestAnimationFrame(Jn):Fn(),{immediate:!0}),watch(()=>sn.mode,Mi),onMounted(()=>{window.addEventListener("sireader:marks-updated",da),window.addEventListener("sireader:tab-switched",Mi),sn.mode==="deck"&&Gs(),setTimeout(Ei,500)}),onUnmounted(()=>{Fn(),Eo==null||Eo.disconnect(),window.removeEventListener("sireader:marks-updated",da),window.removeEventListener("sireader:tab-switched",Mi)}),(ur,lr)=>(openBlock$1(),createElementBlock("div",{class:"sr-toc",onClick:lr[15]||(lr[15]=br=>{mn.value=!1,Sn.value=!1})},[createBaseVNode("div",_hoisted_1$6,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":lr[0]||(lr[0]=br=>gn.value=br),placeholder:tr[an.mode]},null,8,_hoisted_2$5),[[vModelText,gn.value]]),an.mode==="mark"||an.mode==="note"?(openBlock$1(),createElementBlock("div",_hoisted_3$5,[createBaseVNode("button",{class:"b3-tooltips b3-tooltips__sw",onClick:lr[1]||(lr[1]=withModifiers(br=>mn.value=!mn.value,["stop"])),"aria-label":Xn.value},[...lr[16]||(lr[16]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-sliders-horizontal"})],-1)])],8,_hoisted_4$5),createVNode(Transition,{name:"menu"},{default:withCtx(()=>{var br,Mr;return[mn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-menu",onClick:lr[2]||(lr[2]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",_hoisted_5$5,toDisplayString(((br=sn.i18n)==null?void 0:br.color)||""),1),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Un.value.colors,jn=>(openBlock$1(),createElementBlock("div",{key:jn.value,class:normalizeClass(["sr-menu-item",{active:kn.value.color===jn.value}]),onClick:sr=>kn.value.color=jn.value},[jn.bg?(openBlock$1(),createElementBlock("span",{key:0,class:"dot",style:normalizeStyle({background:jn.bg})},null,4)):createCommentVNode("",!0),createTextVNode(toDisplayString(jn.label),1)],10,_hoisted_6$5))),128)),lr[17]||(lr[17]=createBaseVNode("div",{class:"sr-menu-divider"},null,-1)),createBaseVNode("div",_hoisted_7$5,toDisplayString(((Mr=sn.i18n)==null?void 0:Mr.sort)||""),1),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Un.value.sorts,jn=>(openBlock$1(),createElementBlock("div",{key:jn.value,class:normalizeClass(["sr-menu-item",{active:kn.value.sort===jn.value}]),onClick:sr=>kn.value.sort=jn.value},toDisplayString(jn.label),11,_hoisted_8$5))),128))])):createCommentVNode("",!0)]}),_:1})])):createCommentVNode("",!0),an.mode==="toc"&&kr.value?(openBlock$1(),createElementBlock("button",{key:1,class:"b3-tooltips b3-tooltips__sw",onClick:lr[3]||(lr[3]=br=>bn.value=!bn.value),"aria-label":bn.value?"":""},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":bn.value?"#lucide-scroll-text":"#lucide-panels-top-left"},null,8,_hoisted_10$5)]))],8,_hoisted_9$5)):createCommentVNode("",!0),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__sw",onClick:lr[4]||(lr[4]=br=>vn.value=!vn.value),"aria-label":vn.value?"":""},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":vn.value?"#lucide-arrow-up-1-0":"#lucide-arrow-down-0-1"},null,8,_hoisted_12$5)]))],8,_hoisted_11$5),createBaseVNode("button",{class:"b3-tooltips b3-tooltips__sw",onClick:Fr,"aria-label":yn.value?"":""},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":yn.value?"#lucide-panel-top-open":"#lucide-panel-top-close"},null,8,_hoisted_14$4)]))],8,_hoisted_13$5),an.mode==="mark"||an.mode==="note"?(openBlock$1(),createElementBlock("div",_hoisted_15$4,[createBaseVNode("button",{class:"b3-tooltips b3-tooltips__sw",onClick:lr[5]||(lr[5]=withModifiers(br=>Sn.value=!Sn.value,["stop"])),"aria-label":Qn.value||""},[...lr[18]||(lr[18]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconRef"})],-1)])],8,_hoisted_16$4),Sn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-menu sr-bind-menu",onClick:lr[9]||(lr[9]=withModifiers(()=>{},["stop"]))},[Zn.value?(openBlock$1(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",_hoisted_17$4,[createBaseVNode("div",_hoisted_18$4,[createBaseVNode("div",null,toDisplayString(Qn.value),1),createBaseVNode("div",_hoisted_19$4,toDisplayString(Zn.value),1)]),createBaseVNode("button",{onClick:Ho,class:"sr-unbind-btn"},"")]),createBaseVNode("div",_hoisted_20$4,[createBaseVNode("label",null,[withDirectives(createBaseVNode("input",{type:"checkbox","onUpdate:modelValue":lr[6]||(lr[6]=br=>ro.value=br),onChange:is},null,544),[[vModelCheckbox,ro.value]]),lr[19]||(lr[19]=createBaseVNode("span",null,"",-1))])]),createBaseVNode("div",_hoisted_21$3,[createBaseVNode("label",null,[withDirectives(createBaseVNode("input",{type:"checkbox","onUpdate:modelValue":lr[7]||(lr[7]=br=>oo.value=br),onChange:ua},null,544),[[vModelCheckbox,oo.value]]),lr[20]||(lr[20]=createBaseVNode("span",null,"",-1))])])],64)):createCommentVNode("",!0),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":lr[8]||(lr[8]=br=>Rn.value=br),placeholder:"...",onInput:Ci,class:"sr-bind-search"},null,544),[[vModelText,Rn.value]]),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Hn.value,br=>(openBlock$1(),createElementBlock("div",{key:br.path,class:"sr-menu-item",onClick:Mr=>Ks(br)},toDisplayString(br.hPath||""),9,_hoisted_22$3))),128)),Rn.value&&!Hn.value.length?(openBlock$1(),createElementBlock("div",_hoisted_23$3,"")):createCommentVNode("",!0)])):createCommentVNode("",!0)])):createCommentVNode("",!0)]),createBaseVNode("div",{ref_key:"contentRef",ref:hn,class:"sr-content",onScroll:Co},[withDirectives(createBaseVNode("div",{ref_key:"tocRef",ref:dn},null,512),[[vShow,an.mode==="toc"&&!bn.value]]),withDirectives(createBaseVNode("div",{ref_key:"thumbContainer",ref:pn,class:"sr-thumbnails"},[kr.value?(openBlock$1(!0),createElementBlock(Fragment,{key:1},renderList(wr.value,br=>(openBlock$1(),createElementBlock("div",{key:br,"data-page":br,class:"sr-thumb",onClick:Mr=>Br(br)},[An.value[br]?(openBlock$1(),createElementBlock("img",{key:0,src:An.value[br],alt:` ${br} `},null,8,_hoisted_26$1)):(openBlock$1(),createElementBlock("div",_hoisted_27$1,toDisplayString(br),1)),createBaseVNode("div",_hoisted_28$1,toDisplayString(br),1)],8,_hoisted_25$1))),128)):(openBlock$1(),createElementBlock("div",_hoisted_24$3," PDF "))],512),[[vShow,an.mode==="toc"&&bn.value]]),createVNode(Transition,{name:"fade",mode:"out-in"},{default:withCtx(()=>[an.mode==="bookmark"?(openBlock$1(),createElementBlock("div",_hoisted_29$1,[$r.value.length?(openBlock$1(!0),createElementBlock(Fragment,{key:1},renderList($r.value,(br,Mr)=>(openBlock$1(),createElementBlock("div",{key:br.id||Mr,class:"sr-bookmark-item",onClick:jn=>xr(br)},[createTextVNode(toDisplayString(br.title||"")+" ",1),createBaseVNode("button",{class:"sr-action-btn b3-tooltips b3-tooltips__nw","aria-label":"",onClick:withModifiers(jn=>Wn(br),["stop"])},[...lr[21]||(lr[21]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_32$1)],8,_hoisted_31$1))),128)):(openBlock$1(),createElementBlock("div",_hoisted_30$1,toDisplayString(cr.value),1))])):an.mode==="mark"||an.mode==="note"?(openBlock$1(),createElementBlock("div",{key:an.mode,class:"sr-list"},[$r.value.length?(openBlock$1(!0),createElementBlock(Fragment,{key:1},renderList($r.value,(br,Mr)=>(openBlock$1(),createElementBlock(Fragment,{key:br.key||br.groupId||br.id||br.page||Mr},[br.isGroup?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-card sr-group",onClick:jn=>_n.value.has(br.key)?_n.value.delete(br.key):_n.value.add(br.key)},[createBaseVNode("span",{class:normalizeClass(["sr-bar",{collapsed:_n.value.has(br.key)}])},null,2),createBaseVNode("div",_hoisted_35$1,[createBaseVNode("span",_hoisted_36$1,toDisplayString(br.key),1),createBaseVNode("span",_hoisted_37$1,toDisplayString(br.items.length),1)])],8,_hoisted_34$1)):createCommentVNode("",!0),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(br.isGroup&&!_n.value.has(br.key)?br.items:[br.isGroup?null:br],(jn,sr)=>{var _r,Cr,Ar,Rr;return openBlock$1(),createElementBlock(Fragment,{key:(jn==null?void 0:jn.id)||sr},[jn?(openBlock$1(),createElementBlock("div",{key:0,class:normalizeClass(["sr-card",{"sr-card-edit":Gn(jn)}])},[createBaseVNode("span",{class:"sr-bar",style:normalizeStyle({background:jn.type==="ink-group"?"#ff9800":jn.type==="shape-group"?"#2196f3":unref(Yn)[Gn(jn)?Ln.value:jn.color]||"var(--b3-theme-primary)"})},null,4),createBaseVNode("div",{class:"sr-main",onClick:vr=>jn.type==="ink-group"||jn.type==="shape-group"||Gn(jn)?null:xr(jn)},[createBaseVNode("div",_hoisted_39,[jn.chapter?(openBlock$1(),createElementBlock("div",_hoisted_40,toDisplayString(jn.chapter),1)):createCommentVNode("",!0),!jn.type||jn.type==="highlight"||jn.type==="note"?(openBlock$1(),createElementBlock("div",_hoisted_41,toDisplayString(unref(formatTime)(jn.timestamp||Date.now())),1)):createCommentVNode("",!0),jn.type==="ink-group"||jn.type==="shape-group"?(openBlock$1(),createElementBlock("button",{key:2,onClick:withModifiers(vr=>Wr(jn),["stop"]),class:"sr-expand-btn b3-tooltips b3-tooltips__nw","aria-label":Lr(jn)?"":""},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":Lr(jn)?"#iconUp":"#iconDown"},null,8,_hoisted_43)]))],8,_hoisted_42)):createCommentVNode("",!0)]),Gn(jn)?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-title",contenteditable:"",onBlur:lr[10]||(lr[10]=vr=>Nn.value=vr.target.textContent),innerHTML:Nn.value},null,40,_hoisted_44)):(openBlock$1(),createElementBlock("div",_hoisted_45,[createTextVNode(toDisplayString(jn.type==="ink-group"?"":jn.type==="shape-group"?"":jn.text||""),1),jn.type==="ink-group"||jn.type==="shape-group"?(openBlock$1(),createElementBlock("span",_hoisted_46,""+toDisplayString(jn.page)+"  "+toDisplayString((jn.inks||jn.shapes).length)+"",1)):createCommentVNode("",!0)])),Gn(jn)?withDirectives((openBlock$1(),createElementBlock("textarea",{key:2,ref_for:!0,ref_key:"editNoteRef",ref:fn,"onUpdate:modelValue":lr[11]||(lr[11]=vr=>Mn.value=vr),placeholder:"...",class:"sr-note-input"},null,512)),[[vModelText,Mn.value]]):jn.note?(openBlock$1(),createElementBlock("div",_hoisted_47,toDisplayString(jn.note),1)):createCommentVNode("",!0),jn.type==="ink-group"?(openBlock$1(),createElementBlock("canvas",{key:4,"data-page":jn.page,class:"sr-preview sr-group-preview",width:"240",height:"80"},null,8,_hoisted_48)):createCommentVNode("",!0),Gn(jn)&&Dn(jn)?(openBlock$1(),createElementBlock(Fragment,{key:5},[createBaseVNode("div",_hoisted_49,[createBaseVNode("div",_hoisted_50,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(COLORS),vr=>(openBlock$1(),createElementBlock("button",{key:vr.color,class:normalizeClass(["sr-color-btn",{active:Ln.value===vr.color}]),style:normalizeStyle({background:vr.bg}),onClick:withModifiers(Tr=>Ln.value=vr.color,["stop"])},null,14,_hoisted_51))),128))]),jn.type==="shape"?(openBlock$1(),createElementBlock("div",_hoisted_52,[(openBlock$1(),createElementBlock(Fragment,null,renderList(Pn,vr=>createBaseVNode("button",{key:vr.type,class:normalizeClass(["sr-style-btn",{active:zn.value===vr.type}]),onClick:withModifiers(Tr=>zn.value=vr.type,["stop"]),title:vr.label},[(openBlock$1(),createElementBlock("svg",_hoisted_54,[createBaseVNode("use",{"xlink:href":vr.icon},null,8,_hoisted_55)]))],10,_hoisted_53)),64))])):(openBlock$1(),createElementBlock("div",_hoisted_56,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(STYLES).filter(vr=>!vr.pdfOnly||kr.value),vr=>(openBlock$1(),createElementBlock("button",{key:vr.type,class:normalizeClass(["sr-style-btn",{active:On.value===vr.type}]),onClick:withModifiers(Tr=>On.value=vr.type,["stop"])},[createBaseVNode("span",{class:"sr-style-icon","data-type":vr.type},toDisplayString(vr.text),9,_hoisted_58)],10,_hoisted_57))),128))]))]),createBaseVNode("div",_hoisted_59,[createBaseVNode("button",{onClick:withModifiers(vr=>er(jn),["stop"]),class:"sr-btn-primary"},"",8,_hoisted_60),createBaseVNode("button",{onClick:withModifiers(nr,["stop"]),class:"sr-btn-secondary"},"")])],64)):createCommentVNode("",!0),createVNode(Transition,{name:"expand"},{default:withCtx(()=>[Lr(jn)?(openBlock$1(),createElementBlock("div",_hoisted_61,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(jn.inks||jn.shapes,vr=>{var Tr,Kr,Gr,Qr;return openBlock$1(),createElementBlock("div",{key:vr.id,class:normalizeClass(["sr-sub-item",{"sr-card-edit":Gn(vr)}]),onClick:withModifiers(Dr=>Gn(vr)?null:xr(vr),["stop"])},[jn.type==="ink-group"?(openBlock$1(),createElementBlock("canvas",{key:0,"data-ink-id":vr.id,class:"sr-preview",width:"240",height:"40"},null,8,_hoisted_63)):(openBlock$1(),createElementBlock("canvas",{key:1,"data-shape-id":vr.id,class:"sr-preview"},null,8,_hoisted_64)),Gn(vr)?withDirectives((openBlock$1(),createElementBlock("textarea",{key:2,ref_for:!0,ref_key:"editNoteRef",ref:fn,"onUpdate:modelValue":lr[12]||(lr[12]=Dr=>Mn.value=Dr),placeholder:"...",class:"sr-note-input"},null,512)),[[vModelText,Mn.value]]):vr.note?(openBlock$1(),createElementBlock("div",_hoisted_65,toDisplayString(vr.note),1)):createCommentVNode("",!0),Gn(vr)?(openBlock$1(),createElementBlock(Fragment,{key:4},[createBaseVNode("div",_hoisted_66,[createBaseVNode("div",_hoisted_67,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(COLORS),Dr=>(openBlock$1(),createElementBlock("button",{key:Dr.color,class:normalizeClass(["sr-color-btn",{active:Ln.value===Dr.color}]),style:normalizeStyle({background:Dr.bg}),onClick:withModifiers(ho=>Ln.value=Dr.color,["stop"])},null,14,_hoisted_68))),128))]),vr.type==="shape"?(openBlock$1(),createElementBlock("div",_hoisted_69,[(openBlock$1(),createElementBlock(Fragment,null,renderList(Pn,Dr=>createBaseVNode("button",{key:Dr.type,class:normalizeClass(["sr-style-btn",{active:zn.value===Dr.type}]),onClick:withModifiers(ho=>zn.value=Dr.type,["stop"]),title:Dr.label},[(openBlock$1(),createElementBlock("svg",_hoisted_71,[createBaseVNode("use",{"xlink:href":Dr.icon},null,8,_hoisted_72)]))],10,_hoisted_70)),64))])):createCommentVNode("",!0)]),createBaseVNode("div",_hoisted_73,[createBaseVNode("button",{onClick:withModifiers(Dr=>er(vr),["stop"]),class:"sr-btn-primary"},"",8,_hoisted_74),createBaseVNode("button",{onClick:withModifiers(nr,["stop"]),class:"sr-btn-secondary"},"")])],64)):(openBlock$1(),createElementBlock("div",_hoisted_75,[jn.type==="shape-group"?(openBlock$1(),createElementBlock("button",{key:0,onClick:withModifiers(Dr=>$i(vr),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Tr=sn.i18n)==null?void 0:Tr.copy)||""},[...lr[22]||(lr[22]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconCopy"})],-1)])],8,_hoisted_76)):createCommentVNode("",!0),jn.type==="shape-group"?(openBlock$1(),createElementBlock("button",{key:1,onClick:withModifiers(Dr=>rr(vr),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Kr=sn.i18n)==null?void 0:Kr.edit)||""},[...lr[23]||(lr[23]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconEdit"})],-1)])],8,_hoisted_77)):createCommentVNode("",!0),vr.blockId?(openBlock$1(),createElementBlock("button",{key:2,onClick:withModifiers(Dr=>unref(openBlock)(vr.blockId),["stop"]),onMouseenter:Dr=>mr(Dr,vr.blockId),onMouseleave:lr[13]||(lr[13]=(...Dr)=>unref(hideFloat)&&unref(hideFloat)(...Dr)),class:"b3-tooltips b3-tooltips__nw","aria-label":""},[...lr[24]||(lr[24]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconRef"})],-1)])],40,_hoisted_78)):(openBlock$1(),createElementBlock("button",{key:3,onClick:withModifiers(Dr=>ar(vr),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Gr=sn.i18n)==null?void 0:Gr.import)||""},[...lr[25]||(lr[25]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDownload"})],-1)])],8,_hoisted_79)),createBaseVNode("button",{onClick:withModifiers(Dr=>fr(vr),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Qr=sn.i18n)==null?void 0:Qr.delete)||""},[...lr[26]||(lr[26]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_80)]))],10,_hoisted_62)}),128))])):createCommentVNode("",!0)]),_:2},1024),!Gn(jn)&&(!jn.type||jn.type==="highlight"||jn.type==="note")?(openBlock$1(),createElementBlock("div",_hoisted_81,[createBaseVNode("button",{onClick:withModifiers(vr=>$i(jn),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((_r=sn.i18n)==null?void 0:_r.copy)||""},[...lr[27]||(lr[27]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconCopy"})],-1)])],8,_hoisted_82),createBaseVNode("button",{onClick:withModifiers(vr=>rr(jn),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Cr=sn.i18n)==null?void 0:Cr.edit)||""},[...lr[28]||(lr[28]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconEdit"})],-1)])],8,_hoisted_83),jn.blockId?(openBlock$1(),createElementBlock("button",{key:0,onClick:withModifiers(vr=>unref(openBlock)(jn.blockId),["stop"]),onMouseenter:vr=>mr(vr,jn.blockId),onMouseleave:lr[14]||(lr[14]=(...vr)=>unref(hideFloat)&&unref(hideFloat)(...vr)),class:"b3-tooltips b3-tooltips__nw","aria-label":""},[...lr[29]||(lr[29]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconRef"})],-1)])],40,_hoisted_84)):(openBlock$1(),createElementBlock("button",{key:1,onClick:withModifiers(vr=>ar(jn),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Ar=sn.i18n)==null?void 0:Ar.import)||""},[...lr[30]||(lr[30]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDownload"})],-1)])],8,_hoisted_85)),createBaseVNode("button",{onClick:withModifiers(vr=>fr(jn),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((Rr=sn.i18n)==null?void 0:Rr.delete)||""},[...lr[31]||(lr[31]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_86)])):createCommentVNode("",!0)],8,_hoisted_38)],2)):createCommentVNode("",!0)],64)}),128))],64))),128)):(openBlock$1(),createElementBlock("div",_hoisted_33$1,toDisplayString(cr.value),1))])):an.mode==="deck"?(openBlock$1(),createElementBlock("div",_hoisted_87,[$r.value.length?(openBlock$1(!0),createElementBlock(Fragment,{key:1},renderList($r.value,(br,Mr)=>{var jn,sr;return openBlock$1(),createElementBlock("div",{key:br.id||Mr,class:"sr-deck-card",onClick:_r=>En.value=En.value===br.id?null:br.id},[createBaseVNode("div",_hoisted_90,[createBaseVNode("div",_hoisted_91,toDisplayString(br.word),1),createBaseVNode("div",_hoisted_92,[createBaseVNode("button",{onClick:withModifiers(_r=>Er(br),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((jn=sn.i18n)==null?void 0:jn.locate)||""},[...lr[32]||(lr[32]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconFocus"})],-1)])],8,_hoisted_93),createBaseVNode("button",{onClick:withModifiers(_r=>Jr(br.id),["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":((sr=sn.i18n)==null?void 0:sr.delete)||""},[...lr[33]||(lr[33]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_94)])]),createBaseVNode("div",_hoisted_95,[createBaseVNode("span",_hoisted_96,toDisplayString(unref(getDictName)(br.dictId)),1),createBaseVNode("span",_hoisted_97,toDisplayString(unref(formatTime)(br.timestamp)),1)]),createVNode(Transition,{name:"expand"},{default:withCtx(()=>[En.value===br.id?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-deck-content",innerHTML:unref(renderDictCard)(br.data)},null,8,_hoisted_98)):createCommentVNode("",!0)]),_:2},1024)],8,_hoisted_89)}),128)):(openBlock$1(),createElementBlock("div",_hoisted_88,toDisplayString(cr.value),1))])):createCommentVNode("",!0)]),_:1})],544)]))}}),ReaderToc=_export_sfc(_sfc_main$6,[["__scopeId","data-v-7fad0471"]]),_hoisted_1$5={class:"dict-mgr"},_hoisted_2$4={class:"dict-group"},_hoisted_3$4=["disabled"],_hoisted_4$4={key:0,class:"dict-loading"},_hoisted_5$4={key:1,class:"dict-empty"},_hoisted_6$4={key:2,class:"dict-list"},_hoisted_7$4={class:"dict-drag"},_hoisted_8$4=["disabled","onClick"],_hoisted_9$4=["disabled","onClick"],_hoisted_10$4={class:"dict-info"},_hoisted_11$4={class:"dict-name"},_hoisted_12$4={class:"dict-desc"},_hoisted_13$4={class:"dict-actions"},_hoisted_14$3=["checked","onChange"],_hoisted_15$3=["onClick"],_hoisted_16$3={class:"dict-group"},_hoisted_17$3={class:"dict-list"},_hoisted_18$3={class:"dict-drag"},_hoisted_19$3=["disabled","onClick"],_hoisted_20$3=["disabled","onClick"],_hoisted_21$2={class:"dict-info"},_hoisted_22$2={class:"dict-name"},_hoisted_23$2={class:"dict-desc"},_hoisted_24$2=["checked","onChange"],_sfc_main$5=defineComponent({__name:"DictMgr",setup(an){const on=usePlugin(),sn=ref(),ln=ref([]),cn=ref([]),un=ref(!1),dn=ref(!0),hn=async yn=>{const wn=yn.target.files;if(wn!=null&&wn.length){un.value=!0;try{await offlineDictManager.addDict(wn),ln.value=offlineDictManager.getDicts(),siyuan.showMessage(` ${wn.length} `,2e3,"info")}catch(kn){siyuan.showMessage(kn.message||"",3e3,"error")}finally{un.value=!1,sn.value&&(sn.value.value="")}}},fn=async yn=>{await offlineDictManager.toggleDict(yn),ln.value=offlineDictManager.getDicts()},pn=async yn=>{await onlineDictManager.toggleDict(yn),cn.value=onlineDictManager.getDicts()},gn=async yn=>{confirm("")&&(await offlineDictManager.removeDict(yn),ln.value=offlineDictManager.getDicts(),siyuan.showMessage("",1500,"info"))},mn=async(yn,wn,kn,_n)=>{const xn=[...yn],En=kn+_n;if(!(En<0||En>=xn.length))return[xn[kn],xn[En]]=[xn[En],xn[kn]],await wn.sortDicts(xn.map(Tn=>Tn.id)),xn},bn=async(yn,wn)=>{const kn=await mn(ln.value,offlineDictManager,yn,wn);kn&&(ln.value=kn)},vn=async(yn,wn)=>{const kn=await mn(cn.value,onlineDictManager,yn,wn);kn&&(cn.value=kn)};return onMounted(async()=>{dn.value=!0;try{await Promise.all([offlineDictManager.init(on),onlineDictManager.init(on)]),ln.value=offlineDictManager.getDicts(),cn.value=onlineDictManager.getDicts()}finally{dn.value=!1}}),(yn,wn)=>{const kn=resolveDirective("motion-pop-visible");return openBlock$1(),createElementBlock("div",_hoisted_1$5,[withDirectives((openBlock$1(),createElementBlock("div",_hoisted_2$4,[wn[7]||(wn[7]=createStaticVNode('<div class="dict-header" data-v-2cfd160f><h3 class="dict-title" data-v-2cfd160f> </h3><a href="https://github.com/mm-o/siyuan-sireader/blob/main/docs/.md" target="_blank" class="dict-help" data-v-2cfd160f><svg data-v-2cfd160f><use xlink:href="#iconHelp" data-v-2cfd160f></use></svg> </a></div><div class="dict-tip" data-v-2cfd160f><svg data-v-2cfd160f><use xlink:href="#iconInfo" data-v-2cfd160f></use></svg>  StarDict (.ifo/.idx/.dict.dz)  dictd (.index/.dict.dz)  </div>',2)),createBaseVNode("input",{ref_key:"fileInput",ref:sn,type:"file",multiple:"",accept:".ifo,.idx,.dz,.index,.syn",style:{display:"none"},onChange:hn},null,544),createBaseVNode("button",{class:"b3-button b3-button--outline",disabled:un.value,onClick:wn[0]||(wn[0]=_n=>{var xn;return(xn=sn.value)==null?void 0:xn.click()})},[wn[1]||(wn[1]=createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconUpload"})],-1)),createTextVNode(" "+toDisplayString(un.value?"...":""),1)],8,_hoisted_3$4),dn.value?(openBlock$1(),createElementBlock("div",_hoisted_4$4,[...wn[2]||(wn[2]=[createBaseVNode("div",{class:"dict-loading-spinner"},null,-1),createBaseVNode("div",{class:"dict-loading-text"},"...",-1)])])):ln.value.length?(openBlock$1(),createElementBlock("div",_hoisted_6$4,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(ln.value,(_n,xn)=>(openBlock$1(),createElementBlock("div",{key:_n.id,class:"dict-item"},[createBaseVNode("div",_hoisted_7$4,[createBaseVNode("button",{class:"b3-button b3-button--text",disabled:xn===0,onClick:En=>bn(xn,-1)},[...wn[4]||(wn[4]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconUp"})],-1)])],8,_hoisted_8$4),createBaseVNode("button",{class:"b3-button b3-button--text",disabled:xn===ln.value.length-1,onClick:En=>bn(xn,1)},[...wn[5]||(wn[5]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDown"})],-1)])],8,_hoisted_9$4)]),createBaseVNode("div",_hoisted_10$4,[createBaseVNode("div",_hoisted_11$4,toDisplayString(_n.name),1),createBaseVNode("div",_hoisted_12$4,toDisplayString(_n.type==="stardict"?"StarDict":"dictd")+" ",1)]),createBaseVNode("div",_hoisted_13$4,[createBaseVNode("input",{type:"checkbox",checked:_n.enabled,class:"b3-switch",onChange:En=>fn(_n.id)},null,40,_hoisted_14$3),createBaseVNode("button",{class:"b3-button b3-button--text",onClick:En=>gn(_n.id)},[...wn[6]||(wn[6]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_15$3)])]))),128))])):(openBlock$1(),createElementBlock("div",_hoisted_5$4,[...wn[3]||(wn[3]=[createBaseVNode("div",{class:"dict-empty-icon"},"",-1),createBaseVNode("div",{class:"dict-empty-text"},"",-1),createBaseVNode("div",{class:"dict-empty-hint"},"",-1)])]))])),[[kn]]),withDirectives((openBlock$1(),createElementBlock("div",_hoisted_16$3,[wn[10]||(wn[10]=createBaseVNode("h3",{class:"dict-title"}," ",-1)),wn[11]||(wn[11]=createBaseVNode("div",{class:"dict-desc"},'""',-1)),createBaseVNode("div",_hoisted_17$3,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(cn.value,(_n,xn)=>(openBlock$1(),createElementBlock("div",{key:_n.id,class:"dict-item"},[createBaseVNode("div",_hoisted_18$3,[createBaseVNode("button",{class:"b3-button b3-button--text",disabled:xn===0,onClick:En=>vn(xn,-1)},[...wn[8]||(wn[8]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconUp"})],-1)])],8,_hoisted_19$3),createBaseVNode("button",{class:"b3-button b3-button--text",disabled:xn===cn.value.length-1,onClick:En=>vn(xn,1)},[...wn[9]||(wn[9]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDown"})],-1)])],8,_hoisted_20$3)]),createBaseVNode("div",_hoisted_21$2,[createBaseVNode("div",_hoisted_22$2,toDisplayString(_n.name),1),createBaseVNode("div",_hoisted_23$2,toDisplayString(_n.desc),1)]),createBaseVNode("input",{type:"checkbox",checked:_n.enabled,class:"b3-switch",onChange:En=>pn(_n.id)},null,40,_hoisted_24$2)]))),128))])])),[[kn]])])}}}),DictMgr=_export_sfc(_sfc_main$5,[["__scopeId","data-v-2cfd160f"]]),_hoisted_1$4={class:"sr-nav"},_hoisted_2$3=["aria-label","onClick"],_hoisted_3$3=["xlink:href"],_hoisted_4$3={class:"sr-content"},_hoisted_5$3={class:"sr-preview-toggle"},_hoisted_6$3=["xlink:href"],_hoisted_7$3={class:"sr-preview-body"},_hoisted_8$3={key:0,class:"sr-preview-hf"},_hoisted_9$3={class:"sr-group"},_hoisted_10$3={class:"sr-title"},_hoisted_11$3={class:"sr-label"},_hoisted_12$3=["onUpdate:modelValue"],_hoisted_13$3=["value"],_hoisted_14$2={class:"sr-group"},_hoisted_15$2={class:"sr-title"},_hoisted_16$2={class:"sr-item"},_hoisted_17$2={class:"sr-label"},_hoisted_18$2={class:"sr-group"},_hoisted_19$2={class:"sr-title"},_hoisted_20$2={class:"sr-item"},_hoisted_21$1={class:"sr-label"},_hoisted_22$1=["value"],_hoisted_23$1={value:"custom"},_hoisted_24$1=["onUpdate:modelValue","type"],_hoisted_25={class:"sr-title"},_hoisted_26=["onUpdate:modelValue"],_hoisted_27=["value"],_hoisted_28={key:1,class:"sr-slider"},_hoisted_29=["onUpdate:modelValue","min","max","step"],_hoisted_30=["onUpdate:modelValue"],_hoisted_31={key:0,class:"sr-fonts"},_hoisted_32=["disabled","aria-label"],_hoisted_33={style:{width:"12px",height:"12px"}},_hoisted_34={key:1,class:"sr-empty"},_hoisted_35={key:2,class:"sr-font-list"},_hoisted_36=["onClick"],_hoisted_37={key:3,class:"sr-empty"},_sfc_main$4=defineComponent({__name:"Settings",props:{modelValue:{},i18n:{},onSave:{type:Function}},emits:["update:modelValue"],setup(an,{emit:on}){const sn=an,ln=on,cn=ref(sn.modelValue),un=ref("bookshelf"),dn=ref(localStorage.getItem("sr-preview-expanded")!=="0"),hn=usePlugin(),{canShowToc:fn}=useReaderState(),{customFonts:pn,isLoadingFonts:gn,loadCustomFonts:mn,resetStyles:bn}=useSetting(hn),{load:vn}=useNotebooks();useDocSearch();const{interfaceItems:yn,customThemeItems:wn,appearanceGroups:kn}=UI_CONFIG,_n=computed(()=>({left:"e",right:"w",top:"s",bottom:"n"})[cn.value.navPosition]||"n"),xn=computed(()=>[{id:"bookshelf",icon:"lucide-library-big",tip:"bookshelf"},{id:"search",icon:"lucide-book-search",tip:"search"},{id:"deck",icon:"lucide-wallet-cards",tip:""},...fn.value?[{id:"toc",icon:"lucide-scroll-text",tip:""},{id:"bookmark",icon:"lucide-map-pin-check",tip:""},{id:"mark",icon:"lucide-paint-bucket",tip:""},{id:"note",icon:"lucide-map-pin-pen",tip:""}]:[],{id:"general",icon:"lucide-settings-2",tip:"tabGeneral"},{id:"appearance",icon:"lucide-paintbrush-vertical",tip:"tabAppearance"},{id:"dictionary",icon:"lucide-book-text",tip:""}]),En=computed(()=>{const zn=cn.value.theme==="custom"?cn.value.customTheme:PRESET_THEMES[cn.value.theme];if(!zn)return{};const{textSettings:Pn,paragraphSettings:An,layoutSettings:Vn,visualSettings:Sn,viewMode:Rn}=cn.value,Hn=[Sn.brightness!==1&&`brightness(${Sn.brightness})`,Sn.contrast!==1&&`contrast(${Sn.contrast})`,Sn.sepia>0&&`sepia(${Sn.sepia})`,Sn.saturate!==1&&`saturate(${Sn.saturate})`,Sn.invert&&"invert(1) hue-rotate(180deg)"].filter(Boolean).join(" "),Zn=Pn.fontFamily==="custom"&&Pn.customFont.fontFamily?`"${Pn.customFont.fontFamily}", sans-serif`:Pn.fontFamily||"inherit";return{color:zn.color,backgroundColor:zn.bgImg?"transparent":zn.bg,backgroundImage:zn.bgImg?`url("${zn.bgImg}")`:"none",backgroundSize:"cover",backgroundPosition:"center",fontFamily:Zn,fontSize:`${Pn.fontSize}px`,letterSpacing:`${Pn.letterSpacing}em`,lineHeight:An.lineHeight,filter:Hn||"none","--paragraph-spacing":An.paragraphSpacing,"--text-indent":An.textIndent,"--margin-h":`${Vn.marginHorizontal}px`,"--margin-v":`${Vn.marginVertical}px`,"--gap":`${Vn.gap}%`,"--header-footer":`${Vn.headerFooterMargin}px`,"--max-block":Vn.maxBlockSize>0?`${Vn.maxBlockSize}px`:"none","--column-count":Rn==="double"?2:1}}),Tn=async()=>(ln("update:modelValue",cn.value),await sn.onSave()),Bn=(()=>{let zn;return()=>(clearTimeout(zn),zn=setTimeout(Tn,300))})(),Nn=()=>confirm(sn.i18n.confirmReset||"")&&(bn(),Tn()),Mn=zn=>(cn.value.textSettings.fontFamily=zn?"custom":"inherit",cn.value.textSettings.customFont=zn?{fontFamily:zn.displayName,fontFile:zn.name}:{fontFamily:"",fontFile:""},zn?Bn():Tn()),Ln=zn=>siyuan.openTab({app:hn.app,custom:{icon:"siyuan-reader-icon",title:zn.name||"",data:{bookInfo:zn},id:`${hn.name}custom_tab_online_reader`}}),On=()=>(dn.value=!dn.value,localStorage.setItem("sr-preview-expanded",dn.value?"1":"0"));return onMounted(()=>(mn(),bookshelfManager.init())),watch(()=>[un.value,cn.value.annotationMode==="notebook"],([zn,Pn])=>zn==="general"&&Pn&&vn()),watch(()=>sn.modelValue,zn=>cn.value=zn,{deep:!0}),watch(fn,zn=>!zn&&["toc","bookmark","mark","note"].includes(un.value)&&(un.value="bookshelf")),(zn,Pn)=>{const An=resolveDirective("motion-pop-visible");return openBlock$1(),createElementBlock("div",{class:normalizeClass(["sr-settings",`nav-${cn.value.navPosition}`])},[createBaseVNode("nav",_hoisted_1$4,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(xn.value,Vn=>{var Sn;return openBlock$1(),createElementBlock("button",{key:Vn.id,class:normalizeClass(["sr-nav-tab b3-tooltips",[{"sr-nav-tab--active":un.value===Vn.id},`b3-tooltips__${_n.value}`]]),"aria-label":((Sn=an.i18n)==null?void 0:Sn[Vn.tip])||Vn.tip,onClick:Rn=>un.value=Vn.id},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":"#"+Vn.icon},null,8,_hoisted_3$3)]))],10,_hoisted_2$3)}),128))]),createBaseVNode("main",_hoisted_4$3,[un.value==="appearance"?(openBlock$1(),createElementBlock("div",{key:0,class:normalizeClass(["sr-preview",{expanded:dn.value}]),style:normalizeStyle(En.value)},[createBaseVNode("div",{class:"sr-preview-hf",onClick:On},[createBaseVNode("span",null,toDisplayString(an.i18n.livePreview||""),1),(openBlock$1(),createElementBlock("svg",_hoisted_5$3,[createBaseVNode("use",{"xlink:href":dn.value?"#iconContract":"#iconExpand"},null,8,_hoisted_6$3)]))]),createVNode(Transition,{name:"expand"},{default:withCtx(()=>[withDirectives(createBaseVNode("div",_hoisted_7$3,[...Pn[8]||(Pn[8]=[createBaseVNode("p",null,"",-1),createBaseVNode("p",null,"",-1)])],512),[[vShow,dn.value]])]),_:1}),dn.value?(openBlock$1(),createElementBlock("div",_hoisted_8$3,toDisplayString(cn.value.viewMode==="double"?"":cn.value.viewMode==="scroll"?"":""),1)):createCommentVNode("",!0)],6)):createCommentVNode("",!0),createVNode(Transition,{name:"slide",mode:"out-in"},{default:withCtx(()=>{var Vn;return[un.value==="general"?(openBlock$1(),createElementBlock("div",{key:un.value,class:"sr-section"},[withDirectives((openBlock$1(),createElementBlock("div",_hoisted_9$3,[createBaseVNode("h3",_hoisted_10$3,toDisplayString(an.i18n.interfaceSettings||""),1),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(yn),Sn=>(openBlock$1(),createElementBlock("label",{key:Sn.key,class:"sr-item"},[createBaseVNode("span",_hoisted_11$3,[createBaseVNode("b",null,toDisplayString(an.i18n[Sn.key]),1),createBaseVNode("small",null,toDisplayString(an.i18n[Sn.key+"Desc"]),1)]),withDirectives(createBaseVNode("select",{"onUpdate:modelValue":Rn=>cn.value[Sn.key]=Rn,class:"b3-select",onChange:Tn},[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Sn.opts,Rn=>(openBlock$1(),createElementBlock("option",{key:Rn,value:Rn},toDisplayString(an.i18n[Rn]||Rn),9,_hoisted_13$3))),128))],40,_hoisted_12$3),[[vModelSelect,cn.value[Sn.key]]])]))),128))])),[[An]]),withDirectives((openBlock$1(),createElementBlock("div",_hoisted_14$2,[createBaseVNode("h3",_hoisted_15$2,toDisplayString(an.i18n.copySettings||""),1),createBaseVNode("label",_hoisted_16$2,[createBaseVNode("span",_hoisted_17$2,[createBaseVNode("b",null,toDisplayString(an.i18n.linkFormat||""),1),createBaseVNode("small",null,toDisplayString(((Vn=an.i18n)==null?void 0:Vn.linkFormatDesc)||"       "),1)])]),withDirectives(createBaseVNode("textarea",{"onUpdate:modelValue":Pn[0]||(Pn[0]=Sn=>cn.value.linkFormat=Sn),class:"b3-text-field",rows:"2",onInput:Pn[1]||(Pn[1]=(...Sn)=>unref(Bn)&&unref(Bn)(...Sn)),style:{width:"100%",resize:"vertical","font-size":"12px"}},null,544),[[vModelText,cn.value.linkFormat]])])),[[An]])])):un.value==="appearance"?(openBlock$1(),createElementBlock("div",{key:un.value,class:"sr-section"},[withDirectives((openBlock$1(),createElementBlock("div",_hoisted_18$2,[createBaseVNode("h3",_hoisted_19$2,toDisplayString(an.i18n.themeTitle||an.i18n.presetTheme),1),createBaseVNode("label",_hoisted_20$2,[createBaseVNode("span",_hoisted_21$1,[createBaseVNode("b",null,toDisplayString(an.i18n.presetTheme),1),createBaseVNode("small",null,toDisplayString(an.i18n.presetThemeDesc),1)]),withDirectives(createBaseVNode("select",{"onUpdate:modelValue":Pn[2]||(Pn[2]=Sn=>cn.value.theme=Sn),class:"b3-select",onChange:Tn},[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(PRESET_THEMES),(Sn,Rn)=>(openBlock$1(),createElementBlock("option",{key:Rn,value:Rn},toDisplayString(an.i18n[Sn.name]||Sn.name),9,_hoisted_22$1))),128)),createBaseVNode("option",_hoisted_23$1,toDisplayString(an.i18n.custom),1)],544),[[vModelSelect,cn.value.theme]])]),cn.value.theme==="custom"?(openBlock$1(!0),createElementBlock(Fragment,{key:0},renderList(unref(wn),Sn=>(openBlock$1(),createElementBlock("label",{key:Sn.key,class:"sr-item"},[createBaseVNode("b",null,toDisplayString(an.i18n[Sn.label]),1),withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Rn=>cn.value.customTheme[Sn.key]=Rn,type:Sn.type,class:normalizeClass(Sn.type==="color"?"sr-color":"b3-text-field"),onChange:Tn},null,42,_hoisted_24$1),[[vModelDynamic,cn.value.customTheme[Sn.key]]])]))),128)):createCommentVNode("",!0)])),[[An]]),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(kn),Sn=>withDirectives((openBlock$1(),createElementBlock("div",{key:Sn.title,class:"sr-group"},[createBaseVNode("h3",_hoisted_25,toDisplayString(an.i18n[Sn.title]),1),(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Sn.items,Rn=>(openBlock$1(),createElementBlock("label",{key:Rn.key,class:"sr-item"},[createBaseVNode("b",null,toDisplayString(an.i18n[Rn.key]),1),Rn.type==="select"?withDirectives((openBlock$1(),createElementBlock("select",{key:0,"onUpdate:modelValue":Hn=>cn.value[Sn.title][Rn.key]=Hn,class:"b3-select",onChange:Pn[3]||(Pn[3]=(...Hn)=>unref(Bn)&&unref(Bn)(...Hn))},[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(Rn.opts,(Hn,Zn)=>(openBlock$1(),createElementBlock("option",{key:Hn,value:Hn},toDisplayString(an.i18n[Rn.labels[Zn]]),9,_hoisted_27))),128))],40,_hoisted_26)),[[vModelSelect,cn.value[Sn.title][Rn.key]]]):Rn.type==="range"?(openBlock$1(),createElementBlock("span",_hoisted_28,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Hn=>cn.value[Sn.title][Rn.key]=Hn,type:"range",class:"b3-slider",min:Rn.min,max:Rn.max,step:Rn.step,onInput:Pn[4]||(Pn[4]=(...Hn)=>unref(Bn)&&unref(Bn)(...Hn))},null,40,_hoisted_29),[[vModelText,cn.value[Sn.title][Rn.key],void 0,{number:!0}]]),createBaseVNode("em",null,toDisplayString(cn.value[Sn.title][Rn.key])+toDisplayString(Rn.unit||""),1)])):Rn.type==="checkbox"?withDirectives((openBlock$1(),createElementBlock("input",{key:2,"onUpdate:modelValue":Hn=>cn.value[Sn.title][Rn.key]=Hn,type:"checkbox",class:"b3-switch",onChange:Tn},null,40,_hoisted_30)),[[vModelCheckbox,cn.value[Sn.title][Rn.key]]]):createCommentVNode("",!0)]))),128)),Sn.title==="textSettings"?(openBlock$1(),createElementBlock("div",_hoisted_31,[createBaseVNode("b",null,[createTextVNode(toDisplayString(an.i18n.fontFamily)+" ",1),createBaseVNode("button",{class:"b3-button b3-button--text",style:{padding:"0","margin-left":"6px"},onClick:Pn[5]||(Pn[5]=(...Rn)=>unref(mn)&&unref(mn)(...Rn)),disabled:unref(gn),"aria-label":an.i18n.fontTip},[(openBlock$1(),createElementBlock("svg",_hoisted_33,[...Pn[9]||(Pn[9]=[createBaseVNode("use",{"xlink:href":"#iconRefresh"},null,-1)])]))],8,_hoisted_32)]),Pn[10]||(Pn[10]=createBaseVNode("small",null,[createBaseVNode("code",null,"data/plugins/custom-fonts/")],-1)),cn.value.textSettings.customFont.fontFamily?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-font-sel",onClick:Pn[6]||(Pn[6]=Rn=>Mn())},[createBaseVNode("span",{style:normalizeStyle({fontFamily:cn.value.textSettings.customFont.fontFamily})},toDisplayString(cn.value.textSettings.customFont.fontFamily),5),createBaseVNode("small",null,toDisplayString(cn.value.textSettings.customFont.fontFile)+" ",1)])):createCommentVNode("",!0),unref(gn)?(openBlock$1(),createElementBlock("div",_hoisted_34,toDisplayString(an.i18n.loadingFonts),1)):unref(pn).length?(openBlock$1(),createElementBlock("div",_hoisted_35,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(pn),Rn=>(openBlock$1(),createElementBlock("div",{key:Rn.name,class:"sr-font-item",style:normalizeStyle({fontFamily:Rn.displayName}),onClick:Hn=>Mn(Rn)},toDisplayString(Rn.displayName),13,_hoisted_36))),128))])):(openBlock$1(),createElementBlock("div",_hoisted_37,toDisplayString(an.i18n.noCustomFonts),1))])):createCommentVNode("",!0),Sn.title==="visualSettings"?(openBlock$1(),createElementBlock("button",{key:1,class:"b3-button b3-button--outline sr-reset",onClick:Nn},toDisplayString(an.i18n.resetToDefault),1)):createCommentVNode("",!0)])),[[An]])),128))])):un.value==="bookshelf"?(openBlock$1(),createBlock(Bookshelf,{key:un.value,i18n:an.i18n,onRead:Ln},null,8,["i18n"])):un.value==="dictionary"?(openBlock$1(),createBlock(DictMgr,{key:un.value})):["toc","bookmark","mark","note","deck"].includes(un.value)?(openBlock$1(),createBlock(ReaderToc,{key:un.value,mode:un.value,"onUpdate:mode":Pn[7]||(Pn[7]=Sn=>un.value=Sn),i18n:sn.i18n},null,8,["mode","i18n"])):createCommentVNode("",!0)]}),_:1}),withDirectives(createVNode(BookSearch,{i18n:an.i18n,onRead:Ln},null,8,["i18n"]),[[vShow,un.value==="search"]])])],2)}}}),Settings=_export_sfc(_sfc_main$4,[["__scopeId","data-v-75af600e"]]),Settings$1=Object.freeze(Object.defineProperty({__proto__:null,default:Settings},Symbol.toStringTag,{value:"Module"})),PRESET_THEMES={default:{name:"themeDefault",color:"#202124",bg:"#ffffff"},almond:{name:"themeAlmond",color:"#414441",bg:"#FAF9DE"},autumn:{name:"themeAutumn",color:"#414441",bg:"#FFF2E2"},green:{name:"themeGreen",color:"#414441",bg:"#E3EDCD"},blue:{name:"themeBlue",color:"#414441",bg:"#DCE2F1"},night:{name:"themeNight",color:"#fff6e6",bg:"#415062"},dark:{name:"themeDark",color:"#d5cecd",bg:"#414441"},gold:{name:"themeGold",color:"#b58931",bg:"#081010"}},msg={success:an=>siyuan.showMessage(an,2e3,"info"),error:an=>siyuan.showMessage(an,3e3,"error")},DEFAULT_SETTINGS={enabled:!0,openMode:"newTab",tocPosition:"left",navPosition:"left",pageAnimation:"slide",viewMode:"scroll",theme:"default",customTheme:{name:"custom",color:"#202124",bg:"#ffffff"},annotationMode:"notebook",notebookId:"",parentDoc:void 0,linkFormat:`> [!NOTE]  
> []() 
> 
> `,textSettings:{fontFamily:"inherit",fontSize:16,letterSpacing:0,customFont:{fontFamily:"",fontFile:""}},paragraphSettings:{lineHeight:1.6,paragraphSpacing:.8,textIndent:0},layoutSettings:{marginHorizontal:40,marginVertical:20,gap:5,headerFooterMargin:0},visualSettings:{brightness:1,contrast:1,sepia:0,saturate:1,invert:!1}},range=(an,on,sn,ln,cn="")=>({key:an,type:"range",min:on,max:sn,step:ln,unit:cn}),UI_CONFIG={interfaceItems:[{key:"openMode",opts:["newTab","rightTab","bottomTab","newWindow"]},{key:"navPosition",opts:["left","right","top","bottom"]},{key:"tocPosition",opts:["left","right"]},{key:"viewMode",opts:["single","double","scroll"]},{key:"pageAnimation",opts:["slide","none"]}],customThemeItems:[{key:"color",label:"textColor",type:"color"},{key:"bg",label:"bgColor",type:"color"},{key:"bgImg",label:"bgImage",type:"text"}],appearanceGroups:[{title:"textSettings",items:[range("fontSize",12,32,1,"px"),range("letterSpacing",0,.2,.01,"em")]},{title:"paragraphSettings",items:[range("lineHeight",1,3,.1),range("paragraphSpacing",0,2,.1,"em"),range("textIndent",0,4,.5,"em")]},{title:"layoutSettings",items:[range("marginHorizontal",0,100,5,"px"),range("marginVertical",0,80,5,"px"),range("gap",0,20,1,"%"),range("headerFooterMargin",0,60,5,"px")]},{title:"visualSettings",items:[range("brightness",.5,1.5,.05),range("contrast",.5,1.5,.05),range("sepia",0,1,.05),range("saturate",0,2,.1),{key:"invert",type:"checkbox"}]}]},scanCustomFonts=async()=>{try{const an=await siyuan.fetchSyncPost("/api/file/readDir",{path:"/data/plugins/custom-fonts"});return(an==null?void 0:an.code)===0&&Array.isArray(an.data)?an.data.filter(on=>!on.isDir&&/\.(ttf|otf|woff2?)$/i.test(on.name)).map(on=>({name:on.name,displayName:on.name.replace(/\.(ttf|otf|woff2?)$/i,"")})):[]}catch{return[]}},loadFonts=an=>{let on=document.getElementById("sr-fonts")||Object.assign(document.createElement("style"),{id:"sr-fonts"});on.parentNode||document.head.appendChild(on),on.textContent=an.map(sn=>`@font-face{font-family:"${sn.displayName}";src:url("/plugins/custom-fonts/${sn.name}")}`).join("")},resetToDefaults=an=>Object.assign(an,{textSettings:DEFAULT_SETTINGS.textSettings,paragraphSettings:DEFAULT_SETTINGS.paragraphSettings,layoutSettings:DEFAULT_SETTINGS.layoutSettings,visualSettings:DEFAULT_SETTINGS.visualSettings}),applyTemplate=(an,on)=>Object.entries(on).reduce((sn,[ln,cn])=>ln.split("|").reduce((un,dn)=>un.replace(new RegExp(dn,"g"),cn),sn),an),formatBookLink=(an,on,sn,ln,cn,un,dn,hn="",fn="",pn="")=>applyTemplate(dn,{"|{{title}}":on,"|{{author}}":sn,"|{{chapter}}":ln,"|{{location}}":cn,"|{{url}}":`sireader://open?url=${pn?`${an}_${pn}`:an}&cfi=${cn}`,"|{{text}}":un,"|{{note}}":hn,"|{{image}}":fn}).replace(/> \n/g,"").replace(/\n\n+/g,`
`),parseBookLink=an=>{try{const on=an.match(/^sireader:\/\/open\?(.+)$/);if(!on)return null;const sn=new URLSearchParams(on[1].replace(/&amp;/g,"&"));let ln=sn.get("url"),cn=sn.get("cfi");if(!ln||!cn)return null;let un;const dn=ln.indexOf("://");if(dn!==-1){const hn=ln.slice(dn+3),fn=[/_(note-[^_]+)$/,/_(shape_\d+_[^_]+)$/,/_(bookmark-[^_]+)$/];for(const pn of fn){const gn=hn.match(pn);if(gn){un=gn[1],ln=ln.slice(0,ln.lastIndexOf("_"+un));break}}}return{bookUrl:ln,cfi:cn,id:un}}catch{return null}},loadNotebooks=async()=>{var on;const an=await siyuan.fetchSyncPost("/api/notebook/lsNotebooks",{});return(an==null?void 0:an.code)===0?((on=an.data)==null?void 0:on.notebooks)||[]:[]},searchDocs=async an=>{const on=await siyuan.fetchSyncPost("/api/filetree/searchDocs",{k:an});return(on==null?void 0:on.code)===0&&Array.isArray(on.data)?on.data:[]},createDocInfo=an=>({id:an.id,name:an.hPath||an.content||"",path:an.path||"",notebook:an.box||""}),useDocSearch=()=>{const an=ref({input:"",results:[],show:!1});return{state:an,search:async()=>{const cn=an.value.input.trim();cn&&(an.value.results=await searchDocs(cn),an.value.show=!0)},select:(cn,un)=>(un(createDocInfo(cn)),an.value={input:"",results:[],show:!1}),reset:()=>an.value={input:"",results:[],show:!1}}},useNotebooks=()=>{const an=ref([]);return{notebooks:an,load:async()=>!an.value.length&&(an.value=await loadNotebooks())}};function useSetting(an){const on=ref({...DEFAULT_SETTINGS}),sn=an.i18n,ln=ref([]),cn=ref(!1),un=ref(!1);let dn=null,hn=null;const fn=async()=>{var wn;const yn=await an.loadData("config.json")||{};if(yn.settings){const{pageSettings:kn,..._n}=yn.settings;(wn=_n.layoutSettings)==null||delete wn.maxBlockSize,on.value={...DEFAULT_SETTINGS,..._n,textSettings:{...DEFAULT_SETTINGS.textSettings,..._n.textSettings},layoutSettings:{...DEFAULT_SETTINGS.layoutSettings,..._n.layoutSettings}}}un.value=!0},pn=async()=>{try{const yn=await an.loadData("config.json")||{},wn=JSON.parse(JSON.stringify(toRaw(on.value)));yn.settings=wn,await an.saveData("config.json",yn),window.dispatchEvent(new CustomEvent("sireaderSettingsUpdated",{detail:wn})),msg.success((sn==null?void 0:sn.saved)||"")}catch{msg.error((sn==null?void 0:sn.saveError)||"")}},gn=async()=>(cn.value=!0,ln.value=await scanCustomFonts(),cn.value=!1,loadFonts(ln.value)),mn=(yn,wn)=>{on.value.textSettings.fontFamily=yn?"custom":"inherit",yn?on.value.textSettings.customFont={fontFamily:yn.displayName,fontFile:yn.name}:on.value.textSettings.customFont={fontFamily:"",fontFile:""},wn==null||wn()},bn=()=>resetToDefaults(on.value),vn=async()=>{dn&&(hn==null||hn.unmount(),dn.destroy()),await fn(),dn=new siyuan.Dialog({title:(sn==null?void 0:sn.settingsTitle)||"",content:'<div id="sireader-settings-mount"></div>',width:"680px",height:"580px",destroyCallback:()=>(hn==null||hn.unmount(),dn=null,hn=null)});const yn=dn.element.querySelector("#sireader-settings-mount");yn&&(hn=createApp(Settings,{modelValue:on.value,i18n:sn,onSave:pn,"onUpdate:modelValue":wn=>on.value=wn}),hn.use(MotionPlugin),hn.mount(yn))};return fn(),{settings:on,isLoaded:un,open:vn,save:pn,loadCustomFonts:gn,setFont:mn,resetStyles:bn,customFonts:ln,isLoadingFonts:cn}}const useSetting$1=Object.freeze(Object.defineProperty({__proto__:null,PRESET_THEMES,UI_CONFIG,createDocInfo,formatBookLink,loadFonts,loadNotebooks,parseBookLink,resetToDefaults,scanCustomFonts,searchDocs,useDocSearch,useNotebooks,useSetting},Symbol.toStringTag,{value:"Module"})),_hoisted_1$3={class:"toolbar-row"},_hoisted_2$2={value:"custom"},_hoisted_3$2=["aria-label"],_hoisted_4$2=["xlink:href"],_hoisted_5$2={key:0,initial:{opacity:0,height:0},enter:{opacity:1,height:"auto"},class:"toolbar-row ink-row"},_hoisted_6$2=["aria-label","onClick"],_hoisted_7$2={class:"ink-width-control"},_hoisted_8$2={class:"ink-width-value"},_hoisted_9$2={key:1,initial:{opacity:0,height:0},enter:{opacity:1,height:"auto"},class:"toolbar-row ink-row"},_hoisted_10$2=["aria-label","onClick"],_hoisted_11$2=["xlink:href"],_hoisted_12$2=["aria-label","onClick"],_hoisted_13$2={class:"ink-width-control"},_hoisted_14$1={class:"ink-width-value"},_hoisted_15$1={class:"pdf-meta-header"},_hoisted_16$1={class:"pdf-meta-body"},_hoisted_17$1={key:0,class:"pdf-meta-grid"},_hoisted_18$1={class:"label"},_hoisted_19$1={class:"value"},_hoisted_20$1={key:1,class:"pdf-meta-loading"},_sfc_main$3=defineComponent({__name:"PdfToolbar",props:{viewer:{},searcher:{},fileSize:{}},emits:["print","download","export-images","ink-toggle","ink-color","ink-width","ink-undo","ink-clear","ink-save","ink-eraser","shape-toggle","shape-type","shape-color","shape-width","shape-filled","shape-undo","shape-clear"],setup(an,{emit:on}){const sn=an,ln=on,cn=ref(!1),un=ref(sn.viewer.getScale()),dn=ref(0),hn=ref("fit-width"),fn=ref(!1),pn=ref("text"),gn=["#ff0000","#00ff00","#0000ff","#ffff00","#ff00ff","#00ffff","#000000"],mn=ref(!1),bn=ref(!1),vn=ref("#ff0000"),yn=ref(2),wn=ref(!1),kn=ref("rect"),_n=ref("#ff0000"),xn=ref(2),En=ref(!1),Tn=[{type:"rect",label:"",icon:"#iconSquareDashed"},{type:"circle",label:"",icon:"#iconCircleDashed"},{type:"triangle",label:"",icon:"#iconTriangleDashed"}],Bn=ref(!1),Nn=ref(null),Mn=ref(),Ln=ref({x:16,y:52}),On=gr=>{gr.preventDefault();const Jn=Mn.value,Fn=Jn.getBoundingClientRect(),Cn=Jn.offsetParent.getBoundingClientRect(),qn=gr.clientX,Gn=gr.clientY,Dn=Cn.right-Fn.right,In=Fn.top-Cn.top,Wn=nr=>{const er=Dn-(nr.clientX-qn),ar=In+(nr.clientY-Gn);Ln.value={x:Math.max(0,Math.min(Cn.width-Fn.width,er)),y:Math.max(0,Math.min(Cn.height-Fn.height,ar))}},rr=()=>{document.removeEventListener("mousemove",Wn),document.removeEventListener("mouseup",rr)};document.addEventListener("mousemove",Wn),document.addEventListener("mouseup",rr)},zn=computed(()=>Math.round(un.value*100)),Pn=gr=>gr<1024?`${gr} B`:gr<1048576?`${(gr/1024).toFixed(2)} KB`:`${(gr/1048576).toFixed(2)} MB`,An=computed(()=>{if(!Nn.value)return[];const gr=Nn.value,Jn=Fn=>Fn.toLocaleString("zh-CN");return[{label:"",value:gr.title||""},{label:"",value:gr.author||""},{label:"",value:gr.subject||""},{label:"",value:gr.keywords||""},{label:"",value:gr.creator||""},{label:"",value:gr.producer||""},{label:"",value:gr.pageCount},{label:"PDF",value:gr.pdfVersion||""},gr.fileSize&&{label:"",value:Pn(gr.fileSize)},gr.creationDate&&{label:"",value:Jn(gr.creationDate)},gr.modificationDate&&{label:"",value:Jn(gr.modificationDate)}].filter(Boolean)}),Vn=async()=>{un.value=Math.min(5,un.value+.25),await sn.viewer.setScale(un.value),hn.value="custom"},Sn=async()=>{un.value=Math.max(.25,un.value-.25),await sn.viewer.setScale(un.value),hn.value="custom"},Rn=async()=>{hn.value==="fit-width"?await sn.viewer.fitWidth():hn.value==="fit-page"&&await sn.viewer.fitPage(),un.value=sn.viewer.getScale()},Hn=async()=>{dn.value=(dn.value-90+360)%360,await sn.viewer.setRotation(dn.value)},Zn=async()=>{dn.value=(dn.value+90)%360,await sn.viewer.setRotation(dn.value)},Qn=()=>ln("print"),Yn=()=>ln("download"),tr=()=>ln("export-images");let Un=null;const Xn=gr=>{pn.value=gr,Un==null||Un();const Jn=sn.viewer.container;if(Object.assign(Jn.style,gr==="hand"?{cursor:"grab",userSelect:"none"}:{cursor:"text",userSelect:"text"}),gr==="hand"){let Fn=!1,Kn=0,Cn=0,qn=0,Gn=0;const Dn=rr=>{rr.button||(Fn=!0,Jn.style.cursor="grabbing",Kn=rr.pageX,Cn=rr.pageY,qn=Jn.scrollLeft,Gn=Jn.scrollTop,rr.preventDefault())},In=rr=>{Fn&&(Jn.scrollLeft=qn-(rr.pageX-Kn),Jn.scrollTop=Gn-(rr.pageY-Cn))},Wn=()=>{Fn=!1,pn.value==="hand"&&(Jn.style.cursor="grab")};Jn.addEventListener("mousedown",Dn),Jn.addEventListener("mousemove",In),Jn.addEventListener("mouseup",Wn),Jn.addEventListener("mouseleave",Wn),Un=()=>{Jn.removeEventListener("mousedown",Dn),Jn.removeEventListener("mousemove",In),Jn.removeEventListener("mouseup",Wn),Jn.removeEventListener("mouseleave",Wn)}}},or=()=>{mn.value=!mn.value,wn.value=!1,ln("ink-toggle",mn.value)},kr=()=>{bn.value=!bn.value,ln("ink-eraser",bn.value)},wr=()=>ln("ink-undo"),Nr=()=>ln("ink-clear"),$r=()=>{wn.value=!wn.value,mn.value=!1,ln("shape-toggle",wn.value)},cr=()=>ln("shape-undo"),hr=()=>ln("shape-clear");return watch(vn,gr=>ln("ink-color",gr)),watch(yn,gr=>ln("ink-width",gr)),watch(kn,gr=>ln("shape-type",gr)),watch(_n,gr=>ln("shape-color",gr)),watch(xn,gr=>ln("shape-width",gr)),watch(En,gr=>ln("shape-filled",gr)),watch(cn,gr=>{gr||(mn.value&&ln("ink-toggle",!1),wn.value&&ln("shape-toggle",!1),mn.value=!1,wn.value=!1)}),watch(Bn,async gr=>{if(gr&&!Nn.value){const{getMetadata:Jn}=await Promise.resolve().then(()=>index);Nn.value=await Jn(sn.viewer.getPDF(),sn.fileSize)}}),(gr,Jn)=>{const Fn=resolveDirective("motion"),Kn=resolveDirective("motion-slide-visible-once-left"),Cn=resolveDirective("motion-pop");return openBlock$1(),createElementBlock(Fragment,null,[withDirectives((openBlock$1(),createElementBlock("div",{ref_key:"toolbarRef",ref:Mn,initial:{opacity:0,x:100},enter:{opacity:1,x:0},class:"pdf-toolbar",style:normalizeStyle({top:Ln.value.y+"px",right:Ln.value.x+"px"})},[createBaseVNode("div",_hoisted_1$3,[cn.value?(openBlock$1(),createElementBlock(Fragment,{key:0},[createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n","aria-label":"",onClick:withModifiers(Sn,["stop"])},[...Jn[16]||(Jn[16]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-zoom-out"})],-1)])]),withDirectives(createBaseVNode("select",{"onUpdate:modelValue":Jn[0]||(Jn[0]=qn=>hn.value=qn),onChange:Rn,onMousedown:Jn[1]||(Jn[1]=withModifiers(()=>{},["stop"]))},[createBaseVNode("option",_hoisted_2$2,toDisplayString(zn.value)+"%",1),Jn[17]||(Jn[17]=createBaseVNode("option",{value:"fit-width"},"",-1)),Jn[18]||(Jn[18]=createBaseVNode("option",{value:"fit-page"},"",-1))],544),[[vModelSelect,hn.value]]),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n","aria-label":"",onClick:withModifiers(Vn,["stop"])},[...Jn[19]||(Jn[19]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-zoom-in"})],-1)])]),Jn[27]||(Jn[27]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n","aria-label":"",onClick:withModifiers(Hn,["stop"])},[...Jn[20]||(Jn[20]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-rotate-ccw-square"})],-1)])]),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n","aria-label":"",onClick:withModifiers(Zn,["stop"])},[...Jn[21]||(Jn[21]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-rotate-cw-square"})],-1)])]),Jn[28]||(Jn[28]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__n",{active:pn.value==="text"}]),"aria-label":"",onClick:Jn[2]||(Jn[2]=withModifiers(qn=>Xn("text"),["stop"]))},[...Jn[22]||(Jn[22]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-square-mouse-pointer"})],-1)])],2),createBaseVNode("button",{class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__n",{active:pn.value==="hand"}]),"aria-label":"",onClick:Jn[3]||(Jn[3]=withModifiers(qn=>Xn("hand"),["stop"]))},[...Jn[23]||(Jn[23]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-hand"})],-1)])],2),createBaseVNode("button",{class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__n",{active:mn.value}]),"aria-label":"",onClick:withModifiers(or,["stop"])},[...Jn[24]||(Jn[24]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-brush"})],-1)])],2),createBaseVNode("button",{class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__n",{active:wn.value}]),"aria-label":"",onClick:withModifiers($r,["stop"])},[...Jn[25]||(Jn[25]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconShapes"})],-1)])],2),Jn[29]||(Jn[29]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n","aria-label":"",onClick:Jn[4]||(Jn[4]=withModifiers(qn=>fn.value=!fn.value,["stop"]))},[...Jn[26]||(Jn[26]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconMore"})],-1)])]),Jn[30]||(Jn[30]=createBaseVNode("span",{class:"toolbar-divider"},null,-1))],64)):createCommentVNode("",!0),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n","aria-label":cn.value?"":"",onClick:Jn[5]||(Jn[5]=withModifiers(qn=>cn.value=!cn.value,["stop"])),onMousedown:On},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":cn.value?"#iconClose":"#iconMenu"},null,8,_hoisted_4$2)]))],40,_hoisted_3$2)]),cn.value&&mn.value?withDirectives((openBlock$1(),createElementBlock("div",_hoisted_5$2,[(openBlock$1(),createElementBlock(Fragment,null,renderList(gn,qn=>createBaseVNode("button",{key:qn,class:normalizeClass(["ink-color b3-tooltips b3-tooltips__s",{active:vn.value===qn}]),style:normalizeStyle({background:qn}),"aria-label":` ${qn}`,onClick:withModifiers(Gn=>vn.value=qn,["stop"])},null,14,_hoisted_6$2)),64)),Jn[34]||(Jn[34]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("div",_hoisted_7$2,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Jn[6]||(Jn[6]=qn=>yn.value=qn),type:"range",min:"1",max:"10",class:"ink-slider",onMousedown:Jn[7]||(Jn[7]=withModifiers(()=>{},["stop"]))},null,544),[[vModelText,yn.value,void 0,{number:!0}]]),createBaseVNode("span",_hoisted_8$2,toDisplayString(yn.value),1)]),Jn[35]||(Jn[35]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__s",{active:bn.value}]),"aria-label":"",onClick:withModifiers(kr,["stop"])},[...Jn[31]||(Jn[31]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-eraser"})],-1)])],2),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__s","aria-label":"",onClick:withModifiers(wr,["stop"])},[...Jn[32]||(Jn[32]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-undo-2"})],-1)])]),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__s","aria-label":"",onClick:withModifiers(Nr,["stop"])},[...Jn[33]||(Jn[33]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-brush-cleaning"})],-1)])])])),[[Fn]]):createCommentVNode("",!0),cn.value&&wn.value?withDirectives((openBlock$1(),createElementBlock("div",_hoisted_9$2,[(openBlock$1(),createElementBlock(Fragment,null,renderList(Tn,qn=>createBaseVNode("button",{key:qn.type,class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__s",{active:kn.value===qn.type}]),"aria-label":qn.label,onClick:withModifiers(Gn=>kn.value=qn.type,["stop"])},[(openBlock$1(),createElementBlock("svg",null,[createBaseVNode("use",{"xlink:href":qn.icon},null,8,_hoisted_11$2)]))],10,_hoisted_10$2)),64)),Jn[39]||(Jn[39]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),(openBlock$1(),createElementBlock(Fragment,null,renderList(gn,qn=>createBaseVNode("button",{key:qn,class:normalizeClass(["ink-color b3-tooltips b3-tooltips__s",{active:_n.value===qn}]),style:normalizeStyle({background:qn}),"aria-label":` ${qn}`,onClick:withModifiers(Gn=>_n.value=qn,["stop"])},null,14,_hoisted_12$2)),64)),Jn[40]||(Jn[40]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__s",{active:En.value}]),"aria-label":"",onClick:Jn[8]||(Jn[8]=withModifiers(qn=>En.value=!En.value,["stop"]))},[...Jn[36]||(Jn[36]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-paint-bucket"})],-1)])],2),createBaseVNode("div",_hoisted_13$2,[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":Jn[9]||(Jn[9]=qn=>xn.value=qn),type:"range",min:"1",max:"10",class:"ink-slider",onMousedown:Jn[10]||(Jn[10]=withModifiers(()=>{},["stop"]))},null,544),[[vModelText,xn.value,void 0,{number:!0}]]),createBaseVNode("span",_hoisted_14$1,toDisplayString(xn.value),1)]),Jn[41]||(Jn[41]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__s","aria-label":"",onClick:withModifiers(cr,["stop"])},[...Jn[37]||(Jn[37]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-undo-2"})],-1)])]),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__s","aria-label":"",onClick:withModifiers(hr,["stop"])},[...Jn[38]||(Jn[38]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#lucide-brush-cleaning"})],-1)])])])),[[Fn]]):createCommentVNode("",!0)],4)),[[Fn]]),createVNode(Transition,{name:"fade"},{default:withCtx(()=>[fn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"pdf-menu",onClick:Jn[12]||(Jn[12]=qn=>fn.value=!1)},[createBaseVNode("button",{onClick:Qn},[...Jn[42]||(Jn[42]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconFile"})],-1),createTextVNode("",-1)])]),createBaseVNode("button",{onClick:Yn},[...Jn[43]||(Jn[43]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDownload"})],-1),createTextVNode("",-1)])]),createBaseVNode("button",{onClick:tr},[...Jn[44]||(Jn[44]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconImage"})],-1),createTextVNode("",-1)])]),createBaseVNode("button",{onClick:Jn[11]||(Jn[11]=qn=>Bn.value=!0)},[...Jn[45]||(Jn[45]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconInfo"})],-1),createTextVNode("",-1)])])])):createCommentVNode("",!0)]),_:1}),(openBlock$1(),createBlock(Teleport,{to:"body"},[Bn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"pdf-meta-overlay",onClick:Jn[15]||(Jn[15]=qn=>Bn.value=!1)},[withDirectives((openBlock$1(),createElementBlock("div",{class:"pdf-meta-dialog",onClick:Jn[14]||(Jn[14]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",_hoisted_15$1,[Jn[47]||(Jn[47]=createBaseVNode("h3",null,"",-1)),createBaseVNode("button",{onClick:Jn[13]||(Jn[13]=qn=>Bn.value=!1)},[...Jn[46]||(Jn[46]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconClose"})],-1)])])]),createBaseVNode("div",_hoisted_16$1,[Nn.value?(openBlock$1(),createElementBlock("div",_hoisted_17$1,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(An.value,(qn,Gn)=>withDirectives((openBlock$1(),createElementBlock("div",{key:Gn,class:"pdf-meta-item"},[createBaseVNode("span",_hoisted_18$1,toDisplayString(qn.label),1),createBaseVNode("span",_hoisted_19$1,toDisplayString(qn.value),1)])),[[Kn]])),128))])):(openBlock$1(),createElementBlock("div",_hoisted_20$1,"..."))])])),[[Cn]])])):createCommentVNode("",!0)]))],64)}}}),PdfToolbar=_export_sfc(_sfc_main$3,[["__scopeId","data-v-582c4838"]]),_hoisted_1$2=["aria-label"],_hoisted_2$1=["aria-label"],_hoisted_3$1=["aria-label"],_hoisted_4$1={class:"sr-title"},_hoisted_5$1={key:0,class:"sr-note"},_hoisted_6$1={class:"sr-btns"},_hoisted_7$1=["aria-label"],_hoisted_8$1=["aria-label"],_hoisted_9$1=["aria-label"],_hoisted_10$1=["aria-label"],_hoisted_11$1=["innerHTML"],_hoisted_12$1={key:1,class:"sr-title"},_hoisted_13$1={class:"sr-options"},_hoisted_14={class:"sr-colors"},_hoisted_15=["onClick"],_hoisted_16={key:0,class:"sr-styles"},_hoisted_17=["onClick","title"],_hoisted_18={style:{width:"16px",height:"16px"}},_hoisted_19=["xlink:href"],_hoisted_20={style:{width:"16px",height:"16px"}},_hoisted_21={key:1,class:"sr-styles"},_hoisted_22=["onClick"],_hoisted_23=["data-type"],_hoisted_24={class:"sr-actions"},_sfc_main$2=defineComponent({__name:"MarkPanel",props:{manager:{},i18n:{}},emits:["copy","dict","copyMark"],setup(an,{expose:on,emit:sn}){const ln=an,cn=sn,un=[{type:"rect",name:"",icon:"#iconSquareDashed"},{type:"circle",name:"",icon:"#iconCircleDashed"},{type:"triangle",name:"",icon:"#iconTriangleDashed"}],dn=getColorMap(),hn=ref(),fn=reactive({showMenu:!1,showCard:!1,isEditing:!1,x:0,y:0,selection:null,currentMark:null,text:"",note:"",color:"yellow",style:"highlight",shapeType:"rect",shapeFilled:!1,markType:"text"}),pn=computed(()=>dn[fn.color]||"#ffeb3b"),gn=computed(()=>{var Rn,Hn;return(((Rn=fn.selection)==null?void 0:Rn.location.format)||((Hn=fn.currentMark)==null?void 0:Hn.format))==="pdf"}),mn=computed(()=>{const Hn=document.querySelector(".reader-container"),Zn=(Hn==null?void 0:Hn.getBoundingClientRect())||{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight},Qn=Math.max(Zn.left+140/2+10,Math.min(fn.x,Zn.right-140/2-10)),Yn=Math.max(Zn.top+60,Math.min(fn.y-54,Zn.bottom-60));return{left:`${Qn}px`,top:`${Yn}px`,transform:"translate(-50%, 0)"}}),bn=computed(()=>{const Hn=fn.isEditing?420:180,Zn=document.querySelector(".reader-container"),Qn=(Zn==null?void 0:Zn.getBoundingClientRect())||{left:0,top:0,right:window.innerWidth,bottom:window.innerHeight},Yn=Math.max(Qn.left+340/2+10,Math.min(fn.x,Qn.right-340/2-10));let tr=fn.y+10;return tr+Hn>Qn.bottom-20&&(tr=Math.max(Qn.top+20,fn.y-Hn-10)),{left:`${Yn}px`,top:`${tr}px`,transform:"translate(-50%, 0)"}}),vn=(Rn,Hn,Zn)=>{fn.selection=Rn,fn.x=Hn,fn.y=Zn,fn.showMenu=!0,fn.showCard=!1},yn=(Rn,Hn,Zn,Qn=!1)=>{fn.currentMark=Rn,fn.text=Rn.text||(Rn.type==="shape"?"":""),fn.note=Rn.note||"",fn.color=Rn.color||"yellow",fn.style=Rn.style||"highlight",fn.shapeType=Rn.shapeType||"rect",fn.shapeFilled=Rn.filled||!1,fn.markType=Rn.type==="shape"?"shape":"text",fn.x=Hn,fn.y=Zn,fn.isEditing=Qn,fn.showMenu=!1,fn.showCard=!0,Qn&&nextTick(()=>{var Yn;return(Yn=hn.value)==null?void 0:Yn.focus()})},wn=()=>{fn.showMenu=!1,fn.showCard=!1,fn.isEditing=!1,fn.selection=null,fn.currentMark=null};on({showMenu:vn,showCard:yn,closeAll:wn});const kn=()=>{fn.selection&&(fn.currentMark=null,fn.text=fn.selection.text,fn.note="",fn.isEditing=!0,fn.showMenu=!1,fn.showCard=!0,nextTick(()=>{var Rn;return(Rn=hn.value)==null?void 0:Rn.focus()}))},_n=()=>{fn.selection&&(cn("copy",fn.selection.text),wn())},xn=()=>{fn.selection&&(cn("dict",fn.selection.text,fn.x,fn.y+50),wn())},En=Rn=>{fn.text=Rn.target.textContent||""},Tn=Rn=>{fn.color=Rn},Bn=()=>{fn.isEditing=!0,nextTick(()=>{var Rn;return(Rn=hn.value)==null?void 0:Rn.focus()})},Nn=async()=>{var Rn,Hn,Zn;if(ln.manager)try{if(fn.currentMark){const Qn={note:fn.note.trim()||void 0,color:fn.color};fn.currentMark.type==="shape"?(Qn.shapeType=fn.shapeType,Qn.filled=fn.shapeFilled):(Qn.text=fn.text.trim(),Qn.style=fn.style),await ln.manager.updateMark(fn.currentMark,Qn),siyuan.showMessage(((Rn=ln.i18n)==null?void 0:Rn.saved)||"",1e3),fn.isEditing=!1}else if(fn.selection){const Qn=fn.selection.location,Yn=(Qn==null?void 0:Qn.cfi)||(Qn==null?void 0:Qn.page)||(Qn==null?void 0:Qn.section);if(Yn===void 0){siyuan.showMessage("",2e3,"error");return}fn.note.trim()?await ln.manager.addNote(Yn,fn.note.trim(),fn.text.trim(),fn.color,fn.style,Qn.rects,Qn.textOffset):await ln.manager.addHighlight(Yn,fn.text.trim(),fn.color,fn.style,Qn.rects,Qn.textOffset),siyuan.showMessage(((Hn=ln.i18n)==null?void 0:Hn.created)||"",1e3),wn()}}catch(Qn){console.error("[MarkPanel] Save error:",Qn),siyuan.showMessage(((Zn=ln.i18n)==null?void 0:Zn.saveError)||"",2e3,"error")}},Mn=async()=>{var Rn,Hn;if(!(!ln.manager||!fn.currentMark))try{await ln.manager.deleteMark(fn.currentMark)?(siyuan.showMessage(((Rn=ln.i18n)==null?void 0:Rn.deleted)||"",1e3),wn()):siyuan.showMessage("",2e3,"error")}catch(Zn){console.error("[MarkPanel] Delete error:",Zn),siyuan.showMessage(((Hn=ln.i18n)==null?void 0:Hn.deleteError)||"",2e3,"error")}},Ln=()=>{fn.currentMark?(fn.text=fn.currentMark.text||"",fn.note=fn.currentMark.note||"",fn.color=fn.currentMark.color||"yellow",fn.style=fn.currentMark.style||"highlight",fn.isEditing=!1):wn()},On=()=>{fn.currentMark?cn("copyMark",fn.currentMark):cn("copy",fn.text)},zn=async()=>{if(!fn.currentMark)return;const{importMark:Rn}=await Promise.resolve().then(()=>copy);await Rn(fn.currentMark,{bookUrl:window.__currentBookUrl||"",isPdf:gn.value,showMsg:(Hn,Zn)=>siyuan.showMessage(Hn,Zn==="error"?2e3:1500,Zn),i18n:ln.i18n,marks:ln.manager})},Pn=()=>{var Rn;return((Rn=fn.currentMark)==null?void 0:Rn.blockId)&&openBlock(fn.currentMark.blockId)},An=Rn=>{var Hn;return((Hn=fn.currentMark)==null?void 0:Hn.blockId)&&showFloat(fn.currentMark.blockId,Rn.target)},Vn=hideFloat,Sn=Rn=>{Rn.target.closest("[data-note-marker],[data-note-tooltip],.pdf-highlight,[data-txt-mark]")||wn()};return(Rn,Hn)=>{var Qn,Yn,tr;const Zn=resolveDirective("motion");return openBlock$1(),createBlock(Teleport,{to:"body"},[fn.showMenu||fn.showCard?(openBlock$1(),createElementBlock("div",{key:0,class:"mark-overlay",onClick:Sn})):createCommentVNode("",!0),fn.showMenu?withDirectives((openBlock$1(),createElementBlock("div",{key:1,initial:{opacity:0,scale:.95},enter:{opacity:1,scale:1,transition:{type:"spring",stiffness:400,damping:25}},class:"mark-selection-menu",style:normalizeStyle(mn.value),onClick:Hn[0]||(Hn[0]=withModifiers(()=>{},["stop"]))},[createBaseVNode("button",{class:"mark-menu-btn b3-tooltips b3-tooltips__s",onClick:kn,"aria-label":an.i18n.mark||""},[...Hn[5]||(Hn[5]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconMark"})],-1)])],8,_hoisted_1$2),createBaseVNode("button",{class:"mark-menu-btn b3-tooltips b3-tooltips__s",onClick:_n,"aria-label":an.i18n.copy||""},[...Hn[6]||(Hn[6]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconCopy"})],-1)])],8,_hoisted_2$1),createBaseVNode("button",{class:"mark-menu-btn b3-tooltips b3-tooltips__s",onClick:xn,"aria-label":an.i18n.dict||""},[...Hn[7]||(Hn[7]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconLanguage"})],-1)])],8,_hoisted_3$1)],4)),[[Zn]]):createCommentVNode("",!0),fn.showCard?withDirectives((openBlock$1(),createElementBlock("div",{key:2,initial:{opacity:0,y:5},enter:{opacity:1,y:0},class:"sr-card",style:normalizeStyle(bn.value),onClick:Hn[4]||(Hn[4]=withModifiers(()=>{},["stop"]))},[createBaseVNode("div",{class:"sr-main",style:normalizeStyle({borderLeftColor:pn.value})},[fn.isEditing?(openBlock$1(),createElementBlock(Fragment,{key:1},[((Yn=fn.currentMark)==null?void 0:Yn.type)!=="shape"?(openBlock$1(),createElementBlock("div",{key:0,class:"sr-title",contenteditable:"",onBlur:En,innerHTML:fn.text},null,40,_hoisted_11$1)):(openBlock$1(),createElementBlock("div",_hoisted_12$1,toDisplayString(fn.text),1)),withDirectives(createBaseVNode("textarea",{ref_key:"noteRef",ref:hn,"onUpdate:modelValue":Hn[2]||(Hn[2]=Un=>fn.note=Un),placeholder:"...",class:"sr-note-input"},null,512),[[vModelText,fn.note]]),createBaseVNode("div",_hoisted_13$1,[createBaseVNode("div",_hoisted_14,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(COLORS),Un=>(openBlock$1(),createElementBlock("button",{key:Un.color,class:normalizeClass(["sr-color-btn",{active:fn.color===Un.color}]),style:normalizeStyle({background:Un.bg}),onClick:withModifiers(Xn=>Tn(Un.color),["stop"])},null,14,_hoisted_15))),128))]),((tr=fn.currentMark)==null?void 0:tr.type)==="shape"?(openBlock$1(),createElementBlock("div",_hoisted_16,[(openBlock$1(),createElementBlock(Fragment,null,renderList(un,Un=>createBaseVNode("button",{key:Un.type,class:normalizeClass(["sr-style-btn",{active:fn.shapeType===Un.type}]),onClick:withModifiers(Xn=>fn.shapeType=Un.type,["stop"]),title:Un.name},[(openBlock$1(),createElementBlock("svg",_hoisted_18,[createBaseVNode("use",{"xlink:href":Un.icon},null,8,_hoisted_19)]))],10,_hoisted_17)),64)),Hn[14]||(Hn[14]=createBaseVNode("span",{class:"toolbar-divider"},null,-1)),createBaseVNode("button",{class:normalizeClass(["sr-style-btn",{active:fn.shapeFilled}]),onClick:Hn[3]||(Hn[3]=withModifiers(Un=>fn.shapeFilled=!fn.shapeFilled,["stop"])),title:""},[(openBlock$1(),createElementBlock("svg",_hoisted_20,[...Hn[13]||(Hn[13]=[createBaseVNode("use",{"xlink:href":"#lucide-paint-bucket"},null,-1)])]))],2)])):(openBlock$1(),createElementBlock("div",_hoisted_21,[(openBlock$1(!0),createElementBlock(Fragment,null,renderList(unref(STYLES),Un=>withDirectives((openBlock$1(),createElementBlock("button",{key:Un.type,class:normalizeClass(["sr-style-btn",{active:fn.style===Un.type}]),onClick:withModifiers(Xn=>fn.style=Un.type,["stop"])},[createBaseVNode("span",{class:"sr-style-icon","data-type":Un.type},toDisplayString(Un.text),9,_hoisted_23)],10,_hoisted_22)),[[vShow,!Un.pdfOnly&&!Un.epubOnly||Un.pdfOnly&&gn.value||Un.epubOnly&&!gn.value]])),128))]))]),createBaseVNode("div",_hoisted_24,[createBaseVNode("button",{onClick:withModifiers(On,["stop"]),class:"sr-btn-secondary"},""),createBaseVNode("button",{onClick:withModifiers(Nn,["stop"]),class:"sr-btn-primary"},""),createBaseVNode("button",{onClick:withModifiers(Ln,["stop"]),class:"sr-btn-secondary"},"")])],64)):(openBlock$1(),createElementBlock(Fragment,{key:0},[createBaseVNode("div",_hoisted_4$1,toDisplayString(fn.text||""),1),fn.note?(openBlock$1(),createElementBlock("div",_hoisted_5$1,toDisplayString(fn.note),1)):createCommentVNode("",!0),createBaseVNode("div",_hoisted_6$1,[createBaseVNode("button",{onClick:withModifiers(On,["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":an.i18n.copy||""},[...Hn[8]||(Hn[8]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconCopy"})],-1)])],8,_hoisted_7$1),createBaseVNode("button",{onClick:withModifiers(Bn,["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":an.i18n.edit||""},[...Hn[9]||(Hn[9]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconEdit"})],-1)])],8,_hoisted_8$1),(Qn=fn.currentMark)!=null&&Qn.blockId?(openBlock$1(),createElementBlock("button",{key:0,onClick:withModifiers(Pn,["stop"]),onMouseenter:An,onMouseleave:Hn[1]||(Hn[1]=(...Un)=>unref(Vn)&&unref(Vn)(...Un)),class:"b3-tooltips b3-tooltips__nw","aria-label":""},[...Hn[10]||(Hn[10]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconRef"})],-1)])],32)):(openBlock$1(),createElementBlock("button",{key:1,onClick:withModifiers(zn,["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":an.i18n.import||""},[...Hn[11]||(Hn[11]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDownload"})],-1)])],8,_hoisted_9$1)),createBaseVNode("button",{onClick:withModifiers(Mn,["stop"]),class:"b3-tooltips b3-tooltips__nw","aria-label":an.i18n.delete||""},[...Hn[12]||(Hn[12]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconTrashcan"})],-1)])],8,_hoisted_10$1)])],64))],4)],4)),[[Zn]]):createCommentVNode("",!0)])}}}),MarkPanel=_export_sfc(_sfc_main$2,[["__scopeId","data-v-e4002477"]]),_hoisted_1$1={key:0,class:"reader-loading"},_hoisted_2=["placeholder"],_hoisted_3=["disabled"],_hoisted_4=["disabled"],_hoisted_5={class:"search-count"},_hoisted_6={class:"reader-toolbar"},_hoisted_7=["aria-label"],_hoisted_8=["max"],_hoisted_9={class:"toolbar-page-total"},_hoisted_10=["aria-label"],_hoisted_11=["aria-label"],_hoisted_12=["aria-label"],_hoisted_13=["aria-label"],_sfc_main$1=defineComponent({__name:"Reader",props:{file:{},plugin:{},settings:{},url:{},blockId:{},bookInfo:{},onReaderReady:{type:Function},i18n:{}},setup(an){const on=an,sn=computed(()=>on.i18n||{}),ln=ref(),cn=ref(null);getColorMap();const un=async jn=>{var _r;const sr=jn.detail;(_r=Pn==null?void 0:Pn.updateSettings)==null||_r.call(Pn,sr),xn.value&&dn(xn.value,sr),kn.value&&await kn.value.updateTheme(sr)},dn=(jn,sr)=>{var Xr;if(!((Xr=jn==null?void 0:jn.iframe)!=null&&Xr.contentDocument))return;const _r=jn.iframe.contentDocument;_r.querySelectorAll("style[data-sireader]").forEach(fo=>fo.remove());const{textSettings:Cr,paragraphSettings:Ar,layoutSettings:Rr,visualSettings:vr,theme:Tr,customTheme:Kr}=sr,Gr=Tr==="custom"?Kr:Tr&&PRESET_THEMES[Tr]||PRESET_THEMES.default,Qr=[vr.brightness!==1&&`brightness(${vr.brightness})`,vr.contrast!==1&&`contrast(${vr.contrast})`,vr.sepia>0&&`sepia(${vr.sepia})`,vr.saturate!==1&&`saturate(${vr.saturate})`,vr.invert&&"invert(1) hue-rotate(180deg)"].filter(Boolean).join(" "),Dr=Cr.fontFamily==="custom"&&Cr.customFont.fontFamily,ho=Dr?`"${Cr.customFont.fontFamily}", sans-serif`:Cr.fontFamily||"inherit",qo=Dr?`@font-face{font-family:"${Cr.customFont.fontFamily}";src:url("/plugins/custom-fonts/${Cr.customFont.fontFile}")}`:"",Wo=Gr.bgImg?`background:url("${Gr.bgImg}") center/cover no-repeat`:`background:${Gr.bg}`,To=`${qo}body{${Wo}!important;color:${Gr.color}!important;font-family:${ho}!important;font-size:${Cr.fontSize}px!important;letter-spacing:${Cr.letterSpacing}em!important;padding:${Rr.marginVertical}px ${Rr.marginHorizontal}px!important${Qr?`;filter:${Qr}`:""}}p{line-height:${Ar.lineHeight}!important;margin:${Ar.paragraphSpacing}em 0!important;text-indent:${Ar.textIndent}em!important}`,yo=_r.createElement("style");yo.setAttribute("data-sireader","true"),yo.textContent=To,_r.head.appendChild(yo);const bo=jn.iframe;bo&&Object.assign(bo.style,{background:Gr.bgImg?`url("${Gr.bgImg}") center/cover no-repeat`:Gr.bg})},hn=ref(),fn=ref(),pn=ref(!0),gn=ref(""),mn=ref(!1);let bn=0,vn=0;const yn=jn=>{!isMobile()||jn.touches.length!==1||(bn=jn.touches[0].clientX,vn=jn.touches[0].clientY)},wn=jn=>{if(!isMobile()||!bn)return;const sr=jn.changedTouches[0].clientX-bn,_r=jn.changedTouches[0].clientY-vn;Math.abs(_r)>Math.abs(sr)||Math.abs(sr)<50||(sr>0?$r():cr(),bn=0,vn=0)},kn=ref(null),_n=ref(null),xn=ref(null),En=ref(1),Tn=ref(0),Bn=ref(!1),Nn=ref(!1),Mn=ref("toc"),Ln=ref(""),On=ref([]),zn=ref(0);let Pn=null,An=null,Vn=null,Sn=null,Rn=null;const Hn=(jn,sr)=>{var Ar;const _r=(Ar=sr.defaultView)==null?void 0:Ar.frameElement;if(!_r)return{x:jn.left,y:jn.top};const Cr=_r.getBoundingClientRect();return{x:(jn.left>Cr.width?jn.left%Cr.width:jn.left)+Cr.left,y:jn.top+Cr.top}},Zn=computed(()=>cn.value),Qn=computed(()=>!!kn.value),Yn=computed(()=>On.value.length>0),tr=computed(()=>{if(Qn.value){const jn=On.value.length;return jn>0?`${zn.value+1}/${jn}`:"0/0"}return On.value.length>0?`${On.value.length}`:"0"}),Un=async()=>{var jn,sr,_r,Cr,Ar,Rr,vr,Tr,Kr,Gr,Qr,Dr,ho,qo,Wo,To,yo,bo;if(hn.value)try{pn.value=!0,gn.value="";const Xr=((jn=on.bookInfo)==null?void 0:jn.bookUrl)||on.url||(on.file?`file://${on.file.name}`:`book-${Date.now()}`);window.__currentBookUrl=Xr;const fo=((sr=on.bookInfo)==null?void 0:sr.format)||((_r=on.bookInfo)!=null&&_r.isEpub?"epub":(Cr=on.file)!=null&&Cr.name.endsWith(".txt")?"txt":(Ar=on.file)!=null&&Ar.name.endsWith(".pdf")?"pdf":"online"),Es=fo==="txt"||fo==="online",Js=fo==="pdf",Ro=()=>{var zr;Co(),(zr=cn.value)==null||zr.updateProgress(),gr()},Xs=async()=>{var Ko;if(on.file)return on.file;if(!((Ko=on.bookInfo)!=null&&Ko.filePath))return null;const zr=await fetch("/api/file/getFile",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({path:on.bookInfo.filePath})});if(!zr.ok)throw new Error("");const io=await zr.arrayBuffer(),eo=on.bookInfo.filePath.split("/").pop()||"book",Vr=zr.headers.get("content-type")||"application/octet-stream";return new File([io],eo,{type:Vr})};if(Js){const{PDFViewer:zr,PDFSearch:io}=await Promise.resolve().then(()=>index),eo=po=>{var ao;const Po=document.querySelector(`[data-id="${po.id}"]`);if(Po){const as=Po.getBoundingClientRect();(ao=ln.value)==null||ao.showCard(po,as.left+as.width/2,as.bottom,!1)}},Vr=new zr({container:fn.value,scale:1.5,onPageChange:Ro,onAnnotationClick:eo});on.settings&&Vr.applyTheme(on.settings);const Ko=new io,ha=await Xs();if(Vn=ha?await ha.arrayBuffer():null,!Vn)throw new Error("PDF");await Vr.open(Vn),await Vr.fitWidth(),Ko.setPDF(Vr.getPDF()),window.__pdfDoc=Vr.getPDF(),Ko.extractAllText().catch(()=>{});const Cl=await Vr.createView();cn.value=createMarkManager({format:"pdf",plugin:on.plugin,bookUrl:Xr,bookName:((Rr=on.bookInfo)==null?void 0:Rr.name)||((vr=on.file)==null?void 0:vr.name)||"book",onAnnotationClick:eo,pdfViewer:Vr}),await cn.value.init(),await cn.value.restoreProgress(on.bookInfo),xn.value={...Cl,isPdf:!0,marks:cn.value},kn.value=Vr,_n.value=Ko,Sn=createInkToolManager(fn.value,on.plugin,Xr,((Tr=on.bookInfo)==null?void 0:Tr.name)||((Kr=on.file)==null?void 0:Kr.name)||"book",Vr);const El=po=>{var Ni;const Po=document.querySelector(`.pdf-shape-layer[data-page="${po.page}"]`);if(!Po)return;const ao=Po.getBoundingClientRect(),[as,Za,Ts,Ys]=po.rect;(Ni=ln.value)==null||Ni.showCard(po,ao.left+(as+Ts)/2,ao.top+Ys+10,!1)};Rn=createShapeToolManager(fn.value,on.plugin,Xr,((Gr=on.bookInfo)==null?void 0:Gr.name)||((Qr=on.file)==null?void 0:Qr.name)||"book",El,Vr),await Sn.init(),await Rn.init(),cn.value.inkManager=Sn,cn.value.shapeManager=Rn,gr(),setActiveReader(xn.value,null);const Ya=po=>setTimeout(()=>{var as;if(po.target.closest(".mark-card,.mark-selection-menu,[data-note-marker],.pdf-highlight"))return;const ao=window.getSelection();if(!(!ao||ao.isCollapsed||!ao.toString().trim()))try{const Za=ao.getRangeAt(0),Ts=Array.from(Za.getClientRects());if(!Ts.length)return;const Ys=Vr.getCurrentPage(),Ni=document.querySelector(`[data-page="${Ys}"]`);if(!Ni)return;const Qa=Vr.getPages().get(Ys);if(!Qa)return;const fa=Ni.getBoundingClientRect(),el=Qa.getViewport({scale:Vr.getScale(),rotation:Vr.getRotation()}),tl=ao.toString().trim(),nl=Ts.map(pa=>{const[rl,ol]=el.convertToPdfPoint(pa.left-fa.left,pa.top-fa.top),[Tl,$l]=el.convertToPdfPoint(pa.right-fa.left,pa.bottom-fa.top);return{x:rl,y:ol,w:Tl-rl,h:$l-ol}});An={text:tl,page:Ys,rects:nl},(as=ln.value)==null||as.showMenu({text:tl,location:{format:"pdf",page:Ys,rects:nl}},Ts[0].left+Ts[0].width/2,Ts[0].top)}catch{}},100);document.addEventListener("mouseup",Ya);const Aa=po=>{var ao;const Po=po.detail.page;(ao=cn.value)==null||ao.renderPdf(Po),Rn==null||Rn.render(Po),Sn==null||Sn.render(Po)};window.addEventListener("pdf:layer-ready",Aa);const Ma=Vr.onChange;Vr.onChange=po=>{Ma==null||Ma(po),setTimeout(()=>Aa({detail:{page:po}}),50)},xn.value.cleanup=()=>{document.removeEventListener("mouseup",Ya),window.removeEventListener("pdf:layer-ready",Aa)}}else if(Es){const{createFoliateView:zr,loadTxtBook:io}=await Promise.resolve().then(()=>reader),eo=zr(fn.value);if(xn.value=eo,fo==="online"&&on.bookInfo)await io(eo,"",on.bookInfo.chapters||[],on.bookInfo,on.settings);else{const Vr=await Xs();if(!Vr)throw new Error("TXT");await io(eo,await Vr.arrayBuffer(),[],null,on.settings)}cn.value=createMarkManager({format:"txt",view:eo,plugin:on.plugin,bookUrl:Xr,bookName:((Dr=on.bookInfo)==null?void 0:Dr.name)||((ho=on.file)==null?void 0:ho.name)||"book",reader:null}),await cn.value.init(),eo.marks=cn.value,await cn.value.restoreProgress(on.bookInfo),eo.addEventListener("relocate",()=>Ro()),setActiveReader(eo,null)}else{if(Pn=createReader({container:fn.value,settings:on.settings,bookUrl:Xr,plugin:on.plugin}),on.file)await Pn.open(on.file);else if(on.url)await Pn.open(on.url);else{const zr=await Xs();if(!zr)throw new Error("");await Pn.open(zr)}cn.value=createMarkManager({format:"epub",view:Pn.getView(),plugin:on.plugin,bookUrl:Xr,bookName:((qo=on.bookInfo)==null?void 0:qo.name)||((Wo=on.file)==null?void 0:Wo.name)||"book",reader:Pn}),await cn.value.init(),Pn.getView().marks=cn.value,await cn.value.restoreProgress(on.bookInfo),Pn.on("relocate",()=>Ro()),Pn.on("load",({doc:zr})=>{var io;return(io=zr==null?void 0:zr.addEventListener)==null?void 0:io.call(zr,"mouseup",eo=>setTimeout(()=>Xn(zr,eo),50))}),setTimeout(()=>{var zr,io,eo;return(eo=(io=(zr=Pn.getView().renderer)==null?void 0:zr.getContents)==null?void 0:io.call(zr))==null?void 0:eo.forEach(({doc:Vr})=>{var Ko;return(Ko=Vr==null?void 0:Vr.addEventListener)==null?void 0:Ko.call(Vr,"mouseup",ha=>setTimeout(()=>Xn(Vr,ha),50))})},500),Nr(),xn.value=Pn.getView(),setActiveReader(xn.value,Pn),(To=on.onReaderReady)==null||To.call(on,Pn)}}catch(Xr){gn.value=Xr instanceof Error?Xr.message:"",(yo=ln.value)==null||yo.closeAll()}finally{pn.value=!1,await restorePosition(Hr(),Pn,kn.value,getMobilePosition),(bo=on.bookInfo)!=null&&bo.epubCfi&&initJump(on.bookInfo.epubCfi,Qn.value)}},Xn=(jn,sr)=>{var Cr,Ar;if(sr&&sr.target.closest(".mark-card,.mark-selection-menu,[data-note-marker],[data-txt-mark]"))return;const _r=(Rr,vr)=>{var Kr,Gr,Qr,Dr;const Tr=(Kr=Rr.defaultView)==null?void 0:Kr.getSelection();if(!Tr||Tr.isCollapsed||!Tr.toString().trim())return!1;try{const ho=Tr.getRangeAt(0),qo=ho.getBoundingClientRect(),{x:Wo,y:To}=Hn(qo,Rr),yo=Tr.toString().trim(),bo=vr!==void 0?Pn.getView().getCFI(vr,ho):void 0,Xr=vr===void 0?((Qr=(Gr=xn.value)==null?void 0:Gr.lastLocation)==null?void 0:Qr.section)||0:void 0;let fo;if(Xr!==void 0&&!bo){let Es=0;const Js=Rr.createTreeWalker(Rr.body,NodeFilter.SHOW_TEXT);for(let Ro;Ro=Js.nextNode();){if(Ro===ho.startContainer){fo=Es+ho.startOffset;break}Es+=(Ro.textContent||"").length}}return An={text:yo,cfi:bo,section:Xr,textOffset:fo},(Dr=ln.value)==null||Dr.showMenu({text:yo,location:{format:Qn.value?"pdf":"epub",cfi:bo,section:Xr,textOffset:fo}},Wo+(vr===void 0?qo.width/2:0),To),!0}catch{return!1}};if(Pn){const Rr=(Ar=(Cr=Pn.getView().renderer)==null?void 0:Cr.getContents)==null?void 0:Ar.call(Cr);if(!Rr)return;for(const{doc:vr,index:Tr}of Rr)if(_r(vr,Tr))return}else if(xn.value&&jn&&_r(jn))return},or=async jn=>{var Wo,To,yo,bo,Xr,fo,Es,Js,Ro,Xs;const sr=(zr,io="")=>navigator.clipboard.writeText(zr).then(()=>siyuan.showMessage(io,1e3)),_r=window.__currentBookUrl||((Wo=on.bookInfo)==null?void 0:Wo.bookUrl)||on.url||"";if(!_r||_r.startsWith("file://"))return sr(jn,"");if(!An)return sr(jn);const{formatBookLink:Cr}=await Promise.resolve().then(()=>useSetting$1),{formatAuthor:Ar,getChapterName:Rr}=await Promise.resolve().then(()=>MarkManager$1),vr=Qn.value,Tr=vr?null:Pn==null?void 0:Pn.getBook(),Kr=vr?null:Pn==null?void 0:Pn.getLocation(),Gr=vr?(bo=(yo=(To=kn.value)==null?void 0:To.getPDF)==null?void 0:yo.call(To))==null?void 0:bo.toc:Tr==null?void 0:Tr.toc,Qr=An.page||(vr?(Xr=kn.value)==null?void 0:Xr.getCurrentPage():Kr==null?void 0:Kr.page),Dr=An.cfi||(vr&&Qr?`#page-${Qr}`:""),ho=Rr({cfi:An.cfi,page:Qr,isPdf:vr,toc:Gr,location:Kr})||"",qo=Cr(_r,((fo=Tr==null?void 0:Tr.metadata)==null?void 0:fo.title)||((Es=on.bookInfo)==null?void 0:Es.name)||"",Ar(((Js=Tr==null?void 0:Tr.metadata)==null?void 0:Js.author)||((Ro=on.bookInfo)==null?void 0:Ro.author)),ho,Dr,jn,((Xs=on.settings)==null?void 0:Xs.linkFormat)||`> [!NOTE]  
> []() `);sr(qo)},kr=jn=>{var sr;return copyMark(jn,{bookUrl:window.__currentBookUrl||((sr=on.bookInfo)==null?void 0:sr.bookUrl)||on.url||"",bookInfo:on.bookInfo,settings:on.settings,isPdf:Qn.value,reader:Pn,pdfViewer:kn.value,showMsg:_r=>siyuan.showMessage(_r,1e3)})},wr=(jn,sr,_r)=>{An&&openDict(jn,sr,_r,An)},Nr=()=>{!Pn||!cn.value||Pn.getView().addEventListener("show-annotation",(jn=>{var Ar,Rr;const{value:sr,range:_r}=jn.detail,Cr=(Ar=cn.value)==null?void 0:Ar.getAll().find(vr=>vr.cfi===sr);if(Cr)try{const vr=_r.getBoundingClientRect(),{x:Tr,y:Kr}=Hn(vr,_r.startContainer.ownerDocument);(Rr=ln.value)==null||Rr.showCard(Cr,Tr,Kr+vr.height+10,!1)}catch{}}))},$r=()=>{var jn,sr;return kn.value?kn.value.goToPage(Math.max(1,kn.value.getCurrentPage()-1)):Pn?Pn.prev():(sr=(jn=xn.value)==null?void 0:jn.prev)==null?void 0:sr.call(jn)},cr=()=>{var jn,sr;return kn.value?kn.value.goToPage(Math.min(Tn.value,kn.value.getCurrentPage()+1)):Pn?Pn.next():(sr=(jn=xn.value)==null?void 0:jn.next)==null?void 0:sr.call(jn)},hr=()=>{var sr;const jn=Math.max(1,Math.min(Tn.value,En.value||1));En.value=jn,(sr=kn.value)==null||sr.goToPage(jn)},gr=()=>{kn.value&&(Tn.value=kn.value.getPageCount(),En.value=kn.value.getCurrentPage())},Jn=ref(),Fn=()=>{Bn.value=!Bn.value,Bn.value&&setTimeout(()=>{var jn;return(jn=Jn.value)==null?void 0:jn.focus()},100)},Kn=async()=>{var jn;if(Ln.value.trim()){if(Qn.value&&_n.value)On.value=await _n.value.search(Ln.value),zn.value=0,On.value.length>0&&((jn=kn.value)==null||jn.goToPage(_n.value.getCurrent().page));else if(Pn!=null&&Pn.searchManager){On.value=[];for await(const sr of Pn.search(Ln.value))On.value.push(sr);zn.value=On.value.length>0?0:-1}}},Cn=()=>{var jn;if(Qn.value&&_n.value){const sr=_n.value.next();sr&&(zn.value=_n.value.getCurrentIndex(),(jn=kn.value)==null||jn.goToPage(sr.page))}else Pn!=null&&Pn.searchManager&&Pn.nextSearchResult()&&(zn.value=Pn.searchManager.getCurrentIndex())},qn=()=>{var jn;if(Qn.value&&_n.value){const sr=_n.value.prev();sr&&(zn.value=_n.value.getCurrentIndex(),(jn=kn.value)==null||jn.goToPage(sr.page))}else Pn!=null&&Pn.searchManager&&Pn.prevSearchResult()&&(zn.value=Pn.searchManager.getCurrentIndex())},Gn=()=>{var jn;Ln.value="",On.value=[],zn.value=0,(jn=_n.value)==null||jn.clear(),Pn==null||Pn.clearSearch(),Bn.value=!1},Dn=async()=>{if(!kn.value)return;const{printPDF:jn}=await Promise.resolve().then(()=>index);await jn(kn.value.getPDF())},In=async()=>{var sr,_r;if(!Vn)return;const{downloadPDF:jn}=await Promise.resolve().then(()=>index);await jn(Vn,((sr=on.file)==null?void 0:sr.name)||((_r=on.bookInfo)==null?void 0:_r.name)||"document.pdf")},Wn=async()=>{if(!kn.value)return;const{exportAsImages:jn}=await Promise.resolve().then(()=>index);await jn(kn.value.getPDF())},rr=async jn=>{jn&&await(Rn==null?void 0:Rn.toggle(!1)),await(Sn==null?void 0:Sn.toggle(jn))},nr=async jn=>await(Sn==null?void 0:Sn.setConfig({color:jn})),er=async jn=>await(Sn==null?void 0:Sn.setConfig({width:jn})),ar=async jn=>await(Sn==null?void 0:Sn.setConfig(jn?{color:"#fff",width:20}:{color:"#f00",width:2})),mr=async()=>await(Sn==null?void 0:Sn.undo()),fr=async()=>await(Sn==null?void 0:Sn.clear()),xr=()=>{},Br=async jn=>{jn&&await(Sn==null?void 0:Sn.toggle(!1)),await(Rn==null?void 0:Rn.toggle(jn))},Er=async jn=>await(Rn==null?void 0:Rn.setConfig({shapeType:jn})),Or=async jn=>await(Rn==null?void 0:Rn.setConfig({color:jn})),Wr=async jn=>await(Rn==null?void 0:Rn.setConfig({width:jn})),Lr=async jn=>await(Rn==null?void 0:Rn.setConfig({filled:jn})),Jr=async()=>{var sr;const jn=(sr=kn.value)==null?void 0:sr.getCurrentPage();jn&&await(Rn==null?void 0:Rn.undo(jn))},Fr=async()=>{var sr;const jn=(sr=kn.value)==null?void 0:sr.getCurrentPage();jn&&await(Rn==null?void 0:Rn.clear(jn))},Co=()=>{var jn,sr;return mn.value=!!((sr=(jn=cn.value)==null?void 0:jn.hasBookmark)!=null&&sr.call(jn))},Ur=()=>{var jn,sr;try{mn.value=(sr=(jn=Zn.value)==null?void 0:jn.toggleBookmark)==null?void 0:sr.call(jn)}catch(_r){siyuan.showMessage(_r.message||"",2e3,"error")}},Hr=()=>{var jn;return window.__currentBookUrl||((jn=on.bookInfo)==null?void 0:jn.bookUrl)||on.url||""},ro=()=>{var jn,sr;return Qn.value?{page:(jn=kn.value)==null?void 0:jn.getCurrentPage()}:{cfi:(sr=Pn==null?void 0:Pn.getLocation())==null?void 0:sr.cfi}},oo=()=>{if(!isMobile())return;const jn=Hr();jn&&saveMobilePosition(jn,ro())},Ci=()=>{Nn.value=!Nn.value},ss=()=>{oo(),window.dispatchEvent(new CustomEvent("reader:close"))},Ks=jn=>{var _r,Cr,Ar;const sr=jn.detail;sr!=null&&sr.item&&((Ar=ln.value)==null||Ar.showCard(sr.item,(_r=sr.position)==null?void 0:_r.x,(Cr=sr.position)==null?void 0:Cr.y,!0))},Ho=jn=>{const sr=jn.detail;setTimeout(()=>Xn(sr==null?void 0:sr.doc,sr==null?void 0:sr.event),50)},is=jn=>{var Ar;const{mark:sr,x:_r,y:Cr}=jn.detail;(Ar=ln.value)==null||Ar.showCard(sr,_r,Cr,!1)},ua=()=>{var jn;return(jn=kn.value)==null?void 0:jn.setScale(kn.value.getScale()+.25)},Ei=()=>{var jn;return(jn=kn.value)==null?void 0:jn.setScale(kn.value.getScale()-.25)},Ti=()=>{var jn;return(jn=kn.value)==null?void 0:jn.setScale(1.5)},Cs=()=>{var jn;return(jn=kn.value)==null?void 0:jn.setRotation((kn.value.getRotation()+90)%360)},$i=()=>window.dispatchEvent(new CustomEvent("pdf:toggle-search")),Bi=()=>{var jn;return(jn=kn.value)==null?void 0:jn.goToPage(1)},Ai=()=>{var jn;return(jn=kn.value)==null?void 0:jn.goToPage(kn.value.getPageCount())},Eo=()=>$r(),Gs=()=>cr(),da=jn=>{const{cfi:sr,id:_r,section:Cr,textOffset:Ar,text:Rr}=jn.detail;if(Qn.value&&(sr!=null&&sr.startsWith("#page-")))gotoPDF(parseInt(sr.slice(6)),_r,kn.value,cn.value,Rn);else if(Cr!==void 0||sr!=null&&sr.startsWith("#txt-")){const vr=sr==null?void 0:sr.match(/#txt-(\d+)-(\d+)/),Tr=Cr!==void 0?Cr:vr?parseInt(vr[1]):0,Kr=Ar!==void 0?Ar:vr?parseInt(vr[2]):void 0;Promise.resolve().then(()=>jump$1).then(({gotoTXT:Gr})=>Gr(Tr,Kr,Rr,_r,xn.value))}else sr&&gotoEPUB(sr,_r,Pn,cn.value)},Mi=jn=>{const sr=jn.target;if(sr.tagName==="INPUT"||sr.tagName==="TEXTAREA"||sr.isContentEditable)return;const _r=jn.key,Cr=jn.ctrlKey||jn.metaKey;if(["ArrowLeft","ArrowUp"].includes(_r)||_r===" "&&jn.shiftKey){$r(),jn.preventDefault();return}if(["ArrowRight","ArrowDown"," "].includes(_r)){cr(),jn.preventDefault();return}if(!kn.value)return;const Ar={Home:Bi,End:Ai,PageUp:Eo,PageDown:Gs,r:Cs,R:Cs};Ar[_r]?(Ar[_r](),jn.preventDefault()):Cr&&(_r==="+"||_r==="="?(ua(),jn.preventDefault()):_r==="-"?(Ei(),jn.preventDefault()):_r==="0"?(Ti(),jn.preventDefault()):_r==="f"?($i(),jn.preventDefault()):_r==="p"&&(Dn(),jn.preventDefault()))},ur=[["sireader:edit-mark",Ks],["txt-selection",Ho],["txt-annotation-click",is],["sireaderSettingsUpdated",un],["sireader:goto",da],["sireader:toggleBookmark",Ur],["sireader:prevPage",$r],["sireader:nextPage",cr],["sireader:pdfZoomIn",ua],["sireader:pdfZoomOut",Ei],["sireader:pdfZoomReset",Ti],["sireader:pdfRotate",Cs],["sireader:pdfSearch",$i],["sireader:pdfPrint",Dn],["sireader:pdfFirstPage",Bi],["sireader:pdfLastPage",Ai],["sireader:pdfPageUp",Eo],["sireader:pdfPageDown",Gs]],lr=jn=>{var sr;return/createTreeWalker|destroy/.test(((sr=jn.reason)==null?void 0:sr.message)||"")&&jn.preventDefault()},br=()=>{var sr;if(isMobile())return;let jn=(sr=hn.value)==null?void 0:sr.parentElement;for(;jn;){if(jn.hasAttribute("data-id")){const _r=document.querySelector(`li[data-type="tab-header"][data-id="${jn.getAttribute("data-id")}"]`);if(_r){const Cr=new MutationObserver(Ar=>Ar.forEach(Rr=>Rr.type==="attributes"&&Rr.attributeName==="class"&&Rr.target.classList.contains("item--focus")&&(setActiveReader(xn.value,Pn),window.dispatchEvent(new CustomEvent("sireader:tab-switched")))));Cr.observe(_r,{attributes:!0,attributeFilter:["class"]}),hn.value.__observer=Cr}break}jn=jn.parentElement}},Mr=jn=>{const{shape:sr,x:_r,y:Cr,edit:Ar}=jn.detail;ln.value&&Ar&&ln.value.showCard(sr,_r,Cr,!0)};return onMounted(()=>{var jn;Un(),(jn=hn.value)==null||jn.focus(),ur.forEach(([sr,_r])=>window.addEventListener(sr,_r)),window.addEventListener("unhandledrejection",lr),window.addEventListener("shape-created",Mr),br(),isMobile()&&hn.value&&(hn.value.addEventListener("touchstart",yn),hn.value.addEventListener("touchend",wn))}),onUnmounted(async()=>{var jn,sr,_r,Cr,Ar,Rr,vr,Tr,Kr;oo(),clearActiveReader(),await((jn=cn.value)==null?void 0:jn.destroy());try{Pn==null||Pn.destroy(),(_r=(sr=xn.value)==null?void 0:sr.cleanup)==null||_r.call(sr),(Rr=(Ar=(Cr=xn.value)==null?void 0:Cr.viewer)==null?void 0:Ar.destroy)==null||Rr.call(Ar)}catch{}(vr=Sn==null?void 0:Sn.destroy)==null||vr.call(Sn),(Tr=Rn==null?void 0:Rn.destroy)==null||Tr.call(Rn),setTimeout(()=>fn.value&&(fn.value.innerHTML=""),50),ur.forEach(([Gr,Qr])=>window.removeEventListener(Gr,Qr)),window.removeEventListener("unhandledrejection",lr),window.removeEventListener("shape-created",Mr),hn.value&&((Kr=hn.value.__observer)==null||Kr.disconnect()),isMobile()&&hn.value&&(hn.value.removeEventListener("touchstart",yn),hn.value.removeEventListener("touchend",wn))}),(jn,sr)=>{var _r;return openBlock$1(),createElementBlock(Fragment,null,[createBaseVNode("div",{ref_key:"containerRef",ref:hn,class:"reader-container",tabindex:"0",onKeydown:Mi},[pn.value?(openBlock$1(),createElementBlock("div",_hoisted_1$1,[sr[7]||(sr[7]=createBaseVNode("div",{class:"spinner"},null,-1)),createBaseVNode("div",null,toDisplayString(gn.value||"..."),1)])):createCommentVNode("",!0),Qn.value&&kn.value&&_n.value?(openBlock$1(),createBlock(PdfToolbar,{key:1,viewer:kn.value,searcher:_n.value,"file-size":(_r=unref(Vn))==null?void 0:_r.byteLength,onPrint:Dn,onDownload:In,onExportImages:Wn,onInkToggle:rr,onInkColor:nr,onInkWidth:er,onInkUndo:mr,onInkClear:fr,onInkSave:xr,onInkEraser:ar,onShapeToggle:Br,onShapeType:Er,onShapeColor:Or,onShapeWidth:Wr,onShapeFilled:Lr,onShapeUndo:Jr,onShapeClear:Fr},null,8,["viewer","searcher","file-size"])):createCommentVNode("",!0),createBaseVNode("div",{ref_key:"viewerContainerRef",ref:fn,class:normalizeClass(["viewer-container",{"has-pdf-toolbar":Qn.value}])},null,2),createVNode(Transition,{name:"toc-popup"},{default:withCtx(()=>[Nn.value&&!pn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"reader-toc-popup",onClick:sr[1]||(sr[1]=withModifiers(()=>{},["stop"]))},[createVNode(ReaderToc,{mode:Mn.value,"onUpdate:mode":sr[0]||(sr[0]=Cr=>Mn.value=Cr),i18n:sn.value},null,8,["mode","i18n"])])):createCommentVNode("",!0)]),_:1}),createVNode(Transition,{name:"search-slide"},{default:withCtx(()=>[Bn.value&&!pn.value?(openBlock$1(),createElementBlock("div",{key:0,class:"reader-search",onClick:sr[4]||(sr[4]=withModifiers(()=>{},["stop"]))},[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":sr[2]||(sr[2]=Cr=>Ln.value=Cr),class:"search-input",placeholder:sn.value.searchPlaceholder||"...",onKeydown:[withKeys(Kn,["enter"]),sr[3]||(sr[3]=withKeys(Cr=>Bn.value=!1,["esc"]))],ref_key:"searchInputRef",ref:Jn},null,40,_hoisted_2),[[vModelText,Ln.value]]),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:Kn,"aria-label":""},[...sr[8]||(sr[8]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconSearch"})],-1)])]),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:qn,disabled:!Yn.value,"aria-label":""},[...sr[9]||(sr[9]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconUp"})],-1)])],8,_hoisted_3),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:Cn,disabled:!Yn.value,"aria-label":""},[...sr[10]||(sr[10]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconDown"})],-1)])],8,_hoisted_4),createBaseVNode("span",_hoisted_5,toDisplayString(tr.value),1),createBaseVNode("button",{class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:Gn,"aria-label":""},[...sr[11]||(sr[11]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconClose"})],-1)])])])):createCommentVNode("",!0)]),_:1}),createBaseVNode("div",_hoisted_6,[pn.value?createCommentVNode("",!0):(openBlock$1(),createElementBlock("button",{key:0,class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:withModifiers($r,["stop"]),"aria-label":sn.value.prevChapter||""},[...sr[12]||(sr[12]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconLeft"})],-1)])],8,_hoisted_7)),Qn.value&&!pn.value?(openBlock$1(),createElementBlock("div",{key:1,class:"toolbar-page-nav",onClick:sr[6]||(sr[6]=withModifiers(()=>{},["stop"]))},[withDirectives(createBaseVNode("input",{"onUpdate:modelValue":sr[5]||(sr[5]=Cr=>En.value=Cr),onKeydown:withKeys(hr,["enter"]),type:"number",min:1,max:Tn.value,class:"toolbar-page-input"},null,40,_hoisted_8),[[vModelText,En.value,void 0,{number:!0}]]),createBaseVNode("span",_hoisted_9,"/ "+toDisplayString(Tn.value),1)])):createCommentVNode("",!0),pn.value?createCommentVNode("",!0):(openBlock$1(),createElementBlock("button",{key:2,class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:withModifiers(cr,["stop"]),"aria-label":sn.value.nextChapter||""},[...sr[13]||(sr[13]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconRight"})],-1)])],8,_hoisted_10)),pn.value?createCommentVNode("",!0):(openBlock$1(),createElementBlock("button",{key:3,class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:withModifiers(Ci,["stop"]),"aria-label":sn.value.toc||""},[...sr[14]||(sr[14]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconList"})],-1)])],8,_hoisted_11)),pn.value?createCommentVNode("",!0):(openBlock$1(),createElementBlock("button",{key:4,class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__n",{active:mn.value}]),onClick:withModifiers(Ur,["stop"]),"aria-label":mn.value?sn.value.removeBookmark||"":sn.value.addBookmark||""},[...sr[15]||(sr[15]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconBookmark"})],-1)])],10,_hoisted_12)),pn.value?createCommentVNode("",!0):(openBlock$1(),createElementBlock("button",{key:5,class:normalizeClass(["toolbar-btn b3-tooltips b3-tooltips__n",{active:Bn.value}]),onClick:withModifiers(Fn,["stop"]),"aria-label":sn.value.search||""},[...sr[16]||(sr[16]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconSearch"})],-1)])],10,_hoisted_13)),unref(isMobile)()?(openBlock$1(),createElementBlock("button",{key:6,class:"toolbar-btn b3-tooltips b3-tooltips__n",onClick:withModifiers(ss,["stop"]),"aria-label":""},[...sr[17]||(sr[17]=[createBaseVNode("svg",null,[createBaseVNode("use",{"xlink:href":"#iconClose"})],-1)])])):createCommentVNode("",!0)])],544),createVNode(MarkPanel,{ref_key:"markPanelRef",ref:ln,manager:cn.value,i18n:sn.value,onCopy:or,onDict:wr,onCopyMark:kr},null,8,["manager","i18n"])],64)}}}),Reader=_export_sfc(_sfc_main$1,[["__scopeId","data-v-156b546d"]]),_hoisted_1={class:"plugin-app-main"},iconId="siyuan-reader-icon",_sfc_main=defineComponent({__name:"App",setup(an){var vn;const on=usePlugin(),{settings:sn,isLoaded:ln}=useSetting(on);let cn=null,un=null;const dn=()=>{var yn,wn;return(wn=document.querySelector(`.dock__item[data-title="${((yn=on.i18n)==null?void 0:yn.name)||""}"]`))==null?void 0:wn.click()},hn=[".epub",".pdf",".mobi",".azw3",".azw",".fb2",".cbz",".txt"],fn=async yn=>{var wn;try{const kn=await fetch(yn[0]==="/"||yn.startsWith("http")?yn:`/${yn}`);return kn.ok?new File([await kn.blob()],((wn=yn.split("/").pop())==null?void 0:wn.split("?")[0])||"book"):null}catch{return null}},pn=async(yn,wn)=>{ln.value||await new Promise(Tn=>{const Bn=()=>ln.value?Tn(!0):setTimeout(Bn,50);Bn()}),await new Promise(Tn=>requestAnimationFrame(()=>Tn(!0)));const kn=yn.appendChild(Object.assign(document.createElement("div"),{style:"width:100%;height:100%"})),{toRaw:_n}=await Promise.resolve().then(()=>vue_runtime_esmBundler),xn=JSON.parse(JSON.stringify(_n(sn.value))),En=createApp(Reader,{...wn,plugin:on,settings:xn,i18n:on.i18n});return En.mount(kn),En};window.sireader={mountReader:async(yn,wn)=>await pn(yn,wn),openEpubTab:(yn,wn)=>siyuan.openTab({app:on.app,custom:{icon:"siyuan-reader-icon",title:wn||yn.name.replace(/\.[^.]+$/,""),data:{file:yn},id:`${on.name}epub_reader`}}),openOnlineTab:yn=>siyuan.openTab({app:on.app,custom:{icon:"siyuan-reader-icon",title:yn.name||"",data:{bookInfo:yn},id:`${on.name}custom_tab_online_reader`}})},on.addTab({type:"epub_reader",async init(){const{url:yn,blockId:wn,file:kn}=this.data,_n=kn!=null&&kn.arrayBuffer?kn:yn&&await fn(yn);if(!_n)return this.element.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--b3-theme-error)"></div>';this._app=await pn(this.element,{file:_n,url:yn,blockId:wn})},destroy(){var yn;(yn=this._app)==null||yn.unmount()}}),on.addTab({type:"custom_tab_online_reader",async init(){const{bookInfo:yn}=this.data;if(!yn)return this.element.innerHTML='<div style="display:flex;align-items:center;justify-content:center;height:100%;color:var(--b3-theme-error)"></div>';this._app=await pn(this.element,{bookInfo:yn})},destroy(){var yn;(yn=this._app)==null||yn.unmount()}});const gn=async yn=>{var En;const wn=yn.target.closest('a[href], [data-href], span[data-type="a"]'),kn=(wn==null?void 0:wn.getAttribute("data-href"))||(wn==null?void 0:wn.getAttribute("href"));if(!kn)return;const _n=(await Promise.resolve().then(()=>useSetting$1)).parseBookLink(kn);if(_n){if(yn.preventDefault(),yn.stopPropagation(),!_n.bookUrl)return siyuan.showMessage("",3e3,"error");const{bookshelfManager:Tn}=await Promise.resolve().then(()=>bookshelf);await Tn.init();let Bn=await Tn.getBook(_n.bookUrl);if(!Bn){const Mn=Tn.getBooks(),Ln=_n.bookUrl.split("://")[1];Bn=Mn.find(On=>On.bookUrl.startsWith(_n.bookUrl.split("://")[0]+"://")&&On.bookUrl.includes(Ln.split("_")[0]))}if(!Bn)return siyuan.showMessage("",3e3,"error");const Nn=Array.from(document.querySelectorAll(".layout-tab-bar .item")).find(Mn=>{var Ln;return(Mn.getAttribute("data-title")||((Ln=Mn.querySelector(".item__text"))==null?void 0:Ln.textContent))===Bn.name});return Nn?(Nn.click(),requestAnimationFrame(()=>window.dispatchEvent(new CustomEvent("sireader:goto",{detail:{cfi:_n.cfi,id:_n.id}})))):siyuan.openTab({app:on.app,custom:{icon:"siyuan-reader-icon",title:Bn.name,data:{bookInfo:{...Bn,epubCfi:_n.cfi}},id:`${on.name}custom_tab_online_reader`},position:{rightTab:"right",bottomTab:"bottom"}[sn.value.openMode]})}if(!hn.some(Tn=>kn.toLowerCase().endsWith(Tn)))return;yn.preventDefault(),yn.stopPropagation();const xn=await fn(kn.split("#")[0]);xn&&siyuan.openTab({app:on.app,custom:{icon:"siyuan-reader-icon",title:xn.name.replace(/\.[^.]+$/,""),data:{file:xn,url:kn.split("#")[0],blockId:(En=wn.closest("[data-node-id]"))==null?void 0:En.getAttribute("data-node-id")},id:`${on.name}epub_reader`},position:{rightTab:"right",bottomTab:"bottom"}[sn.value.openMode]})};setOpenSettingHandler(dn),on.addIcons(`
  <symbol id="${iconId}" viewBox="0 0 1696 1536">
    <path d="M1671 350q40 57 18 129l-275 906q-19 64-76.5 107.5T1215 1536H292q-77 0-148.5-53.5T44 1351q-24-67-2-127q0-4 3-27t4-37q1-8-3-21.5t-3-19.5q2-11 8-21t16.5-23.5T84 1051q23-38 45-91.5t30-91.5q3-10 .5-30t-.5-28q3-11 17-28t17-23q21-36 42-92t25-90q1-9-2.5-32t.5-28q4-13 22-30.5t22-22.5q19-26 42.5-84.5T372 283q1-8-3-25.5t-2-26.5q2-8 9-18t18-23t17-21q8-12 16.5-30.5t15-35t16-36t19.5-32T504.5 12t36-11.5T588 6l-1 3q38-9 51-9h761q74 0 114 56t18 130l-274 906q-36 119-71.5 153.5T1057 1280H188q-27 0-38 15q-11 16-1 43q24 70 144 70h923q29 0 56-15.5t35-41.5l300-987q7-22 5-57q38 15 59 43m-1064 2q-4 13 2 22.5t20 9.5h608q13 0 25.5-9.5T1279 352l21-64q4-13-2-22.5t-20-9.5H670q-13 0-25.5 9.5T628 288zm-83 256q-4 13 2 22.5t20 9.5h608q13 0 25.5-9.5T1196 608l21-64q4-13-2-22.5t-20-9.5H587q-13 0-25.5 9.5T545 544z"/>
  </symbol>
  <symbol id="lucide-library-big" viewBox="0 0 24 24">
    <rect width="8" height="18" x="3" y="3" rx="1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M7 3v18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M20.4 18.9c.2.5-.1 1.1-.6 1.3l-1.9.7c-.5.2-1.1-.1-1.3-.6L11.1 5.1c-.2-.5.1-1.1.6-1.3l1.9-.7c.5-.2 1.1.1 1.3.6Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-book-search" viewBox="0 0 24 24">
    <path d="M11 22H5.5a1 1 0 0 1 0-5h4.501" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m21 22-1.879-1.878" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 19.5v-15A2.5 2.5 0 0 1 5.5 2H18a1 1 0 0 1 1 1v8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="17" cy="18" r="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-settings-2" viewBox="0 0 24 24">
    <path d="M14 17H5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 7h-9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="17" cy="17" r="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="7" cy="7" r="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-paintbrush-vertical" viewBox="0 0 24 24">
    <path d="M10 2v2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 2v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M17 2a1 1 0 0 1 1 1v9H6V3a1 1 0 0 1 1-1z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M6 12a1 1 0 0 0-1 1v1a2 2 0 0 0 2 2h2a1 1 0 0 1 1 1v2.9a2 2 0 1 0 4 0V17a1 1 0 0 1 1-1h2a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-scroll-text" viewBox="0 0 24 24">
    <path d="M15 12h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M15 8h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 17V5a2 2 0 0 0-2-2H4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 21h12a2 2 0 0 0 2-2v-1a1 1 0 0 0-1-1H11a1 1 0 0 0-1 1v1a2 2 0 1 1-4 0V5a2 2 0 1 0-4 0v2a1 1 0 0 0 1 1h3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-map-pin-check" viewBox="0 0 24 24">
    <path d="M19.43 12.935c.357-.967.57-1.955.57-2.935a8 8 0 0 0-16 0c0 4.993 5.539 10.193 7.399 11.799a1 1 0 0 0 1.202 0 32.197 32.197 0 0 0 .813-.728" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="12" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m16 18 2 2 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-paint-bucket" viewBox="0 0 24 24">
    <path d="m19 11-8-8-8.6 8.6a2 2 0 0 0 0 2.8l5.2 5.2c.8.8 2 .8 2.8 0L19 11Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m5 2 5 5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M2 13h15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M22 20a2 2 0 1 1-4 0c0-1.6 1.7-2.4 2-4 .3 1.6 2 2.4 2 4Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-map-pin-pen" viewBox="0 0 24 24">
    <path d="M17.97 9.304A8 8 0 0 0 2 10c0 4.69 4.887 9.562 7.022 11.468" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21.378 16.626a1 1 0 0 0-3.004-3.004l-4.01 4.012a2 2 0 0 0-.506.854l-.837 2.87a.5.5 0 0 0 .62.62l2.87-.837a2 2 0 0 0 .854-.506z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="10" cy="10" r="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-wallet-cards" viewBox="0 0 24 24">
    <rect width="18" height="18" x="3" y="3" rx="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 9a2 2 0 0 1 2-2h14a2 2 0 0 1 2 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 11h3c.8 0 1.6.3 2.1.9l1.1.9c1.6 1.6 4.1 1.6 5.7 0l1.1-.9c.5-.5 1.3-.9 2.1-.9H21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-panel-top-close" viewBox="0 0 24 24">
    <rect width="18" height="18" x="3" y="3" rx="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 9h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m9 16 3-3 3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-panel-top-open" viewBox="0 0 24 24">
    <rect width="18" height="18" x="3" y="3" rx="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 9h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m15 14-3 3-3-3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-zoom-in" viewBox="0 0 24 24">
    <circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m21 21-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M11 8v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 11h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-zoom-out" viewBox="0 0 24 24">
    <circle cx="11" cy="11" r="8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m21 21-4.35-4.35" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 11h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-rotate-ccw-square" viewBox="0 0 24 24">
    <path d="M20 9V7a2 2 0 0 0-2-2h-6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m15 2-3 3 3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M20 13v5a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V7a2 2 0 0 1 2-2h2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-rotate-cw-square" viewBox="0 0 24 24">
    <path d="M12 5H6a2 2 0 0 0-2 2v3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m9 8 3-3-3-3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M4 14v4a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-square-mouse-pointer" viewBox="0 0 24 24">
    <path d="M12.034 12.681a.498.498 0 0 1 .647-.647l9 3.5a.5.5 0 0 1-.033.943l-3.444 1.068a1 1 0 0 0-.66.66l-1.067 3.443a.5.5 0 0 1-.943.033z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 11V5a2 2 0 0 0-2-2H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-hand" viewBox="0 0 24 24">
    <path d="M18 11V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 10V4a2 2 0 0 0-2-2a2 2 0 0 0-2 2v2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M10 10.5V6a2 2 0 0 0-2-2a2 2 0 0 0-2 2v8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M18 8a2 2 0 1 1 4 0v6a8 8 0 0 1-8 8h-2c-2.8 0-4.5-.86-5.99-2.34l-3.6-3.6a2 2 0 0 1 2.83-2.82L7 15" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-brush" viewBox="0 0 24 24">
    <path d="m11 10 3 3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M6.5 21A3.5 3.5 0 1 0 3 17.5a2.62 2.62 0 0 1-.708 1.792A1 1 0 0 0 3 21z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9.969 17.031 21.378 5.624a1 1 0 0 0-3.002-3.002L6.967 14.031" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-eraser" viewBox="0 0 24 24">
    <path d="M21 21H8a2 2 0 0 1-1.42-.587l-3.994-3.999a2 2 0 0 1 0-2.828l10-10a2 2 0 0 1 2.829 0l5.999 6a2 2 0 0 1 0 2.828L12.834 21" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m5.082 11.09 8.828 8.828" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-undo-2" viewBox="0 0 24 24">
    <path d="M9 14 4 9l5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M4 9h10.5a5.5 5.5 0 0 1 5.5 5.5a5.5 5.5 0 0 1-5.5 5.5H11" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-brush-cleaning" viewBox="0 0 24 24">
    <path d="m16 22-1-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 14a1 1 0 0 0 1-1v-1a2 2 0 0 0-2-2h-3a1 1 0 0 1-1-1V4a2 2 0 0 0-4 0v5a1 1 0 0 1-1 1H6a2 2 0 0 0-2 2v1a1 1 0 0 0 1 1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 14H5l-1.973 6.767A1 1 0 0 0 4 22h16a1 1 0 0 0 .973-1.233z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m8 22 1-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-pocket" viewBox="0 0 24 24">
    <path d="M4 3h16a2 2 0 0 1 2 2v6a10 10 0 0 1-10 10A10 10 0 0 1 2 11V5a2 2 0 0 1 2-2z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="iconShapes" viewBox="0 0 24 24">
    <path d="M8.3 10a.7.7 0 0 1-.626-1.079L11.4 3a.7.7 0 0 1 1.198-.043L16.3 8.9a.7.7 0 0 1-.572 1.1Z" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="3" y="14" width="7" height="7" rx="1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="17.5" cy="17.5" r="3.5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="iconSquareDashed" viewBox="0 0 24 24">
    <path d="M5 3a2 2 0 0 0-2 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 3a2 2 0 0 1 2 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 19a2 2 0 0 1-2 2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M5 21a2 2 0 0 1-2-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9 3h1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9 21h1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 3h1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 21h1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 9v1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 9v1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 14v1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 14v1" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="iconCircleDashed" viewBox="0 0 24 24">
    <path d="M10.1 2.182a10 10 0 0 1 3.8 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M13.9 21.818a10 10 0 0 1-3.8 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M17.609 3.721a10 10 0 0 1 2.69 2.7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M2.182 13.9a10 10 0 0 1 0-3.8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M20.279 17.609a10 10 0 0 1-2.7 2.69" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21.818 10.1a10 10 0 0 1 0 3.8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3.721 6.391a10 10 0 0 1 2.7-2.69" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M6.391 20.279a10 10 0 0 1-2.69-2.7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="iconTriangleDashed" viewBox="0 0 24 24">
    <path d="M10.17 4.193a2 2 0 0 1 3.666.013" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 21h2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m15.874 7.743 1 1.732" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m18.849 12.952 1 1.732" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21.824 18.18a2 2 0 0 1-1.835 2.824" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M4.024 21a2 2 0 0 1-1.839-2.839" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m5.136 12.952-1 1.732" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 21h2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m8.102 7.743-1 1.732" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m8 10 4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-arrow-down-0-1" viewBox="0 0 24 24">
    <path d="m3 16 4 4 4-4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M7 20V4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="15" y="4" width="4" height="6" ry="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M17 20v-6h-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M15 20h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-arrow-up-1-0" viewBox="0 0 24 24">
    <path d="m3 8 4-4 4 4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M7 4v16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M17 10V4h-2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M15 10h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <rect x="15" y="14" width="4" height="6" ry="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-sliders-horizontal" viewBox="0 0 24 24">
    <path d="M10 5H3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M12 19H3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 3v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16 17v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 12h-9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 19h-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21 5h-7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 10v4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 12H3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-clock-plus" viewBox="0 0 24 24">
    <path d="M12 6v6l3.644 1.822" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16 19h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 16v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M21.92 13.267a10 10 0 1 0-8.653 8.653" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-panels-top-left" viewBox="0 0 24 24">
    <rect width="18" height="18" x="3" y="3" rx="2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 9h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9 21V9" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-list-restart" viewBox="0 0 24 24">
    <path d="M21 5H3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M7 12H3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M7 19H3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M12 18a5 5 0 0 0 9-3 4.5 4.5 0 0 0-4.5-4.5c-1.33 0-2.54.54-3.41 1.41L11 14" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M11 10v4h4" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-book-plus" viewBox="0 0 24 24">
    <path d="M12 7v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9 10h6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-book-text" viewBox="0 0 24 24">
    <path d="M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m8 13 4-7 4 7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M9.1 11h5.7" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-eye" viewBox="0 0 24 24">
    <path d="M2.062 12.348a1 1 0 0 1 0-.696 10.75 10.75 0 0 1 19.876 0 1 1 0 0 1 0 .696 10.75 10.75 0 0 1-19.876 0" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <circle cx="12" cy="12" r="3" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-eye-off" viewBox="0 0 24 24">
    <path d="M10.733 5.076a10.744 10.744 0 0 1 11.205 6.575 1 1 0 0 1 0 .696 10.747 10.747 0 0 1-1.444 2.49" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14.084 14.158a3 3 0 0 1-4.242-4.242" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M17.479 17.499a10.75 10.75 0 0 1-15.417-5.151 1 1 0 0 1 0-.696 10.75 10.75 0 0 1 4.446-5.143" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m2 2 20 20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-trash-2" viewBox="0 0 24 24">
    <path d="M3 6h18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M10 11v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M14 11v6" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-refresh-cw" viewBox="0 0 24 24">
    <path d="M21 12a9 9 0 0 0-9-9 9.75 9.75 0 0 0-6.74 2.74L3 8" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 3v5h5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M3 12a9 9 0 0 0 9 9 9.75 9.75 0 0 0 6.74-2.74L21 16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="M16 21h5v-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-x" viewBox="0 0 24 24">
    <path d="M18 6 6 18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
    <path d="m6 6 12 12" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="lucide-check" viewBox="0 0 24 24">
    <path d="M20 6 9 17l-5-5" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
  </symbol>
  <symbol id="iconScroll" viewBox="0 0 32 32">
    <path d="M4 6h24v2H4zm0 6h24v2H4zm0 6h24v2H4zm0 6h24v2H4z"/>
  </symbol>
`),on.addDock({type:"SiyuanReaderDock",config:{position:"RightTop",size:{width:680,height:580},icon:iconId,title:((vn=on.i18n)==null?void 0:vn.name)||""},data:{plugin:on},init(){const yn=document.createElement("div");yn.className="sireader-dock-content",yn.style.cssText="width:100%;height:100%;overflow:auto",this.element.appendChild(yn);const wn=this.data.plugin.i18n;cn=createApp(Settings,{modelValue:sn.value,i18n:wn,onSave:async()=>{const kn=await on.loadData("config.json")||{},_n=JSON.parse(JSON.stringify(sn.value));kn.settings=_n,await on.saveData("config.json",kn),window.dispatchEvent(new CustomEvent("sireaderSettingsUpdated",{detail:_n}))},"onUpdate:modelValue":kn=>{sn.value=kn}}),cn.use(MotionPlugin),cn.mount(yn)},resize(){},destroy(){cn==null||cn.unmount(),cn=null}}),on.addTopBar({icon:`<svg><use xlink:href="#${iconId}"/></svg>`,title:"",callback:dn});const mn=async yn=>{const{book:wn}=yn.detail;un==null||un.unmount(),un=null;let kn=document.getElementById("sireader-mobile-container");kn||(kn=document.createElement("div"),kn.id="sireader-mobile-container",kn.style.cssText="position:fixed;inset:0;z-index:100;background:var(--b3-theme-background)",document.body.appendChild(kn)),kn.style.display="block";const{toRaw:_n}=await Promise.resolve().then(()=>vue_runtime_esmBundler);un=createApp(Reader,{bookInfo:wn,plugin:on,settings:JSON.parse(JSON.stringify(_n(sn.value))),i18n:on.i18n}),un.mount(kn)},bn=()=>{var yn;un==null||un.unmount(),un=null,(yn=document.getElementById("sireader-mobile-container"))==null||yn.style.setProperty("display","none")};return onMounted(async()=>{await bookSourceManager.loadSources(),window.addEventListener("click",gn,!0),registerCleanup(()=>window.removeEventListener("click",gn,!0)),isMobile()&&(window.addEventListener("reader:open",mn),window.addEventListener("reader:close",bn),registerCleanup(()=>{window.removeEventListener("reader:open",mn),window.removeEventListener("reader:close",bn)}))}),(yn,wn)=>(openBlock$1(),createElementBlock("div",_hoisted_1))}}),App=_export_sfc(_sfc_main,[["__scopeId","data-v-e3d0c3bf"]]);let plugin=null,app=null,cleanupCallbacks=[];const usePlugin=an=>an?plugin=an:plugin,registerCleanup=an=>cleanupCallbacks.push(an),setOpenSettingHandler=an=>{window._sy_plugin_sample=window._sy_plugin_sample||{},window._sy_plugin_sample.openSetting=an};function init(an){usePlugin(an),setPlugin(an),initDictModule(an),initMobile(an),isMobile()&&addMobileSidebar(an);const on=document.createElement("div");on.id=an.name,on.className="plugin-sample-vite-vue-app",app=createApp(App),app.mount(on),document.body.appendChild(on)}function destroy(){if(!plugin)return;cleanupCallbacks.forEach(on=>on()),cleanupCallbacks=[],app==null||app.unmount();const an=document.getElementById(plugin.name);an==null||an.remove(),plugin=null}async function addMobileSidebar(an){var pn,gn,mn;const on=document.querySelector("#sidebar .toolbar");if(!on)return setTimeout(()=>addMobileSidebar(an),500);if(on.querySelector('[data-type="sidebar-sireader-tab"]'))return;for(let bn=0;bn<10&&!document.querySelector("#siyuan-reader-icon");bn++)await new Promise(vn=>setTimeout(vn,200));const sn=on.querySelector('[data-type="sidebar-file-tab"]');if(!sn)return;const ln=sn.cloneNode(!0);ln.setAttribute("data-type","sidebar-sireader-tab"),ln.classList.remove("toolbar__icon--active"),(pn=ln.querySelector("use"))==null||pn.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href","#siyuan-reader-icon");const cn=on.querySelector('[data-type="sidebar-plugin-tab"]');cn?cn.before(ln):on.appendChild(ln);const un=document.createElement("div");un.className="fn__flex-column fn__none",un.setAttribute("data-type","sidebar-sireader"),un.style.cssText="height:100%;overflow:hidden",(mn=(gn=on.parentElement)==null?void 0:gn.querySelector(".b3-list--mobile"))==null||mn.appendChild(un);const{default:dn}=await Promise.resolve().then(()=>Settings$1),{useSetting:hn}=await Promise.resolve().then(()=>useSetting$1),{settings:fn}=hn(an);createApp(dn,{modelValue:fn.value,i18n:an.i18n,onSave:async()=>{const bn=await an.loadData("config.json")||{};bn.settings=JSON.parse(JSON.stringify(fn.value)),await an.saveData("config.json",bn),window.dispatchEvent(new CustomEvent("sireaderSettingsUpdated",{detail:bn.settings}))},"onUpdate:modelValue":bn=>{fn.value=bn}}).mount(un),on.addEventListener("click",bn=>{var yn;const vn=bn.target.closest('[data-type="sidebar-sireader-tab"]');vn&&(on.querySelectorAll(".toolbar__icon").forEach(wn=>wn.classList.remove("toolbar__icon--active")),vn.classList.add("toolbar__icon--active"),(yn=on.parentElement)==null||yn.querySelectorAll(".b3-list--mobile > div").forEach(wn=>wn.classList.add("fn__none")),un.classList.remove("fn__none"))})}const{version}=PluginInfoString;class PluginSample extends siyuan.Plugin{constructor(){super(...arguments);ir(this,"isMobile");ir(this,"isBrowser");ir(this,"isLocal");ir(this,"isElectron");ir(this,"isInWindow");ir(this,"platform");ir(this,"version",version)}async onload(){const sn=siyuan.getFrontend();this.platform=sn,this.isMobile=sn==="mobile"||sn==="browser-mobile",this.isBrowser=sn.includes("browser"),this.isLocal=location.href.includes("127.0.0.1")||location.href.includes("localhost"),this.isInWindow=location.href.includes("window.html");try{require("@electron/remote").require("@electron/remote/main"),this.isElectron=!0}catch{this.isElectron=!1}init(this),this.addHotkeys()}addHotkeys(){Object.entries({prevPage:{text:"",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:prevPage"))},nextPage:{text:"",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:nextPage"))},toggleBookmark:{text:"",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:toggleBookmark"))},pdfZoomIn:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfZoomIn"))},pdfZoomOut:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfZoomOut"))},pdfZoomReset:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfZoomReset"))},pdfRotate:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfRotate"))},pdfSearch:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfSearch"))},pdfPrint:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfPrint"))},pdfFirstPage:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfFirstPage"))},pdfLastPage:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfLastPage"))},pdfPageUp:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfPageUp"))},pdfPageDown:{text:"PDF",hotkey:"",callback:()=>window.dispatchEvent(new CustomEvent("sireader:pdfPageDown"))}}).forEach(([ln,{text:cn,hotkey:un,callback:dn}])=>this.addCommand({langKey:ln,langText:cn,hotkey:un,callback:dn}))}async onunload(){destroy(),console.log("[SiReader] "),location.reload()}async uninstall(){await this.removeData("config.json"),await this.removeData("stats.json"),console.log("[SiReader] ")}openSetting(){window._sy_plugin_sample.openSetting()}}const e$1=-2,t$1=-3,n$1=-5,i$2=[0,1,3,7,15,31,63,127,255,511,1023,2047,4095,8191,16383,32767,65535],r$1=[96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,192,80,7,10,0,8,96,0,8,32,0,9,160,0,8,0,0,8,128,0,8,64,0,9,224,80,7,6,0,8,88,0,8,24,0,9,144,83,7,59,0,8,120,0,8,56,0,9,208,81,7,17,0,8,104,0,8,40,0,9,176,0,8,8,0,8,136,0,8,72,0,9,240,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,200,81,7,13,0,8,100,0,8,36,0,9,168,0,8,4,0,8,132,0,8,68,0,9,232,80,7,8,0,8,92,0,8,28,0,9,152,84,7,83,0,8,124,0,8,60,0,9,216,82,7,23,0,8,108,0,8,44,0,9,184,0,8,12,0,8,140,0,8,76,0,9,248,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,196,81,7,11,0,8,98,0,8,34,0,9,164,0,8,2,0,8,130,0,8,66,0,9,228,80,7,7,0,8,90,0,8,26,0,9,148,84,7,67,0,8,122,0,8,58,0,9,212,82,7,19,0,8,106,0,8,42,0,9,180,0,8,10,0,8,138,0,8,74,0,9,244,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,204,81,7,15,0,8,102,0,8,38,0,9,172,0,8,6,0,8,134,0,8,70,0,9,236,80,7,9,0,8,94,0,8,30,0,9,156,84,7,99,0,8,126,0,8,62,0,9,220,82,7,27,0,8,110,0,8,46,0,9,188,0,8,14,0,8,142,0,8,78,0,9,252,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,194,80,7,10,0,8,97,0,8,33,0,9,162,0,8,1,0,8,129,0,8,65,0,9,226,80,7,6,0,8,89,0,8,25,0,9,146,83,7,59,0,8,121,0,8,57,0,9,210,81,7,17,0,8,105,0,8,41,0,9,178,0,8,9,0,8,137,0,8,73,0,9,242,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,202,81,7,13,0,8,101,0,8,37,0,9,170,0,8,5,0,8,133,0,8,69,0,9,234,80,7,8,0,8,93,0,8,29,0,9,154,84,7,83,0,8,125,0,8,61,0,9,218,82,7,23,0,8,109,0,8,45,0,9,186,0,8,13,0,8,141,0,8,77,0,9,250,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,198,81,7,11,0,8,99,0,8,35,0,9,166,0,8,3,0,8,131,0,8,67,0,9,230,80,7,7,0,8,91,0,8,27,0,9,150,84,7,67,0,8,123,0,8,59,0,9,214,82,7,19,0,8,107,0,8,43,0,9,182,0,8,11,0,8,139,0,8,75,0,9,246,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,206,81,7,15,0,8,103,0,8,39,0,9,174,0,8,7,0,8,135,0,8,71,0,9,238,80,7,9,0,8,95,0,8,31,0,9,158,84,7,99,0,8,127,0,8,63,0,9,222,82,7,27,0,8,111,0,8,47,0,9,190,0,8,15,0,8,143,0,8,79,0,9,254,96,7,256,0,8,80,0,8,16,84,8,115,82,7,31,0,8,112,0,8,48,0,9,193,80,7,10,0,8,96,0,8,32,0,9,161,0,8,0,0,8,128,0,8,64,0,9,225,80,7,6,0,8,88,0,8,24,0,9,145,83,7,59,0,8,120,0,8,56,0,9,209,81,7,17,0,8,104,0,8,40,0,9,177,0,8,8,0,8,136,0,8,72,0,9,241,80,7,4,0,8,84,0,8,20,85,8,227,83,7,43,0,8,116,0,8,52,0,9,201,81,7,13,0,8,100,0,8,36,0,9,169,0,8,4,0,8,132,0,8,68,0,9,233,80,7,8,0,8,92,0,8,28,0,9,153,84,7,83,0,8,124,0,8,60,0,9,217,82,7,23,0,8,108,0,8,44,0,9,185,0,8,12,0,8,140,0,8,76,0,9,249,80,7,3,0,8,82,0,8,18,85,8,163,83,7,35,0,8,114,0,8,50,0,9,197,81,7,11,0,8,98,0,8,34,0,9,165,0,8,2,0,8,130,0,8,66,0,9,229,80,7,7,0,8,90,0,8,26,0,9,149,84,7,67,0,8,122,0,8,58,0,9,213,82,7,19,0,8,106,0,8,42,0,9,181,0,8,10,0,8,138,0,8,74,0,9,245,80,7,5,0,8,86,0,8,22,192,8,0,83,7,51,0,8,118,0,8,54,0,9,205,81,7,15,0,8,102,0,8,38,0,9,173,0,8,6,0,8,134,0,8,70,0,9,237,80,7,9,0,8,94,0,8,30,0,9,157,84,7,99,0,8,126,0,8,62,0,9,221,82,7,27,0,8,110,0,8,46,0,9,189,0,8,14,0,8,142,0,8,78,0,9,253,96,7,256,0,8,81,0,8,17,85,8,131,82,7,31,0,8,113,0,8,49,0,9,195,80,7,10,0,8,97,0,8,33,0,9,163,0,8,1,0,8,129,0,8,65,0,9,227,80,7,6,0,8,89,0,8,25,0,9,147,83,7,59,0,8,121,0,8,57,0,9,211,81,7,17,0,8,105,0,8,41,0,9,179,0,8,9,0,8,137,0,8,73,0,9,243,80,7,4,0,8,85,0,8,21,80,8,258,83,7,43,0,8,117,0,8,53,0,9,203,81,7,13,0,8,101,0,8,37,0,9,171,0,8,5,0,8,133,0,8,69,0,9,235,80,7,8,0,8,93,0,8,29,0,9,155,84,7,83,0,8,125,0,8,61,0,9,219,82,7,23,0,8,109,0,8,45,0,9,187,0,8,13,0,8,141,0,8,77,0,9,251,80,7,3,0,8,83,0,8,19,85,8,195,83,7,35,0,8,115,0,8,51,0,9,199,81,7,11,0,8,99,0,8,35,0,9,167,0,8,3,0,8,131,0,8,67,0,9,231,80,7,7,0,8,91,0,8,27,0,9,151,84,7,67,0,8,123,0,8,59,0,9,215,82,7,19,0,8,107,0,8,43,0,9,183,0,8,11,0,8,139,0,8,75,0,9,247,80,7,5,0,8,87,0,8,23,192,8,0,83,7,51,0,8,119,0,8,55,0,9,207,81,7,15,0,8,103,0,8,39,0,9,175,0,8,7,0,8,135,0,8,71,0,9,239,80,7,9,0,8,95,0,8,31,0,9,159,84,7,99,0,8,127,0,8,63,0,9,223,82,7,27,0,8,111,0,8,47,0,9,191,0,8,15,0,8,143,0,8,79,0,9,255],a$1=[80,5,1,87,5,257,83,5,17,91,5,4097,81,5,5,89,5,1025,85,5,65,93,5,16385,80,5,3,88,5,513,84,5,33,92,5,8193,82,5,9,90,5,2049,86,5,129,192,5,24577,80,5,2,87,5,385,83,5,25,91,5,6145,81,5,7,89,5,1537,85,5,97,93,5,24577,80,5,4,88,5,769,84,5,49,92,5,12289,82,5,13,90,5,3073,86,5,193,192,5,24577],s$1=[3,4,5,6,7,8,9,10,11,13,15,17,19,23,27,31,35,43,51,59,67,83,99,115,131,163,195,227,258,0,0],o$1=[0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,112,112],l$1=[1,2,3,4,5,7,9,13,17,25,33,49,65,97,129,193,257,385,513,769,1025,1537,2049,3073,4097,6145,8193,12289,16385,24577],c$1=[0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13],u$1=15;function d$1(){let an,on,sn,ln,cn,un;function dn(fn,pn,gn,mn,bn,vn,yn,wn,kn,_n,xn){let En,Tn,Bn,Nn,Mn,Ln,On,zn,Pn,An,Vn,Sn,Rn,Hn,Zn;An=0,Mn=gn;do sn[fn[pn+An]]++,An++,Mn--;while(Mn!==0);if(sn[0]==gn)return yn[0]=-1,wn[0]=0,0;for(zn=wn[0],Ln=1;Ln<=u$1&&sn[Ln]===0;Ln++);for(On=Ln,zn<Ln&&(zn=Ln),Mn=u$1;Mn!==0&&sn[Mn]===0;Mn--);for(Bn=Mn,zn>Mn&&(zn=Mn),wn[0]=zn,Hn=1<<Ln;Ln<Mn;Ln++,Hn<<=1)if((Hn-=sn[Ln])<0)return t$1;if((Hn-=sn[Mn])<0)return t$1;for(sn[Mn]+=Hn,un[1]=Ln=0,An=1,Rn=2;--Mn!=0;)un[Rn]=Ln+=sn[An],Rn++,An++;Mn=0,An=0;do(Ln=fn[pn+An])!==0&&(xn[un[Ln]++]=Mn),An++;while(++Mn<gn);for(gn=un[Bn],un[0]=Mn=0,An=0,Nn=-1,Sn=-zn,cn[0]=0,Vn=0,Zn=0;On<=Bn;On++)for(En=sn[On];En--!=0;){for(;On>Sn+zn;){if(Nn++,Sn+=zn,Zn=Bn-Sn,Zn=Zn>zn?zn:Zn,(Tn=1<<(Ln=On-Sn))>En+1&&(Tn-=En+1,Rn=On,Ln<Zn))for(;++Ln<Zn&&!((Tn<<=1)<=sn[++Rn]);)Tn-=sn[Rn];if(Zn=1<<Ln,_n[0]+Zn>1440)return t$1;cn[Nn]=Vn=_n[0],_n[0]+=Zn,Nn!==0?(un[Nn]=Mn,ln[0]=Ln,ln[1]=zn,Ln=Mn>>>Sn-zn,ln[2]=Vn-cn[Nn-1]-Ln,kn.set(ln,3*(cn[Nn-1]+Ln))):yn[0]=Vn}for(ln[1]=On-Sn,An>=gn?ln[0]=192:xn[An]<mn?(ln[0]=xn[An]<256?0:96,ln[2]=xn[An++]):(ln[0]=vn[xn[An]-mn]+16+64,ln[2]=bn[xn[An++]-mn]),Tn=1<<On-Sn,Ln=Mn>>>Sn;Ln<Zn;Ln+=Tn)kn.set(ln,3*(Vn+Ln));for(Ln=1<<On-1;Mn&Ln;Ln>>>=1)Mn^=Ln;for(Mn^=Ln,Pn=(1<<Sn)-1;(Mn&Pn)!=un[Nn];)Nn--,Sn-=zn,Pn=(1<<Sn)-1}return Hn!==0&&Bn!=1?n$1:0}function hn(fn){let pn;for(an||(an=[],on=[],sn=new Int32Array(16),ln=[],cn=new Int32Array(u$1),un=new Int32Array(16)),on.length<fn&&(on=[]),pn=0;pn<fn;pn++)on[pn]=0;for(pn=0;pn<16;pn++)sn[pn]=0;for(pn=0;pn<3;pn++)ln[pn]=0;cn.set(sn.subarray(0,u$1),0),un.set(sn.subarray(0,16),0)}this.inflate_trees_bits=function(fn,pn,gn,mn,bn){let vn;return hn(19),an[0]=0,vn=dn(fn,0,19,19,null,null,gn,pn,mn,an,on),vn==t$1?bn.msg="oversubscribed dynamic bit lengths tree":vn!=n$1&&pn[0]!==0||(bn.msg="incomplete dynamic bit lengths tree",vn=t$1),vn},this.inflate_trees_dynamic=function(fn,pn,gn,mn,bn,vn,yn,wn,kn){let _n;return hn(288),an[0]=0,_n=dn(gn,0,fn,257,s$1,o$1,vn,mn,wn,an,on),_n!=0||mn[0]===0?(_n==t$1?kn.msg="oversubscribed literal/length tree":_n!=-4&&(kn.msg="incomplete literal/length tree",_n=t$1),_n):(hn(288),_n=dn(gn,fn,pn,0,l$1,c$1,yn,bn,wn,an,on),_n!=0||bn[0]===0&&fn>257?(_n==t$1?kn.msg="oversubscribed distance tree":_n==n$1?(kn.msg="incomplete distance tree",_n=t$1):_n!=-4&&(kn.msg="empty distance tree with lengths",_n=t$1),_n):0)}}d$1.inflate_trees_fixed=function(an,on,sn,ln){return an[0]=9,on[0]=5,sn[0]=r$1,ln[0]=a$1,0};function f$1(){const an=this;let on,sn,ln,cn,un=0,dn=0,hn=0,fn=0,pn=0,gn=0,mn=0,bn=0,vn=0,yn=0;function wn(kn,_n,xn,En,Tn,Bn,Nn,Mn){let Ln,On,zn,Pn,An,Vn,Sn,Rn,Hn,Zn,Qn,Yn,tr,Un,Xn,or;Sn=Mn.next_in_index,Rn=Mn.avail_in,An=Nn.bitb,Vn=Nn.bitk,Hn=Nn.write,Zn=Hn<Nn.read?Nn.read-Hn-1:Nn.end-Hn,Qn=i$2[kn],Yn=i$2[_n];do{for(;Vn<20;)Rn--,An|=(255&Mn.read_byte(Sn++))<<Vn,Vn+=8;if(Ln=An&Qn,On=xn,zn=En,or=3*(zn+Ln),(Pn=On[or])!==0)for(;;){if(An>>=On[or+1],Vn-=On[or+1],16&Pn){for(Pn&=15,tr=On[or+2]+(An&i$2[Pn]),An>>=Pn,Vn-=Pn;Vn<15;)Rn--,An|=(255&Mn.read_byte(Sn++))<<Vn,Vn+=8;for(Ln=An&Yn,On=Tn,zn=Bn,or=3*(zn+Ln),Pn=On[or];;){if(An>>=On[or+1],Vn-=On[or+1],16&Pn){for(Pn&=15;Vn<Pn;)Rn--,An|=(255&Mn.read_byte(Sn++))<<Vn,Vn+=8;if(Un=On[or+2]+(An&i$2[Pn]),An>>=Pn,Vn-=Pn,Zn-=tr,Hn>=Un)Xn=Hn-Un,Hn-Xn>0&&2>Hn-Xn?(Nn.win[Hn++]=Nn.win[Xn++],Nn.win[Hn++]=Nn.win[Xn++],tr-=2):(Nn.win.set(Nn.win.subarray(Xn,Xn+2),Hn),Hn+=2,Xn+=2,tr-=2);else{Xn=Hn-Un;do Xn+=Nn.end;while(Xn<0);if(Pn=Nn.end-Xn,tr>Pn){if(tr-=Pn,Hn-Xn>0&&Pn>Hn-Xn)do Nn.win[Hn++]=Nn.win[Xn++];while(--Pn!=0);else Nn.win.set(Nn.win.subarray(Xn,Xn+Pn),Hn),Hn+=Pn,Xn+=Pn,Pn=0;Xn=0}}if(Hn-Xn>0&&tr>Hn-Xn)do Nn.win[Hn++]=Nn.win[Xn++];while(--tr!=0);else Nn.win.set(Nn.win.subarray(Xn,Xn+tr),Hn),Hn+=tr,Xn+=tr,tr=0;break}if(64&Pn)return Mn.msg="invalid distance code",tr=Mn.avail_in-Rn,tr=Vn>>3<tr?Vn>>3:tr,Rn+=tr,Sn-=tr,Vn-=tr<<3,Nn.bitb=An,Nn.bitk=Vn,Mn.avail_in=Rn,Mn.total_in+=Sn-Mn.next_in_index,Mn.next_in_index=Sn,Nn.write=Hn,t$1;Ln+=On[or+2],Ln+=An&i$2[Pn],or=3*(zn+Ln),Pn=On[or]}break}if(64&Pn)return 32&Pn?(tr=Mn.avail_in-Rn,tr=Vn>>3<tr?Vn>>3:tr,Rn+=tr,Sn-=tr,Vn-=tr<<3,Nn.bitb=An,Nn.bitk=Vn,Mn.avail_in=Rn,Mn.total_in+=Sn-Mn.next_in_index,Mn.next_in_index=Sn,Nn.write=Hn,1):(Mn.msg="invalid literal/length code",tr=Mn.avail_in-Rn,tr=Vn>>3<tr?Vn>>3:tr,Rn+=tr,Sn-=tr,Vn-=tr<<3,Nn.bitb=An,Nn.bitk=Vn,Mn.avail_in=Rn,Mn.total_in+=Sn-Mn.next_in_index,Mn.next_in_index=Sn,Nn.write=Hn,t$1);if(Ln+=On[or+2],Ln+=An&i$2[Pn],or=3*(zn+Ln),(Pn=On[or])===0){An>>=On[or+1],Vn-=On[or+1],Nn.win[Hn++]=On[or+2],Zn--;break}}else An>>=On[or+1],Vn-=On[or+1],Nn.win[Hn++]=On[or+2],Zn--}while(Zn>=258&&Rn>=10);return tr=Mn.avail_in-Rn,tr=Vn>>3<tr?Vn>>3:tr,Rn+=tr,Sn-=tr,Vn-=tr<<3,Nn.bitb=An,Nn.bitk=Vn,Mn.avail_in=Rn,Mn.total_in+=Sn-Mn.next_in_index,Mn.next_in_index=Sn,Nn.write=Hn,0}an.init=function(kn,_n,xn,En,Tn,Bn){on=0,mn=kn,bn=_n,ln=xn,vn=En,cn=Tn,yn=Bn,sn=null},an.proc=function(kn,_n,xn){let En,Tn,Bn,Nn,Mn,Ln,On,zn=0,Pn=0,An=0;for(An=_n.next_in_index,Nn=_n.avail_in,zn=kn.bitb,Pn=kn.bitk,Mn=kn.write,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn;;)switch(on){case 0:if(Ln>=258&&Nn>=10&&(kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,xn=wn(mn,bn,ln,vn,cn,yn,kn,_n),An=_n.next_in_index,Nn=_n.avail_in,zn=kn.bitb,Pn=kn.bitk,Mn=kn.write,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn,xn!=0)){on=xn==1?7:9;break}hn=mn,sn=ln,dn=vn,on=1;case 1:for(En=hn;Pn<En;){if(Nn===0)return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);xn=0,Nn--,zn|=(255&_n.read_byte(An++))<<Pn,Pn+=8}if(Tn=3*(dn+(zn&i$2[En])),zn>>>=sn[Tn+1],Pn-=sn[Tn+1],Bn=sn[Tn],Bn===0){fn=sn[Tn+2],on=6;break}if(16&Bn){pn=15&Bn,un=sn[Tn+2],on=2;break}if(!(64&Bn)){hn=Bn,dn=Tn/3+sn[Tn+2];break}if(32&Bn){on=7;break}return on=9,_n.msg="invalid literal/length code",xn=t$1,kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);case 2:for(En=pn;Pn<En;){if(Nn===0)return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);xn=0,Nn--,zn|=(255&_n.read_byte(An++))<<Pn,Pn+=8}un+=zn&i$2[En],zn>>=En,Pn-=En,hn=bn,sn=cn,dn=yn,on=3;case 3:for(En=hn;Pn<En;){if(Nn===0)return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);xn=0,Nn--,zn|=(255&_n.read_byte(An++))<<Pn,Pn+=8}if(Tn=3*(dn+(zn&i$2[En])),zn>>=sn[Tn+1],Pn-=sn[Tn+1],Bn=sn[Tn],16&Bn){pn=15&Bn,gn=sn[Tn+2],on=4;break}if(!(64&Bn)){hn=Bn,dn=Tn/3+sn[Tn+2];break}return on=9,_n.msg="invalid distance code",xn=t$1,kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);case 4:for(En=pn;Pn<En;){if(Nn===0)return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);xn=0,Nn--,zn|=(255&_n.read_byte(An++))<<Pn,Pn+=8}gn+=zn&i$2[En],zn>>=En,Pn-=En,on=5;case 5:for(On=Mn-gn;On<0;)On+=kn.end;for(;un!==0;){if(Ln===0&&(Mn==kn.end&&kn.read!==0&&(Mn=0,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn),Ln===0&&(kn.write=Mn,xn=kn.inflate_flush(_n,xn),Mn=kn.write,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn,Mn==kn.end&&kn.read!==0&&(Mn=0,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn),Ln===0)))return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);kn.win[Mn++]=kn.win[On++],Ln--,On==kn.end&&(On=0),un--}on=0;break;case 6:if(Ln===0&&(Mn==kn.end&&kn.read!==0&&(Mn=0,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn),Ln===0&&(kn.write=Mn,xn=kn.inflate_flush(_n,xn),Mn=kn.write,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn,Mn==kn.end&&kn.read!==0&&(Mn=0,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn),Ln===0)))return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);xn=0,kn.win[Mn++]=fn,Ln--,on=0;break;case 7:if(Pn>7&&(Pn-=8,Nn++,An--),kn.write=Mn,xn=kn.inflate_flush(_n,xn),Mn=kn.write,Ln=Mn<kn.read?kn.read-Mn-1:kn.end-Mn,kn.read!=kn.write)return kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);on=8;case 8:return xn=1,kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);case 9:return xn=t$1,kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn);default:return xn=e$1,kn.bitb=zn,kn.bitk=Pn,_n.avail_in=Nn,_n.total_in+=An-_n.next_in_index,_n.next_in_index=An,kn.write=Mn,kn.inflate_flush(_n,xn)}},an.free=function(){}}const h$1=[16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15];function _(an,on){const sn=this;let ln,cn=0,un=0,dn=0,hn=0;const fn=[0],pn=[0],gn=new f$1;let mn=0,bn=new Int32Array(4320);const vn=new d$1;sn.bitk=0,sn.bitb=0,sn.win=new Uint8Array(on),sn.end=on,sn.read=0,sn.write=0,sn.reset=function(yn,wn){wn&&(wn[0]=0),cn==6&&gn.free(yn),cn=0,sn.bitk=0,sn.bitb=0,sn.read=sn.write=0},sn.reset(an,null),sn.inflate_flush=function(yn,wn){let kn,_n,xn;return _n=yn.next_out_index,xn=sn.read,kn=(xn<=sn.write?sn.write:sn.end)-xn,kn>yn.avail_out&&(kn=yn.avail_out),kn!==0&&wn==n$1&&(wn=0),yn.avail_out-=kn,yn.total_out+=kn,yn.next_out.set(sn.win.subarray(xn,xn+kn),_n),_n+=kn,xn+=kn,xn==sn.end&&(xn=0,sn.write==sn.end&&(sn.write=0),kn=sn.write-xn,kn>yn.avail_out&&(kn=yn.avail_out),kn!==0&&wn==n$1&&(wn=0),yn.avail_out-=kn,yn.total_out+=kn,yn.next_out.set(sn.win.subarray(xn,xn+kn),_n),_n+=kn,xn+=kn),yn.next_out_index=_n,sn.read=xn,wn},sn.proc=function(yn,wn){let kn,_n,xn,En,Tn,Bn,Nn,Mn;for(En=yn.next_in_index,Tn=yn.avail_in,_n=sn.bitb,xn=sn.bitk,Bn=sn.write,Nn=Bn<sn.read?sn.read-Bn-1:sn.end-Bn;;){let Ln,On,zn,Pn,An,Vn,Sn,Rn;switch(cn){case 0:for(;xn<3;){if(Tn===0)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);wn=0,Tn--,_n|=(255&yn.read_byte(En++))<<xn,xn+=8}switch(kn=7&_n,mn=1&kn,kn>>>1){case 0:_n>>>=3,xn-=3,kn=7&xn,_n>>>=kn,xn-=kn,cn=1;break;case 1:Ln=[],On=[],zn=[[]],Pn=[[]],d$1.inflate_trees_fixed(Ln,On,zn,Pn),gn.init(Ln[0],On[0],zn[0],0,Pn[0],0),_n>>>=3,xn-=3,cn=6;break;case 2:_n>>>=3,xn-=3,cn=3;break;case 3:return _n>>>=3,xn-=3,cn=9,yn.msg="invalid block type",wn=t$1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn)}break;case 1:for(;xn<32;){if(Tn===0)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);wn=0,Tn--,_n|=(255&yn.read_byte(En++))<<xn,xn+=8}if((~_n>>>16&65535)!=(65535&_n))return cn=9,yn.msg="invalid stored block lengths",wn=t$1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);un=65535&_n,_n=xn=0,cn=un!==0?2:mn!==0?7:0;break;case 2:if(Tn===0||Nn===0&&(Bn==sn.end&&sn.read!==0&&(Bn=0,Nn=Bn<sn.read?sn.read-Bn-1:sn.end-Bn),Nn===0&&(sn.write=Bn,wn=sn.inflate_flush(yn,wn),Bn=sn.write,Nn=Bn<sn.read?sn.read-Bn-1:sn.end-Bn,Bn==sn.end&&sn.read!==0&&(Bn=0,Nn=Bn<sn.read?sn.read-Bn-1:sn.end-Bn),Nn===0)))return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);if(wn=0,kn=un,kn>Tn&&(kn=Tn),kn>Nn&&(kn=Nn),sn.win.set(yn.read_buf(En,kn),Bn),En+=kn,Tn-=kn,Bn+=kn,Nn-=kn,(un-=kn)!=0)break;cn=mn!==0?7:0;break;case 3:for(;xn<14;){if(Tn===0)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);wn=0,Tn--,_n|=(255&yn.read_byte(En++))<<xn,xn+=8}if(dn=kn=16383&_n,(31&kn)>29||(kn>>5&31)>29)return cn=9,yn.msg="too many length or distance symbols",wn=t$1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);if(kn=258+(31&kn)+(kn>>5&31),!ln||ln.length<kn)ln=[];else for(Mn=0;Mn<kn;Mn++)ln[Mn]=0;_n>>>=14,xn-=14,hn=0,cn=4;case 4:for(;hn<4+(dn>>>10);){for(;xn<3;){if(Tn===0)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);wn=0,Tn--,_n|=(255&yn.read_byte(En++))<<xn,xn+=8}ln[h$1[hn++]]=7&_n,_n>>>=3,xn-=3}for(;hn<19;)ln[h$1[hn++]]=0;if(fn[0]=7,kn=vn.inflate_trees_bits(ln,fn,pn,bn,yn),kn!=0)return(wn=kn)==t$1&&(ln=null,cn=9),sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);hn=0,cn=5;case 5:for(;kn=dn,!(hn>=258+(31&kn)+(kn>>5&31));){let Hn,Zn;for(kn=fn[0];xn<kn;){if(Tn===0)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);wn=0,Tn--,_n|=(255&yn.read_byte(En++))<<xn,xn+=8}if(kn=bn[3*(pn[0]+(_n&i$2[kn]))+1],Zn=bn[3*(pn[0]+(_n&i$2[kn]))+2],Zn<16)_n>>>=kn,xn-=kn,ln[hn++]=Zn;else{for(Mn=Zn==18?7:Zn-14,Hn=Zn==18?11:3;xn<kn+Mn;){if(Tn===0)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);wn=0,Tn--,_n|=(255&yn.read_byte(En++))<<xn,xn+=8}if(_n>>>=kn,xn-=kn,Hn+=_n&i$2[Mn],_n>>>=Mn,xn-=Mn,Mn=hn,kn=dn,Mn+Hn>258+(31&kn)+(kn>>5&31)||Zn==16&&Mn<1)return ln=null,cn=9,yn.msg="invalid bit length repeat",wn=t$1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);Zn=Zn==16?ln[Mn-1]:0;do ln[Mn++]=Zn;while(--Hn!=0);hn=Mn}}if(pn[0]=-1,An=[],Vn=[],Sn=[],Rn=[],An[0]=9,Vn[0]=6,kn=dn,kn=vn.inflate_trees_dynamic(257+(31&kn),1+(kn>>5&31),ln,An,Vn,Sn,Rn,bn,yn),kn!=0)return kn==t$1&&(ln=null,cn=9),wn=kn,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);gn.init(An[0],Vn[0],bn,Sn[0],bn,Rn[0]),cn=6;case 6:if(sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,(wn=gn.proc(sn,yn,wn))!=1)return sn.inflate_flush(yn,wn);if(wn=0,gn.free(yn),En=yn.next_in_index,Tn=yn.avail_in,_n=sn.bitb,xn=sn.bitk,Bn=sn.write,Nn=Bn<sn.read?sn.read-Bn-1:sn.end-Bn,mn===0){cn=0;break}cn=7;case 7:if(sn.write=Bn,wn=sn.inflate_flush(yn,wn),Bn=sn.write,Nn=Bn<sn.read?sn.read-Bn-1:sn.end-Bn,sn.read!=sn.write)return sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);cn=8;case 8:return wn=1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);case 9:return wn=t$1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn);default:return wn=e$1,sn.bitb=_n,sn.bitk=xn,yn.avail_in=Tn,yn.total_in+=En-yn.next_in_index,yn.next_in_index=En,sn.write=Bn,sn.inflate_flush(yn,wn)}}},sn.free=function(yn){sn.reset(yn,null),sn.win=null,bn=null},sn.set_dictionary=function(yn,wn,kn){sn.win.set(yn.subarray(wn,wn+kn),0),sn.read=sn.write=kn},sn.sync_point=function(){return cn==1?1:0}}const w$1=13,b$1=[0,0,255,255];function p$1(){const an=this;function on(sn){return sn&&sn.istate?(sn.total_in=sn.total_out=0,sn.msg=null,sn.istate.mode=7,sn.istate.blocks.reset(sn,null),0):e$1}an.mode=0,an.method=0,an.was=[0],an.need=0,an.marker=0,an.wbits=0,an.inflateEnd=function(sn){return an.blocks&&an.blocks.free(sn),an.blocks=null,0},an.inflateInit=function(sn,ln){return sn.msg=null,an.blocks=null,ln<8||ln>15?(an.inflateEnd(sn),e$1):(an.wbits=ln,sn.istate.blocks=new _(sn,1<<ln),on(sn),0)},an.inflate=function(sn,ln){let cn,un;if(!sn||!sn.istate||!sn.next_in)return e$1;const dn=sn.istate;for(ln=ln==4?n$1:0,cn=n$1;;)switch(dn.mode){case 0:if(sn.avail_in===0)return cn;if(cn=ln,sn.avail_in--,sn.total_in++,(15&(dn.method=sn.read_byte(sn.next_in_index++)))!=8){dn.mode=w$1,sn.msg="unknown compression method",dn.marker=5;break}if(8+(dn.method>>4)>dn.wbits){dn.mode=w$1,sn.msg="invalid win size",dn.marker=5;break}dn.mode=1;case 1:if(sn.avail_in===0)return cn;if(cn=ln,sn.avail_in--,sn.total_in++,un=255&sn.read_byte(sn.next_in_index++),((dn.method<<8)+un)%31!=0){dn.mode=w$1,sn.msg="incorrect header check",dn.marker=5;break}if(!(32&un)){dn.mode=7;break}dn.mode=2;case 2:if(sn.avail_in===0)return cn;cn=ln,sn.avail_in--,sn.total_in++,dn.need=(255&sn.read_byte(sn.next_in_index++))<<24&4278190080,dn.mode=3;case 3:if(sn.avail_in===0)return cn;cn=ln,sn.avail_in--,sn.total_in++,dn.need+=(255&sn.read_byte(sn.next_in_index++))<<16&16711680,dn.mode=4;case 4:if(sn.avail_in===0)return cn;cn=ln,sn.avail_in--,sn.total_in++,dn.need+=(255&sn.read_byte(sn.next_in_index++))<<8&65280,dn.mode=5;case 5:return sn.avail_in===0?cn:(cn=ln,sn.avail_in--,sn.total_in++,dn.need+=255&sn.read_byte(sn.next_in_index++),dn.mode=6,2);case 6:return dn.mode=w$1,sn.msg="need dictionary",dn.marker=0,e$1;case 7:if(cn=dn.blocks.proc(sn,cn),cn==t$1){dn.mode=w$1,dn.marker=0;break}if(cn==0&&(cn=ln),cn!=1)return cn;cn=ln,dn.blocks.reset(sn,dn.was),dn.mode=12;case 12:return sn.avail_in=0,1;case w$1:return t$1;default:return e$1}},an.inflateSetDictionary=function(sn,ln,cn){let un=0,dn=cn;if(!sn||!sn.istate||sn.istate.mode!=6)return e$1;const hn=sn.istate;return dn>=1<<hn.wbits&&(dn=(1<<hn.wbits)-1,un=cn-dn),hn.blocks.set_dictionary(ln,un,dn),hn.mode=7,0},an.inflateSync=function(sn){let ln,cn,un,dn,hn;if(!sn||!sn.istate)return e$1;const fn=sn.istate;if(fn.mode!=w$1&&(fn.mode=w$1,fn.marker=0),(ln=sn.avail_in)===0)return n$1;for(cn=sn.next_in_index,un=fn.marker;ln!==0&&un<4;)sn.read_byte(cn)==b$1[un]?un++:un=sn.read_byte(cn)!==0?0:4-un,cn++,ln--;return sn.total_in+=cn-sn.next_in_index,sn.next_in_index=cn,sn.avail_in=ln,fn.marker=un,un!=4?t$1:(dn=sn.total_in,hn=sn.total_out,on(sn),sn.total_in=dn,sn.total_out=hn,fn.mode=7,0)},an.inflateSyncPoint=function(sn){return sn&&sn.istate&&sn.istate.blocks?sn.istate.blocks.sync_point():e$1}}function m$1(){}m$1.prototype={inflateInit(an){const on=this;return on.istate=new p$1,an||(an=15),on.istate.inflateInit(on,an)},inflate(an){const on=this;return on.istate?on.istate.inflate(on,an):e$1},inflateEnd(){const an=this;if(!an.istate)return e$1;const on=an.istate.inflateEnd(an);return an.istate=null,on},inflateSync(){const an=this;return an.istate?an.istate.inflateSync(an):e$1},inflateSetDictionary(an,on){const sn=this;return sn.istate?sn.istate.inflateSetDictionary(sn,an,on):e$1},read_byte(an){return this.next_in[an]},read_buf(an,on){return this.next_in.subarray(an,an+on)}};const g$1=4294967295,y$1=65535,x$2=33639248,k$1=101075792,v$1=22,S=void 0,z$1="undefined",A$1="function";let U$1=class{constructor(on){return class extends TransformStream{constructor(sn,ln){const cn=new on(ln);super({transform(un,dn){dn.enqueue(cn.append(un))},flush(un){const dn=cn.flush();dn&&un.enqueue(dn)}})}}}},D=2;try{typeof navigator!=z$1&&navigator.hardwareConcurrency&&(D=navigator.hardwareConcurrency)}catch(an){}const E$1={chunkSize:524288,maxWorkers:D,terminateWorkerTimeout:5e3,useWebWorkers:!0,useCompressionStream:!0,workerScripts:S,CompressionStreamNative:typeof CompressionStream!=z$1&&CompressionStream,DecompressionStreamNative:typeof DecompressionStream!=z$1&&DecompressionStream},F=Object.assign({},E$1);function T$1(an){const{baseURL:on,chunkSize:sn,maxWorkers:ln,terminateWorkerTimeout:cn,useCompressionStream:un,useWebWorkers:dn,Deflate:hn,Inflate:fn,CompressionStream:pn,DecompressionStream:gn,workerScripts:mn}=an;if(O("baseURL",on),O("chunkSize",sn),O("maxWorkers",ln),O("terminateWorkerTimeout",cn),O("useCompressionStream",un),O("useWebWorkers",dn),hn&&(F.CompressionStream=new U$1(hn)),fn&&(F.DecompressionStream=new U$1(fn)),O("CompressionStream",pn),O("DecompressionStream",gn),mn!==S){const{deflate:bn,inflate:vn}=mn;if((bn||vn)&&(F.workerScripts||(F.workerScripts={})),bn){if(!Array.isArray(bn))throw new Error("workerScripts.deflate must be an array");F.workerScripts.deflate=bn}if(vn){if(!Array.isArray(vn))throw new Error("workerScripts.inflate must be an array");F.workerScripts.inflate=vn}}}function O(an,on){on!==S&&(F[an]=on)}const C=[];for(let an=0;an<256;an++){let on=an;for(let sn=0;sn<8;sn++)1&on?on=on>>>1^3988292384:on>>>=1;C[an]=on}class W{constructor(on){this.crc=on||-1}append(on){let sn=0|this.crc;for(let ln=0,cn=0|on.length;ln<cn;ln++)sn=sn>>>8^C[255&(sn^on[ln])];this.crc=sn}get(){return~this.crc}}class j extends TransformStream{constructor(){let on;const sn=new W;super({transform(ln,cn){sn.append(ln),cn.enqueue(ln)},flush(){const ln=new Uint8Array(4);new DataView(ln.buffer).setUint32(0,sn.get()),on.value=ln}}),on=this}}const M={concat(an,on){if(an.length===0||on.length===0)return an.concat(on);const sn=an[an.length-1],ln=M.getPartial(sn);return ln===32?an.concat(on):M._shiftRight(on,ln,0|sn,an.slice(0,an.length-1))},bitLength(an){const on=an.length;if(on===0)return 0;const sn=an[on-1];return 32*(on-1)+M.getPartial(sn)},clamp(an,on){if(32*an.length<on)return an;const sn=(an=an.slice(0,Math.ceil(on/32))).length;return on&=31,sn>0&&on&&(an[sn-1]=M.partial(on,an[sn-1]&2147483648>>on-1,1)),an},partial:(an,on,sn)=>an===32?on:(sn?0|on:on<<32-an)+1099511627776*an,getPartial:an=>Math.round(an/1099511627776)||32,_shiftRight(an,on,sn,ln){for(ln===void 0&&(ln=[]);on>=32;on-=32)ln.push(sn),sn=0;if(on===0)return ln.concat(an);for(let dn=0;dn<an.length;dn++)ln.push(sn|an[dn]>>>on),sn=an[dn]<<32-on;const cn=an.length?an[an.length-1]:0,un=M.getPartial(cn);return ln.push(M.partial(on+un&31,on+un>32?sn:ln.pop(),1)),ln}},L={bytes:{fromBits(an){const on=M.bitLength(an)/8,sn=new Uint8Array(on);let ln;for(let cn=0;cn<on;cn++)3&cn||(ln=an[cn/4]),sn[cn]=ln>>>24,ln<<=8;return sn},toBits(an){const on=[];let sn,ln=0;for(sn=0;sn<an.length;sn++)ln=ln<<8|an[sn],3&~sn||(on.push(ln),ln=0);return 3&sn&&on.push(M.partial(8*(3&sn),ln)),on}}},P={sha1:class{constructor(an){const on=this;on.blockSize=512,on._init=[1732584193,4023233417,2562383102,271733878,3285377520],on._key=[1518500249,1859775393,2400959708,3395469782],an?(on._h=an._h.slice(0),on._buffer=an._buffer.slice(0),on._length=an._length):on.reset()}reset(){const an=this;return an._h=an._init.slice(0),an._buffer=[],an._length=0,an}update(an){const on=this;typeof an=="string"&&(an=L.utf8String.toBits(an));const sn=on._buffer=M.concat(on._buffer,an),ln=on._length,cn=on._length=ln+M.bitLength(an);if(cn>9007199254740991)throw new Error("Cannot hash more than 2^53 - 1 bits");const un=new Uint32Array(sn);let dn=0;for(let hn=on.blockSize+ln-(on.blockSize+ln&on.blockSize-1);hn<=cn;hn+=on.blockSize)on._block(un.subarray(16*dn,16*(dn+1))),dn+=1;return sn.splice(0,16*dn),on}finalize(){const an=this;let on=an._buffer;const sn=an._h;on=M.concat(on,[M.partial(1,1)]);for(let ln=on.length+2;15&ln;ln++)on.push(0);for(on.push(Math.floor(an._length/4294967296)),on.push(0|an._length);on.length;)an._block(on.splice(0,16));return an.reset(),sn}_f(an,on,sn,ln){return an<=19?on&sn|~on&ln:an<=39?on^sn^ln:an<=59?on&sn|on&ln|sn&ln:an<=79?on^sn^ln:void 0}_S(an,on){return on<<an|on>>>32-an}_block(an){const on=this,sn=on._h,ln=Array(80);for(let pn=0;pn<16;pn++)ln[pn]=an[pn];let cn=sn[0],un=sn[1],dn=sn[2],hn=sn[3],fn=sn[4];for(let pn=0;pn<=79;pn++){pn>=16&&(ln[pn]=on._S(1,ln[pn-3]^ln[pn-8]^ln[pn-14]^ln[pn-16]));const gn=on._S(5,cn)+on._f(pn,un,dn,hn)+fn+ln[pn]+on._key[Math.floor(pn/20)]|0;fn=hn,hn=dn,dn=on._S(30,un),un=cn,cn=gn}sn[0]=sn[0]+cn|0,sn[1]=sn[1]+un|0,sn[2]=sn[2]+dn|0,sn[3]=sn[3]+hn|0,sn[4]=sn[4]+fn|0}}},R={aes:class{constructor(an){const on=this;on._tables=[[[],[],[],[],[]],[[],[],[],[],[]]],on._tables[0][0][0]||on._precompute();const sn=on._tables[0][4],ln=on._tables[1],cn=an.length;let un,dn,hn,fn=1;if(cn!==4&&cn!==6&&cn!==8)throw new Error("invalid aes key size");for(on._key=[dn=an.slice(0),hn=[]],un=cn;un<4*cn+28;un++){let pn=dn[un-1];(un%cn==0||cn===8&&un%cn==4)&&(pn=sn[pn>>>24]<<24^sn[pn>>16&255]<<16^sn[pn>>8&255]<<8^sn[255&pn],un%cn==0&&(pn=pn<<8^pn>>>24^fn<<24,fn=fn<<1^283*(fn>>7))),dn[un]=dn[un-cn]^pn}for(let pn=0;un;pn++,un--){const gn=dn[3&pn?un:un-4];hn[pn]=un<=4||pn<4?gn:ln[0][sn[gn>>>24]]^ln[1][sn[gn>>16&255]]^ln[2][sn[gn>>8&255]]^ln[3][sn[255&gn]]}}encrypt(an){return this._crypt(an,0)}decrypt(an){return this._crypt(an,1)}_precompute(){const an=this._tables[0],on=this._tables[1],sn=an[4],ln=on[4],cn=[],un=[];let dn,hn,fn,pn;for(let gn=0;gn<256;gn++)un[(cn[gn]=gn<<1^283*(gn>>7))^gn]=gn;for(let gn=dn=0;!sn[gn];gn^=hn||1,dn=un[dn]||1){let mn=dn^dn<<1^dn<<2^dn<<3^dn<<4;mn=mn>>8^255&mn^99,sn[gn]=mn,ln[mn]=gn,pn=cn[fn=cn[hn=cn[gn]]];let bn=16843009*pn^65537*fn^257*hn^16843008*gn,vn=257*cn[mn]^16843008*mn;for(let yn=0;yn<4;yn++)an[yn][gn]=vn=vn<<24^vn>>>8,on[yn][mn]=bn=bn<<24^bn>>>8}for(let gn=0;gn<5;gn++)an[gn]=an[gn].slice(0),on[gn]=on[gn].slice(0)}_crypt(an,on){if(an.length!==4)throw new Error("invalid aes block size");const sn=this._key[on],ln=sn.length/4-2,cn=[0,0,0,0],un=this._tables[on],dn=un[0],hn=un[1],fn=un[2],pn=un[3],gn=un[4];let mn,bn,vn,yn=an[0]^sn[0],wn=an[on?3:1]^sn[1],kn=an[2]^sn[2],_n=an[on?1:3]^sn[3],xn=4;for(let En=0;En<ln;En++)mn=dn[yn>>>24]^hn[wn>>16&255]^fn[kn>>8&255]^pn[255&_n]^sn[xn],bn=dn[wn>>>24]^hn[kn>>16&255]^fn[_n>>8&255]^pn[255&yn]^sn[xn+1],vn=dn[kn>>>24]^hn[_n>>16&255]^fn[yn>>8&255]^pn[255&wn]^sn[xn+2],_n=dn[_n>>>24]^hn[yn>>16&255]^fn[wn>>8&255]^pn[255&kn]^sn[xn+3],xn+=4,yn=mn,wn=bn,kn=vn;for(let En=0;En<4;En++)cn[on?3&-En:En]=gn[yn>>>24]<<24^gn[wn>>16&255]<<16^gn[kn>>8&255]<<8^gn[255&_n]^sn[xn++],mn=yn,yn=wn,wn=kn,kn=_n,_n=mn;return cn}}},B={getRandomValues(an){const on=new Uint32Array(an.buffer),sn=ln=>{let cn=987654321;const un=4294967295;return function(){return cn=36969*(65535&cn)+(cn>>16)&un,(((cn<<16)+(ln=18e3*(65535&ln)+(ln>>16)&un)&un)/4294967296+.5)*(Math.random()>.5?1:-1)}};for(let ln,cn=0;cn<an.length;cn+=4){const un=sn(4294967296*(ln||Math.random()));ln=987654071*un(),on[cn/4]=4294967296*un()|0}return an}},I={ctrGladman:class{constructor(an,on){this._prf=an,this._initIv=on,this._iv=on}reset(){this._iv=this._initIv}update(an){return this.calculate(this._prf,an,this._iv)}incWord(an){if(255&~(an>>24))an+=1<<24;else{let on=an>>16&255,sn=an>>8&255,ln=255&an;on===255?(on=0,sn===255?(sn=0,ln===255?ln=0:++ln):++sn):++on,an=0,an+=on<<16,an+=sn<<8,an+=ln}return an}incCounter(an){(an[0]=this.incWord(an[0]))===0&&(an[1]=this.incWord(an[1]))}calculate(an,on,sn){let ln;if(!(ln=on.length))return[];const cn=M.bitLength(on);for(let un=0;un<ln;un+=4){this.incCounter(sn);const dn=an.encrypt(sn);on[un]^=dn[0],on[un+1]^=dn[1],on[un+2]^=dn[2],on[un+3]^=dn[3]}return M.clamp(on,cn)}}},N={importKey:an=>new N.hmacSha1(L.bytes.toBits(an)),pbkdf2(an,on,sn,ln){if(sn=sn||1e4,ln<0||sn<0)throw new Error("invalid params to pbkdf2");const cn=1+(ln>>5)<<2;let un,dn,hn,fn,pn;const gn=new ArrayBuffer(cn),mn=new DataView(gn);let bn=0;const vn=M;for(on=L.bytes.toBits(on),pn=1;bn<(cn||1);pn++){for(un=dn=an.encrypt(vn.concat(on,[pn])),hn=1;hn<sn;hn++)for(dn=an.encrypt(dn),fn=0;fn<dn.length;fn++)un[fn]^=dn[fn];for(hn=0;bn<(cn||1)&&hn<un.length;hn++)mn.setInt32(bn,un[hn]),bn+=4}return gn.slice(0,ln/8)},hmacSha1:class{constructor(an){const on=this,sn=on._hash=P.sha1,ln=[[],[]];on._baseHash=[new sn,new sn];const cn=on._baseHash[0].blockSize/32;an.length>cn&&(an=new sn().update(an).finalize());for(let un=0;un<cn;un++)ln[0][un]=909522486^an[un],ln[1][un]=1549556828^an[un];on._baseHash[0].update(ln[0]),on._baseHash[1].update(ln[1]),on._resultHash=new sn(on._baseHash[0])}reset(){const an=this;an._resultHash=new an._hash(an._baseHash[0]),an._updated=!1}update(an){this._updated=!0,this._resultHash.update(an)}digest(){const an=this,on=an._resultHash.finalize(),sn=new an._hash(an._baseHash[1]).update(on).finalize();return an.reset(),sn}encrypt(an){if(this._updated)throw new Error("encrypt on already updated hmac called!");return this.update(an),this.digest(an)}}},V=typeof crypto!=z$1&&typeof crypto.getRandomValues==A$1,q="Invalid password",H="Invalid signature",K="zipjs-abort-check-password";function Z(an){return V?crypto.getRandomValues(an):B.getRandomValues(an)}const G=16,J={name:"PBKDF2"},Q=Object.assign({hash:{name:"HMAC"}},J),X=Object.assign({iterations:1e3,hash:{name:"SHA-1"}},J),Y=["deriveBits"],$=[8,12,16],ee=[16,24,32],te=10,ne=[0,0,0,0],ie=typeof crypto!=z$1,re=ie&&crypto.subtle,ae=ie&&typeof re!=z$1,se=L.bytes,oe=R.aes,le=I.ctrGladman,ce=N.hmacSha1;let ue=ie&&ae&&typeof re.importKey==A$1,de=ie&&ae&&typeof re.deriveBits==A$1;class fe extends TransformStream{constructor({password:on,rawPassword:sn,signed:ln,encryptionStrength:cn,checkPasswordOnly:un}){super({start(){Object.assign(this,{ready:new Promise((dn=>this.resolveReady=dn)),password:be(on,sn),signed:ln,strength:cn-1,pending:new Uint8Array})},async transform(dn,hn){const fn=this,{password:pn,strength:gn,resolveReady:mn,ready:bn}=fn;pn?(await(async function(yn,wn,kn,_n){const xn=await we(yn,wn,kn,me(_n,0,$[wn])),En=me(_n,$[wn]);if(xn[0]!=En[0]||xn[1]!=En[1])throw new Error(q)})(fn,gn,pn,me(dn,0,$[gn]+2)),dn=me(dn,$[gn]+2),un?hn.error(new Error(K)):mn()):await bn;const vn=new Uint8Array(dn.length-te-(dn.length-te)%G);hn.enqueue(_e(fn,dn,vn,0,te,!0))},async flush(dn){const{signed:hn,ctr:fn,hmac:pn,pending:gn,ready:mn}=this;if(pn&&fn){await mn;const bn=me(gn,0,gn.length-te),vn=me(gn,gn.length-te);let yn=new Uint8Array;if(bn.length){const wn=ye(se,bn);pn.update(wn);const kn=fn.update(wn);yn=ge(se,kn)}if(hn){const wn=me(ge(se,pn.digest()),0,te);for(let kn=0;kn<te;kn++)if(wn[kn]!=vn[kn])throw new Error(H)}dn.enqueue(yn)}}})}}class he extends TransformStream{constructor({password:on,rawPassword:sn,encryptionStrength:ln}){let cn;super({start(){Object.assign(this,{ready:new Promise((un=>this.resolveReady=un)),password:be(on,sn),strength:ln-1,pending:new Uint8Array})},async transform(un,dn){const hn=this,{password:fn,strength:pn,resolveReady:gn,ready:mn}=hn;let bn=new Uint8Array;fn?(bn=await(async function(yn,wn,kn){const _n=Z(new Uint8Array($[wn])),xn=await we(yn,wn,kn,_n);return pe(_n,xn)})(hn,pn,fn),gn()):await mn;const vn=new Uint8Array(bn.length+un.length-un.length%G);vn.set(bn,0),dn.enqueue(_e(hn,un,vn,bn.length,0))},async flush(un){const{ctr:dn,hmac:hn,pending:fn,ready:pn}=this;if(hn&&dn){await pn;let gn=new Uint8Array;if(fn.length){const mn=dn.update(ye(se,fn));hn.update(mn),gn=ge(se,mn)}cn.signature=ge(se,hn.digest()).slice(0,te),un.enqueue(pe(gn,cn.signature))}}}),cn=this}}function _e(an,on,sn,ln,cn,un){const{ctr:dn,hmac:hn,pending:fn}=an,pn=on.length-cn;let gn;for(fn.length&&(on=pe(fn,on),sn=(function(mn,bn){if(bn&&bn>mn.length){const vn=mn;(mn=new Uint8Array(bn)).set(vn,0)}return mn})(sn,pn-pn%G)),gn=0;gn<=pn-G;gn+=G){const mn=ye(se,me(on,gn,gn+G));un&&hn.update(mn);const bn=dn.update(mn);un||hn.update(bn),sn.set(ge(se,bn),gn+ln)}return an.pending=me(on,gn),sn}async function we(an,on,sn,ln){an.password=null;const cn=await(async function(gn,mn,bn,vn,yn){if(!ue)return N.importKey(mn);try{return await re.importKey(gn,mn,bn,vn,yn)}catch{return ue=!1,N.importKey(mn)}})("raw",sn,Q,!1,Y),un=await(async function(gn,mn,bn){if(!de)return N.pbkdf2(mn,gn.salt,X.iterations,bn);try{return await re.deriveBits(gn,mn,bn)}catch{return de=!1,N.pbkdf2(mn,gn.salt,X.iterations,bn)}})(Object.assign({salt:ln},X),cn,8*(2*ee[on]+2)),dn=new Uint8Array(un),hn=ye(se,me(dn,0,ee[on])),fn=ye(se,me(dn,ee[on],2*ee[on])),pn=me(dn,2*ee[on]);return Object.assign(an,{keys:{key:hn,authentication:fn,passwordVerification:pn},ctr:new le(new oe(hn),Array.from(ne)),hmac:new ce(fn)}),pn}function be(an,on){return on===S?(function(sn){if(typeof TextEncoder==z$1){sn=unescape(encodeURIComponent(sn));const ln=new Uint8Array(sn.length);for(let cn=0;cn<ln.length;cn++)ln[cn]=sn.charCodeAt(cn);return ln}return new TextEncoder().encode(sn)})(an):on}function pe(an,on){let sn=an;return an.length+on.length&&(sn=new Uint8Array(an.length+on.length),sn.set(an,0),sn.set(on,an.length)),sn}function me(an,on,sn){return an.subarray(on,sn)}function ge(an,on){return an.fromBits(on)}function ye(an,on){return an.toBits(on)}const xe=12;class ke extends TransformStream{constructor({password:on,passwordVerification:sn,checkPasswordOnly:ln}){super({start(){Object.assign(this,{password:on,passwordVerification:sn}),Ae(this,on)},transform(cn,un){const dn=this;if(dn.password){const hn=Se(dn,cn.subarray(0,xe));if(dn.password=null,hn[11]!=dn.passwordVerification)throw new Error(q);cn=cn.subarray(xe)}ln?un.error(new Error(K)):un.enqueue(Se(dn,cn))}})}}class ve extends TransformStream{constructor({password:on,passwordVerification:sn}){super({start(){Object.assign(this,{password:on,passwordVerification:sn}),Ae(this,on)},transform(ln,cn){const un=this;let dn,hn;if(un.password){un.password=null;const fn=Z(new Uint8Array(xe));fn[11]=un.passwordVerification,dn=new Uint8Array(ln.length+fn.length),dn.set(ze(un,fn),0),hn=xe}else dn=new Uint8Array(ln.length),hn=0;dn.set(ze(un,ln),hn),cn.enqueue(dn)}})}}function Se(an,on){const sn=new Uint8Array(on.length);for(let ln=0;ln<on.length;ln++)sn[ln]=De(an)^on[ln],Ue(an,sn[ln]);return sn}function ze(an,on){const sn=new Uint8Array(on.length);for(let ln=0;ln<on.length;ln++)sn[ln]=De(an)^on[ln],Ue(an,on[ln]);return sn}function Ae(an,on){const sn=[305419896,591751049,878082192];Object.assign(an,{keys:sn,crcKey0:new W(sn[0]),crcKey2:new W(sn[2])});for(let ln=0;ln<on.length;ln++)Ue(an,on.charCodeAt(ln))}function Ue(an,on){let[sn,ln,cn]=an.keys;an.crcKey0.append([on]),sn=~an.crcKey0.get(),ln=Fe(Math.imul(Fe(ln+Ee(sn)),134775813)+1),an.crcKey2.append([ln>>>24]),cn=~an.crcKey2.get(),an.keys=[sn,ln,cn]}function De(an){const on=2|an.keys[2];return Ee(Math.imul(on,1^on)>>>8)}function Ee(an){return 255&an}function Fe(an){return 4294967295&an}const Te="deflate-raw";class Oe extends TransformStream{constructor(on,{chunkSize:sn,CompressionStream:ln,CompressionStreamNative:cn}){super({});const{compressed:un,encrypted:dn,useCompressionStream:hn,zipCrypto:fn,signed:pn,level:gn}=on,mn=this;let bn,vn,yn=We(super.readable);dn&&!fn||!pn||(bn=new j,yn=Le(yn,bn)),un&&(yn=Me(yn,hn,{level:gn,chunkSize:sn},cn,ln)),dn&&(fn?yn=Le(yn,new ve(on)):(vn=new he(on),yn=Le(yn,vn))),je(mn,yn,(()=>{let wn;dn&&!fn&&(wn=vn.signature),dn&&!fn||!pn||(wn=new DataView(bn.value.buffer).getUint32(0)),mn.signature=wn}))}}class Ce extends TransformStream{constructor(on,{chunkSize:sn,DecompressionStream:ln,DecompressionStreamNative:cn}){super({});const{zipCrypto:un,encrypted:dn,signed:hn,signature:fn,compressed:pn,useCompressionStream:gn}=on;let mn,bn,vn=We(super.readable);dn&&(un?vn=Le(vn,new ke(on)):(bn=new fe(on),vn=Le(vn,bn))),pn&&(vn=Me(vn,gn,{chunkSize:sn},cn,ln)),dn&&!un||!hn||(mn=new j,vn=Le(vn,mn)),je(this,vn,(()=>{if((!dn||un)&&hn){const yn=new DataView(mn.value.buffer);if(fn!=yn.getUint32(0,!1))throw new Error(H)}}))}}function We(an){return Le(an,new TransformStream({transform(on,sn){on&&on.length&&sn.enqueue(on)}}))}function je(an,on,sn){on=Le(on,new TransformStream({flush:sn})),Object.defineProperty(an,"readable",{get:()=>on})}function Me(an,on,sn,ln,cn){try{an=Le(an,new(on&&ln?ln:cn)(Te,sn))}catch{if(!on)return an;try{an=Le(an,new cn(Te,sn))}catch{return an}}return an}function Le(an,on){return an.pipeThrough(on)}const Pe="message",Re="start",Be="pull",Ie="data",Ne="close",Ve="inflate";class qe extends TransformStream{constructor(on,sn){super({});const ln=this,{codecType:cn}=on;let un;cn.startsWith("deflate")?un=Oe:cn.startsWith(Ve)&&(un=Ce);let dn=0,hn=0;const fn=new un(on,sn),pn=super.readable,gn=new TransformStream({transform(bn,vn){bn&&bn.length&&(hn+=bn.length,vn.enqueue(bn))},flush(){Object.assign(ln,{inputSize:hn})}}),mn=new TransformStream({transform(bn,vn){bn&&bn.length&&(dn+=bn.length,vn.enqueue(bn))},flush(){const{signature:bn}=fn;Object.assign(ln,{signature:bn,outputSize:dn,inputSize:hn})}});Object.defineProperty(ln,"readable",{get:()=>pn.pipeThrough(gn).pipeThrough(fn).pipeThrough(mn)})}}class He extends TransformStream{constructor(on){let sn;super({transform:function ln(cn,un){if(sn){const dn=new Uint8Array(sn.length+cn.length);dn.set(sn),dn.set(cn,sn.length),cn=dn,sn=null}cn.length>on?(un.enqueue(cn.slice(0,on)),ln(cn.slice(on),un)):sn=cn},flush(ln){sn&&sn.length&&ln.enqueue(sn)}})}}let Ke=typeof Worker!=z$1;class Ze{constructor(on,{readable:sn,writable:ln},{options:cn,config:un,streamOptions:dn,useWebWorkers:hn,transferStreams:fn,scripts:pn},gn){const{signal:mn}=dn;return Object.assign(on,{busy:!0,readable:sn.pipeThrough(new He(un.chunkSize)).pipeThrough(new Ge(sn,dn),{signal:mn}),writable:ln,options:Object.assign({},cn),scripts:pn,transferStreams:fn,terminate:()=>new Promise((bn=>{const{worker:vn,busy:yn}=on;vn?(yn?on.resolveTerminated=bn:(vn.terminate(),bn()),on.interface=null):bn()})),onTaskFinished(){const{resolveTerminated:bn}=on;bn&&(on.resolveTerminated=null,on.terminated=!0,on.worker.terminate(),bn()),on.busy=!1,gn(on)}}),(hn&&Ke?Xe:Qe)(on,un)}}class Ge extends TransformStream{constructor(on,{onstart:sn,onprogress:ln,size:cn,onend:un}){let dn=0;super({async start(){sn&&await Je(sn,cn)},async transform(hn,fn){dn+=hn.length,ln&&await Je(ln,dn,cn),fn.enqueue(hn)},async flush(){on.size=dn,un&&await Je(un,dn)}})}}async function Je(an,...on){try{await an(...on)}catch{}}function Qe(an,on){return{run:()=>(async function({options:sn,readable:ln,writable:cn,onTaskFinished:un},dn){try{const hn=new qe(sn,dn);await ln.pipeThrough(hn).pipeTo(cn,{preventClose:!0,preventAbort:!0});const{signature:fn,inputSize:pn,outputSize:gn}=hn;return{signature:fn,inputSize:pn,outputSize:gn}}finally{un()}})(an,on)}}function Xe(an,on){const{baseURL:sn,chunkSize:ln}=on;if(!an.interface){let cn;try{cn=(function(un,dn,hn){const fn={type:"module"};let pn,gn;typeof un==A$1&&(un=un());try{pn=new URL(un,dn)}catch{pn=un}if(Ye)try{gn=new Worker(pn)}catch{Ye=!1,gn=new Worker(pn,fn)}else gn=new Worker(pn,fn);return gn.addEventListener(Pe,(mn=>(async function({data:bn},vn){const{type:yn,value:wn,messageId:kn,result:_n,error:xn}=bn,{reader:En,writer:Tn,resolveResult:Bn,rejectResult:Nn,onTaskFinished:Mn}=vn;try{if(xn){const{message:On,stack:zn,code:Pn,name:An}=xn,Vn=new Error(On);Object.assign(Vn,{stack:zn,code:Pn,name:An}),Ln(Vn)}else{if(yn==Be){const{value:On,done:zn}=await En.read();et$1({type:Ie,value:On,done:zn,messageId:kn},vn)}yn==Ie&&(await Tn.ready,await Tn.write(new Uint8Array(wn)),et$1({type:"ack",messageId:kn},vn)),yn==Ne&&Ln(null,_n)}}catch(On){et$1({type:Ne,messageId:kn},vn),Ln(On)}function Ln(On,zn){On?Nn(On):Bn(zn),Tn&&Tn.releaseLock(),Mn()}})(mn,hn))),gn})(an.scripts[0],sn,an)}catch{return Ke=!1,Qe(an,on)}Object.assign(an,{worker:cn,interface:{run:()=>(async function(un,dn){let hn,fn;const pn=new Promise(((_n,xn)=>{hn=_n,fn=xn}));Object.assign(un,{reader:null,writer:null,resolveResult:hn,rejectResult:fn,result:pn});const{readable:gn,options:mn,scripts:bn}=un,{writable:vn,closed:yn}=(function(_n){let xn;const En=new Promise((Bn=>xn=Bn));return{writable:new WritableStream({async write(Bn){const Nn=_n.getWriter();await Nn.ready,await Nn.write(Bn),Nn.releaseLock()},close(){xn()},abort:Bn=>_n.getWriter().abort(Bn)}),closed:En}})(un.writable),wn=et$1({type:Re,scripts:bn.slice(1),options:mn,config:dn,readable:gn,writable:vn},un);wn||Object.assign(un,{reader:gn.getReader(),writer:vn.getWriter()});const kn=await pn;return wn||await vn.getWriter().close(),await yn,kn})(an,{chunkSize:ln})}})}return an.interface}let Ye=!0,$e=!0;function et$1(an,{worker:on,writer:sn,onTaskFinished:ln,transferStreams:cn}){try{const{value:un,readable:dn,writable:hn}=an,fn=[];if(un&&(un.byteLength<un.buffer.byteLength?an.value=un.buffer.slice(0,un.byteLength):an.value=un.buffer,fn.push(an.value)),cn&&$e?(dn&&fn.push(dn),hn&&fn.push(hn)):an.readable=an.writable=null,fn.length)try{return on.postMessage(an,fn),!0}catch{$e=!1,an.readable=an.writable=null,on.postMessage(an)}else on.postMessage(an)}catch(un){throw sn&&sn.releaseLock(),ln(),un}}let tt=[];const nt=[];let it=0;async function rt(an,on){const{options:sn,config:ln}=on,{transferStreams:cn,useWebWorkers:un,useCompressionStream:dn,codecType:hn,compressed:fn,signed:pn,encrypted:gn}=sn,{workerScripts:mn,maxWorkers:bn}=ln;on.transferStreams=cn||cn===S;const vn=!(fn||pn||gn||on.transferStreams);return on.useWebWorkers=!vn&&(un||un===S&&ln.useWebWorkers),on.scripts=on.useWebWorkers&&mn?mn[hn]:[],sn.useCompressionStream=dn||dn===S&&ln.useCompressionStream,(await(async function(){const wn=tt.find((kn=>!kn.busy));if(wn)return at(wn),new Ze(wn,an,on,yn);if(tt.length<bn){const kn={indexWorker:it};return it++,tt.push(kn),new Ze(kn,an,on,yn)}return new Promise((kn=>nt.push({resolve:kn,stream:an,workerOptions:on})))})()).run();function yn(wn){if(nt.length){const[{resolve:kn,stream:_n,workerOptions:xn}]=nt.splice(0,1);kn(new Ze(wn,_n,xn,yn))}else wn.worker?(at(wn),(function(kn,_n){const{config:xn}=_n,{terminateWorkerTimeout:En}=xn;Number.isFinite(En)&&En>=0&&(kn.terminated?kn.terminated=!1:kn.terminateTimeout=setTimeout((async()=>{tt=tt.filter((Tn=>Tn!=kn));try{await kn.terminate()}catch{}}),En))})(wn,on)):tt=tt.filter((kn=>kn!=wn))}}function at(an){const{terminateTimeout:on}=an;on&&(clearTimeout(on),an.terminateTimeout=null)}const st=65536,ot="writable";class lt{constructor(){this.size=0}init(){this.initialized=!0}}class ct extends lt{get readable(){const on=this,{chunkSize:sn=st}=on,ln=new ReadableStream({start(){this.chunkOffset=0},async pull(cn){const{offset:un=0,size:dn,diskNumberStart:hn}=ln,{chunkOffset:fn}=this,pn=dn===S?sn:Math.min(sn,dn-fn),gn=await pt(on,un+fn,pn,hn);cn.enqueue(gn),fn+sn>dn||dn===S&&!gn.length&&pn?cn.close():this.chunkOffset+=sn}});return ln}}class ut extends ct{constructor(on){super(),Object.assign(this,{blob:on,size:on.size})}async readUint8Array(on,sn){const ln=this,cn=on+sn;let dn=await(on||cn<ln.size?ln.blob.slice(on,cn):ln.blob).arrayBuffer();return dn.byteLength>sn&&(dn=dn.slice(on,cn)),new Uint8Array(dn)}}class dt extends lt{constructor(on){super();const sn=new TransformStream,ln=[];on&&ln.push(["Content-Type",on]),Object.defineProperty(this,ot,{get:()=>sn.writable}),this.blob=new Response(sn.readable,{headers:ln}).blob()}getData(){return this.blob}}class ft extends dt{constructor(on){super(on),Object.assign(this,{encoding:on,utf8:!on||on.toLowerCase()=="utf-8"})}async getData(){const{encoding:on,utf8:sn}=this,ln=await super.getData();if(ln.text&&sn)return ln.text();{const cn=new FileReader;return new Promise(((un,dn)=>{Object.assign(cn,{onload:({target:hn})=>un(hn.result),onerror:()=>dn(cn.error)}),cn.readAsText(ln,on)}))}}}class ht extends ct{constructor(on){super(),this.readers=on}async init(){const on=this,{readers:sn}=on;on.lastDiskNumber=0,on.lastDiskOffset=0,await Promise.all(sn.map((async(ln,cn)=>{await ln.init(),cn!=sn.length-1&&(on.lastDiskOffset+=ln.size),on.size+=ln.size}))),super.init()}async readUint8Array(on,sn,ln=0){const cn=this,{readers:un}=this;let dn,hn=ln;hn==-1&&(hn=un.length-1);let fn=on;for(;fn>=un[hn].size;)fn-=un[hn].size,hn++;const pn=un[hn],gn=pn.size;if(fn+sn<=gn)dn=await pt(pn,fn,sn);else{const mn=gn-fn;dn=new Uint8Array(sn),dn.set(await pt(pn,fn,mn)),dn.set(await cn.readUint8Array(on+mn,sn-mn,ln),mn)}return cn.lastDiskNumber=Math.max(hn,cn.lastDiskNumber),dn}}class _t extends lt{constructor(on,sn=4294967295){super();const ln=this;let cn,un,dn;Object.assign(ln,{diskNumber:0,diskOffset:0,size:0,maxSize:sn,availableSize:sn});const hn=new WritableStream({async write(gn){const{availableSize:mn}=ln;if(dn)gn.length>=mn?(await fn(gn.slice(0,mn)),await pn(),ln.diskOffset+=cn.size,ln.diskNumber++,dn=null,await this.write(gn.slice(mn))):await fn(gn);else{const{value:bn,done:vn}=await on.next();if(vn&&!bn)throw new Error("Writer iterator completed too soon");cn=bn,cn.size=0,cn.maxSize&&(ln.maxSize=cn.maxSize),ln.availableSize=ln.maxSize,await wt(cn),un=bn.writable,dn=un.getWriter(),await this.write(gn)}},async close(){await dn.ready,await pn()}});async function fn(gn){const mn=gn.length;mn&&(await dn.ready,await dn.write(gn),cn.size+=mn,ln.size+=mn,ln.availableSize-=mn)}async function pn(){un.size=cn.size,await dn.close()}Object.defineProperty(ln,ot,{get:()=>hn})}}async function wt(an,on){if(!an.init||an.initialized)return Promise.resolve();await an.init(on)}function bt(an){return Array.isArray(an)&&(an=new ht(an)),an instanceof ReadableStream&&(an={readable:an}),an}function pt(an,on,sn,ln){return an.readUint8Array(on,sn,ln)}const mt="\0 !\"#$%&'()*+,-./0123456789:;<=>?@ABCDEFGHIJKLMNOPQRSTUVWXYZ[\\]^_`abcdefghijklmnopqrstuvwxyz{|}~ ".split(""),gt=mt.length==256;function yt(an,on){return on&&on.trim().toLowerCase()=="cp437"?(function(sn){if(gt){let ln="";for(let cn=0;cn<sn.length;cn++)ln+=mt[sn[cn]];return ln}return new TextDecoder().decode(sn)})(an):new TextDecoder(on).decode(an)}const xt="filename",kt="rawFilename",vt="comment",St="rawComment",zt="uncompressedSize",At="compressedSize",Ut="offset",Dt="diskNumberStart",Et="lastModDate",Ft="rawLastModDate",Tt="lastAccessDate",Ot="rawLastAccessDate",Ct="creationDate",Wt="rawCreationDate",jt=[xt,kt,At,zt,Et,Ft,vt,St,Tt,Ct,Ut,Dt,Dt,"internalFileAttribute","internalFileAttributes","externalFileAttribute","externalFileAttributes","msDosCompatible","zip64","encrypted","version","versionMadeBy","zipCrypto","directory","executable","bitFlag","signature","filenameUTF8","commentUTF8","compressionMethod","extraField","rawExtraField","extraFieldZip64","extraFieldUnicodePath","extraFieldUnicodeComment","extraFieldAES","extraFieldNTFS","extraFieldExtendedTimestamp"];class Mt{constructor(on){jt.forEach((sn=>this[sn]=on[sn]))}}const Lt="File format is not recognized",Pt="Zip64 extra field not found",Rt="Compression method not supported",Bt="Split zip file",It="utf-8",Nt="cp437",Vt=[[zt,g$1],[At,g$1],[Ut,g$1],[Dt,y$1]],qt={[y$1]:{getValue:tn,bytes:4},[g$1]:{getValue:nn,bytes:8}};class Ht{constructor(on,sn={}){Object.assign(this,{reader:bt(on),options:sn,config:F})}async*getEntriesGenerator(on={}){const sn=this;let{reader:ln}=sn;const{config:cn}=sn;if(await wt(ln),ln.size!==S&&ln.readUint8Array||(ln=new ut(await new Response(ln.readable).blob()),await wt(ln)),ln.size<v$1)throw new Error(Lt);ln.chunkSize=(function(zn){return Math.max(zn.chunkSize,64)})(cn);const un=await(async function(zn,Pn,An,Vn,Sn){const Rn=new Uint8Array(4);(function(Qn,Yn,tr){Qn.setUint32(Yn,tr,!0)})(rn(Rn),0,Pn);const Hn=Vn+Sn;return await Zn(Vn)||await Zn(Math.min(Hn,An));async function Zn(Qn){const Yn=An-Qn,tr=await pt(zn,Yn,Qn);for(let Un=tr.length-Vn;Un>=0;Un--)if(tr[Un]==Rn[0]&&tr[Un+1]==Rn[1]&&tr[Un+2]==Rn[2]&&tr[Un+3]==Rn[3])return{offset:Yn+Un,buffer:tr.slice(Un,Un+Vn).buffer}}})(ln,101010256,ln.size,v$1,1048560);if(!un)throw tn(rn(await pt(ln,0,4)))==134695760?new Error(Bt):new Error("End of central directory not found");const dn=rn(un);let hn=tn(dn,12),fn=tn(dn,16);const pn=un.offset,gn=en(dn,20),mn=pn+v$1+gn;let bn=en(dn,4);const vn=ln.lastDiskNumber||0;let yn=en(dn,6),wn=en(dn,8),kn=0,_n=0;if(fn==g$1||hn==g$1||wn==y$1||yn==y$1){const zn=rn(await pt(ln,un.offset-20,20));if(tn(zn,0)==117853008){fn=nn(zn,8);let Pn=await pt(ln,fn,56,-1),An=rn(Pn);const Vn=un.offset-20-56;if(tn(An,0)!=k$1&&fn!=Vn){const Sn=fn;fn=Vn,kn=fn-Sn,Pn=await pt(ln,fn,56,-1),An=rn(Pn)}if(tn(An,0)!=k$1)throw new Error("End of Zip64 central directory locator not found");bn==y$1&&(bn=tn(An,16)),yn==y$1&&(yn=tn(An,20)),wn==y$1&&(wn=nn(An,32)),hn==g$1&&(hn=nn(An,40)),fn-=hn}}if(fn>=ln.size&&(kn=ln.size-fn-hn-v$1,fn=ln.size-hn-v$1),vn!=bn)throw new Error(Bt);if(fn<0)throw new Error(Lt);let xn=0,En=await pt(ln,fn,hn,yn),Tn=rn(En);if(hn){const zn=un.offset-hn;if(tn(Tn,xn)!=x$2&&fn!=zn){const Pn=fn;fn=zn,kn+=fn-Pn,En=await pt(ln,fn,hn,yn),Tn=rn(En)}}const Bn=un.offset-fn-(ln.lastDiskOffset||0);if(hn!=Bn&&Bn>=0&&(hn=Bn,En=await pt(ln,fn,hn,yn),Tn=rn(En)),fn<0||fn>=ln.size)throw new Error(Lt);const Nn=Qt(sn,on,"filenameEncoding"),Mn=Qt(sn,on,"commentEncoding");for(let zn=0;zn<wn;zn++){const Pn=new Kt(ln,cn,sn.options);if(tn(Tn,xn)!=x$2)throw new Error("Central directory header not found");Zt(Pn,Tn,xn+6);const An=!!Pn.bitFlag.languageEncodingFlag,Vn=xn+46,Sn=Vn+Pn.filenameLength,Rn=Sn+Pn.extraFieldLength,Hn=en(Tn,xn+4),Zn=!(Hn>>8),Qn=Hn>>8==3,Yn=En.subarray(Vn,Sn),tr=en(Tn,xn+32),Un=Rn+tr,Xn=En.subarray(Rn,Un),or=An,kr=An,wr=tn(Tn,xn+38),Nr=Zn&&!(16&~$t(Tn,xn+38))||Qn&&!(16384&~(wr>>16))||Yn.length&&Yn[Yn.length-1]==47,$r=Qn&&!(73&~(wr>>16)),cr=tn(Tn,xn+42)+kn;Object.assign(Pn,{versionMadeBy:Hn,msDosCompatible:Zn,compressedSize:0,uncompressedSize:0,commentLength:tr,directory:Nr,offset:cr,diskNumberStart:en(Tn,xn+34),internalFileAttributes:en(Tn,xn+36),externalFileAttributes:wr,rawFilename:Yn,filenameUTF8:or,commentUTF8:kr,rawExtraField:En.subarray(Sn,Rn),executable:$r}),Pn.internalFileAttribute=Pn.internalFileAttributes,Pn.externalFileAttribute=Pn.externalFileAttributes;const hr=Qt(sn,on,"decodeText")||yt,gr=or?It:Nn||Nt,Jn=kr?It:Mn||Nt;let Fn=hr(Yn,gr);Fn===S&&(Fn=yt(Yn,gr));let Kn=hr(Xn,Jn);Kn===S&&(Kn=yt(Xn,Jn)),Object.assign(Pn,{rawComment:Xn,filename:Fn,comment:Kn,directory:Nr||Fn.endsWith("/")}),_n=Math.max(cr,_n),Gt(Pn,Pn,Tn,xn+6),Pn.zipCrypto=Pn.encrypted&&!Pn.extraFieldAES;const Cn=new Mt(Pn);Cn.getData=(Gn,Dn)=>Pn.getData(Gn,Cn,Dn),xn=Un;const{onprogress:qn}=on;if(qn)try{await qn(zn+1,wn,new Mt(Pn))}catch{}yield Cn}const Ln=Qt(sn,on,"extractPrependedData"),On=Qt(sn,on,"extractAppendedData");return Ln&&(sn.prependedData=_n>0?await pt(ln,0,_n):new Uint8Array),sn.comment=gn?await pt(ln,pn+v$1,gn):new Uint8Array,On&&(sn.appendedData=mn<ln.size?await pt(ln,mn,ln.size-mn):new Uint8Array),!0}async getEntries(on={}){const sn=[];for await(const ln of this.getEntriesGenerator(on))sn.push(ln);return sn}async close(){}}class Kt{constructor(on,sn,ln){Object.assign(this,{reader:on,config:sn,options:ln})}async getData(on,sn,ln={}){const cn=this,{reader:un,offset:dn,diskNumberStart:hn,extraFieldAES:fn,compressionMethod:pn,config:gn,bitFlag:mn,signature:bn,rawLastModDate:vn,uncompressedSize:yn,compressedSize:wn}=cn,kn=sn.localDirectory={},_n=rn(await pt(un,dn,30,hn));let xn=Qt(cn,ln,"password"),En=Qt(cn,ln,"rawPassword");const Tn=Qt(cn,ln,"passThrough");if(xn=xn&&xn.length&&xn,En=En&&En.length&&En,fn&&fn.originalCompressionMethod!=99)throw new Error(Rt);if(pn!=0&&pn!=8&&!Tn)throw new Error(Rt);if(tn(_n,0)!=67324752)throw new Error("Local file header not found");Zt(kn,_n,4),kn.rawExtraField=kn.extraFieldLength?await pt(un,dn+30+kn.filenameLength,kn.extraFieldLength,hn):new Uint8Array,Gt(cn,kn,_n,4,!0),Object.assign(sn,{lastAccessDate:kn.lastAccessDate,creationDate:kn.creationDate});const Bn=cn.encrypted&&kn.encrypted&&!Tn,Nn=Bn&&!fn;if(Tn||(sn.zipCrypto=Nn),Bn){if(!Nn&&fn.strength===S)throw new Error("Encryption method not supported");if(!xn&&!En)throw new Error("File contains encrypted entry")}const Mn=dn+30+kn.filenameLength+kn.extraFieldLength,Ln=wn,On=un.readable;Object.assign(On,{diskNumberStart:hn,offset:Mn,size:Ln});const zn=Qt(cn,ln,"signal"),Pn=Qt(cn,ln,"checkPasswordOnly");Pn&&(on=new WritableStream),on=(function(Qn){Qn.writable===S&&typeof Qn.next==A$1&&(Qn=new _t(Qn)),Qn instanceof WritableStream&&(Qn={writable:Qn});const{writable:Yn}=Qn;return Yn.size===S&&(Yn.size=0),Qn instanceof _t||Object.assign(Qn,{diskNumber:0,diskOffset:0,availableSize:1/0,maxSize:1/0}),Qn})(on),await wt(on,Tn?wn:yn);const{writable:An}=on,{onstart:Vn,onprogress:Sn,onend:Rn}=ln,Hn={options:{codecType:Ve,password:xn,rawPassword:En,zipCrypto:Nn,encryptionStrength:fn&&fn.strength,signed:Qt(cn,ln,"checkSignature")&&!Tn,passwordVerification:Nn&&(mn.dataDescriptor?vn>>>8&255:bn>>>24&255),signature:bn,compressed:pn!=0&&!Tn,encrypted:cn.encrypted&&!Tn,useWebWorkers:Qt(cn,ln,"useWebWorkers"),useCompressionStream:Qt(cn,ln,"useCompressionStream"),transferStreams:Qt(cn,ln,"transferStreams"),checkPasswordOnly:Pn},config:gn,streamOptions:{signal:zn,size:Ln,onstart:Vn,onprogress:Sn,onend:Rn}};let Zn=0;try{({outputSize:Zn}=await rt({readable:On,writable:An},Hn))}catch(Qn){if(!Pn||Qn.message!=K)throw Qn}finally{const Qn=Qt(cn,ln,"preventClose");An.size+=Zn,Qn||An.locked||await An.getWriter().close()}return Pn?S:on.getData?on.getData():An}}function Zt(an,on,sn){const ln=an.rawBitFlag=en(on,sn+2),cn=!(1&~ln),un=tn(on,sn+6);Object.assign(an,{encrypted:cn,version:en(on,sn),bitFlag:{level:(6&ln)>>1,dataDescriptor:!(8&~ln),languageEncodingFlag:!(2048&~ln)},rawLastModDate:un,lastModDate:Xt(un),filenameLength:en(on,sn+22),extraFieldLength:en(on,sn+24)})}function Gt(an,on,sn,ln,cn){const{rawExtraField:un}=on,dn=on.extraField=new Map,hn=rn(new Uint8Array(un));let fn=0;try{for(;fn<un.length;){const _n=en(hn,fn),xn=en(hn,fn+2);dn.set(_n,{type:_n,data:un.slice(fn+4,fn+4+xn)}),fn+=4+xn}}catch{}const pn=en(sn,ln+4);Object.assign(on,{signature:tn(sn,ln+10),uncompressedSize:tn(sn,ln+18),compressedSize:tn(sn,ln+14)});const gn=dn.get(1);gn&&((function(_n,xn){xn.zip64=!0;const En=rn(_n.data),Tn=Vt.filter((([Bn,Nn])=>xn[Bn]==Nn));for(let Bn=0,Nn=0;Bn<Tn.length;Bn++){const[Mn,Ln]=Tn[Bn];if(xn[Mn]==Ln){const On=qt[Ln];xn[Mn]=_n[Mn]=On.getValue(En,Nn),Nn+=On.bytes}else if(_n[Mn])throw new Error(Pt)}})(gn,on),on.extraFieldZip64=gn);const mn=dn.get(28789);mn&&(Jt(mn,xt,kt,on,an),on.extraFieldUnicodePath=mn);const bn=dn.get(25461);bn&&(Jt(bn,vt,St,on,an),on.extraFieldUnicodeComment=bn);const vn=dn.get(39169);vn?((function(_n,xn,En){const Tn=rn(_n.data),Bn=$t(Tn,4);Object.assign(_n,{vendorVersion:$t(Tn,0),vendorId:$t(Tn,2),strength:Bn,originalCompressionMethod:En,compressionMethod:en(Tn,5)}),xn.compressionMethod=_n.compressionMethod})(vn,on,pn),on.extraFieldAES=vn):on.compressionMethod=pn;const yn=dn.get(10);yn&&((function(_n,xn){const En=rn(_n.data);let Tn,Bn=4;try{for(;Bn<_n.data.length&&!Tn;){const Nn=en(En,Bn),Mn=en(En,Bn+2);Nn==1&&(Tn=_n.data.slice(Bn+4,Bn+4+Mn)),Bn+=4+Mn}}catch{}try{if(Tn&&Tn.length==24){const Nn=rn(Tn),Mn=Nn.getBigUint64(0,!0),Ln=Nn.getBigUint64(8,!0),On=Nn.getBigUint64(16,!0);Object.assign(_n,{rawLastModDate:Mn,rawLastAccessDate:Ln,rawCreationDate:On});const zn=Yt(Mn),Pn=Yt(Ln),An={lastModDate:zn,lastAccessDate:Pn,creationDate:Yt(On)};Object.assign(_n,An),Object.assign(xn,An)}}catch{}})(yn,on),on.extraFieldNTFS=yn);const wn=dn.get(21589);wn&&((function(_n,xn,En){const Tn=rn(_n.data),Bn=$t(Tn,0),Nn=[],Mn=[];En?(1&~Bn||(Nn.push(Et),Mn.push(Ft)),2&~Bn||(Nn.push(Tt),Mn.push(Ot)),4&~Bn||(Nn.push(Ct),Mn.push(Wt))):_n.data.length>=5&&(Nn.push(Et),Mn.push(Ft));let Ln=1;Nn.forEach(((On,zn)=>{if(_n.data.length>=Ln+4){const Pn=tn(Tn,Ln);xn[On]=_n[On]=new Date(1e3*Pn);const An=Mn[zn];_n[An]=Pn}Ln+=4}))})(wn,on,cn),on.extraFieldExtendedTimestamp=wn);const kn=dn.get(6534);kn&&(on.extraFieldUSDZ=kn)}function Jt(an,on,sn,ln,cn){const un=rn(an.data),dn=new W;dn.append(cn[sn]);const hn=rn(new Uint8Array(4));hn.setUint32(0,dn.get(),!0);const fn=tn(un,1);Object.assign(an,{version:$t(un,0),[on]:yt(an.data.subarray(5)),valid:!cn.bitFlag.languageEncodingFlag&&fn==tn(hn,0)}),an.valid&&(ln[on]=an[on],ln[on+"UTF8"]=!0)}function Qt(an,on,sn){return on[sn]===S?an.options[sn]:on[sn]}function Xt(an){const on=(4294901760&an)>>16,sn=65535&an;try{return new Date(1980+((65024&on)>>9),((480&on)>>5)-1,31&on,(63488&sn)>>11,(2016&sn)>>5,2*(31&sn),0)}catch{}}function Yt(an){return new Date(Number(an/BigInt(1e4)-BigInt(116444736e5)))}function $t(an,on){return an.getUint8(on)}function en(an,on){return an.getUint16(on,!0)}function tn(an,on){return an.getUint32(on,!0)}function nn(an,on){return Number(an.getBigUint64(on,!0))}function rn(an){return new DataView(an.buffer)}T$1({Inflate:function(an){const on=new m$1,sn=an&&an.chunkSize?Math.floor(2*an.chunkSize):131072,ln=new Uint8Array(sn);let cn=!1;on.inflateInit(),on.next_out=ln,this.append=function(un,dn){const hn=[];let fn,pn,gn=0,mn=0,bn=0;if(un.length!==0){on.next_in_index=0,on.next_in=un,on.avail_in=un.length;do{if(on.next_out_index=0,on.avail_out=sn,on.avail_in!==0||cn||(on.next_in_index=0,cn=!0),fn=on.inflate(0),cn&&fn===n$1){if(on.avail_in!==0)throw new Error("inflating: bad input")}else if(fn!==0&&fn!==1)throw new Error("inflating: "+on.msg);if((cn||fn===1)&&on.avail_in===un.length)throw new Error("inflating: bad input");on.next_out_index&&(on.next_out_index===sn?hn.push(new Uint8Array(ln)):hn.push(ln.subarray(0,on.next_out_index))),bn+=on.next_out_index,dn&&on.next_in_index>0&&on.next_in_index!=gn&&(dn(on.next_in_index),gn=on.next_in_index)}while(on.avail_in>0||on.avail_out===0);return hn.length>1?(pn=new Uint8Array(bn),hn.forEach((function(vn){pn.set(vn,mn),mn+=vn.length}))):pn=hn[0]?new Uint8Array(hn[0]):new Uint8Array,pn}},this.flush=function(){on.inflateEnd()}}});const zip=Object.freeze(Object.defineProperty({__proto__:null,BlobReader:ut,BlobWriter:dt,TextWriter:ft,ZipReader:Ht,configure:T$1},Symbol.toStringTag,{value:"Module"})),NS$2={CONTAINER:"urn:oasis:names:tc:opendocument:xmlns:container",XHTML:"http://www.w3.org/1999/xhtml",OPF:"http://www.idpf.org/2007/opf",EPUB:"http://www.idpf.org/2007/ops",DC:"http://purl.org/dc/elements/1.1/",ENC:"http://www.w3.org/2001/04/xmlenc#",NCX:"http://www.daisy.org/z3986/2005/ncx/",XLINK:"http://www.w3.org/1999/xlink",SMIL:"http://www.w3.org/ns/SMIL"},MIME$2={XML:"application/xml",NCX:"application/x-dtbncx+xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml",JS:/\/(x-)?(javascript|ecmascript)/},PREFIX={a11y:"http://www.idpf.org/epub/vocab/package/a11y/#",dcterms:"http://purl.org/dc/terms/",marc:"http://id.loc.gov/vocabulary/",media:"http://www.idpf.org/epub/vocab/overlays/#",onix:"http://www.editeur.org/ONIX/book/codelists/current.html#",rendition:"http://www.idpf.org/vocab/rendition/#",schema:"http://schema.org/",xsd:"http://www.w3.org/2001/XMLSchema#",msv:"http://www.idpf.org/epub/vocab/structure/magazine/#",prism:"http://www.prismstandard.org/specifications/3.0/PRISM_CV_Spec_3.0.htm#"},RELATORS={art:"artist",aut:"author",clr:"colorist",edt:"editor",ill:"illustrator",nrt:"narrator",trl:"translator",pbl:"publisher"},ONIX5={"02":"isbn","06":"doi",15:"isbn",26:"doi",34:"issn"},camel=an=>an.toLowerCase().replace(/[-:](.)/g,(on,sn)=>sn.toUpperCase()),normalizeWhitespace$2=an=>an?an.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"",filterAttribute=(an,on,sn)=>sn?ln=>{var cn,un;return(un=(cn=ln.getAttribute(an))==null?void 0:cn.split(/\s/))==null?void 0:un.includes(on)}:typeof on=="function"?ln=>on(ln.getAttribute(an)):ln=>ln.getAttribute(an)===on,getAttributes=(...an)=>on=>on?Object.fromEntries(an.map(sn=>[camel(sn),on.getAttribute(sn)])):null,getElementText$1=an=>normalizeWhitespace$2(an==null?void 0:an.textContent),childGetter=(an,on)=>{const sn=an.lookupNamespaceURI(null)===on||an.lookupPrefix(on),ln=sn?(cn,un)=>dn=>dn.namespaceURI===on&&dn.localName===un:(cn,un)=>dn=>dn.localName===un;return{$:(cn,un)=>[...cn.children].find(ln(cn,un)),$$:(cn,un)=>[...cn.children].filter(ln(cn,un)),$$$:sn?(cn,un)=>[...cn.getElementsByTagNameNS(on,un)]:(cn,un)=>[...cn.getElementsByTagName(un)]}},resolveURL=(an,on)=>{try{if(an=an.replace(/%2c/,","),on.includes(":")&&!on.startsWith("OEBPS"))return new URL(an,on);const sn="https://invalid.invalid/",ln=new URL(an,sn+on);return ln.search="",decodeURI(ln.href.replace(sn,""))}catch(sn){return console.warn(sn),an}},isExternal=an=>/^(?!blob)\w+:/i.test(an),pathRelative=(an,on)=>{if(!an)return on;const sn=an.replace(/\/$/,"").split("/"),ln=on.replace(/\/$/,"").split("/"),cn=(sn.length>ln.length?sn:ln).findIndex((un,dn)=>sn[dn]!==ln[dn]);return cn<0?"":Array(sn.length-cn).fill("..").concat(ln.slice(cn)).join("/")},pathDirname=an=>an.slice(0,an.lastIndexOf("/")+1),replaceSeries$1=async(an,on,sn)=>{const ln=[];an.replace(on,(...un)=>(ln.push(un),null));const cn=[];for(const un of ln)cn.push(await sn(...un));return an.replace(on,()=>cn.shift())},regexEscape=an=>an.replace(/[-/\\^$*+?.()|[\]{}]/g,"\\$&"),tidy=an=>{for(const[sn,ln]of Object.entries(an))ln==null?delete an[sn]:Array.isArray(ln)?(an[sn]=ln.filter(cn=>cn).map(cn=>typeof cn=="object"&&!Array.isArray(cn)?tidy(cn):cn),an[sn].length?an[sn].length===1&&(an[sn]=an[sn][0]):delete an[sn]):typeof ln=="object"&&(an[sn]=tidy(ln),Object.keys(ln).length||delete an[sn]);const on=Object.keys(an);return on.length===1&&on[0]==="name"?an[on[0]]:an},getPrefixes=an=>{const on=new Map(Object.entries(PREFIX)),sn=an.documentElement.getAttributeNS(NS$2.EPUB,"prefix")||an.documentElement.getAttribute("prefix");if(sn)for(const[,ln,cn]of sn.matchAll(/(.+): +(.+)[ \t\r\n]*/g))on.set(ln,cn);return on},getPropertyURL=(an,on)=>{if(!an)return null;const[sn,ln]=an.split(":"),cn=ln?sn:null,un=ln||sn,dn=on.get(cn);return dn?dn+un:null},getMetadata$1=an=>{var Ln,On,zn,Pn,An,Vn,Sn,Rn,Hn,Zn,Qn,Yn,tr,Un,Xn,or,kr,wr,Nr,$r,cr,hr,gr;const{$:on}=childGetter(an,NS$2.OPF),sn=on(an.documentElement,"metadata"),ln=Object.groupBy(sn.children,Jn=>Jn.namespaceURI===NS$2.DC?"dc":Jn.namespaceURI===NS$2.OPF&&Jn.localName==="meta"?Jn.hasAttribute("name")?"legacyMeta":"meta":""),cn=sn.getAttribute("xml:lang")??an.documentElement.getAttribute("xml:lang")??"und",un=getPrefixes(an),dn=Jn=>{const Fn=Jn.getAttribute("property"),Kn=Jn.getAttribute("scheme");return{property:getPropertyURL(Fn,un)??Fn,scheme:getPropertyURL(Kn,un)??Kn,lang:Jn.getAttribute("xml:lang"),value:getElementText$1(Jn),props:fn(Jn),attrs:Object.fromEntries(Array.from(Jn.attributes).filter(Cn=>Cn.namespaceURI===NS$2.OPF).map(Cn=>[Cn.localName,Cn.value]))}},hn=Map.groupBy(ln.meta??[],Jn=>Jn.getAttribute("refines")),fn=Jn=>{const Fn=hn.get(Jn?"#"+Jn.getAttribute("id"):null);return Fn?Object.groupBy(Fn.map(dn),Kn=>Kn.property):null},pn=Object.fromEntries(Object.entries(Object.groupBy(ln.dc||[],Jn=>Jn.localName)).map(([Jn,Fn])=>[Jn,Fn.map(dn)])),gn=fn()??{},mn=Object.fromEntries(((Ln=ln.legacyMeta)==null?void 0:Ln.map(Jn=>[Jn.getAttribute("name"),Jn.getAttribute("content")]))??[]),bn=Jn=>{var Fn;return(Fn=Jn==null?void 0:Jn[0])==null?void 0:Fn.value},vn=(Jn,Fn)=>{var Kn;return bn((Kn=Jn==null?void 0:Jn.props)==null?void 0:Kn[Fn])},yn=Jn=>{var qn,Gn;if(!Jn)return null;const Fn=((qn=Jn.props)==null?void 0:qn["alternate-script"])??[],Kn=Jn.attrs["alt-rep"];if(!Fn.length&&(!Jn.lang||Jn.lang===cn)&&!Kn)return Jn.value;const Cn={[Jn.lang??cn]:Jn.value};Kn&&(Cn[Jn.attrs["alt-rep-lang"]]=Kn);for(const Dn of Fn)Cn[Gn=Dn.lang]??(Cn[Gn]=Dn.value);return Cn},wn=Jn=>{var Fn,Kn,Cn,qn,Gn;return Jn?{name:yn(Jn),sortAs:yn((Kn=(Fn=Jn.props)==null?void 0:Fn["file-as"])==null?void 0:Kn[0])??Jn.attrs["file-as"],role:((Gn=(qn=(Cn=Jn.props)==null?void 0:Cn.role)==null?void 0:qn.filter(Dn=>Dn.scheme===PREFIX.marc+"relators"))==null?void 0:Gn.map(Dn=>Dn.value))??[Jn.attrs.role],code:vn(Jn,"term")??Jn.attrs.term,scheme:vn(Jn,"authority")??Jn.attrs.authority}:null},kn=Jn=>{var Fn;return{name:yn(Jn),position:bn((Fn=Jn.props)==null?void 0:Fn["group-position"])}},_n=Jn=>{var Cn;const{value:Fn}=Jn;if(/^urn:/i.test(Fn))return Fn;if(/^doi:/i.test(Fn))return`urn:${Fn}`;const Kn=(Cn=Jn.props)==null?void 0:Cn["identifier-type"];if(!Kn){const qn=Jn.attrs.scheme;return qn?/^(doi|isbn|uuid)$/i.test(qn)?`urn:${qn}:${Fn}`:{scheme:qn,value:Fn}:Fn}if(Kn.scheme===PREFIX.onix+"codelist5"){const qn=ONIX5[Kn.value];if(qn)return`urn:${qn}:${Fn}`}return Fn},xn=Object.groupBy(gn["belongs-to-collection"]??[],Jn=>vn(Jn,"collection-type")==="series"?"series":"collection"),En=((On=pn.title)==null?void 0:On.find(Jn=>vn(Jn,"title-type")==="main"))??((zn=pn.title)==null?void 0:zn[0]),Tn={identifier:getIdentifier(an),title:yn(En),sortAs:yn((An=(Pn=En==null?void 0:En.props)==null?void 0:Pn["file-as"])==null?void 0:An[0])??((Vn=En==null?void 0:En.attrs)==null?void 0:Vn["file-as"])??(mn==null?void 0:mn["calibre:title_sort"]),subtitle:(Rn=(Sn=pn.title)==null?void 0:Sn.find(Jn=>vn(Jn,"title-type")==="subtitle"))==null?void 0:Rn.value,language:(Hn=pn.language)==null?void 0:Hn.map(Jn=>Jn.value),description:bn(pn.description),publisher:wn((Zn=pn.publisher)==null?void 0:Zn[0]),published:((Yn=(Qn=pn.date)==null?void 0:Qn.find(Jn=>Jn.attrs.event==="publication"))==null?void 0:Yn.value)??bn(pn.date),modified:bn(gn[PREFIX.dcterms+"modified"])??((Un=(tr=pn.date)==null?void 0:tr.find(Jn=>Jn.attrs.event==="modification"))==null?void 0:Un.value),subject:(Xn=pn.subject)==null?void 0:Xn.map(wn),belongsTo:{collection:(or=xn.collection)==null?void 0:or.map(kn),series:((kr=xn.series)==null?void 0:kr.map(kn))??(mn==null?void 0:mn["calibre:series"])?{name:mn==null?void 0:mn["calibre:series"],position:parseFloat(mn==null?void 0:mn["calibre:series_index"])}:null},altIdentifier:(wr=pn.identifier)==null?void 0:wr.map(_n),source:(Nr=pn.source)==null?void 0:Nr.map(_n),rights:bn(pn.rights)},Bn=Jn=>Fn=>{var Cn;const Kn=new Set((Cn=Fn.role)==null?void 0:Cn.map(qn=>RELATORS[qn]??Jn));return[Kn.size?Kn:[Jn],Fn]};for(const[Jn,Fn]of[].concat(((cr=($r=pn.creator)==null?void 0:$r.map(wn))==null?void 0:cr.map(Bn("author")))??[],((gr=(hr=pn.contributor)==null?void 0:hr.map(wn))==null?void 0:gr.map(Bn("contributor")))??[]))for(const Kn of Jn)Tn[Kn]?Tn[Kn].push(Fn):Tn[Kn]=[Fn];tidy(Tn),Tn.altIdentifier===Tn.identifier&&delete Tn.altIdentifier;const Nn={},Mn={};for(const[Jn,Fn]of Object.entries(gn))Jn.startsWith(PREFIX.rendition)?Nn[camel(Jn.replace(PREFIX.rendition,""))]=bn(Fn):Jn.startsWith(PREFIX.media)&&(Mn[camel(Jn.replace(PREFIX.media,""))]=bn(Fn));return Mn.duration&&(Mn.duration=parseClock(Mn.duration)),{metadata:Tn,rendition:Nn,media:Mn}},parseNav=(an,on=sn=>sn)=>{var yn;const{$:sn,$$:ln,$$$:cn}=childGetter(an,NS$2.XHTML),un=wn=>wn?decodeURI(on(wn)):null,dn=wn=>kn=>{var Nn;const _n=sn(kn,"a")??sn(kn,"span"),xn=sn(kn,"ol"),En=un(_n==null?void 0:_n.getAttribute("href")),Bn={label:getElementText$1(_n)||(_n==null?void 0:_n.getAttribute("title")),href:En,subitems:hn(xn)};return wn&&(Bn.type=(Nn=_n==null?void 0:_n.getAttributeNS(NS$2.EPUB,"type"))==null?void 0:Nn.split(/\s/)),Bn},hn=(wn,kn)=>wn?ln(wn,"li").map(dn(kn)):null,fn=(wn,kn)=>hn(sn(wn,"ol"),kn),pn=cn(an,"nav");let gn=null,mn=null,bn=null,vn=[];for(const wn of pn){const kn=((yn=wn.getAttributeNS(NS$2.EPUB,"type"))==null?void 0:yn.split(/\s/))??[];kn.includes("toc")?gn??(gn=fn(wn)):kn.includes("page-list")?mn??(mn=fn(wn)):kn.includes("landmarks")?bn??(bn=fn(wn,!0)):vn.push({label:getElementText$1(wn.firstElementChild),type:kn,list:fn(wn)})}return{toc:gn,pageList:mn,landmarks:bn,others:vn}},parseNCX=(an,on=sn=>sn)=>{const{$:sn,$$:ln}=childGetter(an,NS$2.NCX),cn=fn=>fn?decodeURI(on(fn)):null,un=fn=>{const pn=sn(fn,"navLabel"),gn=sn(fn,"content"),mn=getElementText$1(pn),bn=cn(gn.getAttribute("src"));if(fn.localName==="navPoint"){const vn=ln(fn,"navPoint");return{label:mn,href:bn,subitems:vn.length?vn.map(un):null}}return{label:mn,href:bn}},dn=(fn,pn)=>ln(fn,pn).map(un),hn=(fn,pn)=>{const gn=sn(an.documentElement,fn);return gn?dn(gn,pn):null};return{toc:hn("navMap","navPoint"),pageList:hn("pageList","pageTarget"),others:ln(an.documentElement,"navList").map(fn=>({label:getElementText$1(sn(fn,"navLabel")),list:dn(fn,"navTarget")}))}},parseClock=an=>{if(!an)return;const on=an.split(":").map(dn=>parseFloat(dn));if(on.length===3){const[dn,hn,fn]=on;return dn*60*60+hn*60+fn}if(on.length===2){const[dn,hn]=on;return dn*60+hn}const[sn,ln]=an.split(/(?=[^\d.])/);return parseFloat(sn)*(ln==="h"?3600:ln==="min"?60:ln==="ms"?.001:1)};var cs,Fi,Is,ko,co,no,Vi,Li,us,Ir,gl,ma,$s,Bs,ya,ba,As,Pa;class MediaOverlay extends EventTarget{constructor(sn,ln){super();pr(this,Ir);pr(this,cs);pr(this,Fi);pr(this,Is);pr(this,ko);pr(this,co);pr(this,no);pr(this,Vi,1);pr(this,Li,1);pr(this,us);this.book=sn,this.loadXML=ln}async start(sn,ln=()=>!0){var hn;(hn=$n(this,no))==null||hn.pause();const cn=this.book.sections[sn],un=cn==null?void 0:cn.id;if(!un)return;const{mediaOverlay:dn}=cn;if(!dn)return this.start(sn+1);yr(this,Is,sn),await dr(this,Ir,gl).call(this,dn);for(let fn=0;fn<$n(this,cs).length;fn++){const{items:pn}=$n(this,cs)[fn];for(let gn=0;gn<pn.length;gn++)if(pn[gn].text.split("#")[0]===un&&ln(pn[gn],gn,pn))return dr(this,Ir,As).call(this,fn,gn).catch(mn=>dr(this,Ir,Bs).call(this,mn))}}pause(){var sn;yr(this,us,"paused"),(sn=$n(this,no))==null||sn.pause()}resume(){var sn;yr(this,us,"playing"),(sn=$n(this,no))==null||sn.play().catch(ln=>dr(this,Ir,Bs).call(this,ln))}stop(){yr(this,us,"stopped"),dr(this,Ir,Pa).call(this)}prev(){$n(this,co)>0?dr(this,Ir,As).call(this,$n(this,ko),$n(this,co)-1):$n(this,ko)>0?dr(this,Ir,As).call(this,$n(this,ko)-1,$n(this,cs)[$n(this,ko)-1].items.length-1):$n(this,Is)>0&&this.start($n(this,Is)-1,(sn,ln,cn)=>ln===cn.length-1)}next(){dr(this,Ir,As).call(this,$n(this,ko),$n(this,co)+1)}setVolume(sn){yr(this,Vi,sn),$n(this,no)&&($n(this,no).volume=sn)}setRate(sn){yr(this,Li,sn),$n(this,no)&&($n(this,no).playbackRate=sn)}}cs=new WeakMap,Fi=new WeakMap,Is=new WeakMap,ko=new WeakMap,co=new WeakMap,no=new WeakMap,Vi=new WeakMap,Li=new WeakMap,us=new WeakMap,Ir=new WeakSet,gl=async function(sn){if($n(this,Fi)===sn)return;const ln=await this.loadXML(sn.href),cn=hn=>hn?resolveURL(hn,sn.href):null,{$:un,$$$:dn}=childGetter(ln,NS$2.SMIL);yr(this,ko,-1),yr(this,co,-1),yr(this,cs,dn(ln,"par").reduce((hn,fn)=>{var wn;const pn=cn((wn=un(fn,"text"))==null?void 0:wn.getAttribute("src")),gn=un(fn,"audio");if(!pn||!gn)return hn;const mn=cn(gn.getAttribute("src")),bn=parseClock(gn.getAttribute("clipBegin")),vn=parseClock(gn.getAttribute("clipEnd")),yn=hn.at(-1);return(yn==null?void 0:yn.src)===mn?yn.items.push({text:pn,begin:bn,end:vn}):hn.push({src:mn,items:[{text:pn,begin:bn,end:vn}]}),hn},[])),yr(this,Fi,sn)},ma=function(){return $n(this,cs)[$n(this,ko)]},$s=function(){var sn,ln;return(ln=(sn=$n(this,Ir,ma))==null?void 0:sn.items)==null?void 0:ln[$n(this,co)]},Bs=function(sn){console.error(sn),this.dispatchEvent(new CustomEvent("error",{detail:sn}))},ya=function(){this.dispatchEvent(new CustomEvent("highlight",{detail:$n(this,Ir,$s)}))},ba=function(){this.dispatchEvent(new CustomEvent("unhighlight",{detail:$n(this,Ir,$s)}))},As=async function(sn,ln){var hn;dr(this,Ir,Pa).call(this),yr(this,ko,sn),yr(this,co,ln);const cn=(hn=$n(this,Ir,ma))==null?void 0:hn.src;if(!cn||!$n(this,Ir,$s))return this.start($n(this,Is)+1);const un=URL.createObjectURL(await this.book.loadBlob(cn)),dn=new Audio(un);yr(this,no,dn),dn.volume=$n(this,Vi),dn.playbackRate=$n(this,Li),dn.addEventListener("timeupdate",()=>{var mn,bn;if(dn.paused)return;const fn=dn.currentTime,{items:pn}=$n(this,Ir,ma);if(fn>((mn=$n(this,Ir,$s))==null?void 0:mn.end)&&(dr(this,Ir,ba).call(this),$n(this,co)===pn.length-1)){dr(this,Ir,As).call(this,$n(this,ko)+1,0).catch(vn=>dr(this,Ir,Bs).call(this,vn));return}const gn=$n(this,co);for(;((bn=pn[$n(this,co)+1])==null?void 0:bn.begin)<=fn;)Ii(this,co)._++;$n(this,co)!==gn&&dr(this,Ir,ya).call(this)}),dn.addEventListener("error",()=>dr(this,Ir,Bs).call(this,new Error(`Failed to load ${cn}`))),dn.addEventListener("playing",()=>dr(this,Ir,ya).call(this)),dn.addEventListener("ended",()=>{dr(this,Ir,ba).call(this),URL.revokeObjectURL(un),yr(this,no,null),dr(this,Ir,As).call(this,sn+1,0).catch(fn=>dr(this,Ir,Bs).call(this,fn))}),$n(this,us)==="paused"?(dr(this,Ir,ya).call(this),dn.currentTime=$n(this,Ir,$s).begin??0):dn.addEventListener("canplaythrough",()=>{dn.currentTime=$n(this,Ir,$s).begin??0,yr(this,us,"playing"),dn.play().catch(fn=>dr(this,Ir,Bs).call(this,fn))},{once:!0})},Pa=function(){$n(this,no)&&($n(this,no).pause(),URL.revokeObjectURL($n(this,no).src),yr(this,no,null),dr(this,Ir,ba).call(this))};const isUUID=/([0-9a-f]{8})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{4})-([0-9a-f]{12})/,getUUID=an=>{for(const on of an.getElementsByTagNameNS(NS$2.DC,"identifier")){const[sn]=getElementText$1(on).split(":").slice(-1);if(isUUID.test(sn))return sn}return""},getIdentifier=an=>getElementText$1(an.getElementById(an.documentElement.getAttribute("unique-identifier"))??an.getElementsByTagNameNS(NS$2.DC,"identifier")[0]),deobfuscate=async(an,on,sn)=>{const ln=new Uint8Array(await sn.slice(0,on).arrayBuffer());on=Math.min(on,ln.length);for(var cn=0;cn<on;cn++)ln[cn]=ln[cn]^an[cn%an.length];return new Blob([ln,sn.slice(on)],{type:sn.type})},WebCryptoSHA1=async an=>{const on=new TextEncoder().encode(an),sn=await globalThis.crypto.subtle.digest("SHA-1",on);return new Uint8Array(sn)},deobfuscators=(an=WebCryptoSHA1)=>({"http://www.idpf.org/2008/embedding":{key:on=>an(getIdentifier(on).replaceAll(/[\u0020\u0009\u000d\u000a]/g,"")),decode:(on,sn)=>deobfuscate(on,1040,sn)},"http://ns.adobe.com/pdf/enc#RC":{key:on=>{const sn=getUUID(on).replaceAll("-","");return Uint8Array.from({length:16},(ln,cn)=>parseInt(sn.slice(cn*2,cn*2+2),16))},decode:(on,sn)=>deobfuscate(on,1024,sn)}});var zi,oi,ji;class Encryption{constructor(on){pr(this,zi,new Map);pr(this,oi,new Map);pr(this,ji);yr(this,ji,on)}async init(on,sn){if(!on)return;const ln=Array.from(on.getElementsByTagNameNS(NS$2.ENC,"EncryptedData"),cn=>{var un,dn;return{algorithm:(un=cn.getElementsByTagNameNS(NS$2.ENC,"EncryptionMethod")[0])==null?void 0:un.getAttribute("Algorithm"),uri:(dn=cn.getElementsByTagNameNS(NS$2.ENC,"CipherReference")[0])==null?void 0:dn.getAttribute("URI")}});for(const{algorithm:cn,uri:un}of ln){if(!$n(this,oi).has(cn)){const dn=$n(this,ji)[cn];if(!dn){console.warn("Unknown encryption algorithm");continue}const hn=await dn.key(sn);$n(this,oi).set(cn,fn=>dn.decode(hn,fn))}$n(this,zi).set(un,cn)}}getDecoder(on){return $n(this,oi).get($n(this,zi).get(on))??(sn=>sn)}}zi=new WeakMap,oi=new WeakMap,ji=new WeakMap;class Resources{constructor({opf:on,resolveHref:sn}){var gn,mn,bn,vn,yn;this.opf=on;const{$:ln,$$:cn,$$$:un}=childGetter(on,NS$2.OPF),dn=ln(on.documentElement,"manifest"),hn=ln(on.documentElement,"spine"),fn=cn(hn,"itemref");this.manifest=cn(dn,"item").map(getAttributes("href","id","media-type","properties","media-overlay")).map(wn=>{var kn;return wn.href=sn(wn.href),wn.properties=(kn=wn.properties)==null?void 0:kn.split(/\s/),wn}),this.spine=fn.map(getAttributes("idref","id","linear","properties")).map(wn=>{var kn;return wn.properties=(kn=wn.properties)==null?void 0:kn.split(/\s/),wn}),this.pageProgressionDirection=hn.getAttribute("page-progression-direction"),this.navPath=(gn=this.getItemByProperty("nav"))==null?void 0:gn.href,this.ncxPath=(mn=this.getItemByID(hn.getAttribute("toc"))??this.manifest.find(wn=>wn.mediaType===MIME$2.NCX))==null?void 0:mn.href;const pn=ln(on.documentElement,"guide");pn&&(this.guide=cn(pn,"reference").map(getAttributes("type","title","href")).map(({type:wn,title:kn,href:_n})=>({label:kn,type:wn.split(/\s/),href:sn(_n)}))),this.cover=this.getItemByProperty("cover-image")??this.getItemByID((bn=un(on,"meta").find(filterAttribute("name","cover")))==null?void 0:bn.getAttribute("content"))??this.manifest.find(wn=>wn.href.includes("cover")&&wn.mediaType.startsWith("image"))??this.getItemByHref((yn=(vn=this.guide)==null?void 0:vn.find(wn=>wn.type.includes("cover")))==null?void 0:yn.href),this.cfis=fromElements(fn)}getItemByID(on){return this.manifest.find(sn=>sn.id===on)}getItemByHref(on){return this.manifest.find(sn=>sn.href===on)}getItemByProperty(on){return this.manifest.find(sn=>{var ln;return(ln=sn.properties)==null?void 0:ln.includes(on)})}resolveCFI(on){const sn=parse(on),ln=(sn.parent??sn).shift();let cn=toElement(this.opf,ln);cn&&cn.nodeName!=="idref"&&(ln.at(-1).id=null,cn=toElement(this.opf,ln));const un=cn==null?void 0:cn.getAttribute("idref");return{index:this.spine.findIndex(fn=>fn.idref===un),anchor:fn=>toRange(fn,sn)}}}var Zo,Qo,Vo;class Loader{constructor({loadText:on,loadBlob:sn,resources:ln}){pr(this,Zo,new Map);pr(this,Qo,new Map);pr(this,Vo,new Map);ir(this,"allowScript",!1);ir(this,"eventTarget",new EventTarget);this.loadText=on,this.loadBlob=sn,this.manifest=ln.manifest,this.assets=ln.manifest}async createURL(on,sn,ln,cn){if(!sn)return"";const un={data:sn,type:ln};Object.defineProperty(un,"name",{value:on});const dn=new CustomEvent("data",{detail:un});this.eventTarget.dispatchEvent(dn);const hn=await dn.detail.data,fn=await dn.detail.type,pn=URL.createObjectURL(new Blob([hn],{type:fn}));if($n(this,Zo).set(on,pn),$n(this,Vo).set(on,1),cn){const gn=$n(this,Qo).get(cn);gn?gn.push(on):$n(this,Qo).set(cn,[on])}return pn}ref(on,sn){const ln=$n(this,Qo).get(sn);return ln!=null&&ln.includes(on)||($n(this,Vo).set(on,$n(this,Vo).get(on)+1),ln?ln.push(on):$n(this,Qo).set(sn,[on])),$n(this,Zo).get(on)}unref(on){if(!$n(this,Vo).has(on))return;const sn=$n(this,Vo).get(on)-1;if(sn<1){URL.revokeObjectURL($n(this,Zo).get(on)),$n(this,Zo).delete(on),$n(this,Vo).delete(on);const ln=$n(this,Qo).get(on);if(ln)for(;ln.length;)this.unref(ln.pop());$n(this,Qo).delete(on)}else $n(this,Vo).set(on,sn)}async loadItem(on,sn=[]){if(!on)return null;const{href:ln,mediaType:cn}=on,un=MIME$2.JS.test(on.mediaType);if(un&&!this.allowScript)return null;const dn=sn.at(-1);if($n(this,Zo).has(ln))return this.ref(ln,dn);if((un||[MIME$2.XHTML,MIME$2.HTML,MIME$2.CSS,MIME$2.SVG].includes(cn))&&sn.every(pn=>pn!==ln))return this.loadReplaced(on,sn);const fn=Promise.resolve().then(()=>this.loadBlob(ln));return this.createURL(ln,fn,cn,dn)}async loadHref(on,sn,ln=[]){if(isExternal(on))return on;const cn=resolveURL(on,sn),un=this.manifest.find(dn=>dn.href===cn);return un?this.loadItem(un,ln.concat(sn)):on}async loadReplaced(on,sn=[]){var fn,pn;const{href:ln,mediaType:cn}=on,un=sn.at(-1);let dn="";try{dn=await this.loadText(ln)}catch(gn){return this.createURL(ln,Promise.reject(gn),cn,un)}if(!dn)return null;if([MIME$2.XHTML,MIME$2.HTML,MIME$2.SVG].includes(cn)){let gn=new DOMParser().parseFromString(dn,cn);if(cn===MIME$2.XHTML&&(gn.querySelector("parsererror")||!((fn=gn.documentElement)!=null&&fn.namespaceURI))&&(console.warn(((pn=gn.querySelector("parsererror"))==null?void 0:pn.innerText)??"Invalid XHTML"),on.mediaType=MIME$2.HTML,gn=new DOMParser().parseFromString(dn,on.mediaType)),[MIME$2.XHTML,MIME$2.SVG].includes(on.mediaType)){let vn=gn.firstChild;for(;vn instanceof ProcessingInstruction;){if(vn.data){const yn=await replaceSeries$1(vn.data,/(?:^|\s*)(href\s*=\s*['"])([^'"]*)(['"])/i,(wn,kn,_n,xn)=>this.loadHref(_n,ln,sn).then(En=>`${kn}${En}${xn}`));vn.replaceWith(gn.createProcessingInstruction(vn.target,yn))}vn=vn.nextSibling}}const mn=async(vn,yn)=>vn.setAttribute(yn,await this.loadHref(vn.getAttribute(yn),ln,sn));for(const vn of gn.querySelectorAll("link[href]"))await mn(vn,"href");for(const vn of gn.querySelectorAll("[src]"))await mn(vn,"src");for(const vn of gn.querySelectorAll("[poster]"))await mn(vn,"poster");for(const vn of gn.querySelectorAll("object[data]"))await mn(vn,"data");for(const vn of gn.querySelectorAll("[*|href]:not([href])"))vn.setAttributeNS(NS$2.XLINK,"href",await this.loadHref(vn.getAttributeNS(NS$2.XLINK,"href"),ln,sn));for(const vn of gn.querySelectorAll("style"))vn.textContent&&(vn.textContent=await this.replaceCSS(vn.textContent,ln,sn));for(const vn of gn.querySelectorAll("[style]"))vn.setAttribute("style",await this.replaceCSS(vn.getAttribute("style"),ln,sn));const bn=new XMLSerializer().serializeToString(gn);return this.createURL(ln,bn,on.mediaType,un)}const hn=cn===MIME$2.CSS?await this.replaceCSS(dn,ln,sn):await this.replaceString(dn,ln,sn);return this.createURL(ln,hn,cn,un)}async replaceCSS(on,sn,ln=[]){const cn=await replaceSeries$1(on,/url\(\s*["']?([^'"\n]*?)\s*["']?\s*\)/gi,(un,dn)=>this.loadHref(dn,sn,ln).then(hn=>`url("${hn}")`));return replaceSeries$1(cn,/@import\s*["']([^"'\n]*?)["']/gi,(un,dn)=>this.loadHref(dn,sn,ln).then(hn=>`@import "${hn}"`))}replaceString(on,sn,ln=[]){const cn=new Map,un=this.assets.map(hn=>{if(hn.href===sn)return;const fn=pathRelative(pathDirname(sn),hn.href),pn=encodeURI(fn),gn="/"+hn.href,mn=encodeURI(gn),bn=new Set([fn,pn,gn,mn]);for(const vn of bn)cn.set(vn,hn);return Array.from(bn)}).flat().filter(hn=>hn);if(!un.length)return on;const dn=new RegExp(un.map(regexEscape).join("|"),"g");return replaceSeries$1(on,dn,async hn=>this.loadItem(cn.get(hn.replace(/^\//,"")),ln.concat(sn)))}unloadItem(on){this.unref(on==null?void 0:on.href)}destroy(){for(const on of $n(this,Zo).values())URL.revokeObjectURL(on)}}Zo=new WeakMap,Qo=new WeakMap,Vo=new WeakMap;const getHTMLFragment=(an,on)=>an.getElementById(on)??an.querySelector(`[name="${CSS.escape(on)}"]`),getPageSpread$1=an=>{for(const on of an){if(on==="page-spread-left"||on==="rendition:page-spread-left")return"left";if(on==="page-spread-right"||on==="rendition:page-spread-right")return"right";if(on==="rendition:page-spread-center")return"center"}},getDisplayOptions=an=>an?{fixedLayout:getElementText$1(an.querySelector('option[name="fixed-layout"]')),openToSpread:getElementText$1(an.querySelector('option[name="open-to-spread"]'))}:null;var ds,si,Bo,Jo;class EPUB{constructor({loadText:on,loadBlob:sn,getSize:ln,sha1:cn}){pr(this,Bo);ir(this,"parser",new DOMParser);pr(this,ds);pr(this,si);this.loadText=on,this.loadBlob=sn,this.getSize=ln,yr(this,si,new Encryption(deobfuscators(cn)))}async init(){var bn,vn;const on=await dr(this,Bo,Jo).call(this,"META-INF/container.xml");if(!on)throw new Error("Failed to load container file");const sn=Array.from(on.getElementsByTagNameNS(NS$2.CONTAINER,"rootfile"),getAttributes("full-path","media-type")).filter(yn=>yn.mediaType==="application/oebps-package+xml");if(!sn.length)throw new Error("No package document defined in container");const ln=sn[0].fullPath,cn=await dr(this,Bo,Jo).call(this,ln);if(!cn)throw new Error("Failed to load package document");const un=await dr(this,Bo,Jo).call(this,"META-INF/encryption.xml");await $n(this,si).init(un,cn),this.resources=new Resources({opf:cn,resolveHref:yn=>resolveURL(yn,ln)}),yr(this,ds,new Loader({loadText:this.loadText,loadBlob:yn=>Promise.resolve(this.loadBlob(yn)).then($n(this,si).getDecoder(yn)),resources:this.resources})),this.transformTarget=$n(this,ds).eventTarget,this.sections=this.resources.spine.map((yn,wn)=>{const{idref:kn,linear:_n,properties:xn=[]}=yn,En=this.resources.getItemByID(kn);return En?{id:En.href,load:()=>$n(this,ds).loadItem(En),unload:()=>$n(this,ds).unloadItem(En),createDocument:()=>this.loadDocument(En),size:this.getSize(En.href),cfi:this.resources.cfis[wn],linear:_n,pageSpread:getPageSpread$1(xn),resolveHref:Tn=>resolveURL(Tn,En.href),mediaOverlay:En.mediaOverlay?this.resources.getItemByID(En.mediaOverlay):null}:(console.warn(`Could not find item with ID "${kn}" in manifest`),null)}).filter(yn=>yn);const{navPath:dn,ncxPath:hn}=this.resources;if(dn)try{const yn=kn=>resolveURL(kn,dn),wn=parseNav(await dr(this,Bo,Jo).call(this,dn),yn);this.toc=wn.toc,this.pageList=wn.pageList,this.landmarks=wn.landmarks}catch(yn){console.warn(yn)}if(!this.toc&&hn)try{const yn=kn=>resolveURL(kn,hn),wn=parseNCX(await dr(this,Bo,Jo).call(this,hn),yn);this.toc=wn.toc,this.pageList=wn.pageList}catch(yn){console.warn(yn)}this.landmarks??(this.landmarks=this.resources.guide);const{metadata:fn,rendition:pn,media:gn}=getMetadata$1(cn);this.metadata=fn,this.rendition=pn,this.media=gn,this.dir=this.resources.pageProgressionDirection;const mn=getDisplayOptions(await dr(this,Bo,Jo).call(this,"META-INF/com.apple.ibooks.display-options.xml")??await dr(this,Bo,Jo).call(this,"META-INF/com.kobobooks.display-options.xml"));return mn&&(mn.fixedLayout==="true"&&((bn=this.rendition).layout??(bn.layout="pre-paginated")),mn.openToSpread==="false"&&((vn=this.sections.find(yn=>yn.linear!=="no")).pageSpread??(vn.pageSpread=this.dir==="rtl"?"left":"right"))),this}async loadDocument(on){const sn=await this.loadText(on.href);return this.parser.parseFromString(sn,on.mediaType)}getMediaOverlay(){return new MediaOverlay(this,dr(this,Bo,Jo).bind(this))}resolveCFI(on){return this.resources.resolveCFI(on)}resolveHref(on){const[sn,ln]=on.split("#"),cn=this.resources.getItemByHref(decodeURI(sn));return cn?{index:this.resources.spine.findIndex(({idref:hn})=>hn===cn.id),anchor:ln?hn=>getHTMLFragment(hn,ln):()=>0}:null}splitTOCHref(on){return(on==null?void 0:on.split("#"))??[]}getTOCFragment(on,sn){return on.getElementById(sn)??on.querySelector(`[name="${CSS.escape(sn)}"]`)}isExternal(on){return isExternal(on)}async getCover(){var sn;const on=(sn=this.resources)==null?void 0:sn.cover;return on!=null&&on.href?new Blob([await this.loadBlob(on.href)],{type:on.mediaType}):null}async getCalibreBookmarks(){const on=await this.loadText("META-INF/calibre_bookmarks.txt"),sn="encoding=json+base64:";if(on!=null&&on.startsWith(sn)){const ln=atob(on.slice(sn.length));return JSON.parse(ln)}}destroy(){var on;(on=$n(this,ds))==null||on.destroy()}}ds=new WeakMap,si=new WeakMap,Bo=new WeakSet,Jo=async function(on){const sn=await this.loadText(on);if(!sn)return null;const ln=this.parser.parseFromString(sn,MIME$2.XML);if(ln.querySelector("parsererror"))throw new Error(`XML parsing error: ${on}
${ln.querySelector("parsererror").innerText}`);return ln};const epub=Object.freeze(Object.defineProperty({__proto__:null,EPUB},Symbol.toStringTag,{value:"Module"})),makeComicBook=async({entries:an,loadBlob:on,getSize:sn,getComment:ln},cn)=>{const un=new Map,dn=new Map,hn=async bn=>{if(un.has(bn))return un.get(bn);const vn=URL.createObjectURL(await on(bn)),yn=URL.createObjectURL(new Blob([`<body style="margin: 0"><img src="${vn}">`],{type:"text/html"}));return dn.set(bn,[vn,yn]),un.set(bn,yn),yn},fn=bn=>{var vn,yn;(yn=(vn=dn.get(bn))==null?void 0:vn.forEach)==null||yn.call(vn,wn=>URL.revokeObjectURL(wn)),dn.delete(bn),un.delete(bn)},pn=[".jpg",".jpeg",".png",".gif",".bmp",".webp",".svg",".jxl",".avif"],gn=an.map(bn=>bn.filename).filter(bn=>pn.some(vn=>bn.endsWith(vn))).sort();if(!gn.length)throw new Error("No supported image files in archive");const mn={};try{const vn=JSON.parse(await ln()||"")["ComicBookInfo/1.0"];if(vn){const yn=vn.publicationYear,wn=vn.publicationMonth,kn=wn&&wn>=1&&wn<=12?String(wn).padStart(2,"0"):null;mn.metadata={title:vn.title||cn.name,publisher:vn.publisher,language:vn.language||vn.lang,author:vn.credits?vn.credits.map(_n=>`${_n.person} (${_n.role})`).join(", "):"",published:yn&&wn?`${yn}-${kn}`:void 0}}else mn.metadata={title:cn.name}}catch{mn.metadata={title:cn.name}}return mn.getCover=()=>on(gn[0]),mn.sections=gn.map(bn=>({id:bn,load:()=>hn(bn),unload:()=>fn(bn),size:sn(bn)})),mn.toc=gn.map(bn=>({label:bn,href:bn})),mn.rendition={layout:"pre-paginated"},mn.resolveHref=bn=>({index:mn.sections.findIndex(vn=>vn.id===bn)}),mn.splitTOCHref=bn=>[bn,null],mn.getTOCFragment=bn=>bn.documentElement,mn.destroy=()=>{for(const bn of dn.values())for(const vn of bn)URL.revokeObjectURL(vn)},mn},comicBook=Object.freeze(Object.defineProperty({__proto__:null,makeComicBook},Symbol.toStringTag,{value:"Module"})),normalizeWhitespace$1=an=>an?an.replace(/[\t\n\f\r ]+/g," ").replace(/^[\t\n\f\r ]+/,"").replace(/[\t\n\f\r ]+$/,""):"",getElementText=an=>normalizeWhitespace$1(an==null?void 0:an.textContent),NS$1={XLINK:"http://www.w3.org/1999/xlink",EPUB:"http://www.idpf.org/2007/ops"},MIME$1={XML:"application/xml",XHTML:"application/xhtml+xml"},STYLE={strong:["strong","self"],emphasis:["em","self"],style:["span","self"],a:"anchor",strikethrough:["s","self"],sub:["sub","self"],sup:["sup","self"],code:["code","self"],image:"image"},TABLE={tr:["tr",{th:["th",STYLE,["colspan","rowspan","align","valign"]],td:["td",STYLE,["colspan","rowspan","align","valign"]]},["align"]]},POEM={epigraph:["blockquote"],subtitle:["h2",STYLE],"text-author":["p",STYLE],date:["p",STYLE],stanza:"stanza"},SECTION={title:["header",{p:["h1",STYLE],"empty-line":["br"]}],epigraph:["blockquote","self"],image:"image",annotation:["aside"],section:["section","self"],p:["p",STYLE],poem:["blockquote",POEM],subtitle:["h2",STYLE],cite:["blockquote","self"],"empty-line":["br"],table:["table",TABLE],"text-author":["p",STYLE]};POEM.epigraph.push(SECTION);const BODY={image:"image",title:["section",{p:["h1",STYLE],"empty-line":["br"]}],epigraph:["section",SECTION],section:["section",SECTION]};class FB2Converter{constructor(on){this.fb2=on,this.doc=document.implementation.createDocument(NS$1.XHTML,"html"),this.bins=new Map(Array.from(this.fb2.getElementsByTagName("binary"),sn=>[sn.id,sn]))}getImageSrc(on){const sn=on.getAttributeNS(NS$1.XLINK,"href");if(!sn)return"data:,";const[,ln]=sn.split("#");if(!ln)return sn;const cn=this.bins.get(ln);return cn?`data:${cn.getAttribute("content-type")};base64,${cn.textContent}`:sn}image(on){const sn=this.doc.createElement("img");return sn.alt=on.getAttribute("alt"),sn.title=on.getAttribute("title"),sn.setAttribute("src",this.getImageSrc(on)),sn}anchor(on){const sn=this.convert(on,{a:["a",STYLE]});return sn.setAttribute("href",on.getAttributeNS(NS$1.XLINK,"href")),on.getAttribute("type")==="note"&&sn.setAttributeNS(NS$1.EPUB,"epub:type","noteref"),sn}stanza(on){const sn=this.convert(on,{stanza:["p",{title:["header",{p:["strong",STYLE],"empty-line":["br"]}],subtitle:["p",STYLE]}]});for(const ln of on.children)ln.nodeName==="v"&&(sn.append(this.doc.createTextNode(ln.textContent)),sn.append(this.doc.createElement("br")));return sn}convert(on,sn){if(on.nodeType===3)return this.doc.createTextNode(on.textContent);if(on.nodeType===4)return this.doc.createCDATASection(on.textContent);if(on.nodeType===8)return this.doc.createComment(on.textContent);const ln=sn==null?void 0:sn[on.nodeName];if(!ln)return null;if(typeof ln=="string")return this[ln](on);const[cn,un,dn]=ln,hn=this.doc.createElement(cn);if(on.id&&(hn.id=on.id),hn.classList.add(on.nodeName),Array.isArray(dn))for(const gn of dn){const mn=on.getAttribute(gn);mn&&hn.setAttribute(gn,mn)}const fn=un==="self"?sn:un;let pn=on.firstChild;for(;pn;){const gn=this.convert(pn,fn);gn&&hn.append(gn),pn=pn.nextSibling}return hn}}const parseXML=async an=>{var dn;const on=await an.arrayBuffer(),sn=new TextDecoder("utf-8").decode(on),ln=new DOMParser,cn=ln.parseFromString(sn,MIME$1.XML),un=cn.xmlEncoding||((dn=sn.match(/^<\?xml\s+version\s*=\s*["']1.\d+"\s+encoding\s*=\s*["']([A-Za-z0-9._-]*)["']/))==null?void 0:dn[1]);if(un&&un.toLowerCase()!=="utf-8"){const hn=new TextDecoder(un).decode(on);return ln.parseFromString(hn,MIME$1.XML)}return cn},style=URL.createObjectURL(new Blob([`
@namespace epub "http://www.idpf.org/2007/ops";
body > img, section > img {
    display: block;
    margin: auto;
}
.title h1 {
    text-align: center;
}
body > section > .title, body.notesBodyType > .title {
    margin: 3em 0;
}
body.notesBodyType > section .title h1 {
    text-align: start;
}
body.notesBodyType > section .title {
    margin: 1em 0;
}
p {
    text-indent: 1em;
    margin: 0;
}
:not(p) + p, p:first-child {
    text-indent: 0;
}
.poem p {
    text-indent: 0;
    margin: 1em 0;
}
.text-author, .date {
    text-align: end;
}
.text-author:before {
    content: "";
}
table {
    border-collapse: collapse;
}
td, th {
    padding: .25em;
}
a[epub|type~="noteref"] {
    font-size: .75em;
    vertical-align: super;
}
body:not(.notesBodyType) > .title, body:not(.notesBodyType) > .epigraph {
    margin: 3em 0;
}
`],{type:"text/css"})),template=an=>`<?xml version="1.0" encoding="utf-8"?>
<html xmlns="http://www.w3.org/1999/xhtml">
    <head><link href="${style}" rel="stylesheet" type="text/css"/></head>
    <body>${an}</body>
</html>`,dataID="data-foliate-id",makeFB2=async an=>{const on={},sn=await parseXML(an),ln=new FB2Converter(sn),cn=vn=>sn.querySelector(vn),un=vn=>[...sn.querySelectorAll(vn)],dn=vn=>{const yn=getElementText(vn.querySelector("nickname"));if(yn)return yn;const wn=getElementText(vn.querySelector("first-name")),kn=getElementText(vn.querySelector("middle-name")),_n=getElementText(vn.querySelector("last-name")),xn=[wn,kn,_n].filter(Tn=>Tn).join(" "),En=_n?[_n,[wn,kn].filter(Tn=>Tn).join(" ")].join(", "):null;return{name:xn,sortAs:En}},hn=vn=>(vn==null?void 0:vn.getAttribute("value"))??getElementText(vn),fn=cn("title-info annotation");if(on.metadata={title:getElementText(cn("title-info book-title")),identifier:getElementText(cn("document-info id")),language:getElementText(cn("title-info lang")),author:un("title-info author").map(dn),translator:un("title-info translator").map(dn),contributor:un("document-info author").map(dn).concat(un("document-info program-used").map(getElementText)).map(vn=>Object.assign(typeof vn=="string"?{name:vn}:vn,{role:"bkp"})),publisher:getElementText(cn("publish-info publisher")),published:hn(cn("title-info date")),modified:hn(cn("document-info date")),description:fn?ln.convert(fn,{annotation:["div",SECTION]}).innerHTML:null,subject:un("title-info genre").map(getElementText)},cn("coverpage image")){const vn=ln.getImageSrc(cn("coverpage image"));on.getCover=()=>fetch(vn).then(yn=>yn.blob())}else on.getCover=()=>null;const pn=Array.from(sn.querySelectorAll("body"),vn=>{const yn=ln.convert(vn,{body:["body",BODY]});return[Array.from(yn.children,wn=>{const kn=[wn,...wn.querySelectorAll("[id]")].map(_n=>_n.id);return{el:wn,ids:kn}}),yn]}),gn=[],mn=pn[0][0].map(({el:vn,ids:yn})=>{const wn=Array.from(vn.querySelectorAll(":scope > section > .title"),(kn,_n)=>(kn.setAttribute(dataID,_n),{title:getElementText(kn),index:_n}));return{ids:yn,titles:wn,el:vn}}).concat(pn.slice(1).map(([vn,yn])=>{const wn=vn.map(kn=>kn.ids).flat();return yn.classList.add("notesBodyType"),{ids:wn,el:yn,linear:"no"}})).map(({ids:vn,titles:yn,el:wn,linear:kn})=>{var Bn;const _n=template(wn.outerHTML),xn=new Blob([_n],{type:MIME$1.XHTML}),En=URL.createObjectURL(xn);gn.push(En);const Tn=normalizeWhitespace$1(((Bn=wn.querySelector(".title, .subtitle, p"))==null?void 0:Bn.textContent)??(wn.classList.contains("title")?wn.textContent:""));return{ids:vn,title:Tn,titles:yn,load:()=>En,createDocument:()=>new DOMParser().parseFromString(_n,MIME$1.XHTML),size:xn.size-Array.from(wn.querySelectorAll("[src]"),Nn=>{var Mn;return((Mn=Nn.getAttribute("src"))==null?void 0:Mn.length)??0}).reduce((Nn,Mn)=>Nn+Mn,0),linear:kn}}),bn=new Map;return on.sections=mn.map((vn,yn)=>{const{ids:wn,load:kn,createDocument:_n,size:xn,linear:En}=vn;for(const Tn of wn)Tn&&bn.set(Tn,yn);return{id:yn,load:kn,createDocument:_n,size:xn,linear:En}}),on.toc=mn.map(({title:vn,titles:yn},wn)=>{const kn=wn.toString();return{label:vn,href:kn,subitems:yn!=null&&yn.length?yn.map(({title:_n,index:xn})=>({label:_n,href:`${kn}#${xn}`})):null}}).filter(vn=>vn),on.resolveHref=vn=>{const[yn,wn]=vn.split("#");return yn?{index:Number(yn),anchor:kn=>kn.querySelector(`[${dataID}="${wn}"]`)}:{index:bn.get(wn),anchor:kn=>kn.getElementById(wn)}},on.splitTOCHref=vn=>{var yn;return((yn=vn==null?void 0:vn.split("#"))==null?void 0:yn.map(wn=>Number(wn)))??[]},on.getTOCFragment=(vn,yn)=>vn.querySelector(`[${dataID}="${yn}"]`),on.destroy=()=>{for(const vn of gn)URL.revokeObjectURL(vn)},on},fb2=Object.freeze(Object.defineProperty({__proto__:null,makeFB2},Symbol.toStringTag,{value:"Module"})),unescapeHTML=an=>{if(!an)return"";const on=document.createElement("textarea");return on.innerHTML=an,on.value},MIME={XML:"application/xml",XHTML:"application/xhtml+xml",HTML:"text/html",CSS:"text/css",SVG:"image/svg+xml"},PDB_HEADER={name:[0,32,"string"],type:[60,4,"string"],creator:[64,4,"string"],numRecords:[76,2,"uint"]},PALMDOC_HEADER={compression:[0,2,"uint"],numTextRecords:[8,2,"uint"],recordSize:[10,2,"uint"],encryption:[12,2,"uint"]},MOBI_HEADER={magic:[16,4,"string"],length:[20,4,"uint"],type:[24,4,"uint"],encoding:[28,4,"uint"],uid:[32,4,"uint"],version:[36,4,"uint"],titleOffset:[84,4,"uint"],titleLength:[88,4,"uint"],localeRegion:[94,1,"uint"],localeLanguage:[95,1,"uint"],resourceStart:[108,4,"uint"],huffcdic:[112,4,"uint"],numHuffcdic:[116,4,"uint"],exthFlag:[128,4,"uint"],trailingFlags:[240,4,"uint"],indx:[244,4,"uint"]},KF8_HEADER={resourceStart:[108,4,"uint"],fdst:[192,4,"uint"],numFdst:[196,4,"uint"],frag:[248,4,"uint"],skel:[252,4,"uint"],guide:[260,4,"uint"]},EXTH_HEADER={magic:[0,4,"string"],length:[4,4,"uint"],count:[8,4,"uint"]},INDX_HEADER={magic:[0,4,"string"],length:[4,4,"uint"],type:[8,4,"uint"],idxt:[20,4,"uint"],numRecords:[24,4,"uint"],encoding:[28,4,"uint"],language:[32,4,"uint"],total:[36,4,"uint"],ordt:[40,4,"uint"],ligt:[44,4,"uint"],numLigt:[48,4,"uint"],numCncx:[52,4,"uint"]},TAGX_HEADER={magic:[0,4,"string"],length:[4,4,"uint"],numControlBytes:[8,4,"uint"]},HUFF_HEADER={magic:[0,4,"string"],offset1:[8,4,"uint"],offset2:[12,4,"uint"]},CDIC_HEADER={magic:[0,4,"string"],length:[4,4,"uint"],numEntries:[8,4,"uint"],codeLength:[12,4,"uint"]},FDST_HEADER={magic:[0,4,"string"],numEntries:[8,4,"uint"]},FONT_HEADER={flags:[8,4,"uint"],dataStart:[12,4,"uint"],keyLength:[16,4,"uint"],keyStart:[20,4,"uint"]},MOBI_ENCODING={1252:"windows-1252",65001:"utf-8"},EXTH_RECORD_TYPE={100:["creator","string",!0],101:["publisher"],103:["description"],104:["isbn"],105:["subject","string",!0],106:["date"],108:["contributor","string",!0],109:["rights"],110:["subjectCode","string",!0],112:["source","string",!0],113:["asin"],121:["boundary","uint"],122:["fixedLayout"],125:["numResources","uint"],126:["originalResolution"],127:["zeroGutter"],128:["zeroMargin"],129:["coverURI"],132:["regionMagnification"],201:["coverOffset","uint"],202:["thumbnailOffset","uint"],503:["title"],524:["language","string",!0],527:["pageProgressionDirection"]},MOBI_LANG={1:["ar","ar-SA","ar-IQ","ar-EG","ar-LY","ar-DZ","ar-MA","ar-TN","ar-OM","ar-YE","ar-SY","ar-JO","ar-LB","ar-KW","ar-AE","ar-BH","ar-QA"],2:["bg"],3:["ca"],4:["zh","zh-TW","zh-CN","zh-HK","zh-SG"],5:["cs"],6:["da"],7:["de","de-DE","de-CH","de-AT","de-LU","de-LI"],8:["el"],9:["en","en-US","en-GB","en-AU","en-CA","en-NZ","en-IE","en-ZA","en-JM",null,"en-BZ","en-TT","en-ZW","en-PH"],10:["es","es-ES","es-MX",null,"es-GT","es-CR","es-PA","es-DO","es-VE","es-CO","es-PE","es-AR","es-EC","es-CL","es-UY","es-PY","es-BO","es-SV","es-HN","es-NI","es-PR"],11:["fi"],12:["fr","fr-FR","fr-BE","fr-CA","fr-CH","fr-LU","fr-MC"],13:["he"],14:["hu"],15:["is"],16:["it","it-IT","it-CH"],17:["ja"],18:["ko"],19:["nl","nl-NL","nl-BE"],20:["no","nb","nn"],21:["pl"],22:["pt","pt-BR","pt-PT"],23:["rm"],24:["ro"],25:["ru"],26:["hr",null,"sr"],27:["sk"],28:["sq"],29:["sv","sv-SE","sv-FI"],30:["th"],31:["tr"],32:["ur"],33:["id"],34:["uk"],35:["be"],36:["sl"],37:["et"],38:["lv"],39:["lt"],41:["fa"],42:["vi"],43:["hy"],44:["az"],45:["eu"],46:["hsb"],47:["mk"],48:["st"],49:["ts"],50:["tn"],52:["xh"],53:["zu"],54:["af"],55:["ka"],56:["fo"],57:["hi"],58:["mt"],59:["se"],62:["ms"],63:["kk"],65:["sw"],67:["uz",null,"uz-UZ"],68:["tt"],69:["bn"],70:["pa"],71:["gu"],72:["or"],73:["ta"],74:["te"],75:["kn"],76:["ml"],77:["as"],78:["mr"],79:["sa"],82:["cy","cy-GB"],83:["gl","gl-ES"],87:["kok"],97:["ne"],98:["fy"]},concatTypedArray$1=(an,on)=>{const sn=new an.constructor(an.length+on.length);return sn.set(an),sn.set(on,an.length),sn},concatTypedArray3=(an,on,sn)=>{const ln=new an.constructor(an.length+on.length+sn.length);return ln.set(an),ln.set(on,an.length),ln.set(sn,an.length+on.length),ln},decoder$1=new TextDecoder,getString=an=>decoder$1.decode(an),getUint=an=>{if(!an)return;const on=an.byteLength,sn=on===4?"getUint32":on===2?"getUint16":"getUint8";return new DataView(an)[sn](0)},getStruct=(an,on)=>Object.fromEntries(Array.from(Object.entries(an)).map(([sn,[ln,cn,un]])=>[sn,(un==="string"?getString:getUint)(on.slice(ln,ln+cn))])),getDecoder=an=>new TextDecoder(MOBI_ENCODING[an]),getVarLen=(an,on=0)=>{let sn=0,ln=0;for(const cn of an.subarray(on,on+4))if(sn=sn<<7|(cn&127)>>>0,ln++,cn&128)break;return{value:sn,length:ln}},getVarLenFromEnd=an=>{let on=0;for(const sn of an.subarray(-4))sn&128&&(on=0),on=on<<7|sn&127;return on},countBitsSet=an=>{let on=0;for(;an>0;an=an>>1)(an&1)===1&&on++;return on},countUnsetEnd=an=>{let on=0;for(;(an&1)===0;)an=an>>1,on++;return on},decompressPalmDOC=an=>{let on=[];for(let sn=0;sn<an.length;sn++){const ln=an[sn];if(ln===0)on.push(0);else if(ln<=8)for(const cn of an.subarray(sn+1,(sn+=ln)+1))on.push(cn);else if(ln<=127)on.push(ln);else if(ln<=191){const cn=ln<<8|an[sn+++1],un=(cn&16383)>>>3,dn=(cn&7)+3;for(let hn=0;hn<dn;hn++)on.push(on[on.length-un])}else on.push(32,ln^128)}return Uint8Array.from(on)},read32Bits=(an,on)=>{const sn=on>>3,ln=on+32,cn=ln>>3;let un=0n;for(let dn=sn;dn<=cn;dn++)un=un<<8n|BigInt(an[dn]??0);return un>>8n-BigInt(ln&7)&0xffffffffn},huffcdic=async(an,on)=>{const sn=await on(an.huffcdic),{magic:ln,offset1:cn,offset2:un}=getStruct(HUFF_HEADER,sn);if(ln!=="HUFF")throw new Error("Invalid HUFF record");const dn=Array.from({length:256},(gn,mn)=>cn+mn*4).map(gn=>getUint(sn.slice(gn,gn+4))).map(gn=>[gn&128,gn&31,gn>>>8]),hn=[null].concat(Array.from({length:32},(gn,mn)=>un+mn*8).map(gn=>[getUint(sn.slice(gn,gn+4)),getUint(sn.slice(gn+4,gn+8))])),fn=[];for(let gn=1;gn<an.numHuffcdic;gn++){const mn=await on(an.huffcdic+gn),bn=getStruct(CDIC_HEADER,mn);if(bn.magic!=="CDIC")throw new Error("Invalid CDIC record");const vn=Math.min(1<<bn.codeLength,bn.numEntries-fn.length),yn=mn.slice(bn.length);for(let wn=0;wn<vn;wn++){const kn=getUint(yn.slice(wn*2,wn*2+2)),_n=getUint(yn.slice(kn,kn+2)),xn=_n&32767,En=_n&32768,Tn=new Uint8Array(yn.slice(kn+2,kn+2+xn));fn.push([Tn,En])}}const pn=gn=>{let mn=new Uint8Array;const bn=gn.byteLength*8;for(let vn=0;vn<bn;){const yn=Number(read32Bits(gn,vn));let[wn,kn,_n]=dn[yn>>>24];if(!wn){for(;yn>>>32-kn<hn[kn][0];)kn+=1;_n=hn[kn][1]}if((vn+=kn)>bn)break;const xn=_n-(yn>>>32-kn);let[En,Tn]=fn[xn];Tn||(En=pn(En),fn[xn]=[En,!0]),mn=concatTypedArray$1(mn,En)}return mn};return pn},getIndexData=async(an,on)=>{const sn=await on(an),ln=getStruct(INDX_HEADER,sn);if(ln.magic!=="INDX")throw new Error("Invalid INDX record");const cn=getDecoder(ln.encoding),un=sn.slice(ln.length),dn=getStruct(TAGX_HEADER,un);if(dn.magic!=="TAGX")throw new Error("Invalid TAGX section");const hn=(dn.length-12)/4,fn=Array.from({length:hn},(bn,vn)=>new Uint8Array(un.slice(12+vn*4,12+vn*4+4))),pn={};let gn=0;for(let bn=0;bn<ln.numCncx;bn++){const vn=await on(an+ln.numRecords+bn+1),yn=new Uint8Array(vn);for(let wn=0;wn<yn.byteLength;){const kn=wn,{value:_n,length:xn}=getVarLen(yn,wn);wn+=xn;const En=vn.slice(wn,wn+_n);wn+=_n,pn[gn+kn]=cn.decode(En)}gn+=65536}const mn=[];for(let bn=0;bn<ln.numRecords;bn++){const vn=await on(an+1+bn),yn=new Uint8Array(vn),wn=getStruct(INDX_HEADER,vn);if(wn.magic!=="INDX")throw new Error("Invalid INDX record");for(let kn=0;kn<wn.numRecords;kn++){const _n=wn.idxt+4+2*kn,xn=getUint(vn.slice(_n,_n+2)),En=getUint(vn.slice(xn,xn+1)),Tn=getString(vn.slice(xn+1,xn+1+En)),Bn=[],Nn=xn+1+En;let Mn=0,Ln=Nn+dn.numControlBytes;for(const[zn,Pn,An,Vn]of fn){if(Vn&1){Mn++;continue}const Sn=Nn+Mn,Rn=getUint(vn.slice(Sn,Sn+1))&An;if(Rn===An)if(countBitsSet(An)>1){const{value:Hn,length:Zn}=getVarLen(yn,Ln);Bn.push([zn,null,Hn,Pn]),Ln+=Zn}else Bn.push([zn,1,null,Pn]);else Bn.push([zn,Rn>>countUnsetEnd(An),null,Pn])}const On={};for(const[zn,Pn,An,Vn]of Bn){const Sn=[];if(Pn!=null)for(let Rn=0;Rn<Pn*Vn;Rn++){const{value:Hn,length:Zn}=getVarLen(yn,Ln);Sn.push(Hn),Ln+=Zn}else{let Rn=0;for(;Rn<An;){const{value:Hn,length:Zn}=getVarLen(yn,Ln);Sn.push(Hn),Ln+=Zn,Rn+=Zn}}On[zn]=Sn}mn.push({name:Tn,tagMap:On})}}return{table:mn,cncx:pn}},getNCX=async(an,on)=>{const{table:sn,cncx:ln}=await getIndexData(an,on),cn=sn.map(({tagMap:dn},hn)=>{var fn,pn,gn,mn,bn,vn;return{index:hn,offset:(fn=dn[1])==null?void 0:fn[0],size:(pn=dn[2])==null?void 0:pn[0],label:ln[dn[3]]??"",headingLevel:(gn=dn[4])==null?void 0:gn[0],pos:dn[6],parent:(mn=dn[21])==null?void 0:mn[0],firstChild:(bn=dn[22])==null?void 0:bn[0],lastChild:(vn=dn[23])==null?void 0:vn[0]}}),un=dn=>(dn.firstChild==null||(dn.children=cn.filter(hn=>hn.parent===dn.index).map(un)),dn);return cn.filter(dn=>dn.headingLevel===0).map(un)},getEXTH=(an,on)=>{const{magic:sn,count:ln}=getStruct(EXTH_HEADER,an);if(sn!=="EXTH")throw new Error("Invalid EXTH header");const cn=getDecoder(on),un={};let dn=12;for(let hn=0;hn<ln;hn++){const fn=getUint(an.slice(dn,dn+4)),pn=getUint(an.slice(dn+4,dn+8));if(fn in EXTH_RECORD_TYPE){const[gn,mn,bn]=EXTH_RECORD_TYPE[fn],vn=an.slice(dn+8,dn+pn),yn=mn==="uint"?getUint(vn):cn.decode(vn);bn?(un[gn]??(un[gn]=[]),un[gn].push(yn)):un[gn]=yn}dn+=pn}return un},getFont=async(an,on)=>{const{flags:sn,dataStart:ln,keyLength:cn,keyStart:un}=getStruct(FONT_HEADER,an),dn=new Uint8Array(an.slice(ln));if(sn&2){const fn=cn===16?1024:1040,pn=new Uint8Array(an.slice(un,un+cn)),gn=Math.min(fn,dn.length);for(var hn=0;hn<gn;hn++)dn[hn]=dn[hn]^pn[hn%pn.length]}if(sn&1)try{return await on(dn)}catch(fn){console.warn(fn),console.warn("Failed to decompress font")}return dn},isMOBI=async an=>getString(await an.slice(60,68).arrayBuffer())==="BOOKMOBI";var ii,ai;class PDB{constructor(){pr(this,ii);pr(this,ai);ir(this,"pdb")}async open(on){yr(this,ii,on);const sn=getStruct(PDB_HEADER,await on.slice(0,78).arrayBuffer());this.pdb=sn;const ln=await on.slice(78,78+sn.numRecords*8).arrayBuffer();yr(this,ai,Array.from({length:sn.numRecords},(cn,un)=>getUint(ln.slice(un*8,un*8+4))).map((cn,un,dn)=>[cn,dn[un+1]]))}loadRecord(on){const sn=$n(this,ai)[on];if(!sn)throw new RangeError("Record index out of bounds");return $n(this,ii).slice(...sn).arrayBuffer()}async loadMagic(on){const sn=$n(this,ai)[on][0];return getString(await $n(this,ii).slice(sn,sn+4).arrayBuffer())}}ii=new WeakMap,ai=new WeakMap;var li,Ui,Hi,qi,ci,Wi,qs,Oa,ml;class MOBI extends PDB{constructor({unzlib:sn}){super();pr(this,qs);pr(this,li,0);pr(this,Ui);pr(this,Hi);pr(this,qi);pr(this,ci);pr(this,Wi);this.unzlib=sn}async open(sn){var cn;await super.open(sn),this.headers=dr(this,qs,Oa).call(this,await super.loadRecord(0)),yr(this,Ui,this.headers.mobi.resourceStart);let ln=this.headers.mobi.version>=8;if(!ln){const un=(cn=this.headers.exth)==null?void 0:cn.boundary;if(un<4294967295)try{this.headers=dr(this,qs,Oa).call(this,await super.loadRecord(un)),yr(this,li,un),ln=!0}catch(dn){console.warn(dn),console.warn("Failed to open KF8; falling back to MOBI")}}return await dr(this,qs,ml).call(this),ln?new KF8(this).init():new MOBI6(this).init()}decode(...sn){return $n(this,Hi).decode(...sn)}encode(...sn){return $n(this,qi).encode(...sn)}loadRecord(sn){return super.loadRecord($n(this,li)+sn)}loadMagic(sn){return super.loadMagic($n(this,li)+sn)}loadText(sn){return this.loadRecord(sn+1).then(ln=>new Uint8Array(ln)).then($n(this,Wi)).then($n(this,ci))}async loadResource(sn){const ln=await super.loadRecord($n(this,Ui)+sn),cn=getString(ln.slice(0,4));return cn==="FONT"?getFont(ln,this.unzlib):cn==="VIDE"||cn==="AUDI"?ln.slice(12):ln}getNCX(){const sn=this.headers.mobi.indx;if(sn<4294967295)return getNCX(sn,this.loadRecord.bind(this))}getMetadata(){var cn,un;const{mobi:sn,exth:ln}=this.headers;return{identifier:sn.uid.toString(),title:unescapeHTML((ln==null?void 0:ln.title)||this.decode(sn.title)),author:(cn=ln==null?void 0:ln.creator)==null?void 0:cn.map(unescapeHTML),publisher:unescapeHTML(ln==null?void 0:ln.publisher),language:(ln==null?void 0:ln.language)??sn.language,published:ln==null?void 0:ln.date,description:unescapeHTML(ln==null?void 0:ln.description),subject:(un=ln==null?void 0:ln.subject)==null?void 0:un.map(unescapeHTML),rights:unescapeHTML(ln==null?void 0:ln.rights),contributor:ln==null?void 0:ln.contributor}}async getCover(){const{exth:sn}=this.headers,ln=(sn==null?void 0:sn.coverOffset)<4294967295?sn==null?void 0:sn.coverOffset:(sn==null?void 0:sn.thumbnailOffset)<4294967295?sn==null?void 0:sn.thumbnailOffset:null;if(ln!=null){const cn=await this.loadResource(ln);return new Blob([cn])}}}li=new WeakMap,Ui=new WeakMap,Hi=new WeakMap,qi=new WeakMap,ci=new WeakMap,Wi=new WeakMap,qs=new WeakSet,Oa=function(sn){const ln=getStruct(PALMDOC_HEADER,sn),cn=getStruct(MOBI_HEADER,sn);if(cn.magic!=="MOBI")throw new Error("Missing MOBI header");const{titleOffset:un,titleLength:dn,localeLanguage:hn,localeRegion:fn}=cn;cn.title=sn.slice(un,un+dn);const pn=MOBI_LANG[hn];cn.language=(pn==null?void 0:pn[fn>>2])??(pn==null?void 0:pn[0]);const gn=cn.exthFlag&64?getEXTH(sn.slice(cn.length+16),cn.encoding):null,mn=cn.version>=8?getStruct(KF8_HEADER,sn):null;return{palmdoc:ln,mobi:cn,exth:gn,kf8:mn}},ml=async function(){const{palmdoc:sn,mobi:ln}=this.headers;yr(this,Hi,getDecoder(ln.encoding)),yr(this,qi,new TextEncoder);const{compression:cn}=sn;if(yr(this,ci,cn===1?fn=>fn:cn===2?decompressPalmDOC:cn===17480?await huffcdic(ln,this.loadRecord.bind(this)):null),!$n(this,ci))throw new Error("Unknown compression type");const{trailingFlags:un}=ln,dn=un&1,hn=countBitsSet(un>>>1);yr(this,Wi,fn=>{for(let pn=0;pn<hn;pn++){const gn=getVarLenFromEnd(fn);fn=fn.subarray(0,-gn)}if(dn){const pn=(fn[fn.length-1]&3)+1;fn=fn.subarray(0,-pn)}return fn})};const mbpPagebreakRegex=/<\s*(?:mbp:)?pagebreak[^>]*>/gi,fileposRegex=/<[^<>]+filepos=['"]{0,1}(\d+)[^<>]*>/gi,getIndent=an=>{let on=0;for(;an;){const sn=an.parentElement;if(sn){const ln=sn.tagName.toLowerCase();ln==="p"?on+=1.5:ln==="blockquote"&&(on+=2)}an=sn}return on};var Ds,ui,Rs,hs,Ki,Gi;class MOBI6{constructor(on){ir(this,"parser",new DOMParser);ir(this,"serializer",new XMLSerializer);pr(this,Ds,new Map);pr(this,ui,new Map);pr(this,Rs,new Map);pr(this,hs);pr(this,Ki,[]);pr(this,Gi,MIME.HTML);this.mobi=on}async init(){var ln;let on=new Uint8Array;for(let cn=0;cn<this.mobi.headers.palmdoc.numTextRecords;cn++)on=concatTypedArray$1(on,await this.mobi.loadText(cn));const sn=Array.from(new Uint8Array(on),cn=>String.fromCharCode(cn)).join("");yr(this,hs,[0].concat(Array.from(sn.matchAll(mbpPagebreakRegex),cn=>cn.index)).map((cn,un,dn)=>sn.slice(cn,dn[un+1])).map(cn=>Uint8Array.from(cn,un=>un.charCodeAt(0))).map(cn=>({book:this,raw:cn})).reduce((cn,un)=>{const dn=cn[cn.length-1];return un.start=(dn==null?void 0:dn.end)??0,un.end=un.start+un.raw.byteLength,cn.concat(un)},[])),this.sections=$n(this,hs).map((cn,un)=>({id:un,load:()=>this.loadSection(cn),createDocument:()=>this.createDocument(cn),size:cn.end-cn.start}));try{this.landmarks=await this.getGuide();const cn=(ln=this.landmarks.find(({type:un})=>un==null?void 0:un.includes("toc")))==null?void 0:ln.href;if(cn){const{index:un}=this.resolveHref(cn),dn=await this.sections[un].createDocument();let hn,fn=0,pn=0;const gn=new Map,mn=new Map;this.toc=Array.from(dn.querySelectorAll("a[filepos]")).reduce((bn,vn)=>{var _n;const yn=getIndent(vn),wn={label:((_n=vn.innerText)==null?void 0:_n.trim())??"",href:`filepos:${vn.getAttribute("filepos")}`},kn=yn>pn?fn+1:yn===pn?fn:gn.get(yn)??Math.max(0,fn-1);if(kn>fn)hn?(hn.subitems??(hn.subitems=[]),hn.subitems.push(wn),mn.set(kn,hn)):bn.push(wn);else{const xn=mn.get(kn);xn?xn.subitems.push(wn):bn.push(wn)}return hn=wn,fn=kn,pn=yn,gn.set(yn,kn),bn},[])}}catch(cn){console.warn(cn)}return yr(this,Ki,[...new Set(Array.from(sn.matchAll(fileposRegex),cn=>cn[1]))].map(cn=>({filepos:cn,number:Number(cn)})).sort((cn,un)=>cn.number-un.number)),this.metadata=this.mobi.getMetadata(),this.getCover=this.mobi.getCover.bind(this.mobi),this}async getGuide(){const on=await this.createDocument($n(this,hs)[0]);return Array.from(on.getElementsByTagName("reference"),sn=>{var ln;return{label:sn.getAttribute("title"),type:(ln=sn.getAttribute("type"))==null?void 0:ln.split(/\s/),href:`filepos:${sn.getAttribute("filepos")}`}})}async loadResource(on){if($n(this,Ds).has(on))return $n(this,Ds).get(on);const sn=await this.mobi.loadResource(on),ln=URL.createObjectURL(new Blob([sn]));return $n(this,Ds).set(on,ln),ln}async loadRecindex(on){return this.loadResource(Number(on)-1)}async replaceResources(on){for(const sn of on.querySelectorAll("img[recindex]")){const ln=sn.getAttribute("recindex");try{sn.src=await this.loadRecindex(ln)}catch{console.warn(`Failed to load image ${ln}`)}}for(const sn of on.querySelectorAll("[mediarecindex]")){const ln=sn.getAttribute("mediarecindex"),cn=sn.getAttribute("recindex");try{sn.src=await this.loadRecindex(ln),cn&&(sn.poster=await this.loadRecindex(cn))}catch{console.warn(`Failed to load media ${ln}`)}}for(const sn of on.querySelectorAll("[filepos]")){const ln=sn.getAttribute("filepos");sn.href=`filepos:${ln}`}}async loadText(on){if($n(this,ui).has(on))return $n(this,ui).get(on);const{raw:sn}=on,ln=$n(this,Ki).filter(({number:dn})=>dn>=on.start&&dn<on.end).map(dn=>({...dn,offset:dn.number-on.start}));let cn=sn;ln.length&&(cn=sn.subarray(0,ln[0].offset),ln.forEach(({filepos:dn,offset:hn},fn)=>{const pn=ln[fn+1],gn=this.mobi.encode(`<a id="filepos${dn}"></a>`);cn=concatTypedArray3(cn,gn,sn.subarray(hn,pn==null?void 0:pn.offset))}));const un=this.mobi.decode(cn).replaceAll(mbpPagebreakRegex,"");return $n(this,ui).set(on,un),un}async createDocument(on){const sn=await this.loadText(on);return this.parser.parseFromString(sn,$n(this,Gi))}async loadSection(on){if($n(this,Rs).has(on))return $n(this,Rs).get(on);const sn=await this.createDocument(on),ln=sn.createElement("style");sn.head.append(ln),ln.append(sn.createTextNode(`blockquote {
            margin-block-start: 0;
            margin-block-end: 0;
            margin-inline-start: 1em;
            margin-inline-end: 0;
        }`)),await this.replaceResources(sn);const cn=this.serializer.serializeToString(sn),un=URL.createObjectURL(new Blob([cn],{type:$n(this,Gi)}));return $n(this,Rs).set(on,un),un}resolveHref(on){const sn=on.match(/filepos:(.*)/)[1],ln=Number(sn);return{index:$n(this,hs).findIndex(dn=>dn.end>ln),anchor:dn=>dn.getElementById(`filepos${sn}`)}}splitTOCHref(on){const sn=on.match(/filepos:(.*)/)[1],ln=Number(sn);return[$n(this,hs).findIndex(un=>un.end>ln),`filepos${sn}`]}getTOCFragment(on,sn){return on.getElementById(sn)}isExternal(on){return/^(?!blob|filepos)\w+:/i.test(on)}destroy(){for(const on of $n(this,Ds).values())URL.revokeObjectURL(on);for(const on of $n(this,Rs).values())URL.revokeObjectURL(on)}}Ds=new WeakMap,ui=new WeakMap,Rs=new WeakMap,hs=new WeakMap,Ki=new WeakMap,Gi=new WeakMap;const kindleResourceRegex=/kindle:(flow|embed):(\w+)(?:\?mime=(\w+\/[-+.\w]+))?/,kindlePosRegex=/kindle:pos:fid:(\w+):off:(\w+)/,parseResourceURI=an=>{const[on,sn,ln]=an.match(kindleResourceRegex).slice(1);return{resourceType:on,id:parseInt(sn,32),type:ln}},parsePosURI=an=>{const[on,sn]=an.match(kindlePosRegex).slice(1);return{fid:parseInt(on,32),off:parseInt(sn,32)}},makePosURI=(an=0,on=0)=>`kindle:pos:fid:${an.toString(32).toUpperCase().padStart(4,"0")}:off:${on.toString(32).toUpperCase().padStart(10,"0")}`,getFragmentSelector=an=>{const on=an.match(/\s(id|name|aid)\s*=\s*['"]([^'"]*)['"]/i);if(!on)return;const[,sn,ln]=on;return`[${sn}="${CSS.escape(ln)}"]`},replaceSeries=async(an,on,sn)=>{const ln=[];an.replace(on,(...un)=>(ln.push(un),null));const cn=[];for(const un of ln)cn.push(await sn(...un));return an.replace(on,()=>cn.shift())},getPageSpread=an=>{for(const on of an){if(on==="page-spread-left"||on==="rendition:page-spread-left")return"left";if(on==="page-spread-right"||on==="rendition:page-spread-right")return"right";if(on==="rendition:page-spread-center")return"center"}};var Lo,di,Ps,Os,Fs,fs,ps,es,$a,Ba,gs,Ji,Xi,Fa;class KF8{constructor(on){pr(this,Xi);ir(this,"parser",new DOMParser);ir(this,"serializer",new XMLSerializer);pr(this,Lo,new Map);pr(this,di,new Map);pr(this,Ps,new Map);pr(this,Os,{});pr(this,Fs);pr(this,fs);pr(this,ps,new Uint8Array);pr(this,es,new Uint8Array);pr(this,$a,-1);pr(this,Ba,-1);pr(this,gs,MIME.XHTML);pr(this,Ji,new Map);this.mobi=on}async init(){var pn,gn,mn,bn;const on=this.mobi.loadRecord.bind(this.mobi),{kf8:sn}=this.mobi.headers;try{const vn=await on(sn.fdst),yn=getStruct(FDST_HEADER,vn);if(yn.magic!=="FDST")throw new Error("Missing FDST record");const wn=Array.from({length:yn.numEntries},(kn,_n)=>12+_n*8).map(kn=>[getUint(vn.slice(kn,kn+4)),getUint(vn.slice(kn+4,kn+8))]);$n(this,Os).fdstTable=wn,yr(this,fs,wn[wn.length-1][1])}catch{}const ln=(await getIndexData(sn.skel,on)).table.map(({name:vn,tagMap:yn},wn)=>({index:wn,name:vn,numFrag:yn[1][0],offset:yn[6][0],length:yn[6][1]})),cn=await getIndexData(sn.frag,on),un=cn.table.map(({name:vn,tagMap:yn})=>({insertOffset:parseInt(vn),selector:cn.cncx[yn[2][0]],index:yn[4][0],offset:yn[6][0],length:yn[6][1]}));$n(this,Os).skelTable=ln,$n(this,Os).fragTable=un,yr(this,Fs,ln.reduce((vn,yn)=>{const wn=vn[vn.length-1],kn=(wn==null?void 0:wn.fragEnd)??0,_n=kn+yn.numFrag,xn=un.slice(kn,_n),En=yn.length+xn.map(Bn=>Bn.length).reduce((Bn,Nn)=>Bn+Nn),Tn=((wn==null?void 0:wn.totalLength)??0)+En;return vn.concat({skel:yn,frags:xn,fragEnd:_n,length:En,totalLength:Tn})},[]));const dn=await this.getResourcesByMagic(["RESC","PAGE"]),hn=new Map;if(dn.RESC){const vn=await this.mobi.loadRecord(dn.RESC),yn=this.mobi.decode(vn.slice(16)).replace(/\0/g,""),wn=yn.search(/\?>/),kn=`<package>${yn.slice(wn)}</package>`,_n=this.parser.parseFromString(kn,MIME.XML);for(const xn of _n.querySelectorAll("spine > itemref")){const En=parseInt(xn.getAttribute("skelid"));hn.set(En,getPageSpread(((pn=xn.getAttribute("properties"))==null?void 0:pn.split(" "))??[]))}}this.sections=$n(this,Fs).map((vn,yn)=>vn.frags.length?{id:yn,load:()=>this.loadSection(vn),createDocument:()=>this.createDocument(vn),size:vn.length,pageSpread:hn.get(yn)}:{linear:"no"});try{const vn=await this.mobi.getNCX(),yn=({label:wn,pos:kn,children:_n})=>{const[xn,En]=kn,Tn=makePosURI(xn,En),Bn=$n(this,di).get(xn);return Bn?Bn.push(En):$n(this,di).set(xn,[En]),{label:unescapeHTML(wn),href:Tn,subitems:_n==null?void 0:_n.map(yn)}};this.toc=vn==null?void 0:vn.map(yn),this.landmarks=await this.getGuide()}catch(vn){console.warn(vn)}const{exth:fn}=this.mobi.headers;return this.dir=fn.pageProgressionDirection,this.rendition={layout:fn.fixedLayout==="true"?"pre-paginated":"reflowable",viewport:Object.fromEntries(((bn=(mn=(gn=fn.originalResolution)==null?void 0:gn.split("x"))==null?void 0:mn.slice(0,2))==null?void 0:bn.map((vn,yn)=>[yn?"height":"width",vn]))??[])},this.metadata=this.mobi.getMetadata(),this.getCover=this.mobi.getCover.bind(this.mobi),this}async getResourcesByMagic(on){const sn={},ln=this.mobi.headers.kf8.resourceStart,cn=this.mobi.pdb.numRecords;for(let un=ln;un<cn;un++)try{const dn=await this.mobi.loadMagic(un),hn=on.find(fn=>fn===dn);hn&&(sn[hn]=un)}catch{}return sn}async getGuide(){const on=this.mobi.headers.kf8.guide;if(on<4294967295){const sn=this.mobi.loadRecord.bind(this.mobi),{table:ln,cncx:cn}=await getIndexData(on,sn);return ln.map(({name:un,tagMap:dn})=>{var hn,fn;return{label:cn[dn[1][0]]??"",type:un==null?void 0:un.split(/\s/),href:makePosURI(((hn=dn[6])==null?void 0:hn[0])??((fn=dn[3])==null?void 0:fn[0]))}})}}async loadResourceBlob(on){var fn;const{resourceType:sn,id:ln,type:cn}=parseResourceURI(on),un=sn==="flow"?await this.loadFlow(ln):await this.mobi.loadResource(ln-1),dn=[MIME.XHTML,MIME.HTML,MIME.CSS,MIME.SVG].includes(cn)?await this.replaceResources(this.mobi.decode(un)):un,hn=cn===MIME.SVG?this.parser.parseFromString(dn,cn):null;return[new Blob([dn],{type:cn}),(fn=hn==null?void 0:hn.getElementsByTagNameNS("http://www.w3.org/2000/svg","image"))!=null&&fn.length?hn.documentElement:null]}async loadResource(on){if($n(this,Lo).has(on))return $n(this,Lo).get(on);const[sn,ln]=await this.loadResourceBlob(on),cn=ln?on:URL.createObjectURL(sn);return ln&&$n(this,Ji).set(cn,ln),$n(this,Lo).set(on,cn),cn}replaceResources(on){const sn=new RegExp(kindleResourceRegex,"g");return replaceSeries(on,sn,this.loadResource.bind(this))}async loadRaw(on,sn){const ln=sn-$n(this,ps).length,cn=$n(this,fs)==null?1/0:$n(this,fs)-$n(this,es).length-on;if(ln<0||ln<cn){for(;$n(this,ps).length<sn;){const dn=++Ii(this,$a)._,hn=await this.mobi.loadText(dn);yr(this,ps,concatTypedArray$1($n(this,ps),hn))}return $n(this,ps).slice(on,sn)}for(;$n(this,fs)-$n(this,es).length>on;){const dn=this.mobi.headers.palmdoc.numTextRecords-1-++Ii(this,Ba)._,hn=await this.mobi.loadText(dn);yr(this,es,concatTypedArray$1(hn,$n(this,es)))}const un=$n(this,fs)-$n(this,es).length;return $n(this,es).slice(on-un,sn-un)}loadFlow(on){if(on<4294967295)return this.loadRaw(...$n(this,Os).fdstTable[on])}async loadText(on){const{skel:sn,frags:ln,length:cn}=on,un=await this.loadRaw(sn.offset,sn.offset+cn);let dn=un.slice(0,sn.length);for(const hn of ln){const fn=hn.insertOffset-sn.offset,pn=sn.length+hn.offset,gn=un.slice(pn,pn+hn.length);dn=concatTypedArray3(dn.slice(0,fn),gn,dn.slice(fn));const mn=$n(this,di).get(hn.index);if(mn)for(const bn of mn){const vn=this.mobi.decode(gn).slice(bn),yn=getFragmentSelector(vn);dr(this,Xi,Fa).call(this,hn.index,bn,yn)}}return this.mobi.decode(dn)}async createDocument(on){const sn=await this.loadText(on);return this.parser.parseFromString(sn,$n(this,gs))}async loadSection(on){var dn;if($n(this,Lo).has(on))return $n(this,Lo).get(on);const sn=await this.loadText(on),ln=await this.replaceResources(sn);let cn=this.parser.parseFromString(ln,$n(this,gs));(cn.querySelector("parsererror")||!((dn=cn.documentElement)!=null&&dn.namespaceURI))&&(yr(this,gs,MIME.HTML),cn=this.parser.parseFromString(ln,$n(this,gs)));for(const[hn,fn]of $n(this,Ji))for(const pn of cn.querySelectorAll(`img[src="${hn}"]`))pn.replaceWith(fn);const un=URL.createObjectURL(new Blob([this.serializer.serializeToString(cn)],{type:$n(this,gs)}));return $n(this,Lo).set(on,un),un}getIndexByFID(on){return $n(this,Fs).findIndex(sn=>sn.frags.some(ln=>ln.index===on))}async resolveHref(on){var yn;const{fid:sn,off:ln}=parsePosURI(on),cn=this.getIndexByFID(sn);if(cn<0)return;const un=(yn=$n(this,Ps).get(sn))==null?void 0:yn.get(ln);if(un)return{index:cn,anchor:wn=>wn.querySelector(un)};const{skel:dn,frags:hn}=$n(this,Fs)[cn],fn=hn.find(wn=>wn.index===sn),pn=dn.offset+dn.length+fn.offset,gn=await this.loadRaw(pn,pn+fn.length),mn=this.mobi.decode(gn).slice(ln),bn=getFragmentSelector(mn);return dr(this,Xi,Fa).call(this,sn,ln,bn),{index:cn,anchor:wn=>wn.querySelector(bn)}}splitTOCHref(on){const sn=parsePosURI(on);return[this.getIndexByFID(sn.fid),sn]}getTOCFragment(on,{fid:sn,off:ln}){var un;const cn=(un=$n(this,Ps).get(sn))==null?void 0:un.get(ln);return on.querySelector(cn)}isExternal(on){return/^(?!blob|kindle)\w+:/i.test(on)}destroy(){for(const on of $n(this,Lo).values())URL.revokeObjectURL(on)}}Lo=new WeakMap,di=new WeakMap,Ps=new WeakMap,Os=new WeakMap,Fs=new WeakMap,fs=new WeakMap,ps=new WeakMap,es=new WeakMap,$a=new WeakMap,Ba=new WeakMap,gs=new WeakMap,Ji=new WeakMap,Xi=new WeakSet,Fa=function(on,sn,ln){const cn=$n(this,Ps).get(on);if(cn)cn.set(sn,ln);else{const un=new Map;$n(this,Ps).set(on,un),un.set(sn,ln)}};const mobi=Object.freeze(Object.defineProperty({__proto__:null,MOBI,isMOBI},Symbol.toStringTag,{value:"Module"}));var r=Uint8Array,a=Uint16Array,e=Int32Array,n=new r([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),i$1=new r([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),t=new r([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),f=function(an,on){for(var sn=new a(31),ln=0;ln<31;++ln)sn[ln]=on+=1<<an[ln-1];var cn=new e(sn[30]);for(ln=1;ln<30;++ln)for(var un=sn[ln];un<sn[ln+1];++un)cn[un]=un-sn[ln]<<5|ln;return{b:sn,r:cn}},o=f(n,2),v=o.b,l=o.r;v[28]=258,l[258]=28;for(var u=f(i$1,0).b,c=new a(32768),d=0;d<32768;++d){var w=(43690&d)>>1|(21845&d)<<1;w=(61680&(w=(52428&w)>>2|(13107&w)<<2))>>4|(3855&w)<<4,c[d]=((65280&w)>>8|(255&w)<<8)>>1}var b=function(an,on,sn){for(var ln=an.length,cn=0,un=new a(on);cn<ln;++cn)an[cn]&&++un[an[cn]-1];var dn,hn=new a(on);for(cn=1;cn<on;++cn)hn[cn]=hn[cn-1]+un[cn-1]<<1;{dn=new a(1<<on);var fn=15-on;for(cn=0;cn<ln;++cn)if(an[cn])for(var pn=cn<<4|an[cn],gn=on-an[cn],mn=hn[an[cn]-1]++<<gn,bn=mn|(1<<gn)-1;mn<=bn;++mn)dn[c[mn]>>fn]=pn}return dn},s=new r(288);for(d=0;d<144;++d)s[d]=8;for(d=144;d<256;++d)s[d]=9;for(d=256;d<280;++d)s[d]=7;for(d=280;d<288;++d)s[d]=8;var h=new r(32);for(d=0;d<32;++d)h[d]=5;var y=b(s,9),g=b(h,5),p=function(an){for(var on=an[0],sn=1;sn<an.length;++sn)an[sn]>on&&(on=an[sn]);return on},k=function(an,on,sn){var ln=on/8|0;return(an[ln]|an[ln+1]<<8)>>(7&on)&sn},m=function(an,on){var sn=on/8|0;return(an[sn]|an[sn+1]<<8|an[sn+2]<<16)>>(7&on)},x$1=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],T=function(an,on,sn){var ln=new Error(on||x$1[an]);if(ln.code=an,Error.captureStackTrace&&Error.captureStackTrace(ln,T),!sn)throw ln;return ln},E=function(an,on,sn,ln){var cn=an.length,un=ln?ln.length:0;if(!cn||on.f&&!on.l)return sn||new r(0);var dn=!sn,hn=dn||on.i!=2,fn=on.i;dn&&(sn=new r(3*cn));var pn=function(Jn){var Fn=sn.length;if(Jn>Fn){var Kn=new r(Math.max(2*Fn,Jn));Kn.set(sn),sn=Kn}},gn=on.f||0,mn=on.p||0,bn=on.b||0,vn=on.l,yn=on.d,wn=on.m,kn=on.n,_n=8*cn;do{if(!vn){gn=k(an,mn,1);var xn=k(an,mn+1,3);if(mn+=3,!xn){var En=an[(Sn=4+((mn+7)/8|0))-4]|an[Sn-3]<<8,Tn=Sn+En;if(Tn>cn){fn&&T(0);break}hn&&pn(bn+En),sn.set(an.subarray(Sn,Tn),bn),on.b=bn+=En,on.p=mn=8*Tn,on.f=gn;continue}if(xn==1)vn=y,yn=g,wn=9,kn=5;else if(xn==2){var Bn=k(an,mn,31)+257,Nn=k(an,mn+10,15)+4,Mn=Bn+k(an,mn+5,31)+1;mn+=14;for(var Ln=new r(Mn),On=new r(19),zn=0;zn<Nn;++zn)On[t[zn]]=k(an,mn+3*zn,7);mn+=3*Nn;var Pn=p(On),An=(1<<Pn)-1,Vn=b(On,Pn);for(zn=0;zn<Mn;){var Sn,Rn=Vn[k(an,mn,An)];if(mn+=15&Rn,(Sn=Rn>>4)<16)Ln[zn++]=Sn;else{var Hn=0,Zn=0;for(Sn==16?(Zn=3+k(an,mn,3),mn+=2,Hn=Ln[zn-1]):Sn==17?(Zn=3+k(an,mn,7),mn+=3):Sn==18&&(Zn=11+k(an,mn,127),mn+=7);Zn--;)Ln[zn++]=Hn}}var Qn=Ln.subarray(0,Bn),Yn=Ln.subarray(Bn);wn=p(Qn),kn=p(Yn),vn=b(Qn,wn),yn=b(Yn,kn)}else T(1);if(mn>_n){fn&&T(0);break}}hn&&pn(bn+131072);for(var tr=(1<<wn)-1,Un=(1<<kn)-1,Xn=mn;;Xn=mn){var or=(Hn=vn[m(an,mn)&tr])>>4;if((mn+=15&Hn)>_n){fn&&T(0);break}if(Hn||T(2),or<256)sn[bn++]=or;else{if(or==256){Xn=mn,vn=null;break}var kr=or-254;if(or>264){var wr=n[zn=or-257];kr=k(an,mn,(1<<wr)-1)+v[zn],mn+=wr}var Nr=yn[m(an,mn)&Un],$r=Nr>>4;if(Nr||T(3),mn+=15&Nr,Yn=u[$r],$r>3&&(wr=i$1[$r],Yn+=m(an,mn)&(1<<wr)-1,mn+=wr),mn>_n){fn&&T(0);break}hn&&pn(bn+131072);var cr=bn+kr;if(bn<Yn){var hr=un-Yn,gr=Math.min(Yn,cr);for(hr+bn<0&&T(3);bn<gr;++bn)sn[bn]=ln[hr+bn]}for(;bn<cr;++bn)sn[bn]=sn[bn-Yn]}}on.l=vn,on.p=Xn,on.b=bn,on.f=gn,vn&&(gn=1,on.m=wn,on.d=yn,on.n=kn)}while(!gn);return bn!=sn.length&&dn?(function(Jn,Fn,Kn){return(Kn==null||Kn>Jn.length)&&(Kn=Jn.length),new r(Jn.subarray(Fn,Kn))})(sn,0,bn):sn.subarray(0,bn)},z=new r(0);function A(an,on){return E(an.subarray((sn=an,ln=on&&on.dictionary,((15&sn[0])!=8||sn[0]>>4>7||(sn[0]<<8|sn[1])%31)&&T(6,"invalid zlib data"),(sn[1]>>5&1)==+!ln&&T(6,"invalid zlib data: "+(32&sn[1]?"need":"unexpected")+" dictionary"),2+(sn[1]>>3&4)),-4),{i:2},on&&on.out,on&&on.dictionary);var sn,ln}var U=typeof TextDecoder<"u"&&new TextDecoder;try{U.decode(z,{stream:!0})}catch(an){}const fflate=Object.freeze(Object.defineProperty({__proto__:null,unzlibSync:A},Symbol.toStringTag,{value:"Module"}));(function(){if(typeof document>"u"||"adoptedStyleSheets"in document)return;var an="ShadyCSS"in window&&!ShadyCSS.nativeShadow,on=document.implementation.createHTMLDocument(""),sn=new WeakMap,ln=typeof DOMException=="object"?Error:DOMException,cn=Object.defineProperty,un=Array.prototype.forEach,dn=/@import.+?;?$/gm;function hn(cr){var hr=cr.replace(dn,"");return hr!==cr&&console.warn("@import rules are not allowed here. See https://github.com/WICG/construct-stylesheets/issues/119#issuecomment-588352418"),hr.trim()}function fn(cr){return"isConnected"in cr?cr.isConnected:document.contains(cr)}function pn(cr){return cr.filter(function(hr,gr){return cr.indexOf(hr)===gr})}function gn(cr,hr){return cr.filter(function(gr){return hr.indexOf(gr)===-1})}function mn(cr){cr.parentNode.removeChild(cr)}function bn(cr){return cr.shadowRoot||sn.get(cr)}var vn=["addRule","deleteRule","insertRule","removeRule"],yn=CSSStyleSheet,wn=yn.prototype;wn.replace=function(){return Promise.reject(new ln("Can't call replace on non-constructed CSSStyleSheets."))},wn.replaceSync=function(){throw new ln("Failed to execute 'replaceSync' on 'CSSStyleSheet': Can't call replaceSync on non-constructed CSSStyleSheets.")};function kn(cr){return typeof cr=="object"?An.isPrototypeOf(cr)||wn.isPrototypeOf(cr):!1}function _n(cr){return typeof cr=="object"?wn.isPrototypeOf(cr):!1}var xn=new WeakMap,En=new WeakMap,Tn=new WeakMap,Bn=new WeakMap;function Nn(cr,hr){var gr=document.createElement("style");return Tn.get(cr).set(hr,gr),En.get(cr).push(hr),gr}function Mn(cr,hr){return Tn.get(cr).get(hr)}function Ln(cr,hr){Tn.get(cr).delete(hr),En.set(cr,En.get(cr).filter(function(gr){return gr!==hr}))}function On(cr,hr){requestAnimationFrame(function(){hr.textContent=xn.get(cr).textContent,Bn.get(cr).forEach(function(gr){return hr.sheet[gr.method].apply(hr.sheet,gr.args)})})}function zn(cr){if(!xn.has(cr))throw new TypeError("Illegal invocation")}function Pn(){var cr=this,hr=document.createElement("style");on.body.appendChild(hr),xn.set(cr,hr),En.set(cr,[]),Tn.set(cr,new WeakMap),Bn.set(cr,[])}var An=Pn.prototype;An.replace=function(hr){try{return this.replaceSync(hr),Promise.resolve(this)}catch(gr){return Promise.reject(gr)}},An.replaceSync=function(hr){if(zn(this),typeof hr=="string"){var gr=this;xn.get(gr).textContent=hn(hr),Bn.set(gr,[]),En.get(gr).forEach(function(Jn){Jn.isConnected()&&On(gr,Mn(gr,Jn))})}},cn(An,"cssRules",{configurable:!0,enumerable:!0,get:function(){return zn(this),xn.get(this).sheet.cssRules}}),cn(An,"media",{configurable:!0,enumerable:!0,get:function(){return zn(this),xn.get(this).sheet.media}}),vn.forEach(function(cr){An[cr]=function(){var hr=this;zn(hr);var gr=arguments;Bn.get(hr).push({method:cr,args:gr}),En.get(hr).forEach(function(Fn){if(Fn.isConnected()){var Kn=Mn(hr,Fn).sheet;Kn[cr].apply(Kn,gr)}});var Jn=xn.get(hr).sheet;return Jn[cr].apply(Jn,gr)}}),cn(Pn,Symbol.hasInstance,{configurable:!0,value:kn});var Vn={childList:!0,subtree:!0},Sn=new WeakMap;function Rn(cr){var hr=Sn.get(cr);return hr||(hr=new kr(cr),Sn.set(cr,hr)),hr}function Hn(cr){cn(cr.prototype,"adoptedStyleSheets",{configurable:!0,enumerable:!0,get:function(){return Rn(this).sheets},set:function(hr){Rn(this).update(hr)}})}function Zn(cr,hr){for(var gr=document.createNodeIterator(cr,NodeFilter.SHOW_ELEMENT,function(Fn){return bn(Fn)?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_REJECT},null,!1),Jn=void 0;Jn=gr.nextNode();)hr(bn(Jn))}var Qn=new WeakMap,Yn=new WeakMap,tr=new WeakMap;function Un(cr,hr){return hr instanceof HTMLStyleElement&&Yn.get(cr).some(function(gr){return Mn(gr,cr)})}function Xn(cr){var hr=Qn.get(cr);return hr instanceof Document?hr.body:hr}function or(cr){var hr=document.createDocumentFragment(),gr=Yn.get(cr),Jn=tr.get(cr),Fn=Xn(cr);Jn.disconnect(),gr.forEach(function(Kn){hr.appendChild(Mn(Kn,cr)||Nn(Kn,cr))}),Fn.insertBefore(hr,null),Jn.observe(Fn,Vn),gr.forEach(function(Kn){On(Kn,Mn(Kn,cr))})}function kr(cr){var hr=this;hr.sheets=[],Qn.set(hr,cr),Yn.set(hr,[]),tr.set(hr,new MutationObserver(function(gr,Jn){if(!document){Jn.disconnect();return}gr.forEach(function(Fn){an||un.call(Fn.addedNodes,function(Kn){Kn instanceof Element&&Zn(Kn,function(Cn){Rn(Cn).connect()})}),un.call(Fn.removedNodes,function(Kn){Kn instanceof Element&&(Un(hr,Kn)&&or(hr),an||Zn(Kn,function(Cn){Rn(Cn).disconnect()}))})})}))}if(kr.prototype={isConnected:function(){var cr=Qn.get(this);return cr instanceof Document?cr.readyState!=="loading":fn(cr.host)},connect:function(){var cr=Xn(this);tr.get(this).observe(cr,Vn),Yn.get(this).length>0&&or(this),Zn(cr,function(hr){Rn(hr).connect()})},disconnect:function(){tr.get(this).disconnect()},update:function(cr){var hr=this,gr=Qn.get(hr)===document?"Document":"ShadowRoot";if(!Array.isArray(cr))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+gr+": Iterator getter is not callable.");if(!cr.every(kn))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+gr+": Failed to convert value to 'CSSStyleSheet'");if(cr.some(_n))throw new TypeError("Failed to set the 'adoptedStyleSheets' property on "+gr+": Can't adopt non-constructed stylesheets");hr.sheets=cr;var Jn=Yn.get(hr),Fn=pn(cr),Kn=gn(Jn,Fn);Kn.forEach(function(Cn){mn(Mn(Cn,hr)),Ln(Cn,hr)}),Yn.set(hr,Fn),hr.isConnected()&&Fn.length>0&&or(hr)}},window.CSSStyleSheet=Pn,Hn(Document),"ShadowRoot"in window){Hn(ShadowRoot);var wr=Element.prototype,Nr=wr.attachShadow;wr.attachShadow=function(hr){var gr=Nr.call(this,hr);return hr.mode==="closed"&&sn.set(this,gr),gr}}var $r=Rn(document);$r.isConnected()?$r.connect():document.addEventListener("DOMContentLoaded",$r.connect.bind($r))})();const parseViewport=an=>{var on,sn;return(sn=(on=an==null?void 0:an.split(/[,;\s]/))==null?void 0:on.filter(ln=>ln))==null?void 0:sn.map(ln=>ln.split("=").map(cn=>cn.trim()))},getViewport=(an,on)=>{var cn,un;if(an.documentElement.localName==="svg"){const[,,dn,hn]=((cn=an.documentElement.getAttribute("viewBox"))==null?void 0:cn.split(/\s/))??[];return{width:dn,height:hn}}const sn=parseViewport((un=an.querySelector('meta[name="viewport"]'))==null?void 0:un.getAttribute("content"));if(sn)return Object.fromEntries(sn);if(typeof on=="string")return parseViewport(on);if(on)return on;const ln=an.querySelector("img");return ln?{width:ln.naturalWidth,height:ln.naturalHeight}:(console.warn(new Error("Missing viewport properties")),{width:1e3,height:2e3})};var Vs,Yi,ts,ms,hi,Ao,Mo,_o,ys,bs,qr,va,Zs,Va,La,za,wa;class FixedLayout extends HTMLElement{constructor(){super();pr(this,qr);pr(this,Vs,this.attachShadow({mode:"closed"}));pr(this,Yi,new ResizeObserver(()=>dr(this,qr,Zs).call(this)));pr(this,ts);pr(this,ms,-1);ir(this,"defaultViewport");ir(this,"spread");pr(this,hi,!1);pr(this,Ao);pr(this,Mo);pr(this,_o);pr(this,ys);pr(this,bs);const sn=new CSSStyleSheet;$n(this,Vs).adoptedStyleSheets=[sn],sn.replaceSync(`:host {
            width: 100%;
            height: 100%;
            display: flex;
            justify-content: center;
            align-items: center;
            overflow: auto;
        }`),$n(this,Yi).observe(this)}attributeChangedCallback(sn,ln,cn){switch(sn){case"zoom":yr(this,bs,cn!=="fit-width"&&cn!=="fit-page"?parseFloat(cn):cn),dr(this,qr,Zs).call(this);break}}open(sn){this.book=sn;const{rendition:ln}=sn;this.spread=ln==null?void 0:ln.spread,this.defaultViewport=ln==null?void 0:ln.viewport;const cn=sn.dir==="rtl",un=!cn;this.rtl=cn,(ln==null?void 0:ln.spread)==="none"?yr(this,ts,sn.sections.map(dn=>({center:dn}))):yr(this,ts,sn.sections.reduce((dn,hn,fn)=>{const pn=dn[dn.length-1],{pageSpread:gn}=hn,mn=()=>{const bn={};return dn.push(bn),bn};if(gn==="center"){const bn=pn.left||pn.right?mn():pn;bn.center=hn}else if(gn==="left"){const bn=pn.center||pn.left||un&&fn?mn():pn;bn.left=hn}else if(gn==="right"){const bn=pn.center||pn.right||cn&&fn?mn():pn;bn.right=hn}else un?pn.center||pn.right?mn().left=hn:pn.left||!fn?pn.right=hn:pn.left=hn:pn.center||pn.left?mn().right=hn:pn.right||!fn?pn.left=hn:pn.right=hn;return dn},[{}]))}get index(){const sn=$n(this,ts)[$n(this,ms)],ln=(sn==null?void 0:sn.center)??(this.side==="left"?sn.left??sn.right:sn.right??sn.left);return this.book.sections.indexOf(ln)}getSpreadOf(sn){const ln=$n(this,ts);for(let cn=0;cn<ln.length;cn++){const{left:un,right:dn,center:hn}=ln[cn];if(un===sn)return{index:cn,side:"left"};if(dn===sn)return{index:cn,side:"right"};if(hn===sn)return{index:cn,side:"center"}}}async goToSpread(sn,ln,cn){var dn,hn,fn,pn,gn,mn;if(sn<0||sn>$n(this,ts).length-1)return;if(sn===$n(this,ms)){dr(this,qr,Zs).call(this,ln);return}yr(this,ms,sn);const un=$n(this,ts)[sn];if(un.center){const bn=this.book.sections.indexOf(un.center),vn=await((hn=(dn=un.center)==null?void 0:dn.load)==null?void 0:hn.call(dn));await dr(this,qr,Va).call(this,{center:{index:bn,src:vn}})}else{const bn=this.book.sections.indexOf(un.left),vn=this.book.sections.indexOf(un.right),yn=await((pn=(fn=un.left)==null?void 0:fn.load)==null?void 0:pn.call(fn)),wn=await((mn=(gn=un.right)==null?void 0:gn.load)==null?void 0:mn.call(gn)),kn={index:bn,src:yn},_n={index:vn,src:wn};await dr(this,qr,Va).call(this,{left:kn,right:_n,side:ln})}dr(this,qr,wa).call(this,cn)}async select(sn){await this.goTo(sn)}async goTo(sn){const{book:ln}=this,cn=await sn,un=ln.sections[cn.index];if(!un)return;const{index:dn,side:hn}=this.getSpreadOf(un);await this.goToSpread(dn,hn)}async next(){if(this.rtl?dr(this,qr,La).call(this):dr(this,qr,za).call(this))dr(this,qr,wa).call(this,"page");else return this.goToSpread($n(this,ms)+1,this.rtl?"right":"left","page")}async prev(){if(this.rtl?dr(this,qr,za).call(this):dr(this,qr,La).call(this))dr(this,qr,wa).call(this,"page");else return this.goToSpread($n(this,ms)-1,this.rtl?"left":"right","page")}getContents(){return Array.from($n(this,Vs).querySelectorAll("iframe"),sn=>({doc:sn.contentDocument}))}destroy(){$n(this,Yi).unobserve(this)}}Vs=new WeakMap,Yi=new WeakMap,ts=new WeakMap,ms=new WeakMap,hi=new WeakMap,Ao=new WeakMap,Mo=new WeakMap,_o=new WeakMap,ys=new WeakMap,bs=new WeakMap,qr=new WeakSet,va=async function({index:sn,src:ln}){const cn=typeof ln=="string",un=cn?ln:ln==null?void 0:ln.src,dn=cn?null:ln==null?void 0:ln.onZoom,hn=document.createElement("div"),fn=document.createElement("iframe");return hn.append(fn),Object.assign(fn.style,{border:"0",display:"none",overflow:"hidden"}),fn.setAttribute("sandbox","allow-same-origin allow-scripts"),fn.setAttribute("scrolling","no"),fn.setAttribute("part","filter"),$n(this,Vs).append(hn),un?new Promise(pn=>{fn.addEventListener("load",()=>{const gn=fn.contentDocument;this.dispatchEvent(new CustomEvent("load",{detail:{doc:gn,index:sn}}));const{width:mn,height:bn}=getViewport(gn,this.defaultViewport);pn({element:hn,iframe:fn,width:parseFloat(mn),height:parseFloat(bn),onZoom:dn})},{once:!0}),fn.src=un}):{blank:!0,element:hn,iframe:fn}},Zs=function(sn=$n(this,ys)){if(!sn)return;const ln=$n(this,Ao)??{},cn=$n(this,_o)??$n(this,Mo),un=sn==="left"?ln:cn,{width:dn,height:hn}=this.getBoundingClientRect(),fn=this.spread!=="both"&&this.spread!=="portrait"&&hn>dn;yr(this,hi,fn);const pn=ln.width??cn.width,gn=ln.height??cn.height,mn=typeof $n(this,bs)=="number"&&!isNaN($n(this,bs))?$n(this,bs):$n(this,bs)==="fit-width"?fn||$n(this,_o)?dn/(un.width??pn):dn/((ln.width??pn)+(cn.width??pn)):fn||$n(this,_o)?Math.min(dn/(un.width??pn),hn/(un.height??gn)):Math.min(dn/((ln.width??pn)+(cn.width??pn)),hn/Math.max(ln.height??gn,cn.height??gn)),bn=vn=>{let{element:yn,iframe:wn,width:kn,height:_n,blank:xn,onZoom:En}=vn;En&&En({doc:vn.iframe.contentDocument,scale:mn});const Tn=En?mn:1;Object.assign(wn.style,{width:`${kn*Tn}px`,height:`${_n*Tn}px`,transform:En?"none":`scale(${mn})`,transformOrigin:"top left",display:xn?"none":"block"}),Object.assign(yn.style,{width:`${(kn??pn)*mn}px`,height:`${(_n??gn)*mn}px`,overflow:"hidden",display:"block",flexShrink:"0",marginBlock:"auto"}),fn&&vn!==un&&(yn.style.display="none")};$n(this,_o)?bn($n(this,_o)):(bn(ln),bn(cn))},Va=async function({left:sn,right:ln,center:cn,side:un}){$n(this,Vs).replaceChildren(),yr(this,Ao,null),yr(this,Mo,null),yr(this,_o,null),cn?(yr(this,_o,await dr(this,qr,va).call(this,cn)),yr(this,ys,"center"),dr(this,qr,Zs).call(this)):(yr(this,Ao,await dr(this,qr,va).call(this,sn)),yr(this,Mo,await dr(this,qr,va).call(this,ln)),yr(this,ys,$n(this,Ao).blank?"right":$n(this,Mo).blank?"left":un),dr(this,qr,Zs).call(this))},La=function(){var sn,ln,cn,un;if(!($n(this,_o)||(sn=$n(this,Ao))!=null&&sn.blank)&&$n(this,hi)&&((un=(cn=(ln=$n(this,Ao))==null?void 0:ln.element)==null?void 0:cn.style)==null?void 0:un.display)==="none")return $n(this,Mo).element.style.display="none",$n(this,Ao).element.style.display="block",yr(this,ys,"left"),!0},za=function(){var sn,ln,cn,un;if(!($n(this,_o)||(sn=$n(this,Mo))!=null&&sn.blank)&&$n(this,hi)&&((un=(cn=(ln=$n(this,Mo))==null?void 0:ln.element)==null?void 0:cn.style)==null?void 0:un.display)==="none")return $n(this,Ao).element.style.display="none",$n(this,Mo).element.style.display="block",yr(this,ys,"right"),!0},wa=function(sn){this.dispatchEvent(new CustomEvent("relocate",{detail:{reason:sn,range:null,index:this.index,fraction:0,size:1}}))},ir(FixedLayout,"observedAttributes",["zoom"]);customElements.define("foliate-fxl",FixedLayout);const fixedLayout=Object.freeze(Object.defineProperty({__proto__:null,FixedLayout},Symbol.toStringTag,{value:"Module"})),wait=an=>new Promise(on=>setTimeout(on,an)),debounce=(an,on,sn)=>{let ln;return(...cn)=>{const un=()=>{ln=null,an(...cn)};ln&&clearTimeout(ln),ln=setTimeout(un,on)}},lerp=(an,on,sn)=>sn*(on-an)+an,easeOutQuad=an=>1-(1-an)*(1-an),animate=(an,on,sn,ln,cn)=>new Promise(un=>{let dn;const hn=fn=>{dn??(dn=fn);const pn=Math.min(1,(fn-dn)/sn);cn(lerp(an,on,ln(pn))),pn<1?requestAnimationFrame(hn):un()};requestAnimationFrame(hn)}),uncollapse=an=>{if(!(an!=null&&an.collapsed))return an;const{endOffset:on,endContainer:sn}=an;if(sn.nodeType===1){const ln=sn.childNodes[on];return(ln==null?void 0:ln.nodeType)===1?ln:sn}if(on+1<sn.length)an.setEnd(sn,on+1);else if(on>1)an.setStart(sn,on-1);else return sn.parentNode;return an},makeRange=(an,on,sn,ln=sn)=>{const cn=an.createRange();return cn.setStart(on,sn),cn.setEnd(on,ln),cn},bisectNode=(an,on,sn,ln=0,cn=on.nodeValue.length)=>{if(cn-ln===1)return sn(makeRange(an,on,ln),makeRange(an,on,cn))<0?ln:cn;const un=Math.floor(ln+(cn-ln)/2),dn=sn(makeRange(an,on,ln,un),makeRange(an,on,un,cn));return dn<0?bisectNode(an,on,sn,ln,un):dn>0?bisectNode(an,on,sn,un,cn):un},{SHOW_ELEMENT,SHOW_TEXT,SHOW_CDATA_SECTION,FILTER_ACCEPT,FILTER_REJECT,FILTER_SKIP}=NodeFilter,filter=SHOW_ELEMENT|SHOW_TEXT|SHOW_CDATA_SECTION,getBoundingClientRect=an=>{let on=1/0,sn=-1/0,ln=1/0,cn=-1/0;for(const un of an.getClientRects())ln=Math.min(ln,un.left),on=Math.min(on,un.top),sn=Math.max(sn,un.right),cn=Math.max(cn,un.bottom);return new DOMRect(ln,on,sn-ln,cn-on)},getVisibleRange=(an,on,sn,ln)=>{const cn=bn=>{var yn,wn;const vn=(yn=bn.localName)==null?void 0:yn.toLowerCase();if(vn==="script"||vn==="style")return FILTER_REJECT;if(bn.nodeType===1){const{left:kn,right:_n}=ln(bn.getBoundingClientRect());if(_n<on||kn>sn)return FILTER_REJECT;if(kn>=on&&_n<=sn)return FILTER_ACCEPT}else{if(!((wn=bn.nodeValue)!=null&&wn.trim()))return FILTER_SKIP;const kn=an.createRange();kn.selectNodeContents(bn);const{left:_n,right:xn}=ln(kn.getBoundingClientRect());if(xn>=on&&_n<=sn)return FILTER_ACCEPT}return FILTER_SKIP},un=an.createTreeWalker(an.body,filter,{acceptNode:cn}),dn=[];for(let bn=un.nextNode();bn;bn=un.nextNode())dn.push(bn);const hn=dn[0]??an.body,fn=dn[dn.length-1]??hn,pn=hn.nodeType===1?0:bisectNode(an,hn,(bn,vn)=>{const yn=ln(getBoundingClientRect(bn)),wn=ln(getBoundingClientRect(vn));return yn.right<on&&wn.left>on?0:wn.left>on?-1:1}),gn=fn.nodeType===1?0:bisectNode(an,fn,(bn,vn)=>{const yn=ln(getBoundingClientRect(bn)),wn=ln(getBoundingClientRect(vn));return yn.right<sn&&wn.left>sn?0:wn.left>sn?-1:1}),mn=an.createRange();return mn.setStart(hn,pn),mn.setEnd(fn,gn),mn},selectionIsBackward=an=>{const on=document.createRange();return on.setStart(an.anchorNode,an.anchorOffset),on.setEnd(an.focusNode,an.focusOffset),on.collapsed},setSelectionTo=(an,on)=>{let sn;if(an.startContainer?sn=an.cloneRange():an.nodeType&&(sn=document.createRange(),sn.selectNode(an)),sn){const ln=sn.startContainer.ownerDocument.defaultView.getSelection();ln.removeAllRanges(),on===-1?sn.collapse(!0):on===1&&sn.collapse(),ln.addRange(sn)}},getDirection=an=>{const{defaultView:on}=an,{writingMode:sn,direction:ln}=on.getComputedStyle(an.body),cn=sn==="vertical-rl"||sn==="vertical-lr",un=an.body.dir==="rtl"||ln==="rtl"||an.documentElement.dir==="rtl";return{vertical:cn,rtl:un}},getBackground=an=>{const on=an.defaultView.getComputedStyle(an.body);return on.backgroundColor==="rgba(0, 0, 0, 0)"&&on.backgroundImage==="none"?an.defaultView.getComputedStyle(an.documentElement).background:on.background},makeMarginals=(an,on)=>Array.from({length:an},()=>{const sn=document.createElement("div"),ln=document.createElement("div");return sn.append(ln),ln.setAttribute("part",on),sn}),setStylesImportant=(an,on)=>{const{style:sn}=an;for(const[ln,cn]of Object.entries(on))sn.setProperty(ln,cn,"important")};var Zi,go,Yr,Qi,to,so,ea,fi,zo,pi;class View{constructor({container:on,onExpand:sn}){pr(this,Zi,new ResizeObserver(()=>this.expand()));pr(this,go,document.createElement("div"));pr(this,Yr,document.createElement("iframe"));pr(this,Qi,document.createRange());pr(this,to);pr(this,so,!1);pr(this,ea,!1);pr(this,fi,!0);pr(this,zo);pr(this,pi,{});this.container=on,this.onExpand=sn,$n(this,Yr).setAttribute("part","filter"),$n(this,go).append($n(this,Yr)),Object.assign($n(this,go).style,{boxSizing:"content-box",position:"relative",overflow:"hidden",flex:"0 0 auto",width:"100%",height:"100%",display:"flex",justifyContent:"center",alignItems:"center"}),Object.assign($n(this,Yr).style,{overflow:"hidden",border:"0",display:"none",width:"100%",height:"100%"}),$n(this,Yr).setAttribute("sandbox","allow-same-origin allow-scripts"),$n(this,Yr).setAttribute("scrolling","no")}get element(){return $n(this,go)}get document(){return $n(this,Yr).contentDocument}async load(on,sn,ln){if(typeof on!="string")throw new Error(`${on} is not string`);return new Promise(cn=>{$n(this,Yr).addEventListener("load",()=>{const un=this.document;sn==null||sn(un),$n(this,Yr).style.display="block";const{vertical:dn,rtl:hn}=getDirection(un);this.docBackground=getBackground(un),un.body.style.background="none";const fn=this.docBackground;$n(this,Yr).style.display="none",yr(this,so,dn),yr(this,ea,hn),$n(this,Qi).selectNodeContents(un.body);const pn=ln==null?void 0:ln({vertical:dn,rtl:hn,background:fn});$n(this,Yr).style.display="block",this.render(pn),$n(this,Zi).observe(un.body),un.fonts.ready.then(()=>this.expand()),cn()},{once:!0}),$n(this,Yr).src=on})}render(on){!on||!this.document||(yr(this,fi,on.flow!=="scrolled"),yr(this,pi,on),$n(this,fi)?this.columnize(on):this.scrolled(on))}scrolled({margin:on,gap:sn,columnWidth:ln}){const cn=$n(this,so),un=this.document;setStylesImportant(un.documentElement,{"box-sizing":"border-box",padding:cn?`${on*1.5}px ${sn}px`:`0 ${sn}px`,"column-width":"auto",height:"auto",width:"auto"}),setStylesImportant(un.body,{[cn?"max-height":"max-width"]:`${ln}px`,margin:"auto"}),this.setImageSize(),this.expand()}columnize({width:on,height:sn,margin:ln,gap:cn,columnWidth:un}){const dn=$n(this,so);yr(this,zo,dn?sn:on);const hn=this.document;setStylesImportant(hn.documentElement,{"box-sizing":"border-box","column-width":`${Math.trunc(un)}px`,"column-gap":dn?`${ln}px`:`${cn}px`,"column-fill":"auto",...dn?{width:`${on}px`}:{height:`${sn}px`},padding:dn?`${ln/2}px ${cn}px`:`0 ${cn/2}px`,overflow:"hidden","overflow-wrap":"break-word",position:"static",border:"0",margin:"0","max-height":"none","max-width":"none","min-height":"none","min-width":"none","-webkit-line-box-contain":"block glyphs replaced"}),setStylesImportant(hn.body,{"max-height":"none","max-width":"none",margin:"0"}),this.setImageSize(),this.expand()}setImageSize(){const{width:on,height:sn,margin:ln}=$n(this,pi),cn=$n(this,so),un=this.document;for(const dn of un.body.querySelectorAll("img, svg, video")){const{maxHeight:hn,maxWidth:fn}=un.defaultView.getComputedStyle(dn);setStylesImportant(dn,{"max-height":cn?hn!=="none"&&hn!=="0px"?hn:"100%":`${sn-ln*2}px`,"max-width":cn?`${on-ln*2}px`:fn!=="none"&&fn!=="0px"?fn:"100%","object-fit":"contain","page-break-inside":"avoid","break-inside":"avoid","box-sizing":"border-box"})}}expand(){const{documentElement:on}=this.document;if($n(this,fi)){const sn=$n(this,so)?"height":"width",ln=$n(this,so)?"width":"height",cn=$n(this,Qi).getBoundingClientRect(),un=on.getBoundingClientRect(),hn=($n(this,so)?0:$n(this,ea)?un.right-cn.right:cn.left-un.left)+cn[sn],pn=Math.ceil(hn/$n(this,zo))*$n(this,zo);$n(this,go).style.padding="0",$n(this,Yr).style[sn]=`${pn}px`,$n(this,go).style[sn]=`${pn+$n(this,zo)*2}px`,$n(this,Yr).style[ln]="100%",$n(this,go).style[ln]="100%",on.style[sn]=`${$n(this,zo)}px`,$n(this,to)&&($n(this,to).element.style.margin="0",$n(this,to).element.style.left=$n(this,so)?"0":`${$n(this,zo)}px`,$n(this,to).element.style.top=$n(this,so)?`${$n(this,zo)}px`:"0",$n(this,to).element.style[sn]=`${pn}px`,$n(this,to).redraw())}else{const sn=$n(this,so)?"width":"height",ln=$n(this,so)?"height":"width",un=on.getBoundingClientRect()[sn],{margin:dn,gap:hn}=$n(this,pi),fn=$n(this,so)?`0 ${hn}px`:`${dn}px 0`;$n(this,go).style.padding=fn,$n(this,Yr).style[sn]=`${un}px`,$n(this,go).style[sn]=`${un}px`,$n(this,Yr).style[ln]="100%",$n(this,go).style[ln]="100%",$n(this,to)&&($n(this,to).element.style.margin=fn,$n(this,to).element.style.left="0",$n(this,to).element.style.top="0",$n(this,to).element.style[sn]=`${un}px`,$n(this,to).redraw())}this.onExpand()}set overlayer(on){yr(this,to,on),$n(this,go).append(on.element)}get overlayer(){return $n(this,to)}destroy(){this.document&&$n(this,Zi).unobserve(this.document.body)}}Zi=new WeakMap,go=new WeakMap,Yr=new WeakMap,Qi=new WeakMap,to=new WeakMap,so=new WeakMap,ea=new WeakMap,fi=new WeakMap,zo=new WeakMap,pi=new WeakMap;var ns,ta,rs,vs,uo,ws,Ls,Pr,xo,No,ks,jo,Io,gi,zs,na,ra,oa,mi,_s,js,yi,sa,Sr,yl,ka,ja,Ua,Ha,qa,Di,bl,Qs,ei,ti,vl,Ri,Wa,Ka,xa,wl,kl,Ms,Ga;class Paginator extends HTMLElement{constructor(){super();pr(this,Sr);pr(this,ns,this.attachShadow({mode:"closed"}));pr(this,ta,new ResizeObserver(()=>this.render()));pr(this,rs);pr(this,vs);pr(this,uo);pr(this,ws);pr(this,Ls);pr(this,Pr);pr(this,xo,!1);pr(this,No,!1);pr(this,ks,0);pr(this,jo,-1);pr(this,Io,0);pr(this,gi,!1);pr(this,zs,!1);pr(this,na);pr(this,ra,new WeakMap);pr(this,oa,matchMedia("(prefers-color-scheme: dark)"));pr(this,mi);pr(this,_s);pr(this,js);pr(this,yi);pr(this,sa);$n(this,ns).innerHTML=`<style>
        :host {
            display: block;
            container-type: size;
        }
        :host, #top {
            box-sizing: border-box;
            position: relative;
            overflow: hidden;
            width: 100%;
            height: 100%;
        }
        #top {
            --_gap: 7%;
            --_margin: 48px;
            --_max-inline-size: 720px;
            --_max-block-size: 1440px;
            --_max-column-count: 2;
            --_max-column-count-portrait: 1;
            --_max-column-count-spread: var(--_max-column-count);
            --_half-gap: calc(var(--_gap) / 2);
            --_max-width: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            --_max-height: var(--_max-block-size);
            display: grid;
            grid-template-columns:
                minmax(var(--_half-gap), 1fr)
                var(--_half-gap)
                minmax(0, calc(var(--_max-width) - var(--_gap)))
                var(--_half-gap)
                minmax(var(--_half-gap), 1fr);
            grid-template-rows:
                minmax(var(--_margin), 1fr)
                minmax(0, var(--_max-height))
                minmax(var(--_margin), 1fr);
            &.vertical {
                --_max-column-count-spread: var(--_max-column-count-portrait);
                --_max-width: var(--_max-block-size);
                --_max-height: calc(var(--_max-inline-size) * var(--_max-column-count-spread));
            }
            @container (orientation: portrait) {
                & {
                    --_max-column-count-spread: var(--_max-column-count-portrait);
                }
                &.vertical {
                    --_max-column-count-spread: var(--_max-column-count);
                }
            }
        }
        #background {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
        }
        #container {
            grid-column: 2 / 5;
            grid-row: 2;
            overflow: hidden;
        }
        :host([flow="scrolled"]) #container {
            grid-column: 1 / -1;
            grid-row: 1 / -1;
            overflow: auto;
        }
        #header {
            grid-column: 3 / 4;
            grid-row: 1;
        }
        #footer {
            grid-column: 3 / 4;
            grid-row: 3;
            align-self: end;
        }
        #header, #footer {
            display: grid;
            height: var(--_margin);
        }
        :is(#header, #footer) > * {
            display: flex;
            align-items: center;
            min-width: 0;
        }
        :is(#header, #footer) > * > * {
            width: 100%;
            overflow: hidden;
            white-space: nowrap;
            text-overflow: ellipsis;
            text-align: center;
            font-size: .75em;
            opacity: .6;
        }
        </style>
        <div id="top">
            <div id="background" part="filter"></div>
            <div id="header"></div>
            <div id="container" part="container"></div>
            <div id="footer"></div>
        </div>
        `,yr(this,rs,$n(this,ns).getElementById("top")),yr(this,vs,$n(this,ns).getElementById("background")),yr(this,uo,$n(this,ns).getElementById("container")),yr(this,ws,$n(this,ns).getElementById("header")),yr(this,Ls,$n(this,ns).getElementById("footer")),$n(this,ta).observe($n(this,uo)),$n(this,uo).addEventListener("scroll",()=>this.dispatchEvent(new Event("scroll"))),$n(this,uo).addEventListener("scroll",debounce(()=>{this.scrolled&&($n(this,gi)?yr(this,gi,!1):dr(this,Sr,Ri).call(this,"scroll"))},250));const sn={passive:!1};this.addEventListener("touchstart",dr(this,Sr,Ua).bind(this),sn),this.addEventListener("touchmove",dr(this,Sr,Ha).bind(this),sn),this.addEventListener("touchend",dr(this,Sr,qa).bind(this)),this.addEventListener("load",({detail:{doc:cn}})=>{cn.addEventListener("touchstart",dr(this,Sr,Ua).bind(this),sn),cn.addEventListener("touchmove",dr(this,Sr,Ha).bind(this),sn),cn.addEventListener("touchend",dr(this,Sr,qa).bind(this))}),this.addEventListener("relocate",({detail:cn})=>{cn.reason==="selection"?setSelectionTo($n(this,Io),0):cn.reason==="navigation"&&($n(this,Io)===1?setSelectionTo(cn.range,1):typeof $n(this,Io)=="number"?setSelectionTo(cn.range,-1):setSelectionTo($n(this,Io),-1))});const ln=debounce((cn,un)=>{if(!un.rangeCount)return;const dn=un.getRangeAt(0),hn=selectionIsBackward(un);hn&&dn.compareBoundaryPoints(Range.START_TO_START,cn)<0?this.prev():!hn&&dn.compareBoundaryPoints(Range.END_TO_END,cn)>0&&this.next()},700);this.addEventListener("load",({detail:{doc:cn}})=>{let un=!1;cn.addEventListener("pointerdown",()=>un=!0),cn.addEventListener("pointerup",()=>un=!1);let dn=!1;cn.addEventListener("keydown",()=>dn=!0),cn.addEventListener("keyup",()=>dn=!1),cn.addEventListener("selectionchange",()=>{if(this.scrolled)return;const hn=$n(this,sa);if(!hn)return;const fn=cn.getSelection();if(fn.rangeCount){if(un&&fn.type==="Range")ln(hn,fn);else if(dn){const pn=fn.getRangeAt(0).cloneRange();selectionIsBackward(fn)||pn.collapse(),dr(this,Sr,ti).call(this,pn)}}}),cn.addEventListener("focusin",hn=>this.scrolled?null:requestAnimationFrame(()=>dr(this,Sr,ti).call(this,hn.target)))}),yr(this,mi,()=>{$n(this,Pr)&&dr(this,Sr,ka).call(this,$n(this,Pr).docBackground,this.columnCount)}),$n(this,oa).addEventListener("change",$n(this,mi))}attributeChangedCallback(sn,ln,cn){switch(sn){case"flow":this.render();break;case"gap":case"margin":case"max-block-size":case"max-column-count":$n(this,rs).style.setProperty("--_"+sn,cn),this.render();break;case"max-inline-size":$n(this,rs).style.setProperty("--_"+sn,cn),this.render();break}}open(sn){var ln;this.bookDir=sn.dir,this.sections=sn.sections,(ln=sn.transformTarget)==null||ln.addEventListener("data",({detail:cn})=>{if(cn.type!=="text/css")return;const un=innerWidth,dn=innerHeight;cn.data=Promise.resolve(cn.data).then(hn=>hn.replace(new RegExp("(?<=[{\\s;])-epub-","gi"),"").replace(/(\d*\.?\d+)vw/gi,(fn,pn)=>parseFloat(pn)*un/100+"px").replace(/(\d*\.?\d+)vh/gi,(fn,pn)=>parseFloat(pn)*dn/100+"px").replace(/page-break-(after|before|inside)\s*:/gi,(fn,pn)=>`-webkit-column-break-${pn}:`).replace(/break-(after|before|inside)\s*:\s*(avoid-)?page/gi,(fn,pn,gn)=>`break-${pn}: ${gn??""}column`))})}render(){$n(this,Pr)&&($n(this,Pr).render(dr(this,Sr,ja).call(this,{vertical:$n(this,xo),rtl:$n(this,No)})),dr(this,Sr,ti).call(this,$n(this,Io)))}get scrolled(){return this.getAttribute("flow")==="scrolled"}get scrollProp(){const{scrolled:sn}=this;return $n(this,xo)?sn?"scrollLeft":"scrollTop":sn?"scrollTop":"scrollLeft"}get sideProp(){const{scrolled:sn}=this;return $n(this,xo)?sn?"width":"height":sn?"height":"width"}get size(){return $n(this,uo).getBoundingClientRect()[this.sideProp]}get viewSize(){return $n(this,Pr).element.getBoundingClientRect()[this.sideProp]}get start(){return Math.abs($n(this,uo)[this.scrollProp])}get end(){return this.start+this.size}get page(){return Math.floor((this.start+this.end)/2/this.size)}get pages(){return Math.round(this.viewSize/this.size)}get containerPosition(){return $n(this,uo)[this.scrollProp]}set containerPosition(sn){$n(this,uo)[this.scrollProp]=sn}scrollBy(sn,ln){const cn=$n(this,xo)?ln:sn,[un,dn,hn]=$n(this,_s),fn=$n(this,No),pn=fn?un-hn:un-dn,gn=fn?un+dn:un+hn;this.containerPosition=Math.max(pn,Math.min(gn,this.containerPosition+cn))}snap(sn,ln){const cn=$n(this,xo)?ln:sn,[un,dn,hn]=$n(this,_s),{start:fn,end:pn,pages:gn,size:mn}=this,bn=Math.abs(un)-dn,vn=Math.abs(un)+hn,yn=cn*($n(this,No)?-mn:mn),wn=Math.floor(Math.max(bn,Math.min(vn,(fn+pn)/2+(isNaN(yn)?0:yn)))/mn);dr(this,Sr,ei).call(this,wn,"snap").then(()=>{const kn=wn<=0?-1:wn>=gn-1?1:null;if(kn)return dr(this,Sr,xa).call(this,{index:dr(this,Sr,Ms).call(this,kn),anchor:kn<0?()=>1:()=>0})})}async scrollToAnchor(sn,ln){return dr(this,Sr,ti).call(this,sn,ln?"selection":"navigation")}async goTo(sn){if($n(this,zs))return;const ln=await sn;if(dr(this,Sr,Ka).call(this,ln.index))return dr(this,Sr,xa).call(this,ln)}get atStart(){return dr(this,Sr,Ms).call(this,-1)==null&&this.page<=1}get atEnd(){return dr(this,Sr,Ms).call(this,1)==null&&this.page>=this.pages-2}async prev(sn){return await dr(this,Sr,Ga).call(this,-1,sn)}async next(sn){return await dr(this,Sr,Ga).call(this,1,sn)}prevSection(){return this.goTo({index:dr(this,Sr,Ms).call(this,-1)})}nextSection(){return this.goTo({index:dr(this,Sr,Ms).call(this,1)})}firstSection(){const sn=this.sections.findIndex(ln=>ln.linear!=="no");return this.goTo({index:sn})}lastSection(){const sn=this.sections.findLastIndex(ln=>ln.linear!=="no");return this.goTo({index:sn})}getContents(){return $n(this,Pr)?[{index:$n(this,jo),overlayer:$n(this,Pr).overlayer,doc:$n(this,Pr).document}]:[]}setStyles(sn){var dn,hn,fn,pn,gn;yr(this,na,sn);const ln=$n(this,ra).get((dn=$n(this,Pr))==null?void 0:dn.document);if(!ln)return;const[cn,un]=ln;if(Array.isArray(sn)){const[mn,bn]=sn;cn.textContent=mn,un.textContent=bn}else un.textContent=sn;requestAnimationFrame(()=>{dr(this,Sr,ka).call(this,$n(this,Pr).docBackground,this.columnCount)}),(gn=(pn=(fn=(hn=$n(this,Pr))==null?void 0:hn.document)==null?void 0:fn.fonts)==null?void 0:pn.ready)==null||gn.then(()=>$n(this,Pr).expand())}focusView(){$n(this,Pr).document.defaultView.focus()}destroy(){var sn,ln;$n(this,ta).unobserve(this),$n(this,Pr).destroy(),yr(this,Pr,null),(ln=(sn=this.sections[$n(this,jo)])==null?void 0:sn.unload)==null||ln.call(sn),$n(this,oa).removeEventListener("change",$n(this,mi))}}ns=new WeakMap,ta=new WeakMap,rs=new WeakMap,vs=new WeakMap,uo=new WeakMap,ws=new WeakMap,Ls=new WeakMap,Pr=new WeakMap,xo=new WeakMap,No=new WeakMap,ks=new WeakMap,jo=new WeakMap,Io=new WeakMap,gi=new WeakMap,zs=new WeakMap,na=new WeakMap,ra=new WeakMap,oa=new WeakMap,mi=new WeakMap,_s=new WeakMap,js=new WeakMap,yi=new WeakMap,sa=new WeakMap,Sr=new WeakSet,yl=function(){return $n(this,Pr)&&($n(this,Pr).destroy(),$n(this,uo).removeChild($n(this,Pr).element)),yr(this,Pr,new View({container:this,onExpand:()=>dr(this,Sr,ti).call(this,$n(this,Io))})),$n(this,uo).append($n(this,Pr).element),$n(this,Pr)},ka=function(sn,ln){var hn;const cn=(hn=$n(this,Pr))==null?void 0:hn.document;if(!cn)return;const dn=cn.defaultView.getComputedStyle(cn.documentElement).getPropertyValue("--theme-bg-color");if(sn&&dn){const fn=sn.split(/\s(?=(?:url|rgb|hsl|#[0-9a-fA-F]{3,6}))/);fn[0]=dn,sn=fn.join(" ")}/cover.*fixed|fixed.*cover/.test(sn)&&(sn=sn.replace("cover","auto 100%").replace("fixed","")),$n(this,vs).innerHTML="",$n(this,vs).style.display="grid",$n(this,vs).style.gridTemplateColumns=`repeat(${ln}, 1fr)`;for(let fn=0;fn<ln;fn++){const pn=document.createElement("div");pn.style.background=sn,pn.style.width="100%",pn.style.height="100%",$n(this,vs).appendChild(pn)}},ja=function({vertical:sn,rtl:ln,background:cn}){yr(this,xo,sn),yr(this,No,ln),$n(this,rs).classList.toggle("vertical",sn);const{width:un,height:dn}=$n(this,uo).getBoundingClientRect(),hn=sn?dn:un,fn=getComputedStyle($n(this,rs)),pn=parseFloat(fn.getPropertyValue("--_max-inline-size")),gn=parseInt(fn.getPropertyValue("--_max-column-count-spread")),mn=parseFloat(fn.getPropertyValue("--_margin"));yr(this,ks,mn);const bn=parseFloat(fn.getPropertyValue("--_gap"))/100,vn=-bn/(bn-1)*hn,yn=this.getAttribute("flow");if(yn==="scrolled"){this.setAttribute("dir",sn?"rtl":"ltr"),$n(this,rs).style.padding="0";const Bn=pn;return this.heads=null,this.feet=null,$n(this,ws).replaceChildren(),$n(this,Ls).replaceChildren(),{flow:yn,margin:mn,gap:vn,columnWidth:Bn}}const wn=Math.min(gn,Math.ceil(hn/pn)),kn=sn?hn/wn-mn:hn/wn-vn;this.setAttribute("dir",ln?"rtl":"ltr"),this.columnCount=wn,dr(this,Sr,ka).call(this,cn,this.columnCount);const _n=sn?Math.min(2,Math.ceil(un/pn)):wn,xn={gridTemplateColumns:`repeat(${_n}, 1fr)`,gap:`${vn}px`,direction:this.bookDir==="rtl"?"rtl":"ltr"};Object.assign($n(this,ws).style,xn),Object.assign($n(this,Ls).style,xn);const En=makeMarginals(_n,"head"),Tn=makeMarginals(_n,"foot");return this.heads=En.map(Bn=>Bn.children[0]),this.feet=Tn.map(Bn=>Bn.children[0]),$n(this,ws).replaceChildren(...En),$n(this,Ls).replaceChildren(...Tn),{height:dn,width:un,margin:mn,gap:vn,columnWidth:kn}},Ua=function(sn){const ln=sn.changedTouches[0];yr(this,js,{x:ln==null?void 0:ln.screenX,y:ln==null?void 0:ln.screenY,t:sn.timeStamp,vx:0,xy:0})},Ha=function(sn){var bn;const ln=$n(this,js);if(ln.pinched||(ln.pinched=globalThis.visualViewport.scale>1,this.scrolled||ln.pinched))return;if(sn.touches.length>1){$n(this,yi)&&sn.preventDefault();return}const cn=(bn=$n(this,Pr))==null?void 0:bn.document,un=cn==null?void 0:cn.getSelection();if(un&&un.rangeCount>0&&!un.isCollapsed)return;sn.preventDefault();const dn=sn.changedTouches[0],hn=dn.screenX,fn=dn.screenY,pn=ln.x-hn,gn=ln.y-fn,mn=sn.timeStamp-ln.t;ln.x=hn,ln.y=fn,ln.t=sn.timeStamp,ln.vx=pn/mn,ln.vy=gn/mn,yr(this,yi,!0),Math.abs(pn)>=Math.abs(gn)?this.scrollBy(pn,0):Math.abs(gn)>Math.abs(pn)&&this.scrollBy(0,gn)},qa=function(){yr(this,yi,!1),!this.scrolled&&requestAnimationFrame(()=>{globalThis.visualViewport.scale===1&&this.snap($n(this,js).vx,$n(this,js).vy)})},Di=function(){if(this.scrolled){const ln=this.viewSize,cn=$n(this,ks);return $n(this,xo)?({left:un,right:dn})=>({left:ln-dn-cn,right:ln-un-cn}):({top:un,bottom:dn})=>({left:un+cn,right:dn+cn})}const sn=this.pages*this.size;return $n(this,No)?({left:ln,right:cn})=>({left:sn-cn,right:sn-ln}):$n(this,xo)?({top:ln,bottom:cn})=>({left:ln,right:cn}):ln=>ln},bl=async function(sn,ln){if(this.scrolled){const un=dr(this,Sr,Di).call(this)(sn).left-$n(this,ks);return dr(this,Sr,Qs).call(this,un,ln)}const cn=dr(this,Sr,Di).call(this)(sn).left;return dr(this,Sr,ei).call(this,Math.floor(cn/this.size)+($n(this,No)?-1:1),ln)},Qs=async function(sn,ln,cn){const{size:un}=this;if(this.containerPosition===sn){yr(this,_s,[sn,this.atStart?0:un,this.atEnd?0:un]),dr(this,Sr,Ri).call(this,ln);return}if(this.scrolled&&$n(this,xo)&&(sn=-sn),(ln==="snap"||cn)&&this.hasAttribute("animated"))return animate(this.containerPosition,sn,300,easeOutQuad,dn=>this.containerPosition=dn).then(()=>{yr(this,_s,[sn,this.atStart?0:un,this.atEnd?0:un]),dr(this,Sr,Ri).call(this,ln)});this.containerPosition=sn,yr(this,_s,[sn,this.atStart?0:un,this.atEnd?0:un]),dr(this,Sr,Ri).call(this,ln)},ei=async function(sn,ln,cn){const un=this.size*($n(this,No)?-sn:sn);return dr(this,Sr,Qs).call(this,un,ln,cn)},ti=async function(sn,ln="anchor"){var fn,pn;yr(this,Io,sn);const cn=(pn=(fn=uncollapse(sn))==null?void 0:fn.getClientRects)==null?void 0:pn.call(fn);if(cn){const gn=Array.from(cn).find(mn=>mn.width>0&&mn.height>0)||cn[0];if(!gn)return;await dr(this,Sr,bl).call(this,gn,ln);return}if(this.scrolled){await dr(this,Sr,Qs).call(this,sn*this.viewSize,ln);return}const{pages:un}=this;if(!un)return;const dn=un-2,hn=Math.round(sn*(dn-1));await dr(this,Sr,ei).call(this,hn+1,ln)},vl=function(){if(this.scrolled)return getVisibleRange($n(this,Pr).document,this.start+$n(this,ks),this.end-$n(this,ks),dr(this,Sr,Di).call(this));const sn=$n(this,No)?-this.size:this.size;return getVisibleRange($n(this,Pr).document,this.start-sn,this.end-sn,dr(this,Sr,Di).call(this))},Ri=function(sn){const ln=dr(this,Sr,vl).call(this);yr(this,sa,ln),sn!=="selection"&&sn!=="navigation"&&sn!=="anchor"?yr(this,Io,ln):yr(this,gi,!0);const cn=$n(this,jo),un={reason:sn,range:ln,index:cn};if(this.scrolled)un.fraction=this.start/this.viewSize;else if(this.pages>0){const{page:dn,pages:hn}=this;$n(this,ws).style.visibility=dn>1?"visible":"hidden",un.fraction=(dn-1)/(hn-2),un.size=1/(hn-2)}this.dispatchEvent(new CustomEvent("relocate",{detail:un}))},Wa=async function(sn){var pn,gn;const{index:ln,src:cn,anchor:un,onLoad:dn,select:hn}=await sn;yr(this,jo,ln);const fn=(gn=(pn=$n(this,Pr))==null?void 0:pn.document)==null?void 0:gn.hasFocus();if(cn){const mn=dr(this,Sr,yl).call(this),bn=yn=>{if(yn.head){const wn=yn.createElement("style");yn.head.prepend(wn);const kn=yn.createElement("style");yn.head.append(kn),$n(this,ra).set(yn,[wn,kn])}dn==null||dn({doc:yn,index:ln})},vn=dr(this,Sr,ja).bind(this);await mn.load(cn,bn,vn),this.dispatchEvent(new CustomEvent("create-overlayer",{detail:{doc:mn.document,index:ln,attach:yn=>mn.overlayer=yn}})),yr(this,Pr,mn)}await this.scrollToAnchor((typeof un=="function"?un($n(this,Pr).document):un)??0,hn),fn&&this.focusView()},Ka=function(sn){return sn>=0&&sn<=this.sections.length-1},xa=async function({index:sn,anchor:ln,select:cn}){if(sn===$n(this,jo))await dr(this,Sr,Wa).call(this,{index:sn,anchor:ln,select:cn});else{const un=$n(this,jo),dn=hn=>{var fn,pn;(pn=(fn=this.sections[un])==null?void 0:fn.unload)==null||pn.call(fn),this.setStyles($n(this,na)),this.dispatchEvent(new CustomEvent("load",{detail:hn}))};await dr(this,Sr,Wa).call(this,Promise.resolve(this.sections[sn].load()).then(hn=>({index:sn,src:hn,anchor:ln,onLoad:dn,select:cn})).catch(hn=>(console.warn(hn),console.warn(new Error(`Failed to load section ${sn}`)),{})))}},wl=function(sn){if(!$n(this,Pr))return!0;if(this.scrolled)return this.start>0?dr(this,Sr,Qs).call(this,Math.max(0,this.start-(sn??this.size)),null,!0):!this.atStart;if(this.atStart)return;const ln=this.page-1;return dr(this,Sr,ei).call(this,ln,"page",!0).then(()=>ln<=0)},kl=function(sn){if(!$n(this,Pr))return!0;if(this.scrolled)return this.viewSize-this.end>2?dr(this,Sr,Qs).call(this,Math.min(this.viewSize,sn?this.start+sn:this.end),null,!0):!this.atEnd;if(this.atEnd)return;const ln=this.page+1,cn=this.pages;return dr(this,Sr,ei).call(this,ln,"page",!0).then(()=>ln>=cn-1)},Ms=function(sn){var ln;for(let cn=$n(this,jo)+sn;dr(this,Sr,Ka).call(this,cn);cn+=sn)if(((ln=this.sections[cn])==null?void 0:ln.linear)!=="no")return cn},Ga=async function(sn,ln){if($n(this,zs))return;yr(this,zs,!0);const cn=sn===-1,un=await(cn?dr(this,Sr,wl).call(this,ln):dr(this,Sr,kl).call(this,ln));un&&await dr(this,Sr,xa).call(this,{index:dr(this,Sr,Ms).call(this,sn),anchor:cn?()=>1:()=>0}),(un||!this.hasAttribute("animated"))&&await wait(100),yr(this,zs,!1)},ir(Paginator,"observedAttributes",["flow","gap","margin","max-inline-size","max-block-size","max-column-count"]);customElements.define("foliate-paginator",Paginator);const paginator=Object.freeze(Object.defineProperty({__proto__:null,Paginator},Symbol.toStringTag,{value:"Module"})),CONTEXT_LENGTH=50,normalizeWhitespace=an=>an.replace(/\s+/g," "),makeExcerpt=(an,{startIndex:on,startOffset:sn,endIndex:ln,endOffset:cn})=>{const un=an[on],dn=an[ln],hn=un===dn?un.slice(sn,cn):un.slice(sn)+an.slice(un+1,dn).join("")+dn.slice(0,cn),fn=normalizeWhitespace(un.slice(0,sn)).trimStart(),pn=normalizeWhitespace(dn.slice(cn)).trimEnd(),gn=fn.length<CONTEXT_LENGTH?"":"",mn=pn.length<CONTEXT_LENGTH?"":"",bn=`${gn}${fn.slice(-CONTEXT_LENGTH)}`,vn=`${pn.slice(0,CONTEXT_LENGTH)}${mn}`;return{pre:bn,match:hn,post:vn}},simpleSearch=function*(an,on,sn={}){const{locales:ln="en",sensitivity:cn}=sn,un=cn==="variant",dn=an.join(""),hn=un?dn:dn.toLocaleLowerCase(ln),fn=un?on:on.toLocaleLowerCase(ln),pn=fn.length;let gn=-1,mn=-1,bn=0;do if(gn=hn.indexOf(fn,gn+1),gn>-1){for(;bn<=gn;)bn+=an[++mn].length;const vn=mn,yn=gn-(bn-an[mn].length),wn=gn+pn;for(;bn<=wn;)bn+=an[++mn].length;const kn=mn,_n=wn-(bn-an[mn].length),xn={startIndex:vn,startOffset:yn,endIndex:kn,endOffset:_n};yield{range:xn,excerpt:makeExcerpt(an,xn)}}while(gn>-1)},segmenterSearch=function*(an,on,sn={}){var bn;const{locales:ln="en",granularity:cn="word",sensitivity:un="base"}=sn;let dn,hn;try{dn=new Intl.Segmenter(ln,{usage:"search",granularity:cn}),hn=new Intl.Collator(ln,{sensitivity:un})}catch(vn){console.warn(vn),dn=new Intl.Segmenter("en",{usage:"search",granularity:cn}),hn=new Intl.Collator("en",{sensitivity:un})}const fn=Array.from(dn.segment(on)).length,pn=[];let gn=0,mn=dn.segment(an[gn])[Symbol.iterator]();e:for(;gn<an.length;){for(;pn.length<fn;){const{done:yn,value:wn}=mn.next();if(yn)if(gn++,gn<an.length){mn=dn.segment(an[gn])[Symbol.iterator]();continue}else break e;const{index:kn,segment:_n}=wn;if(/[^\p{Format}]/u.test(_n)){if(/\s/u.test(_n)){/\s/u.test((bn=pn[pn.length-1])==null?void 0:bn.segment)||pn.push({strIndex:gn,index:kn,segment:" "});continue}wn.strIndex=gn,pn.push(wn)}}const vn=pn.map(yn=>yn.segment).join("");if(hn.compare(on,vn)===0){const yn=gn,wn=pn[pn.length-1],kn=wn.index+wn.segment.length,_n=pn[0].strIndex,xn=pn[0].index,En={startIndex:_n,startOffset:xn,endIndex:yn,endOffset:kn};yield{range:En,excerpt:makeExcerpt(an,En)}}pn.shift()}},search=(an,on,sn)=>{const{granularity:ln="grapheme",sensitivity:cn="base"}=sn;return!(Intl!=null&&Intl.Segmenter)||ln==="grapheme"&&(cn==="variant"||cn==="accent")?simpleSearch(an,on,sn):segmenterSearch(an,on,sn)},searchMatcher=(an,on)=>{const{defaultLocale:sn,matchCase:ln,matchDiacritics:cn,matchWholeWords:un}=on;return function*(dn,hn){const fn=an(dn,function*(pn,gn){for(const mn of search(pn,hn,{locales:dn.body.lang||dn.documentElement.lang||sn||"en",granularity:un?"word":"grapheme",sensitivity:cn&&ln?"variant":cn&&!ln?"accent":!cn&&ln?"case":"base"})){const{startIndex:bn,startOffset:vn,endIndex:yn,endOffset:wn}=mn.range;mn.range=gn(bn,vn,yn,wn),yield mn}});for(const pn of fn)yield pn}},search$1=Object.freeze(Object.defineProperty({__proto__:null,search,searchMatcher},Symbol.toStringTag,{value:"Module"})),NS={XML:"http://www.w3.org/XML/1998/namespace",SSML:"http://www.w3.org/2001/10/synthesis"},blockTags=new Set(["article","aside","audio","blockquote","caption","details","dialog","div","dl","dt","dd","figure","footer","form","figcaption","h1","h2","h3","h4","h5","h6","header","hgroup","hr","li","main","math","nav","ol","p","pre","section","tr"]),getLang=an=>{var sn;const on=an.lang||((sn=an==null?void 0:an.getAttributeNS)==null?void 0:sn.call(an,NS.XML,"lang"));return on||(an.parentElement?getLang(an.parentElement):null)},getAlphabet=an=>{var sn;const on=(sn=an==null?void 0:an.getAttributeNS)==null?void 0:sn.call(an,NS.XML,"lang");return on||(an.parentElement?getAlphabet(an.parentElement):null)},getSegmenter=(an="en",on="word")=>{const sn=new Intl.Segmenter(an,{granularity:on}),ln=on==="word";return function*(cn,un){var bn;const dn=cn.join("").replace(/\r\n/g,"  ").replace(/\r/g," ").replace(/\n/g," ");let hn=0,fn=-1,pn=0;const gn=Array.from(sn.segment(dn)),mn=[];for(let vn=0;vn<gn.length;vn++){const yn=gn[vn],wn=gn[vn+1],kn=yn.segment.trim(),_n=(bn=wn==null?void 0:wn.segment)==null?void 0:bn.trim(),xn=/(?:^|\s)([A-Z][a-z]{1,5})\.$/.test(kn),En=/^[A-Z]/.test(_n||"");if(xn&&En){const Tn={index:yn.index,segment:yn.segment+((wn==null?void 0:wn.segment)||""),isWordLike:!0};mn.push(Tn),vn++}else mn.push(yn)}for(const{index:vn,segment:yn,isWordLike:wn}of mn){if(ln&&!wn)continue;for(;pn<=vn;)pn+=cn[++fn].length;const kn=fn,_n=vn-(pn-cn[fn].length),xn=vn+yn.length-1;if(xn<dn.length)for(;pn<=xn;)pn+=cn[++fn].length;const En=fn,Tn=xn-(pn-cn[fn].length)+1;yield[(hn++).toString(),un(kn,_n,En,Tn)]}}},fragmentToSSML=(an,on)=>{const sn=document.implementation.createDocument(NS.SSML,"speak"),{lang:ln}=on;ln&&sn.documentElement.setAttributeNS(NS.XML,"lang",ln);const cn=(un,dn,hn)=>{if(!un)return;if(un.nodeType===3)return sn.createTextNode(un.textContent);if(un.nodeType===4)return sn.createCDATASection(un.textContent);if(un.nodeType!==1)return;let fn;const pn=un.nodeName.toLowerCase();pn==="foliate-mark"?(fn=sn.createElementNS(NS.SSML,"mark"),fn.setAttribute("name",un.dataset.name)):pn==="br"?fn=sn.createElementNS(NS.SSML,"break"):(pn==="em"||pn==="strong")&&(fn=sn.createElementNS(NS.SSML,"emphasis"));const gn=un.lang||un.getAttributeNS(NS.XML,"lang");gn&&(fn||(fn=sn.createElementNS(NS.SSML,"lang")),fn.setAttributeNS(NS.XML,"lang",gn));const mn=un.getAttributeNS(NS.SSML,"alphabet")||hn;if(!fn){const vn=un.getAttributeNS(NS.SSML,"ph");vn&&(fn=sn.createElementNS(NS.SSML,"phoneme"),mn&&fn.setAttribute("alphabet",mn),fn.setAttribute("ph",vn))}fn||(fn=dn);let bn=un.firstChild;for(;bn;){const vn=cn(bn,fn,mn);vn&&fn!==vn&&fn.append(vn),bn=bn.nextSibling}return fn};return cn(an.firstChild,sn.documentElement,on.alphabet),sn},getFragmentWithMarks=(an,on,sn)=>{const ln=getLang(an.commonAncestorContainer),cn=getAlphabet(an.commonAncestorContainer),un=getSegmenter(ln,sn),dn=an.cloneContents(),hn=[...on(an,un)],fn=[...on(dn,un)];for(const[gn,mn]of fn){const bn=document.createElement("foliate-mark");bn.dataset.name=gn,mn.insertNode(bn)}const pn=fragmentToSSML(dn,{lang:ln,alphabet:cn});return{entries:hn,ssml:pn}},rangeIsEmpty=an=>!an.toString().trim();function*getBlocks(an){let on;const sn=an.createTreeWalker(an.body,NodeFilter.SHOW_ELEMENT);for(let ln=sn.nextNode();ln;ln=sn.nextNode()){const cn=ln.tagName.toLowerCase();blockTags.has(cn)&&(on&&(on.setEndBefore(ln),rangeIsEmpty(on)||(yield on)),on=an.createRange(),on.setStart(ln,0))}on||(on=an.createRange(),on.setStart(an.body.firstChild??an.body,0)),on.setEndAfter(an.body.lastChild??an.body),rangeIsEmpty(on)||(yield on)}var Zr,bi,mo,Do;class ListIterator{constructor(on,sn=ln=>ln){pr(this,Zr,[]);pr(this,bi);pr(this,mo,-1);pr(this,Do);yr(this,bi,on),yr(this,Do,sn)}current(){if($n(this,Zr)[$n(this,mo)])return $n(this,Do).call(this,$n(this,Zr)[$n(this,mo)])}first(){if($n(this,Zr)[0])return yr(this,mo,0),$n(this,Do).call(this,$n(this,Zr)[0])}prev(){const on=$n(this,mo)-1;if($n(this,Zr)[on])return yr(this,mo,on),$n(this,Do).call(this,$n(this,Zr)[on])}next(){const on=$n(this,mo)+1;if($n(this,Zr)[on])return yr(this,mo,on),$n(this,Do).call(this,$n(this,Zr)[on]);for(;;){const{done:sn,value:ln}=$n(this,bi).next();if(sn)break;if($n(this,Zr).push(ln),$n(this,Zr)[on])return yr(this,mo,on),$n(this,Do).call(this,$n(this,Zr)[on])}}find(on){const sn=$n(this,Zr).findIndex(ln=>on(ln));if(sn>-1)return yr(this,mo,sn),$n(this,Do).call(this,$n(this,Zr)[sn]);for(;;){const{done:ln,value:cn}=$n(this,bi).next();if(ln)break;if($n(this,Zr).push(cn),on(cn))return yr(this,mo,$n(this,Zr).length-1),$n(this,Do).call(this,cn)}}}Zr=new WeakMap,bi=new WeakMap,mo=new WeakMap,Do=new WeakMap;var os,vi,Uo,ia,So,Sa,ni;class TTS{constructor(on,sn,ln,cn){pr(this,So);pr(this,os);pr(this,vi);pr(this,Uo);pr(this,ia,new XMLSerializer);this.doc=on,this.highlight=ln,yr(this,os,new ListIterator(getBlocks(on),un=>{const{entries:dn,ssml:hn}=getFragmentWithMarks(un,sn,cn);return yr(this,vi,new Map(dn)),[hn,un]}))}start(){yr(this,Uo,null);const[on]=$n(this,os).first()??[];return on?dr(this,So,ni).call(this,on,sn=>dr(this,So,Sa).call(this,sn,$n(this,Uo))):this.next()}resume(){const[on]=$n(this,os).current()??[];return on?dr(this,So,ni).call(this,on,sn=>dr(this,So,Sa).call(this,sn,$n(this,Uo))):this.next()}prev(on){yr(this,Uo,null);const[sn,ln]=$n(this,os).prev()??[];return on&&ln&&this.highlight(ln.cloneRange()),dr(this,So,ni).call(this,sn)}next(on){yr(this,Uo,null);const[sn,ln]=$n(this,os).next()??[];return on&&ln&&this.highlight(ln.cloneRange()),dr(this,So,ni).call(this,sn)}from(on){yr(this,Uo,null);const[sn]=$n(this,os).find(cn=>on.compareBoundaryPoints(Range.END_TO_START,cn)<=0);let ln;for(const[cn,un]of $n(this,vi).entries())if(on.compareBoundaryPoints(Range.START_TO_START,un)<=0){ln=cn;break}return dr(this,So,ni).call(this,sn,cn=>dr(this,So,Sa).call(this,cn,ln))}setMark(on){const sn=$n(this,vi).get(on);sn&&(yr(this,Uo,on),this.highlight(sn.cloneRange()))}}os=new WeakMap,vi=new WeakMap,Uo=new WeakMap,ia=new WeakMap,So=new WeakSet,Sa=function(on,sn){return sn?on.querySelector(`mark[name="${CSS.escape(sn)}"`):null},ni=function(on,sn){var un,dn;if(!on)return;if(!sn)return $n(this,ia).serializeToString(on);const ln=document.implementation.createDocument(NS.SSML,"speak");ln.documentElement.replaceWith(ln.importNode(on.documentElement,!0));let cn=(un=sn(ln))==null?void 0:un.previousSibling;for(;cn;){const hn=cn.previousSibling??((dn=cn.parentNode)==null?void 0:dn.previousSibling);cn.parentNode.removeChild(cn),cn=hn}return $n(this,ia).serializeToString(ln)};const tts=Object.freeze(Object.defineProperty({__proto__:null,TTS},Symbol.toStringTag,{value:"Module"})),decoder=new TextDecoder,decode=decoder.decode.bind(decoder),concatTypedArray=(an,on)=>{const sn=new an.constructor(an.length+on.length);return sn.set(an),sn.set(on,an.length),sn},strcmp=(an,on)=>(an=an.toLowerCase(),on=on.toLowerCase(),an<on?-1:an>on?1:0);var Us,wi,aa;class DictZip{constructor(){pr(this,Us);pr(this,wi);pr(this,aa);ir(this,"inflate")}async load(on){const sn=new DataView(await on.slice(0,12).arrayBuffer());if(sn.getUint8(0)!==31||sn.getUint8(1)!==139||sn.getUint8(2)!==8)throw new Error("Not a DictZip file");const ln=sn.getUint8(3);if(!ln&4)throw new Error("Missing FEXTRA flag");const cn=sn.getUint16(10,!0),un=new DataView(await on.slice(12,12+cn).arrayBuffer());if(un.getUint8(0)!==82||un.getUint8(1)!==65)throw new Error("Subfield ID should be RA");if(un.getUint16(4,!0)!==1)throw new Error("Unsupported version");yr(this,Us,un.getUint16(6,!0));const dn=un.getUint16(8,!0);yr(this,wi,[]);for(let gn=0,mn=0;gn<dn;gn++){const bn=un.getUint16(10+2*gn,!0);$n(this,wi).push([mn,bn]),mn=mn+bn}let hn=12+cn;const fn=Math.min(hn+512,on.size),pn=new Uint8Array(await on.slice(0,fn).arrayBuffer());if(ln&8){const gn=pn.indexOf(0,hn);if(gn<0)throw new Error("Header too long");hn=gn+1}if(ln&16){const gn=pn.indexOf(0,hn);if(gn<0)throw new Error("Header too long");hn=gn+1}ln&2&&(hn+=2),yr(this,aa,on.slice(hn))}async read(on,sn){const ln=$n(this,wi),cn=Math.trunc(on/$n(this,Us)),un=Math.trunc((on+sn)/$n(this,Us)),dn=await $n(this,aa).slice(ln[cn][0],ln[un][0]+ln[un][1]).arrayBuffer();let hn=new Uint8Array;for(let pn=0,gn=cn;gn<=un;gn++){const mn=new Uint8Array(dn,pn,ln[gn][1]);hn=concatTypedArray(hn,await this.inflate(mn)),pn+=ln[gn][1]}const fn=on-cn*$n(this,Us);return hn.subarray(fn,fn+sn)}}Us=new WeakMap,wi=new WeakMap,aa=new WeakMap;class Index{constructor(){ir(this,"strcmp",strcmp)}bisect(on,sn=0,ln=this.words.length-1){if(ln-sn===1)return this.strcmp(on,this.getWord(sn))?this.strcmp(on,this.getWord(ln))?null:ln:sn;const cn=Math.floor(sn+(ln-sn)/2),un=this.strcmp(on,this.getWord(cn));return un<0?this.bisect(on,sn,cn):un>0?this.bisect(on,cn,ln):cn}checkAdjacent(on,sn){if(sn==null)return[];let ln=sn;const cn=dn=>{const hn=this.getWord(dn);return hn?this.strcmp(on,hn)===0:!1};for(;cn(ln-1);)ln--;let un=sn;for(;cn(un+1);)un++;return ln===un?[sn]:Array.from({length:un+1-ln},(dn,hn)=>ln+hn)}lookup(on){return this.checkAdjacent(on,this.bisect(on))}}const decodeBase64Number=an=>{const{length:on}=an;let sn=0;for(let ln=0;ln<on;ln++){const cn=an.charCodeAt(ln);sn+=(cn===43?62:cn===47?63:cn<58?cn+4:cn<91?cn-65:cn-71)*64**(on-1-ln)}return sn};class DictdIndex extends Index{getWord(on){return this.words[on]}async load(on){const sn=[],ln=[],cn=[];for(const un of decode(await on.arrayBuffer()).split(`
`)){const dn=un.split("	");sn.push(dn[0]),ln.push(decodeBase64Number(dn[1])),cn.push(decodeBase64Number(dn[2]))}this.words=sn,this.offsets=ln,this.sizes=cn}}var ki,Hs,Si,_l,xl;class DictdDict{constructor(){pr(this,Si);pr(this,ki,new DictZip);pr(this,Hs,new DictdIndex)}loadDict(on,sn){return $n(this,ki).inflate=sn,$n(this,ki).load(on)}lookup(on){return dr(this,Si,xl).call(this,$n(this,Hs).lookup(on))}}ki=new WeakMap,Hs=new WeakMap,Si=new WeakSet,_l=async function(on){const sn=$n(this,Hs).getWord(on),ln=$n(this,Hs).offsets[on],cn=$n(this,Hs).sizes[on];return{word:sn,data:["m",$n(this,ki).read(ln,cn)]}},xl=function(on){return Promise.all(on.map(dr(this,Si,_l).bind(this)))};var la;class StarDictIndex extends Index{constructor(){super(...arguments);ir(this,"isSyn");pr(this,la)}getWord(sn){const ln=this.words[sn];if(ln)return decode($n(this,la).subarray(ln[0],ln[1]))}async load(sn){const{isSyn:ln}=this,cn=await sn.arrayBuffer(),un=new Uint8Array(cn);yr(this,la,un);const dn=new DataView(cn),hn=[],fn=[],pn=[];for(let gn=0;gn<un.length;){const mn=un.subarray(0,gn+256).indexOf(0,gn);if(mn<0)throw new Error("Word too big");hn.push([gn,mn]),fn.push(dn.getUint32(mn+1)),ln?gn=mn+5:(pn.push(dn.getUint32(mn+5)),gn=mn+9)}this.words=hn,this.offsets=fn,this.sizes=pn}}la=new WeakMap;var _i,xs,xi,Ws,Sl,Ja;class StarDict{constructor(){pr(this,Ws);pr(this,_i,new DictZip);pr(this,xs,new StarDictIndex);pr(this,xi,Object.assign(new StarDictIndex,{isSyn:!0}))}async loadIfo(on){const sn=decode(await on.arrayBuffer());this.ifo=Object.fromEntries(sn.split(`
`).map(ln=>{const cn=ln.indexOf("=");if(!(cn<0))return[ln.slice(0,cn),ln.slice(cn+1)]}).filter(ln=>ln))}loadDict(on,sn){return $n(this,_i).inflate=sn,$n(this,_i).load(on)}loadIdx(on){return $n(this,xs).load(on)}loadSyn(on){if(on)return $n(this,xi).load(on)}lookup(on){return dr(this,Ws,Ja).call(this,$n(this,xs).lookup(on))}synonyms(on){return dr(this,Ws,Ja).call(this,$n(this,xi).lookup(on).map(sn=>$n(this,xi).offsets[sn]))}}_i=new WeakMap,xs=new WeakMap,xi=new WeakMap,Ws=new WeakSet,Sl=async function(on){const sn=$n(this,xs).getWord(on),ln=$n(this,xs).offsets[on],cn=$n(this,xs).sizes[on],un=await $n(this,_i).read(ln,cn),dn=this.ifo.sametypesequence;if(!dn)throw new Error("TODO");if(dn.length===1)return{word:sn,data:[[dn[0],un]]};throw new Error("TODO")},Ja=function(on){return Promise.all(on.map(dr(this,Ws,Sl).bind(this)))};const dict=Object.freeze(Object.defineProperty({__proto__:null,DictdDict,StarDict},Symbol.toStringTag,{value:"Module"}));var ch2={},wk=(function(an,on,sn,ln,cn){var un=new Worker(ch2[on]||(ch2[on]=URL.createObjectURL(new Blob([an+';addEventListener("error",function(e){e=e.error;postMessage({$e$:[e.message,e.code,e.stack]})})'],{type:"text/javascript"}))));return un.onmessage=function(dn){var hn=dn.data,fn=hn.$e$;if(fn){var pn=new Error(fn[0]);pn.code=fn[1],pn.stack=fn[2],cn(pn,null)}else cn(null,hn)},un.postMessage(sn,ln),un}),u8=Uint8Array,u16=Uint16Array,i32=Int32Array,fleb=new u8([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),fdeb=new u8([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),clim=new u8([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),freb=function(an,on){for(var sn=new u16(31),ln=0;ln<31;++ln)sn[ln]=on+=1<<an[ln-1];for(var cn=new i32(sn[30]),ln=1;ln<30;++ln)for(var un=sn[ln];un<sn[ln+1];++un)cn[un]=un-sn[ln]<<5|ln;return{b:sn,r:cn}},_a=freb(fleb,2),fl=_a.b,revfl=_a.r;fl[28]=258,revfl[258]=28;var _b=freb(fdeb,0),fd=_b.b,rev=new u16(32768);for(var i=0;i<32768;++i){var x=(i&43690)>>1|(i&21845)<<1;x=(x&52428)>>2|(x&13107)<<2,x=(x&61680)>>4|(x&3855)<<4,rev[i]=((x&65280)>>8|(x&255)<<8)>>1}var hMap=(function(an,on,sn){for(var ln=an.length,cn=0,un=new u16(on);cn<ln;++cn)an[cn]&&++un[an[cn]-1];var dn=new u16(on);for(cn=1;cn<on;++cn)dn[cn]=dn[cn-1]+un[cn-1]<<1;var hn;if(sn){hn=new u16(1<<on);var fn=15-on;for(cn=0;cn<ln;++cn)if(an[cn])for(var pn=cn<<4|an[cn],gn=on-an[cn],mn=dn[an[cn]-1]++<<gn,bn=mn|(1<<gn)-1;mn<=bn;++mn)hn[rev[mn]>>fn]=pn}else for(hn=new u16(ln),cn=0;cn<ln;++cn)an[cn]&&(hn[cn]=rev[dn[an[cn]-1]++]>>15-an[cn]);return hn}),flt=new u8(288);for(var i=0;i<144;++i)flt[i]=8;for(var i=144;i<256;++i)flt[i]=9;for(var i=256;i<280;++i)flt[i]=7;for(var i=280;i<288;++i)flt[i]=8;var fdt=new u8(32);for(var i=0;i<32;++i)fdt[i]=5;var flrm=hMap(flt,9,1),fdrm=hMap(fdt,5,1),max=function(an){for(var on=an[0],sn=1;sn<an.length;++sn)an[sn]>on&&(on=an[sn]);return on},bits=function(an,on,sn){var ln=on/8|0;return(an[ln]|an[ln+1]<<8)>>(on&7)&sn},bits16=function(an,on){var sn=on/8|0;return(an[sn]|an[sn+1]<<8|an[sn+2]<<16)>>(on&7)},shft=function(an){return(an+7)/8|0},slc=function(an,on,sn){return(on==null||on<0)&&(on=0),(sn==null||sn>an.length)&&(sn=an.length),new u8(an.subarray(on,sn))},ec=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],err=function(an,on,sn){var ln=new Error(on||ec[an]);if(ln.code=an,Error.captureStackTrace&&Error.captureStackTrace(ln,err),!sn)throw ln;return ln},inflt=function(an,on,sn,ln){var cn=an.length,un=ln?ln.length:0;if(!cn||on.f&&!on.l)return sn||new u8(0);var dn=!sn,hn=dn||on.i!=2,fn=on.i;dn&&(sn=new u8(cn*3));var pn=function(Jn){var Fn=sn.length;if(Jn>Fn){var Kn=new u8(Math.max(Fn*2,Jn));Kn.set(sn),sn=Kn}},gn=on.f||0,mn=on.p||0,bn=on.b||0,vn=on.l,yn=on.d,wn=on.m,kn=on.n,_n=cn*8;do{if(!vn){gn=bits(an,mn,1);var xn=bits(an,mn+1,3);if(mn+=3,xn)if(xn==1)vn=flrm,yn=fdrm,wn=9,kn=5;else if(xn==2){var Nn=bits(an,mn,31)+257,Mn=bits(an,mn+10,15)+4,Ln=Nn+bits(an,mn+5,31)+1;mn+=14;for(var On=new u8(Ln),zn=new u8(19),Pn=0;Pn<Mn;++Pn)zn[clim[Pn]]=bits(an,mn+Pn*3,7);mn+=Mn*3;for(var An=max(zn),Vn=(1<<An)-1,Sn=hMap(zn,An,1),Pn=0;Pn<Ln;){var Rn=Sn[bits(an,mn,Vn)];mn+=Rn&15;var En=Rn>>4;if(En<16)On[Pn++]=En;else{var Hn=0,Zn=0;for(En==16?(Zn=3+bits(an,mn,3),mn+=2,Hn=On[Pn-1]):En==17?(Zn=3+bits(an,mn,7),mn+=3):En==18&&(Zn=11+bits(an,mn,127),mn+=7);Zn--;)On[Pn++]=Hn}}var Qn=On.subarray(0,Nn),Yn=On.subarray(Nn);wn=max(Qn),kn=max(Yn),vn=hMap(Qn,wn,1),yn=hMap(Yn,kn,1)}else err(1);else{var En=shft(mn)+4,Tn=an[En-4]|an[En-3]<<8,Bn=En+Tn;if(Bn>cn){fn&&err(0);break}hn&&pn(bn+Tn),sn.set(an.subarray(En,Bn),bn),on.b=bn+=Tn,on.p=mn=Bn*8,on.f=gn;continue}if(mn>_n){fn&&err(0);break}}hn&&pn(bn+131072);for(var tr=(1<<wn)-1,Un=(1<<kn)-1,Xn=mn;;Xn=mn){var Hn=vn[bits16(an,mn)&tr],or=Hn>>4;if(mn+=Hn&15,mn>_n){fn&&err(0);break}if(Hn||err(2),or<256)sn[bn++]=or;else if(or==256){Xn=mn,vn=null;break}else{var kr=or-254;if(or>264){var Pn=or-257,wr=fleb[Pn];kr=bits(an,mn,(1<<wr)-1)+fl[Pn],mn+=wr}var Nr=yn[bits16(an,mn)&Un],$r=Nr>>4;Nr||err(3),mn+=Nr&15;var Yn=fd[$r];if($r>3){var wr=fdeb[$r];Yn+=bits16(an,mn)&(1<<wr)-1,mn+=wr}if(mn>_n){fn&&err(0);break}hn&&pn(bn+131072);var cr=bn+kr;if(bn<Yn){var hr=un-Yn,gr=Math.min(Yn,cr);for(hr+bn<0&&err(3);bn<gr;++bn)sn[bn]=ln[hr+bn]}for(;bn<cr;++bn)sn[bn]=sn[bn-Yn]}}on.l=vn,on.p=Xn,on.b=bn,on.f=gn,vn&&(gn=1,on.m=wn,on.d=yn,on.n=kn)}while(!gn);return bn!=sn.length&&dn?slc(sn,0,bn):sn.subarray(0,bn)},et=new u8(0),mrg=function(an,on){var sn={};for(var ln in an)sn[ln]=an[ln];for(var ln in on)sn[ln]=on[ln];return sn},wcln=function(an,on,sn){for(var ln=an(),cn=an.toString(),un=cn.slice(cn.indexOf("[")+1,cn.lastIndexOf("]")).replace(/\s+/g,"").split(","),dn=0;dn<ln.length;++dn){var hn=ln[dn],fn=un[dn];if(typeof hn=="function"){on+=";"+fn+"=";var pn=hn.toString();if(hn.prototype)if(pn.indexOf("[native code]")!=-1){var gn=pn.indexOf(" ",8)+1;on+=pn.slice(gn,pn.indexOf("(",gn))}else{on+=pn;for(var mn in hn.prototype)on+=";"+fn+".prototype."+mn+"="+hn.prototype[mn].toString()}else on+=pn}else sn[fn]=hn}return on},ch=[],cbfs=function(an){var on=[];for(var sn in an)an[sn].buffer&&on.push((an[sn]=new an[sn].constructor(an[sn])).buffer);return on},wrkr=function(an,on,sn,ln){if(!ch[sn]){for(var cn="",un={},dn=an.length-1,hn=0;hn<dn;++hn)cn=wcln(an[hn],cn,un);ch[sn]={c:wcln(an[dn],cn,un),e:un}}var fn=mrg({},ch[sn].e);return wk(ch[sn].c+";onmessage=function(e){for(var k in e.data)self[k]=e.data[k];onmessage="+on.toString()+"}",sn,fn,cbfs(fn),ln)},bInflt=function(){return[u8,u16,i32,fleb,fdeb,clim,fl,fd,flrm,fdrm,rev,ec,hMap,max,bits,bits16,shft,slc,err,inflt,inflateSync,pbf,gopt]},pbf=function(an){return postMessage(an,[an.buffer])},gopt=function(an){return an&&{out:an.size&&new u8(an.size),dictionary:an.dictionary}},cbify=function(an,on,sn,ln,cn,un){var dn=wrkr(sn,ln,cn,function(hn,fn){dn.terminate(),un(hn,fn)});return dn.postMessage([an,on],on.consume?[an.buffer]:[]),function(){dn.terminate()}};function inflate(an,on,sn){return sn||(sn=on,on={}),typeof sn!="function"&&err(7),cbify(an,on,[bInflt],function(ln){return pbf(inflateSync(ln.data[0],gopt(ln.data[1])))},1,sn)}function inflateSync(an,on){return inflt(an,{i:2},on&&on.out,on&&on.dictionary)}var td=typeof TextDecoder<"u"&&new TextDecoder,tds=0;try{td.decode(et,{stream:!0}),tds=1}catch(an){}const browser=Object.freeze(Object.defineProperty({__proto__:null,inflate,inflateSync},Symbol.toStringTag,{value:"Module"})),createSVGElement=an=>document.createElementNS("http://www.w3.org/2000/svg",an),createExpanderIcon=()=>{const an=createSVGElement("svg");an.setAttribute("viewBox","0 0 13 10"),an.setAttribute("width","13"),an.setAttribute("height","13");const on=createSVGElement("polygon");return on.setAttribute("points","2 1, 12 1, 7 9"),an.append(on),an},createTOCItemElement=(an,on,sn)=>{let ln=0;const cn=()=>`toc-element-${ln++}`,un=({label:dn,href:hn,subitems:fn},pn=0)=>{const gn=document.createElement(hn?"a":"span");gn.innerText=dn,gn.setAttribute("role","treeitem"),gn.tabIndex=-1,gn.style.paddingInlineStart=`${(pn+1)*24}px`,an.push(gn),hn?(on.has(hn)||on.set(hn,gn),gn.href=hn,gn.onclick=bn=>{bn.preventDefault(),sn(hn)}):gn.onclick=bn=>{var vn;return(vn=gn.firstElementChild)==null?void 0:vn.onclick(bn)};const mn=document.createElement("li");if(mn.setAttribute("role","none"),mn.append(gn),fn!=null&&fn.length){gn.setAttribute("aria-expanded","false");const bn=createExpanderIcon();bn.onclick=yn=>{yn.preventDefault(),yn.stopPropagation();const wn=gn.getAttribute("aria-expanded");gn.setAttribute("aria-expanded",wn==="true"?"false":"true")},gn.prepend(bn);const vn=document.createElement("ol");vn.id=cn(),vn.setAttribute("role","group"),gn.setAttribute("aria-owns",vn.id),vn.replaceChildren(...fn.map(yn=>un(yn,pn+1))),mn.append(vn)}return mn};return un},createTOCView=(an,on)=>{const sn=document.createElement("ol");sn.setAttribute("role","tree");const ln=[],cn=new Map,un=createTOCItemElement(ln,cn,on);sn.replaceChildren(...an.map(yn=>un(yn)));const dn=yn=>(yn==null?void 0:yn.getAttribute("role"))==="treeitem",hn=function*(yn){for(let wn=yn.parentNode;wn!==sn;wn=wn.parentNode){const kn=wn.previousElementSibling;dn(kn)&&(yield kn)}};let fn,pn;sn.addEventListener("focusout",()=>{if(fn){if(pn&&(pn.tabIndex=-1),fn.offsetParent){fn.tabIndex=0;return}for(const yn of hn(fn))if(yn.offsetParent){yn.tabIndex=0,pn=yn;break}}});const gn=yn=>{fn&&(fn.removeAttribute("aria-current"),fn.tabIndex=-1);const wn=cn.get(yn);if(!wn){fn=ln[0],fn.tabIndex=0;return}for(const kn of hn(wn))kn.setAttribute("aria-expanded","true");wn.setAttribute("aria-current","page"),wn.tabIndex=0,wn.scrollIntoView({behavior:"smooth",block:"center"}),fn=wn},mn=yn=>dn(yn)&&yn.offsetParent?NodeFilter.FILTER_ACCEPT:NodeFilter.FILTER_SKIP,bn=document.createTreeWalker(sn,1,{acceptNode:mn}),vn=yn=>(bn.currentNode=yn,bn);for(const yn of ln)yn.addEventListener("keydown",wn=>{var En,Tn,Bn,Nn,Mn,Ln;let kn=!1;const{currentTarget:_n,key:xn}=wn;switch(xn){case" ":case"Enter":_n.click(),kn=!0;break;case"ArrowDown":(En=vn(_n).nextNode())==null||En.focus(),kn=!0;break;case"ArrowUp":(Tn=vn(_n).previousNode())==null||Tn.focus(),kn=!0;break;case"ArrowLeft":_n.getAttribute("aria-expanded")==="true"?_n.setAttribute("aria-expanded","false"):(Nn=(Bn=hn(_n).next())==null?void 0:Bn.value)==null||Nn.focus(),kn=!0;break;case"ArrowRight":_n.getAttribute("aria-expanded")==="true"?(Mn=vn(_n).nextNode())==null||Mn.focus():_n.getAttribute("aria-owns")&&_n.setAttribute("aria-expanded","true"),kn=!0;break;case"Home":ln[0].focus(),kn=!0;break;case"End":{const On=ln[ln.length-1];On.offsetParent?On.focus():(Ln=vn(On).previousNode())==null||Ln.focus(),kn=!0;break}}kn&&(wn.preventDefault(),wn.stopPropagation())});return{element:sn,setCurrentHref:gn}},tree=Object.freeze(Object.defineProperty({__proto__:null,createTOCView},Symbol.toStringTag,{value:"Module"}));let pdfjsLib=null;async function loadPDFJS(){return pdfjsLib||(pdfjsLib=await import("/stage/protyle/js/pdf/pdf.min.mjs"),pdfjsLib.GlobalWorkerOptions.workerSrc="/stage/protyle/js/pdf/pdf.worker.min.mjs",pdfjsLib)}class PDFViewer{constructor(on){ir(this,"pdf",null);ir(this,"container");ir(this,"scale");ir(this,"rotation",0);ir(this,"viewMode","scroll");ir(this,"pages");ir(this,"rendered",new Set);ir(this,"current",1);ir(this,"onChange");ir(this,"observer");ir(this,"renderQueue",[]);ir(this,"rendering",!1);ir(this,"themeSettings",null);ir(this,"getScale",()=>this.scale);ir(this,"getRotation",()=>this.rotation);ir(this,"getViewMode",()=>this.viewMode);ir(this,"getPDF",()=>this.pdf);ir(this,"getPages",()=>this.pages);ir(this,"getPageCount",()=>{var on;return((on=this.pdf)==null?void 0:on.numPages)||0});this.container=on.container,this.scale=on.scale||1,this.onChange=on.onPageChange,this.pages=markRaw(new Map)}applyTheme(on){this.themeSettings=on;const sn=on.theme==="custom"?on.customTheme:on.theme&&PRESET_THEMES[on.theme]||PRESET_THEMES.default;if(!sn)return;const{visualSettings:ln}=on,cn=sn.bg&&parseInt(sn.bg.replace("#",""),16)<8421504,un=[ln.brightness!==1&&`brightness(${ln.brightness})`,ln.contrast!==1&&`contrast(${ln.contrast})`,ln.sepia>0&&`sepia(${ln.sepia})`,ln.saturate!==1&&`saturate(${ln.saturate})`,(ln.invert||cn)&&"invert(1) hue-rotate(180deg)"].filter(Boolean).join(" "),dn=this.container.style,hn=sn.bgImg,fn=pn=>pn.startsWith("http")||pn.startsWith("/")?pn:`/${pn}`;Object.assign(dn,{color:sn.color,backgroundColor:hn?"transparent":sn.bg,backgroundImage:hn?`url("${fn(hn)}")`:" ",backgroundSize:hn?"cover":"",backgroundPosition:hn?"center":"",backgroundRepeat:hn?"no-repeat":"",filter:un||"none"}),dn.setProperty("--pdf-page-bg",sn.bg),this.container.querySelectorAll(".pdf-page").forEach(pn=>pn.style.background=sn.bg),on.viewMode&&(this.viewMode=on.viewMode)}async open(on){const sn=await loadPDFJS();this.pdf=markRaw(await sn.getDocument({data:on,cMapUrl:"/stage/protyle/js/pdf/cmaps/",cMapPacked:!0,standardFontDataUrl:"/stage/protyle/js/pdf/standard_fonts/",useSystemFonts:!1,disableFontFace:!1,useWorkerFetch:!0,isEvalSupported:!1,maxImageSize:16777216}).promise),this.pages.set(1,markRaw(await this.pdf.getPage(1))),await this.fitWidth(),this.setupScroll()}async createPlaceholders(){if(!this.pdf)return;const on=this.pdf.numPages;this.container.innerHTML="";const sn=this.viewMode==="double",ln=this.viewMode==="single";Object.assign(this.container.style,sn?{display:"flex",flexWrap:"wrap",justifyContent:"center",gap:"20px"}:{display:"block"});const cn=document.createDocumentFragment(),dn=(this.pages.get(1)||await this.pdf.getPage(1)).getViewport({scale:this.scale,rotation:this.rotation});for(let hn=1;hn<=on;hn++){const fn=document.createElement("div");if(fn.className="pdf-page",fn.dataset.page=String(hn),fn.style.cssText=`position:relative;margin:${ln?"0 auto":sn?"0":"20px auto"};width:${dn.width}px;height:${dn.height}px;box-shadow:0 2px 8px #0003;background:var(--pdf-page-bg,#fff)${sn?";flex-shrink:0":""}`,cn.appendChild(fn),ln&&hn<on){const pn=document.createElement("div");pn.style.height="100vh",cn.appendChild(pn)}}this.container.appendChild(cn)}setupLazyLoad(){this.observer=new IntersectionObserver(on=>on.forEach(sn=>{if(sn.isIntersecting){const ln=+sn.target.dataset.page;ln&&!this.rendered.has(ln)&&this.queueRender(ln)}}),{rootMargin:"300px"}),this.container.querySelectorAll(".pdf-page").forEach(on=>this.observer.observe(on))}queueRender(on){this.renderQueue.includes(on)||(this.renderQueue.push(on),this.processQueue())}async processQueue(){this.rendering||!this.renderQueue.length||(this.rendering=!0,await this.renderPage(this.renderQueue.shift()),this.rendering=!1,this.processQueue())}async renderPage(on){const sn=this.container.querySelector(`[data-page="${on}"]`);if(!sn||this.rendered.has(on))return;this.rendered.add(on);let ln=this.pages.get(on);if(!ln&&this.pdf&&(ln=markRaw(await this.pdf.getPage(on)),this.pages.set(on,ln)),!ln)return;const cn=await loadPDFJS(),un=getComputedStyle(sn).getPropertyValue("--pdf-page-bg")||"#fff";sn.style.background=un;const dn=ln.getViewport({scale:this.scale,rotation:this.rotation}),hn=window.devicePixelRatio||1;try{const fn=document.createElement("canvas"),pn=fn.getContext("2d",{alpha:!1,willReadFrequently:!1});fn.width=Math.floor(dn.width*hn),fn.height=Math.floor(dn.height*hn),fn.style.cssText=`width:${dn.width}px;height:${dn.height}px`,await ln.render({canvasContext:pn,viewport:dn,transform:[hn,0,0,hn,0,0],background:un,enableWebGL:!0}).promise,sn.appendChild(fn)}catch(fn){console.error(`[PDF]  ${on}:`,fn),sn.style.background="#fee",sn.innerHTML='<div style="padding:20px;color:#c00"></div>';return}requestIdleCallback(()=>{const fn=document.createElement("div");fn.className="textLayer",fn.style.cssText="position:absolute;inset:0;line-height:1",sn.appendChild(fn),ln.getTextContent().then(pn=>{const gn=ln.getViewport({scale:this.scale,rotation:this.rotation});for(let mn=0,bn=pn.items;mn<bn.length;){const vn=bn[mn];if(!vn.str){mn++;continue}const yn=cn.Util.transform(gn.transform,vn.transform),wn=Math.hypot(yn[2],yn[3]),kn=Math.atan2(yn[1],yn[0]);let _n=vn.str,xn=yn[4]+vn.width*wn,En=mn+1;for(;En<bn.length;En++){const Tn=bn[En];if(!Tn.str)continue;const Bn=cn.Util.transform(gn.transform,Tn.transform),Nn=Math.hypot(Bn[2],Bn[3]);if(Math.abs(Bn[5]-yn[5])>wn*.3||Math.abs(Math.atan2(Bn[1],Bn[0])-kn)>.01||Math.abs(Nn-wn)>wn*.1||Bn[4]-xn>wn*2)break;_n+=Tn.str,xn=Bn[4]+Tn.width*Nn}fn.innerHTML+=`<span style="position:absolute;left:${yn[4]}px;top:${yn[5]}px;font-size:${wn}px;transform:rotate(${kn}rad)translateY(-.8em);transform-origin:0 0;white-space:pre;color:transparent;cursor:text">${_n}</span>`,mn=En}})}),requestIdleCallback(async()=>{const fn=document.createElement("div");fn.className="pdf-annotation-layer",fn.style.cssText="position:absolute;inset:0;pointer-events:none",sn.appendChild(fn),await this.renderLinks(on,sn,ln,dn),this.createInkLayer(on,sn,dn),requestAnimationFrame(()=>{window.dispatchEvent(new CustomEvent("pdf:layer-ready",{detail:{page:on}}))})})}createInkLayer(on,sn,ln){const cn=document.createElement("canvas");cn.className="pdf-ink-layer",cn.dataset.page=String(on),cn.width=ln.width,cn.height=ln.height,cn.style.cssText=`position:absolute;inset:0;width:${ln.width}px;height:${ln.height}px;z-index:10;pointer-events:none`,sn.appendChild(cn);const un=document.createElement("canvas");un.className="pdf-shape-layer",un.dataset.page=String(on),un.width=ln.width,un.height=ln.height,un.style.cssText=`position:absolute;inset:0;width:${ln.width}px;height:${ln.height}px;z-index:11;pointer-events:none`,sn.appendChild(un)}async renderLinks(on,sn,ln,cn){try{const un=await loadPDFJS(),dn=await ln.getAnnotations(),hn=document.createElement("div");hn.className="annotationLayer",hn.style.cssText="position:absolute;inset:0;z-index:10;pointer-events:none";for(const fn of dn){if(fn.subtype!=="Link")continue;const pn=document.createElement("a"),[gn,mn,bn,vn]=un.Util.normalizeRect(fn.rect),[yn,wn]=[cn.convertToViewportPoint(gn,mn),cn.convertToViewportPoint(bn,vn)];pn.style.cssText=`position:absolute;left:${Math.min(yn[0],wn[0])}px;top:${Math.min(yn[1],wn[1])}px;width:${Math.abs(wn[0]-yn[0])}px;height:${Math.abs(wn[1]-yn[1])}px;cursor:pointer;pointer-events:auto`,fn.url?(pn.href=fn.url,pn.target="_blank"):fn.dest&&(pn.href="#",pn.onclick=async kn=>{kn.preventDefault();const _n=typeof fn.dest=="string"?await this.pdf.getDestination(fn.dest):fn.dest;if(_n!=null&&_n[0]){const xn=await this.pdf.getPageIndex(_n[0]);this.goToPage(xn+1)}}),hn.appendChild(pn)}sn.appendChild(hn)}catch{}}setupScroll(){let on;this.container.addEventListener("scroll",()=>{clearTimeout(on),on=setTimeout(()=>{var ln;const sn=this.getCurrentPage();sn!==this.current&&(this.current=sn,(ln=this.onChange)==null||ln.call(this,sn),this.cleanupDistantPages())},100)})}cleanupDistantPages(){this.rendered.forEach(on=>{if(Math.abs(on-this.current)>5){const sn=this.container.querySelector(`[data-page="${on}"]`);sn&&(sn.innerHTML="",sn.style.background=getComputedStyle(sn).getPropertyValue("--pdf-page-bg")||"#fff"),this.rendered.delete(on)}})}getCurrentPage(){var ln;const on=this.container.scrollTop+this.container.clientHeight/2,sn=this.container.querySelectorAll(".pdf-page");for(let cn=0;cn<sn.length;cn++){const un=sn[cn];if(un.offsetTop+un.offsetHeight>on)return cn+1}return((ln=this.pdf)==null?void 0:ln.numPages)||1}getLocation(){var ln;const on=this.getCurrentPage(),sn=((ln=this.pdf)==null?void 0:ln.numPages)||1;return{page:on,total:sn,fraction:(on-1)/sn,scrollTop:this.container.scrollTop}}goToPage(on){var ln;const sn=this.container.querySelector(`[data-page="${on}"]`);sn&&(this.container.scrollTop=sn.offsetTop,this.current=on,(ln=this.onChange)==null||ln.call(this,on),this.renderQueue=[on,...Array.from({length:3},(cn,un)=>[on-1+un,on+1+un]).flat().filter(cn=>{var un;return cn>0&&cn<=((un=this.pdf)==null?void 0:un.numPages)&&cn!==on&&!this.rendered.has(cn)})],this.processQueue())}async setScale(on){this.scale=Math.max(.25,Math.min(5,on)),this.rendered.clear(),await this.createPlaceholders(),this.setupLazyLoad()}async fitWidth(){const on=this.pages.get(1);on&&await this.setScale((this.container.clientWidth-40)/on.getViewport({scale:1}).width)}async fitPage(){const on=this.pages.get(1);if(!on)return;const sn=on.getViewport({scale:1}),ln=(this.container.clientWidth-40)/sn.width,cn=(this.container.clientHeight-40)/sn.height;await this.setScale(Math.min(ln,cn))}async setRotation(on){this.rotation=on,this.rendered.clear(),await this.createPlaceholders(),this.setupLazyLoad()}async setViewMode(on){this.viewMode=on,this.rendered.clear(),await this.createPlaceholders(),this.setupLazyLoad(),on==="double"&&await this.fitPage()}async updateTheme(on){const sn=this.viewMode;if(this.applyTheme(on),sn!==this.viewMode)return await this.setViewMode(this.viewMode);const ln=Array.from(this.rendered);this.rendered.clear();for(const cn of ln){const un=this.container.querySelector(`[data-page="${cn}"]`);un&&(un.innerHTML=""),await this.renderPage(cn)}}async getThumbnail(on,sn=.2){const ln=this.pages.get(on);if(!ln)return"";const cn=ln.getViewport({scale:sn}),un=document.createElement("canvas");return un.width=cn.width,un.height=cn.height,await ln.render({canvasContext:un.getContext("2d"),viewport:cn,canvas:un}).promise,un.toDataURL()}async getOutline(){if(!this.pdf)return[];try{const on=await this.pdf.getOutline()||[],sn=(ln,cn=0)=>ln.flatMap(un=>[{title:un.title,dest:un.dest,level:cn},...un.items?sn(un.items,cn+1):[]]);return Promise.all(sn(on).map(async ln=>{let cn=1;if(ln.dest)try{const un=typeof ln.dest=="string"?await this.pdf.getDestination(ln.dest):ln.dest;un&&(cn=await this.pdf.getPageIndex(un[0])+1)}catch{}return{title:ln.title,pageNumber:cn,level:ln.level}}))}catch{return[]}}destroy(){var on,sn;(on=this.observer)==null||on.disconnect(),(sn=this.pdf)==null||sn.destroy(),this.pages.clear(),this.rendered.clear(),this.container.innerHTML=""}async createView(){const on=this.getPageCount(),sn=()=>this.getCurrentPage(),ln=un=>this.goToPage(sn()+un),cn=[];return{viewer:this,isPdf:!0,pageCount:on,getThumbnail:async un=>cn[un-1]||(cn[un-1]=await this.getThumbnail(un).catch(()=>"")),book:{toc:(await this.getOutline()).map(un=>({label:un.title,href:`#page-${un.pageNumber}`,pageNumber:un.pageNumber,level:un.level}))},goTo:un=>this.goToPage(typeof un=="number"?un:(un==null?void 0:un.pageNumber)||+String(un).replace("#page-","")),lastLocation:{page:1,total:on},nav:{prev:()=>ln(-1),next:()=>ln(1),goLeft:()=>ln(-1),goRight:()=>ln(1)}}}}class PDFSearch{constructor(){ir(this,"pdf",null);ir(this,"matches",[]);ir(this,"current",-1);ir(this,"query","");ir(this,"pageMatches",new Map);ir(this,"pageContents",new Map);ir(this,"extractPromises",new Map);ir(this,"getCurrent",()=>this.current>=0?this.matches[this.current]:null);ir(this,"getCurrentIndex",()=>this.current);ir(this,"getResults",()=>this.matches)}setPDF(on){this.pdf=on,this.pageMatches.clear()}async extractAllText(){if(this.pdf)for(let on=1;on<=this.pdf.numPages;on++)this.getPageText(on)}async getPageText(on){if(this.pageContents.has(on))return this.pageContents.get(on);if(this.extractPromises.has(on))return this.extractPromises.get(on);const sn=(async()=>{try{const ln=document.querySelector(`[data-page="${on}"] .textLayer`);if(ln){const hn=ln.querySelectorAll("span");if(hn.length>0){const fn=Array.from(hn).map(pn=>pn.textContent||"").join("");return this.pageContents.set(on,fn),fn}}if(!this.pdf)return"";const dn=(await(await this.pdf.getPage(on)).getTextContent()).items.map(hn=>hn.str||"").join("");return this.pageContents.set(on,dn),dn}catch(ln){return console.error(` ${on} :`,ln),""}finally{this.extractPromises.delete(on)}})();return this.extractPromises.set(on,sn),sn}async search(on){if(console.time("[PDF] "),this.clear(),!on.trim()||!this.pdf)return[];this.query=on.toLowerCase(),console.log("[PDF] :",this.query,":",this.pdf.numPages),console.time("[PDF] ");const sn=[];for(let ln=1;ln<=this.pdf.numPages;ln++)sn.push(this.searchPage(ln));await Promise.all(sn),console.timeEnd("[PDF] "),this.matches=[];for(let ln=1;ln<=this.pdf.numPages;ln++)(this.pageMatches.get(ln)||[]).forEach(un=>this.matches.push({page:ln,index:un}));return console.log("[PDF] :",this.matches.length),this.matches.length>0&&(this.current=0,await this.highlightPage(this.matches[0].page),this.scrollToMatch(this.matches[0])),console.timeEnd("[PDF] "),this.matches}async searchPage(on){try{const sn=(await this.getPageText(on)).toLowerCase(),ln=[];let cn=0;for(;(cn=sn.indexOf(this.query,cn))!==-1;)ln.push(cn),cn+=this.query.length;ln.length>0&&this.pageMatches.set(on,ln)}catch(sn){console.error(` ${on} :`,sn)}}async highlightPage(on){if(document.querySelectorAll(".textLayer mark").forEach(pn=>pn.replaceWith(...pn.childNodes)),!this.query)return;const sn=document.querySelector(`[data-page="${on}"] .textLayer`);if(!sn)return;const ln=Array.from(sn.querySelectorAll("span")),cn=(await this.getPageText(on)).toLowerCase(),un=[];let dn=0;for(;(dn=cn.indexOf(this.query,dn))!==-1;)un.push(dn),dn+=this.query.length;if(un.length===0)return;const hn=[];let fn=0;ln.forEach(pn=>{const gn=pn.textContent||"";hn.push({span:pn,start:fn,end:fn+gn.length}),fn+=gn.length}),un.forEach(pn=>{const gn=pn+this.query.length;hn.forEach(({span:mn,start:bn,end:vn})=>{if(gn<=bn||pn>=vn)return;const yn=mn.textContent||"",wn=Math.max(0,pn-bn),kn=Math.min(yn.length,gn-bn);if(wn>=kn)return;const _n=document.createDocumentFragment();wn>0&&_n.appendChild(document.createTextNode(yn.substring(0,wn)));const xn=document.createElement("mark");xn.className="pdf-search-hl",xn.textContent=yn.substring(wn,kn),_n.appendChild(xn),kn<yn.length&&_n.appendChild(document.createTextNode(yn.substring(kn))),mn.textContent="",mn.appendChild(_n)})}),this.highlightCurrent()}highlightCurrent(){if(document.querySelectorAll(".pdf-search-hl").forEach(dn=>dn.classList.remove("pdf-search-current")),this.current<0||this.current>=this.matches.length)return;const on=this.matches[this.current],sn=document.querySelector(`[data-page="${on.page}"] .textLayer`);if(!sn)return;const ln=sn.querySelectorAll("mark.pdf-search-hl"),un=(this.pageMatches.get(on.page)||[]).indexOf(on.index);un>=0&&un<ln.length&&ln[un].classList.add("pdf-search-current")}scrollToMatch(on){const sn=document.querySelector(`[data-page="${on.page}"]`);sn&&sn.scrollIntoView({behavior:"smooth",block:"center"})}next(){if(!this.matches.length)return null;const on=this.current>=0?this.matches[this.current].page:0;this.current=(this.current+1)%this.matches.length;const sn=this.matches[this.current];return on!==sn.page?this.highlightPage(sn.page):this.highlightCurrent(),this.scrollToMatch(sn),sn}prev(){if(!this.matches.length)return null;const on=this.current>=0?this.matches[this.current].page:0;this.current=(this.current-1+this.matches.length)%this.matches.length;const sn=this.matches[this.current];return on!==sn.page?this.highlightPage(sn.page):this.highlightCurrent(),this.scrollToMatch(sn),sn}clear(){document.querySelectorAll(".textLayer mark").forEach(on=>on.replaceWith(...on.childNodes)),this.matches=[],this.current=-1,this.query="",this.pageMatches.clear()}}const printPDF=async(an,on)=>{const sn=window.open("","_blank");if(sn){sn.document.write("<html><head><title></title><style>body{margin:0}img{display:block;page-break-after:always;width:100%}</style></head><body>");for(const ln of on||Array.from({length:an.numPages},(cn,un)=>un+1)){const cn=await an.getPage(ln),un=cn.getViewport({scale:2}),dn=document.createElement("canvas");dn.width=un.width,dn.height=un.height,await cn.render({canvasContext:dn.getContext("2d"),viewport:un,canvas:dn}).promise,sn.document.write(`<img src="${dn.toDataURL()}"/>`)}sn.document.write("</body></html>"),sn.document.close(),setTimeout(()=>{sn.print(),sn.close()},500)}},downloadPDF=(an,on="document.pdf")=>{const sn=URL.createObjectURL(new Blob([an],{type:"application/pdf"})),ln=document.createElement("a");ln.href=sn,ln.download=on,ln.click(),URL.revokeObjectURL(sn)},exportAsImages=async(an,on="png")=>{const sn=await Promise.resolve().then(()=>jszip_min).then(un=>new un.default);for(let un=1;un<=an.numPages;un++){const dn=await an.getPage(un),hn=dn.getViewport({scale:2}),fn=document.createElement("canvas");fn.width=hn.width,fn.height=hn.height,await dn.render({canvasContext:fn.getContext("2d"),viewport:hn,canvas:fn}).promise,sn.file(`page-${un}.${on}`,await new Promise(pn=>fn.toBlob(gn=>pn(gn),`image/${on}`)))}const ln=URL.createObjectURL(await sn.generateAsync({type:"blob"})),cn=document.createElement("a");cn.href=ln,cn.download="pdf-images.zip",cn.click(),URL.revokeObjectURL(ln)},getMetadata=async(an,on)=>{const sn=await an.getMetadata(),ln=sn.info;return{title:ln.Title||"",author:ln.Author||"",subject:ln.Subject||"",keywords:ln.Keywords||"",creator:ln.Creator||"",producer:ln.Producer||"",creationDate:ln.CreationDate?new Date(ln.CreationDate):void 0,modificationDate:ln.ModDate?new Date(ln.ModDate):void 0,pageCount:an.numPages,fileSize:on,pdfVersion:ln.PDFFormatVersion}},index=Object.freeze(Object.defineProperty({__proto__:null,PDFSearch,PDFViewer,downloadPDF,exportAsImages,getMetadata,printPDF},Symbol.toStringTag,{value:"Module"}));module.exports=PluginSample;
